(()=>{"use strict";var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function n(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function r(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function i(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function s(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function o(t){return this instanceof o?(this.v=t,this):new o(t)}function a(t){return"function"==typeof t}function l(t){var e=t(function(t){Error.call(t),t.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}Object.create,Object.create;var u=l(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}});function c(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var h=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,n,o,l;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var h=r(c),f=h.next();!f.done;f=h.next())f.value.remove(this)}catch(e){t={error:e}}finally{try{f&&!f.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}else c.remove(this);var p=this.initialTeardown;if(a(p))try{p()}catch(t){l=t instanceof u?t.errors:[t]}var y=this._finalizers;if(y){this._finalizers=null;try{for(var g=r(y),v=g.next();!v.done;v=g.next()){var m=v.value;try{d(m)}catch(t){l=null!=l?l:[],t instanceof u?l=s(s([],i(l)),i(t.errors)):l.push(t)}}}catch(t){n={error:t}}finally{try{v&&!v.done&&(o=g.return)&&o.call(g)}finally{if(n)throw n.error}}}if(l)throw new u(l)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)d(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&c(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&c(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t;var e}(),f=h.EMPTY;function p(t){return t instanceof h||t&&"closed"in t&&a(t.remove)&&a(t.add)&&a(t.unsubscribe)}function d(t){a(t)?t():t.unsubscribe()}var y=null,g=null,v=void 0,m=!1,_=!1,w={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=w.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,s([t,e],i(n))):setTimeout.apply(void 0,s([t,e],i(n)))},clearTimeout:function(t){var e=w.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function b(t){w.setTimeout(function(){if(!y)throw t;y(t)})}function x(){}var k=A("C",void 0,void 0);function A(t,e,n){return{kind:t,value:e,error:n}}var S=null;function E(t){if(m){var e=!S;if(e&&(S={errorThrown:!1,error:null}),t(),e){var n=S,r=n.errorThrown,i=n.error;if(S=null,r)throw i}}else t()}var C=function(t){function n(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,p(e)&&e.add(n)):n.destination=$,n}return e(n,t),n.create=function(t,e,n){return new P(t,e,n)},n.prototype.next=function(t){this.isStopped?z(function(t){return A("N",t,void 0)}(t),this):this._next(t)},n.prototype.error=function(t){this.isStopped?z(A("E",void 0,t),this):(this.isStopped=!0,this._error(t))},n.prototype.complete=function(){this.isStopped?z(k,this):(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},n.prototype._next=function(t){this.destination.next(t)},n.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},n.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},n}(h),T=Function.prototype.bind;function I(t,e){return T.call(t,e)}var M=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){O(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){O(t)}else O(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){O(t)}},t}(),P=function(t){function n(e,n,r){var i,s,o=t.call(this)||this;return a(e)||!e?i={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:o&&_?((s=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},i={next:e.next&&I(e.next,s),error:e.error&&I(e.error,s),complete:e.complete&&I(e.complete,s)}):i=e,o.destination=new M(i),o}return e(n,t),n}(C);function O(t){var e;m?(e=t,m&&S&&(S.errorThrown=!0,S.error=e)):b(t)}function z(t,e){var n=g;n&&w.setTimeout(function(){return n(t,e)})}var $={closed:!0,next:x,error:function(t){throw t},complete:x},Z="function"==typeof Symbol&&Symbol.observable||"@@observable";function W(t){return t}var X=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r,i=this,s=(r=t)&&r instanceof C||function(t){return t&&a(t.next)&&a(t.error)&&a(t.complete)}(r)&&p(r)?t:new P(t,e,n);return E(function(){var t=i,e=t.operator,n=t.source;s.add(e?e.call(s,n):n?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=N(e))(function(e,r){var i=new P({next:function(e){try{t(e)}catch(t){r(t),i.unsubscribe()}},error:r,complete:e});n.subscribe(i)})},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[Z]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0===(n=t).length?W:1===n.length?n[0]:function(t){return n.reduce(function(t,e){return e(t)},t)})(this);var n},t.prototype.toPromise=function(t){var e=this;return new(t=N(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}();function N(t){var e;return null!==(e=null!=t?t:v)&&void 0!==e?e:Promise}var D=l(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Y=function(t){function n(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(n,t),n.prototype.lift=function(t){var e=new R(this,this);return e.operator=t,e},n.prototype._throwIfClosed=function(){if(this.closed)throw new D},n.prototype.next=function(t){var e=this;E(function(){var n,i;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var s=r(e.currentObservers),o=s.next();!o.done;o=s.next())o.value.next(t)}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}}})},n.prototype.error=function(t){var e=this;E(function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}})},n.prototype.complete=function(){var t=this;E(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},n.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(n.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),n.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},n.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},n.prototype._innerSubscribe=function(t){var e=this,n=this,r=n.hasError,i=n.isStopped,s=n.observers;return r||i?f:(this.currentObservers=null,s.push(t),new h(function(){e.currentObservers=null,c(s,t)}))},n.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,r=e.thrownError,i=e.isStopped;n?t.error(r):i&&t.complete()},n.prototype.asObservable=function(){var t=new X;return t.source=this,t},n.create=function(t,e){return new R(t,e)},n}(X),R=function(t){function n(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return e(n,t),n.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},n.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},n.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},n.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:f},n}(Y),j=function(t){function n(e){var n=t.call(this)||this;return n._value=e,n}return e(n,t),Object.defineProperty(n.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),n.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return!n.closed&&e.next(this._value),n},n.prototype.getValue=function(){var t=this,e=t.hasError,n=t.thrownError,r=t._value;if(e)throw n;return this._throwIfClosed(),r},n.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},n}(Y),L=function(t){function n(e,n){return t.call(this)||this}return e(n,t),n.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},n}(h),V={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=V.delegate;return(null==o?void 0:o.setInterval)?o.setInterval.apply(o,s([t,e],i(n))):setInterval.apply(void 0,s([t,e],i(n)))},clearInterval:function(t){var e=V.delegate;return((null==e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},B=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return e(n,t),n.prototype.schedule=function(t,e){var n;if(void 0===e&&(e=0),this.closed)return this;this.state=t;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,e)),this.pending=!0,this.delay=e,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,e),this},n.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),V.setInterval(t.flush.bind(t,this),n)},n.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return e;null!=e&&V.clearInterval(e)},n.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},n.prototype._execute=function(t,e){var n,r=!1;try{this.work(t)}catch(t){r=!0,n=t||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},n.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,c(r,this),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},n}(L),F={now:function(){return(F.delegate||Date).now()},delegate:void 0},H=function(){function t(e,n){void 0===n&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(n,e)},t.now=F.now,t}(),K=function(t){function n(e,n){void 0===n&&(n=H.now);var r=t.call(this,e,n)||this;return r.actions=[],r._active=!1,r}return e(n,t),n.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},n}(H),G=new K(B),q=G;function U(t){return t&&a(t.schedule)}function J(t,e,n){void 0===t&&(t=0),void 0===n&&(n=q);var r=-1;return null!=e&&(U(e)?n=e:r=e),new X(function(e){var i,s=(i=t)instanceof Date&&!isNaN(i)?+t-n.now():t;s<0&&(s=0);var o=0;return n.schedule(function(){e.closed||(e.next(o++),0<=r?this.schedule(void 0,r):e.complete())},s)})}function Q(t,e){return void 0===t&&(t=0),void 0===e&&(e=G),t<0&&(t=0),J(t,t,e)}function tt(t){return function(e){if(function(t){return a(null==t?void 0:t.lift)}(e))return e.lift(function(e){try{return t(e,this)}catch(t){this.error(t)}});throw new TypeError("Unable to lift unknown Observable type")}}function et(t,e,n,r,i){return new nt(t,e,n,r,i)}var nt=function(t){function n(e,n,r,i,s,o){var a=t.call(this,e)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=n?function(t){try{n(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=i?function(t){try{i(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=r?function(){try{r()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return e(n,t),n.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},n}(C),rt=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function it(t){return a(null==t?void 0:t.then)}function st(t){return a(t[Z])}function ot(t){return Symbol.asyncIterator&&a(null==t?void 0:t[Symbol.asyncIterator])}function at(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var lt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ut(t){return a(null==t?void 0:t[lt])}function ct(t){return function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),s=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){i[t]&&(r[t]=function(e){return new Promise(function(n,r){s.push([t,e,n,r])>1||l(t,e)})})}function l(t,e){try{(n=i[t](e)).value instanceof o?Promise.resolve(n.value.v).then(u,c):h(s[0][2],n)}catch(t){h(s[0][3],t)}var n}function u(t){l("next",t)}function c(t){l("throw",t)}function h(t,e){t(e),s.shift(),s.length&&l(s[0][0],s[0][1])}}(this,arguments,function(){var e,r,i;return n(this,function(n){switch(n.label){case 0:e=t.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,o(e.read())];case 3:return r=n.sent(),i=r.value,r.done?[4,o(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,o(i)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function ht(t){return a(null==t?void 0:t.getReader)}function ft(t){if(t instanceof X)return t;if(null!=t){if(st(t))return s=t,new X(function(t){var e=s[Z]();if(a(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(rt(t))return e=t,new X(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()});if(it(t))return i=t,new X(function(t){i.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,b)});if(ot(t))return pt(t);if(ut(t))return n=t,new X(function(t){var e,i;try{for(var s=r(n),o=s.next();!o.done;o=s.next()){var a=o.value;if(t.next(a),t.closed)return}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}t.complete()});if(ht(t))return pt(ct(t))}var e,n,i,s;throw at(t)}function pt(t){return new X(function(e){(function(t,e){var i,s,o,a,l,u,c,h;return l=this,u=void 0,h=function(){var l,u;return n(this,function(n){switch(n.label){case 0:n.trys.push([0,5,6,11]),i=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=r(t),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise(function(r,i){!function(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)}(r,i,(e=t[n](e)).done,e.value)})}}}(t),n.label=1;case 1:return[4,i.next()];case 2:if((s=n.sent()).done)return[3,4];if(l=s.value,e.next(l),e.closed)return[2];n.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=n.sent(),o={error:u},[3,11];case 6:return n.trys.push([6,,9,10]),s&&!s.done&&(a=i.return)?[4,a.call(i)]:[3,8];case 7:n.sent(),n.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})},new((c=void 0)||(c=Promise))(function(t,e){function n(t){try{i(h.next(t))}catch(t){e(t)}}function r(t){try{i(h.throw(t))}catch(t){e(t)}}function i(e){var i;e.done?t(e.value):(i=e.value,i instanceof c?i:new c(function(t){t(i)})).then(n,r)}i((h=h.apply(l,u||[])).next())})})(t,e).catch(function(t){return e.error(t)})})}function dt(t){return tt(function(e,n){ft(t).subscribe(et(n,function(){return n.complete()},x)),!n.closed&&e.subscribe(n)})}class yt{constructor(t,e="",n="local"){this._initialConfig=t,this._storageKey=e,this._persistable=!!e,this._storageType=n,this.load()||(this.data=Object.assign({},this._initialConfig)),this.init()}init(){null==window.zetaConfig&&(window.zetaConfig=[]),null==window.zetaConfigCtrl&&(window.zetaConfigCtrl=[]),window.zetaConfig[this._storageKey]=this.data,window.zetaConfigCtrl[this._storageKey]=this,window.addEventListener("beforeunload",()=>{this.save()})}save(){this._persistable?(("local"===this._storageType?localStorage:sessionStorage).setItem(this._storageKey,JSON.stringify(this.data)),console.log(`Configuration ${this._storageKey} saved to ${this._storageType}`)):console.log(`Configuration ${this._storageKey} not persistable`)}load(){if(!this._persistable)return!1;{const t=("local"===this._storageType?localStorage:sessionStorage).getItem(this._storageKey);if(!t)return console.log(`No Configuration ${this._storageKey} found in ${this._storageType}`),!1;try{return this.data=JSON.parse(t),console.log(`Configuration ${this._storageKey} loaded from ${this._storageType}`),!0}catch(t){return console.error("Error loading configuration ${this._storageKey}:",t),!1}}}clear(){("local"===this._storageType?localStorage:sessionStorage).removeItem(this._storageKey),console.log(`Configuration ${this._storageKey} cleared from ${this._storageType}`)}print(){console.log("Current configuration ${this._storageKey}:",this.data)}reset(){this.data=Object.assign({},this._initialConfig),console.log(`Configuration ${this._storageKey} reset ${JSON.stringify(this.data)}`)}}const gt=Math.PI/180;function vt(){return{position:{x:0,y:0,z:-7.5},angleX:45*gt,angleY:45*gt,angleZ:0*gt}}class mt{constructor(){this.state$=new j(vt())}get position(){return this.state$.getValue().position}get angleX(){return this.state$.getValue().angleX}get angleY(){return this.state$.getValue().angleY}get angleZ(){return this.state$.getValue().angleZ}moveX(t){const e=structuredClone(this.state$.getValue());e.position.x+=t,this.state$.next(e)}moveY(t){const e=structuredClone(this.state$.getValue());e.position.y+=t,this.state$.next(e)}moveZ(t){const e=structuredClone(this.state$.getValue());e.position.z+=t,this.state$.next(e)}rotateX(t){const e=structuredClone(this.state$.getValue());e.angleX+=t,this.state$.next(e)}rotateY(t){const e=structuredClone(this.state$.getValue());e.angleY+=t,this.state$.next(e)}rotateZ(t){const e=structuredClone(this.state$.getValue());e.angleZ+=t,this.state$.next(e)}mountCamera(t){const e=structuredClone(t);this.state$.next(e)}}var _t;!function(t){t.W="w",t.A="a",t.S="s",t.D="d",t.R="r",t.F="f",t.Up="ArrowUp",t.Left="ArrowLeft",t.Down="ArrowDown",t.Right="ArrowRight",t.Comma=",",t.Dot="."}(_t||(_t={}));class wt{constructor(t){this._camera=t}onNextEvent(t){switch(t){case _t.W:return this._camera.moveZ(.1),!0;case _t.A:return this._camera.moveX(-.1),!0;case _t.S:return this._camera.moveZ(-.1),!0;case _t.D:return this._camera.moveX(.1),!0;case _t.R:return this._camera.moveY(.1),!0;case _t.F:return this._camera.moveY(-.1),!0;case _t.Up:return this._camera.rotateX(gt),!0;case _t.Left:return this._camera.rotateY(gt),!0;case _t.Down:return this._camera.rotateX(-gt),!0;case _t.Right:return this._camera.rotateY(-gt),!0;case _t.Comma:return this._camera.rotateZ(-gt),!0;case _t.Dot:return this._camera.rotateZ(gt),!0;default:return!1}}}class bt{constructor(){this._listeners=new Map,this._animationClassName="physical-key-pressed-detected",this._animationEndEvent="animationend"}triggerAnimation(t){const e=this.getElementFromKeyValue(t);if(null!=e){const t=()=>{e.classList.remove(this._animationClassName),this._listeners.delete(e)};this.cleanupListener(e),e.classList.remove(this._animationClassName),e.offsetWidth,e.classList.add(this._animationClassName),e.addEventListener(this._animationEndEvent,t,{once:!0}),this._listeners.set(e,t)}}cleanupAll(){this._listeners.forEach((t,e)=>{e.removeEventListener(this._animationEndEvent,t)}),this._listeners.clear()}cleanupListener(t){const e=this._listeners.get(t);e&&(t.removeEventListener(this._animationEndEvent,e),this._listeners.delete(t))}getElementFromKeyValue(t){switch(t){case _t.W:case _t.A:case _t.S:case _t.D:case _t.R:case _t.F:case _t.Up:case _t.Left:case _t.Down:case _t.Right:return document.getElementById(`virtual-key-${t}`);case _t.Comma:return document.getElementById("virtual-key-Comma");case _t.Dot:return document.getElementById("virtual-key-Period");case"Escape":return document.getElementById("virtual-key-Escape");default:return null}}}var xt=new X(function(t){return t.complete()}),kt=Array.isArray,At=Object.getPrototypeOf,St=Object.prototype,Et=Object.keys;function Ct(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function Tt(t,e){return void 0===e&&(e=0),tt(function(n,r){n.subscribe(et(r,function(n){return Ct(r,t,function(){return r.next(n)},e)},function(){return Ct(r,t,function(){return r.complete()},e)},function(n){return Ct(r,t,function(){return r.error(n)},e)}))})}function It(t,e){return void 0===e&&(e=0),tt(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function Mt(t,e){if(!t)throw new Error("Iterable cannot be null");return new X(function(n){Ct(n,e,function(){var r=t[Symbol.asyncIterator]();Ct(n,e,function(){r.next().then(function(t){t.done?n.complete():n.next(t.value)})},0,!0)})})}function Pt(t,e){return e?function(t,e){if(null!=t){if(st(t))return function(t,e){return ft(t).pipe(It(e),Tt(e))}(t,e);if(rt(t))return function(t,e){return new X(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}(t,e);if(it(t))return function(t,e){return ft(t).pipe(It(e),Tt(e))}(t,e);if(ot(t))return Mt(t,e);if(ut(t))return function(t,e){return new X(function(n){var r;return Ct(n,e,function(){r=t[lt](),Ct(n,e,function(){var t,e,i;try{e=(t=r.next()).value,i=t.done}catch(t){return void n.error(t)}i?n.complete():n.next(e)},0,!0)}),function(){return a(null==r?void 0:r.return)&&r.return()}})}(t,e);if(ht(t))return function(t,e){return Mt(ct(t),e)}(t,e)}throw at(t)}(t,e):ft(t)}function Ot(t,e){return tt(function(n,r){var i=0;n.subscribe(et(r,function(n){r.next(t.call(e,n,i++))}))})}var zt,$t=Array.isArray;function Zt(t){return Ot(function(e){return function(t,e){return $t(e)?t.apply(void 0,s([],i(e))):t(e)}(t,e)})}function Wt(t){return t[t.length-1]}function Xt(t){return U(Wt(t))?t.pop():void 0}function Nt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Xt(t),r=function(t){return a(Wt(t))?t.pop():void 0}(t),i=function(t){if(1===t.length){var e=t[0];if(kt(e))return{args:e,keys:null};if((r=e)&&"object"==typeof r&&At(r)===St){var n=Et(e);return{args:n.map(function(t){return e[t]}),keys:n}}}var r;return{args:t,keys:null}}(t),s=i.args,o=i.keys;if(0===s.length)return Pt([],n);var l=new X(function(t,e,n){return void 0===n&&(n=W),function(r){Dt(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,l=function(i){Dt(e,function(){var l=Pt(t[i],e),u=!1;l.subscribe(et(r,function(t){s[i]=t,u||(u=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},u=0;u<i;u++)l(u)},r)}}(s,n,o?function(t){return function(t,e){return t.reduce(function(t,n,r){return t[n]=e[r],t},{})}(o,t)}:W));return r?l.pipe(Zt(r)):l}function Dt(t,e,n){t?Ct(n,t,e):e()}!function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"}(zt||(zt={}));class Yt{constructor(){this.m=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}static multiply(t,e){let n=new Yt;for(let r=0;r<Yt.SIZE;r++)for(let i=0;i<Yt.SIZE;i++)for(let s=0;s<Yt.SIZE;s++)n.m[r][i]+=t.m[r][s]*e.m[s][i];return n}get det(){let t=this.m;return t[0][0]*t[1][1]*t[2][2]*t[3][3]+t[0][0]*t[1][2]*t[2][3]*t[3][1]+t[0][0]*t[1][3]*t[2][1]*t[3][2]+t[0][1]*t[1][0]*t[2][3]*t[3][2]+t[0][1]*t[1][2]*t[2][0]*t[3][3]+t[0][1]*t[1][3]*t[2][2]*t[3][0]+t[0][2]*t[1][0]*t[2][1]*t[3][3]+t[0][2]*t[1][1]*t[2][3]*t[3][0]+t[0][2]*t[1][3]*t[2][0]*t[3][1]+t[0][3]*t[1][0]*t[2][2]*t[3][1]+t[0][3]*t[1][1]*t[2][0]*t[3][2]+t[0][3]*t[1][2]*t[2][1]*t[3][0]-t[0][0]*t[1][1]*t[2][3]*t[3][2]-t[0][0]*t[1][2]*t[2][1]*t[3][3]-t[0][0]*t[1][3]*t[2][2]*t[3][1]-t[0][1]*t[1][0]*t[2][2]*t[3][3]-t[0][1]*t[1][2]*t[2][3]*t[3][0]-t[0][1]*t[1][3]*t[2][0]*t[3][2]-t[0][2]*t[1][0]*t[2][3]*t[3][1]-t[0][2]*t[1][1]*t[2][0]*t[3][3]-t[0][2]*t[1][3]*t[2][1]*t[3][0]-t[0][3]*t[1][0]*t[2][1]*t[3][2]-t[0][3]*t[1][1]*t[2][2]*t[3][0]-t[0][3]*t[1][2]*t[2][0]*t[3][1]}get inv(){let t=this.det;if(!t)return null;let e=this.m,n=new Yt;return n.m[0][0]=e[1][1]*e[2][2]*e[3][3]+e[1][2]*e[2][3]*e[3][1]+e[1][3]*e[2][1]*e[3][2]-e[1][1]*e[2][3]*e[3][2]-e[1][2]*e[2][1]*e[3][3]-e[1][3]*e[2][2]*e[3][1],n.m[0][1]=e[0][1]*e[2][3]*e[3][2]+e[0][2]*e[2][1]*e[3][3]+e[0][3]*e[2][2]*e[3][1]-e[0][1]*e[2][2]*e[3][3]-e[0][2]*e[2][3]*e[3][1]-e[0][3]*e[2][1]*e[3][2],n.m[0][2]=e[0][1]*e[1][2]*e[3][3]+e[0][2]*e[1][3]*e[3][1]+e[0][3]*e[1][1]*e[3][2]-e[0][1]*e[1][3]*e[3][2]-e[0][2]*e[1][1]*e[3][3]-e[0][3]*e[1][2]*e[3][1],n.m[0][3]=e[0][1]*e[1][3]*e[2][2]+e[0][2]*e[1][1]*e[2][3]+e[0][3]*e[1][2]*e[2][1]-e[0][1]*e[1][2]*e[2][3]-e[0][2]*e[1][3]*e[2][1]-e[0][3]*e[1][1]*e[2][2],n.m[1][0]=e[1][0]*e[2][3]*e[3][2]+e[1][2]*e[2][0]*e[3][3]+e[1][3]*e[2][2]*e[3][0]-e[1][0]*e[2][2]*e[3][3]-e[1][2]*e[2][3]*e[3][0]-e[1][3]*e[2][0]*e[3][2],n.m[1][1]=e[0][0]*e[2][2]*e[3][3]+e[0][2]*e[2][3]*e[3][0]+e[0][3]*e[2][0]*e[3][2]-e[0][0]*e[2][3]*e[3][2]-e[0][2]*e[2][0]*e[3][3]-e[0][3]*e[2][2]*e[3][0],n.m[1][2]=e[0][0]*e[1][3]*e[3][2]+e[0][2]*e[1][0]*e[3][3]+e[0][3]*e[1][2]*e[3][0]-e[0][0]*e[1][2]*e[3][3]-e[0][2]*e[1][3]*e[3][0]-e[0][3]*e[1][0]*e[3][2],n.m[1][3]=e[0][0]*e[1][2]*e[2][3]+e[0][2]*e[1][3]*e[2][0]+e[0][3]*e[1][0]*e[2][2]-e[0][0]*e[1][3]*e[2][2]-e[0][2]*e[1][0]*e[2][3]-e[0][3]*e[1][2]*e[2][0],n.m[2][0]=e[1][0]*e[2][1]*e[3][3]+e[1][1]*e[2][3]*e[3][0]+e[1][3]*e[2][0]*e[3][1]-e[1][0]*e[2][3]*e[3][1]-e[1][1]*e[2][0]*e[3][3]-e[1][3]*e[2][1]*e[3][0],n.m[2][1]=e[0][0]*e[2][3]*e[3][1]+e[0][1]*e[2][0]*e[3][3]+e[0][3]*e[2][1]*e[3][0]-e[0][0]*e[2][1]*e[3][3]-e[0][1]*e[2][3]*e[3][0]-e[0][3]*e[2][0]*e[3][1],n.m[2][2]=e[0][0]*e[1][1]*e[3][3]+e[0][1]*e[1][3]*e[3][0]+e[0][3]*e[1][0]*e[3][1]-e[0][0]*e[1][3]*e[3][1]-e[0][1]*e[1][0]*e[3][3]-e[0][3]*e[1][1]*e[3][0],n.m[2][3]=e[0][0]*e[1][3]*e[2][1]+e[0][1]*e[1][0]*e[2][3]+e[0][3]*e[1][1]*e[2][0]-e[0][0]*e[1][1]*e[2][3]-e[0][1]*e[1][3]*e[2][0]-e[0][3]*e[1][0]*e[2][1],n.m[3][0]=e[1][0]*e[2][2]*e[3][1]+e[1][1]*e[2][0]*e[3][2]+e[1][2]*e[2][1]*e[3][0]-e[1][0]*e[2][1]*e[3][2]-e[1][1]*e[2][2]*e[3][0]-e[1][2]*e[2][0]*e[3][1],n.m[3][1]=e[0][0]*e[2][1]*e[3][2]+e[0][1]*e[2][2]*e[3][0]+e[0][2]*e[2][0]*e[3][1]-e[0][0]*e[2][2]*e[3][1]-e[0][1]*e[2][0]*e[3][2]-e[0][2]*e[2][1]*e[3][0],n.m[3][2]=e[0][0]*e[1][2]*e[3][1]+e[0][1]*e[1][0]*e[3][2]+e[0][2]*e[1][1]*e[3][0]-e[0][0]*e[1][1]*e[3][2]-e[0][1]*e[1][2]*e[3][0]-e[0][2]*e[1][0]*e[3][1],n.m[3][3]=e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[1][0]*e[2][1]-e[0][0]*e[1][2]*e[2][1]-e[0][1]*e[1][0]*e[2][2]-e[0][2]*e[1][1]*e[2][0],n.scalarMultiply(1/t),n}scalarMultiply(t){for(let e=0;e<Yt.SIZE;e++)for(let n=0;n<Yt.SIZE;n++)this.m[e][n]*=t}vectorMultiply(t){let e,n=[t.x,t.y,t.z,1],r=[];for(let t=0;t<Yt.SIZE;t++){e=0;for(let r=0;r<Yt.SIZE;r++)e+=this.m[t][r]*n[r];r.push(e)}return{x:r[0],y:r[1],z:r[2]}}log(){let t="";for(let e=0;e<Yt.SIZE;e++){for(let n=0;n<Yt.SIZE;n++)t+=this.m[e][n].toFixed(5)+" ";t+="\n"}console.log(t)}}Yt.SIZE=4;class Rt extends Yt{constructor(){super();for(let t=0;t<Yt.SIZE;t++)this.m[t][t]=1}}class jt extends Rt{constructor(t,e){super(),this.axis=t,this.angle=e}set angle(t){const e=Math.cos(t),n=Math.sin(t);switch(this.axis){case zt.X:this.m[1][1]=e,this.m[1][2]=-n,this.m[2][1]=n,this.m[2][2]=e;break;case zt.Y:this.m[0][0]=e,this.m[0][2]=n,this.m[2][0]=-n,this.m[2][2]=e;break;case zt.Z:this.m[0][0]=e,this.m[0][1]=-n,this.m[1][0]=n,this.m[1][1]=e}}}class Lt extends Rt{constructor(t){super(),this.vector=t}set vector(t){this.m[0][3]=t.x,this.m[1][3]=t.y,this.m[2][3]=t.z}set x(t){this.m[0][3]=t}set y(t){this.m[1][3]=t}set z(t){this.m[2][3]=t}}const Vt=new class{constructor(t,e){this.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",this.list=new Set,this.partSize=t,this.parts=e}newId(t){let e=this.createCandidate(t),n=0;for(;this.exists(e);)if(console.warn(`Candidate ${e} already exists. Retry.`),e=this.createCandidate(t),n++,n>10)return console.error("Could not create a unique id, returning empty string",this.list),"";return this.list.add(e),e}createCandidate(t){for(let e=0;e<this.parts;e++)t+=`_${this.createPart()}`;return t}createPart(){return[...Array(this.partSize).keys()].map(()=>this.getRandomChar()).join("")}getRandomChar(){return this.CHARS.charAt(Math.floor(Math.random()*this.CHARS.length))}exists(t){return this.list.has(t)}}(4,2);var Bt;!function(t){t.CIRCLE="CIRCLE",t.RECTANGLE="RECTANGLE",t.PATH="PATH",t.TEXT="TEXT"}(Bt||(Bt={}));class Ft{constructor(){this._visibility=!0}get isVisible(){return this._visibility}set visible(t){this._visibility=t}}class Ht extends Ft{constructor(t,e,n,r){super(),this.id=Vt.newId(Bt.CIRCLE),this.type=Bt.CIRCLE,this.attr={cx:t,cy:e,r:n},this.style=r}setPosition(t,e,n){this.attr.cx=t,this.attr.cy=e,this.attr.r=n}}class Kt{}class Gt extends Kt{constructor(t,e=1,n={strokeWidth:.15,stroke:"#aaa",strokeOpacity:1,fill:"#ddd",fillOpacity:1}){super(),this.position=t,this.radius=e,this.style=n}get position(){return this._position}set position(t){this._position=t}get radius(){return this._radius}set radius(t){this._radius=t}get style(){return this._style}set style(t){this._style=t}get attributes(){return{position:structuredClone(this._position),radius:this._radius,style:structuredClone(this._style)}}}class qt extends Ft{constructor(t,e){super(),this.id=Vt.newId(Bt.PATH),this.type=Bt.PATH,this.attr={d:t},this.style=e}setPath(t){this.attr.d=t}}class Ut extends Kt{constructor(t,e=!1,n={strokeWidth:1.5,stroke:"#aaa",strokeOpacity:1}){super(),this.path=t,this._close=e,this.style=n}get path(){return this._path}set path(t){this._path=t}get style(){return this._style}set style(t){this._style=t}get attributes(){return{path:structuredClone(this._path),close:this._close,style:structuredClone(this._style)}}}class Jt extends Ft{constructor(t,e){super(),this.id=Vt.newId(Bt.RECTANGLE),this.type=Bt.RECTANGLE,this.attr={d:t},this.style=e}setPath(t){this.attr.d=t}}class Qt{constructor(){this.m=[[0,0,0],[0,0,0],[0,0,0]]}static multiply(t,e){let n=new Qt;for(let r=0;r<Qt.SIZE;r++)for(let i=0;i<Qt.SIZE;i++)for(let s=0;s<Qt.SIZE;s++)n.m[r][i]+=t.m[r][s]*e.m[s][i];return n}scalarMultiply(t){for(let e=0;e<Qt.SIZE;e++)for(let n=0;n<Qt.SIZE;n++)this.m[e][n]*=t}vectorMultiply(t){let e,n=[t.x,t.y,t.z,1],r=[];for(let t=0;t<Qt.SIZE;t++){e=0;for(let r=0;r<Qt.SIZE;r++)e+=this.m[t][r]*n[r];r.push(e)}return{x:r[0],y:r[1],z:r[2]}}log(){let t="";for(let e=0;e<Qt.SIZE;e++){for(let n=0;n<Qt.SIZE;n++)t+=this.m[e][n].toFixed(5)+" ";t+="\n"}console.log(t)}}Qt.SIZE=3;class te extends Qt{constructor(){super();for(let t=0;t<Qt.SIZE;t++)this.m[t][t]=1}}class ee extends te{constructor(t,e){super(),this.axis=t,this.angle=e}set angle(t){const e=Math.cos(t),n=Math.sin(t);switch(this.axis){case zt.X:this.m[1][1]=e,this.m[1][2]=-n,this.m[2][1]=n,this.m[2][2]=e;break;case zt.Y:this.m[0][0]=e,this.m[0][2]=n,this.m[2][0]=-n,this.m[2][2]=e;break;case zt.Z:this.m[0][0]=e,this.m[0][1]=-n,this.m[1][0]=n,this.m[1][1]=e}}}class ne extends Kt{constructor(t,e,n,r={rotateX:0,rotateY:0,rotateZ:0},i={strokeWidth:1.5,stroke:"#aaa",strokeOpacity:1,fill:"#ddd",fillOpacity:1}){super(),this._position=t,this._width=e,this._height=n,this._rotateX=r.rotateX*gt,this._rotateY=r.rotateY*gt,this._rotateZ=r.rotateZ*gt,this._style=i,this.evaluatePath()}set position(t){this._position=t,this.evaluatePath()}set width(t){this._width=t,this.evaluatePath()}set height(t){this._height=t,this.evaluatePath()}get orientation(){return{rotateX:this._rotateX/gt,rotateY:this._rotateY/gt,rotateZ:this._rotateZ/gt}}set orientation(t){this._rotateX=t.rotateX*gt,this._rotateY=t.rotateY*gt,this._rotateZ=t.rotateZ*gt,this.evaluatePath()}set style(t){this._style=t}get attributes(){return{path:structuredClone(this._path),style:structuredClone(this._style)}}evaluatePath(){const t=new ee(zt.X,this._rotateX),e=new ee(zt.Y,this._rotateY),n=new ee(zt.Z,this._rotateZ);let r=new te;r=Qt.multiply(r,n),r=Qt.multiply(r,e),r=Qt.multiply(r,t);const i=this._width/2,s=this._height/2,o=[{x:-i,y:s,z:0},{x:i,y:s,z:0},{x:i,y:-s,z:0},{x:-i,y:-s,z:0}];this._path=o.map(t=>{return e=r.vectorMultiply(t),n=this._position,{x:e.x+n.x,y:e.y+n.y,z:e.z+n.z};var e,n})}}var re=function(t){function n(e,n,r){void 0===e&&(e=1/0),void 0===n&&(n=1/0),void 0===r&&(r=F);var i=t.call(this)||this;return i._bufferSize=e,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,e),i._windowTime=Math.max(1,n),i}return e(n,t),n.prototype.next=function(e){var n=this,r=n.isStopped,i=n._buffer,s=n._infiniteTimeWindow,o=n._timestampProvider,a=n._windowTime;r||(i.push(e),!s&&i.push(o.now()+a)),this._trimBuffer(),t.prototype.next.call(this,e)},n.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(t),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!t.closed;i+=n?1:2)t.next(r[i]);return this._checkFinalizedStatuses(t),e},n.prototype._trimBuffer=function(){var t=this,e=t._bufferSize,n=t._timestampProvider,r=t._buffer,i=t._infiniteTimeWindow,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){for(var o=n.now(),a=0,l=1;l<r.length&&r[l]<=o;l+=2)a=l;a&&r.splice(0,a+1)}},n}(Y);class ie{constructor(t,e){this._collection$=new re(1),this.collection$=this._collection$,this.id=Vt.newId(t),this._collection=e,this.emitList()}update(t){t(this._collection),this.emitList()}emitList(){this._collection$.next(this._collection)}}class se extends Ft{constructor(t,e,n,r,i){super(),this.id=Vt.newId(Bt.TEXT),this.type=Bt.TEXT,this.attr={x:t,y:e,fontSize:n,text:r},this.style=i}setPosition(t,e,n){this.attr.x=t,this.attr.y=e,this.attr.fontSize=n}setText(t){this.attr.text=t}}class oe extends Kt{constructor(t,e,n={fontSize:12,fontFamily:"sans-serif",fill:"#666",fillOpacity:1,alignmentBaseline:"baseline"}){super(),this.position=t,this.text=e,this.style=n}get position(){return this._position}set position(t){this._position=t}get text(){return this._text}set text(t){this._text=t}get style(){return this._style}set style(t){this._style=t}get attributes(){return{position:structuredClone(this._position),text:this._text,style:structuredClone(this._style)}}}class ae{static spaceToPlane(t){if(t.z<1)return{x:0,y:0};const e=1/t.z;return{x:e*t.x,y:e*t.y}}static distanceToCamera(t){return t.z<1?-1:1*(30-t.z)/(29*t.z)}static planeToPixel(t){return{left:640*t.x*.5625+640,top:-360*t.y+360}}static spaceToPixel(t){return ae.planeToPixel(ae.spaceToPlane(t))}constructor(t,e){var n,r,i;this._world=t,this._camera=e,this._world.state$.pipe(tt(function(t,e){var n=0;t.subscribe(et(e,function(t){++n<=1&&(e.next(t),1<=n&&e.complete())}))})).subscribe(t=>{this.createShapes(this.createData(t))}),Nt([this._world.state$,this._camera.state$]).pipe((n=40,void 0===r&&(r=G),i=Q(n,r),tt(function(t,e){var n=!1,r=null;t.subscribe(et(e,function(t){n=!0,r=t})),ft(i).subscribe(et(e,function(){if(n){n=!1;var t=r;r=null,e.next(t)}},x))}))).subscribe(t=>{this.updateShapes(this.createData(t[0]))})}get shapes(){return this._shapes}createData(t){const e=new jt(zt.X,this._camera.angleX),n=new jt(zt.Y,this._camera.angleY),r=new jt(zt.Z,this._camera.angleZ),i=new Lt(this._camera.position);let s=new Rt;s=Yt.multiply(s,r),s=Yt.multiply(s,n),s=Yt.multiply(s,e),s=Yt.multiply(s,i),s=s.inv;let o=t.circles.map(t=>{let e=s.vectorMultiply(t.position);return{pixel:ae.spaceToPixel(e),dist:ae.distanceToCamera(e),position:{x:t.position.x,y:t.position.y,z:t.position.z},radius:t.radius,style:t.style}});return o.sort((t,e)=>t.dist-e.dist),{circles:o,paths:t.paths.map(t=>{let e=ae.spaceToPixel(s.vectorMultiply(t.path[0])),n=ae.distanceToCamera(s.vectorMultiply(t.path[0])),r="M"+e.left+" "+e.top+" ";for(let i=1;i<t.path.length;i++){e=ae.spaceToPixel(s.vectorMultiply(t.path[i]));let o=ae.distanceToCamera(s.vectorMultiply(t.path[i]));n=Math.min(n,o),r+="L"+e.left+" "+e.top+" "}return{path:t.path,close:t.close,d:t.close?r+"Z":r,dist:n,style:t.style}}),rectangles:t.rectangles.map(t=>{let e=ae.spaceToPixel(s.vectorMultiply(t.path[0])),n=ae.distanceToCamera(s.vectorMultiply(t.path[0])),r="M"+e.left+" "+e.top+" ";for(let i=1;i<t.path.length;i++){e=ae.spaceToPixel(s.vectorMultiply(t.path[i]));let o=ae.distanceToCamera(s.vectorMultiply(t.path[i]));n=Math.min(n,o),r+="L"+e.left+" "+e.top+" "}return{path:t.path,d:r+"Z",dist:n,style:t.style}}),texts:t.texts.map(t=>{let e=s.vectorMultiply(t.position);return{pixel:ae.spaceToPixel(e),dist:ae.distanceToCamera(e),position:{x:t.position.x,y:t.position.y,z:t.position.z},text:t.text,style:t.style}})}}createShapes(t){this._shapes=new ie("PRJ",{circles:t.circles.map(t=>new Ht(t.pixel.left,t.pixel.top,this.getDistantDependentValue(t.radius,t.dist),{strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity,fill:t.style.fill,fillOpacity:t.style.fillOpacity})),paths:t.paths.map(t=>new qt(t.d,{strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity})),rectangles:t.rectangles.map(t=>new Jt(t.d,{strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity,fill:t.style.fill,fillOpacity:t.style.fillOpacity})),texts:t.texts.map(t=>new se(t.pixel.left,t.pixel.top,this.getDistantDependentValue(t.style.fontSize,t.dist),t.text,t.style))})}updateShapes(t){this._shapes.update(e=>{e.circles.forEach((e,n)=>{let r=t.circles[n];e.setPosition(r.pixel.left,r.pixel.top,this.getDistantDependentValue(r.radius,r.dist)),e.style={strokeWidth:this.getDistantDependentValue(r.style.strokeWidth,r.dist),stroke:r.style.stroke,strokeOpacity:r.style.strokeOpacity,fill:r.style.fill,fillOpacity:r.style.fillOpacity},e.visible=r.dist>0}),e.paths.forEach((e,n)=>{let r=t.paths[n];e.setPath(r.d),e.style={strokeWidth:this.getDistantDependentValue(r.style.strokeWidth,r.dist),stroke:r.style.stroke,strokeOpacity:r.style.strokeOpacity},e.visible=r.dist>0}),e.rectangles.forEach((e,n)=>{let r=t.rectangles[n];e.setPath(r.d),e.style={strokeWidth:this.getDistantDependentValue(r.style.strokeWidth,r.dist),stroke:r.style.stroke,strokeOpacity:r.style.strokeOpacity,fill:r.style.fill,fillOpacity:r.style.fillOpacity},e.visible=r.dist>0}),e.texts.forEach((e,n)=>{let r=t.texts[n];e.setPosition(r.pixel.left,r.pixel.top,this.getDistantDependentValue(r.style.fontSize,r.dist)),e.style=r.style,e.visible=r.dist>0,e.setText(r.text)})})}getDistantDependentValue(t,e){return e>0?t*e*20:0}}function le(){}function ue(t){return null==t?le:function(){return this.querySelector(t)}}function ce(){return[]}function he(t){return null==t?ce:function(){return this.querySelectorAll(t)}}function fe(t){return function(){return this.matches(t)}}function pe(t){return function(e){return e.matches(t)}}var de=Array.prototype.find;function ye(){return this.firstElementChild}var ge=Array.prototype.filter;function ve(){return Array.from(this.children)}function me(t){return new Array(t.length)}function _e(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function we(t,e,n,r,i,s){for(var o,a=0,l=e.length,u=s.length;a<u;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):n[a]=new _e(t,s[a]);for(;a<l;++a)(o=e[a])&&(i[a]=o)}function be(t,e,n,r,i,s,o){var a,l,u,c=new Map,h=e.length,f=s.length,p=new Array(h);for(a=0;a<h;++a)(l=e[a])&&(p[a]=u=o.call(l,l.__data__,a,e)+"",c.has(u)?i[a]=l:c.set(u,l));for(a=0;a<f;++a)u=o.call(t,s[a],a,s)+"",(l=c.get(u))?(r[a]=l,l.__data__=s[a],c.delete(u)):n[a]=new _e(t,s[a]);for(a=0;a<h;++a)(l=e[a])&&c.get(p[a])===l&&(i[a]=l)}function xe(t){return t.__data__}function ke(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Ae(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}_e.prototype={constructor:_e,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var Se="http://www.w3.org/1999/xhtml";const Ee={svg:"http://www.w3.org/2000/svg",xhtml:Se,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ce(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),Ee.hasOwnProperty(e)?{space:Ee[e],local:t}:t}function Te(t){return function(){this.removeAttribute(t)}}function Ie(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Me(t,e){return function(){this.setAttribute(t,e)}}function Pe(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Oe(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function ze(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function $e(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ze(t){return function(){this.style.removeProperty(t)}}function We(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Xe(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Ne(t,e){return t.style.getPropertyValue(e)||$e(t).getComputedStyle(t,null).getPropertyValue(e)}function De(t){return function(){delete this[t]}}function Ye(t,e){return function(){this[t]=e}}function Re(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function je(t){return t.trim().split(/^|\s+/)}function Le(t){return t.classList||new Ve(t)}function Ve(t){this._node=t,this._names=je(t.getAttribute("class")||"")}function Be(t,e){for(var n=Le(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Fe(t,e){for(var n=Le(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function He(t){return function(){Be(this,t)}}function Ke(t){return function(){Fe(this,t)}}function Ge(t,e){return function(){(e.apply(this,arguments)?Be:Fe)(this,t)}}function qe(){this.textContent=""}function Ue(t){return function(){this.textContent=t}}function Je(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Qe(){this.innerHTML=""}function tn(t){return function(){this.innerHTML=t}}function en(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function nn(){this.nextSibling&&this.parentNode.appendChild(this)}function rn(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function sn(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Se&&e.documentElement.namespaceURI===Se?e.createElement(t):e.createElementNS(n,t)}}function on(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function an(t){var e=Ce(t);return(e.local?on:sn)(e)}function ln(){return null}function un(){var t=this.parentNode;t&&t.removeChild(this)}function cn(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function hn(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function fn(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,s=e.length;r<s;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function pn(t,e,n){return function(){var r,i=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),void(r.value=e);this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function dn(t,e,n){var r=$e(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function yn(t,e){return function(){return dn(this,t,e)}}function gn(t,e){return function(){return dn(this,t,e.apply(this,arguments))}}Ve.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var vn=[null];function mn(t,e){this._groups=t,this._parents=e}function _n(){return new mn([[document.documentElement]],vn)}mn.prototype=_n.prototype={constructor:mn,select:function(t){"function"!=typeof t&&(t=ue(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o,a=e[i],l=a.length,u=r[i]=new Array(l),c=0;c<l;++c)(s=a[c])&&(o=t.call(s,s.__data__,c,a))&&("__data__"in s&&(o.__data__=s.__data__),u[c]=o);return new mn(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):he(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o,a=e[s],l=a.length,u=0;u<l;++u)(o=a[u])&&(r.push(t.call(o,o.__data__,u,a)),i.push(o));return new mn(r,i)},selectChild:function(t){return this.select(null==t?ye:function(t){return function(){return de.call(this.children,t)}}("function"==typeof t?t:pe(t)))},selectChildren:function(t){return this.selectAll(null==t?ve:function(t){return function(){return ge.call(this.children,t)}}("function"==typeof t?t:pe(t)))},filter:function(t){"function"!=typeof t&&(t=fe(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o=e[i],a=o.length,l=r[i]=[],u=0;u<a;++u)(s=o[u])&&t.call(s,s.__data__,u,o)&&l.push(s);return new mn(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,xe);var n,r=e?be:we,i=this._parents,s=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=s.length,a=new Array(o),l=new Array(o),u=new Array(o),c=0;c<o;++c){var h=i[c],f=s[c],p=f.length,d=ke(t.call(h,h&&h.__data__,c,i)),y=d.length,g=l[c]=new Array(y),v=a[c]=new Array(y);r(h,f,g,v,u[c]=new Array(p),d,e);for(var m,_,w=0,b=0;w<y;++w)if(m=g[w]){for(w>=b&&(b=w+1);!(_=v[b])&&++b<y;);m._next=_||null}}return(a=new mn(a,i))._enter=l,a._exit=u,a},enter:function(){return new mn(this._enter||this._groups.map(me),this._parents)},exit:function(){return new mn(this._exit||this._groups.map(me),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,s=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?s.remove():n(s),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var u,c=n[l],h=r[l],f=c.length,p=a[l]=new Array(f),d=0;d<f;++d)(u=c[d]||h[d])&&(p[d]=u);for(;l<i;++l)a[l]=n[l];return new mn(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],s=i.length-1,o=i[s];--s>=0;)(r=i[s])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Ae);for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o,a=n[s],l=a.length,u=i[s]=new Array(l),c=0;c<l;++c)(o=a[c])&&(u[c]=o);u.sort(e)}return new mn(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,s=e[n],o=0,a=s.length;o<a;++o)(i=s[o])&&t.call(i,i.__data__,o,s);return this},attr:function(t,e){var n=Ce(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?Ie:Te:"function"==typeof e?n.local?ze:Oe:n.local?Pe:Me)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?Ze:"function"==typeof e?Xe:We)(t,e,null==n?"":n)):Ne(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?De:"function"==typeof e?Re:Ye)(t,e)):this.node()[t]},classed:function(t,e){var n=je(t+"");if(arguments.length<2){for(var r=Le(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?Ge:e?He:Ke)(n,e))},text:function(t){return arguments.length?this.each(null==t?qe:("function"==typeof t?Je:Ue)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Qe:("function"==typeof t?en:tn)(t)):this.node().innerHTML},raise:function(){return this.each(nn)},lower:function(){return this.each(rn)},append:function(t){var e="function"==typeof t?t:an(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:an(t),r=null==e?ln:"function"==typeof e?e:ue(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(un)},clone:function(t){return this.select(t?hn:cn)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,s=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?pn:fn,r=0;r<o;++r)this.each(a(s[r],e,n));return this}var a=this.node().__on;if(a)for(var l,u=0,c=a.length;u<c;++u)for(r=0,l=a[u];r<o;++r)if((i=s[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?gn:yn)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],s=0,o=i.length;s<o;++s)(r=i[s])&&(yield r)}};const wn=_n;var bn={value:()=>{}};function xn(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new kn(r)}function kn(t){this._=t}function An(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function Sn(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=bn,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}kn.prototype=xn.prototype={constructor:kn,on:function(t,e){var n,r,i=this._,s=(r=i,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),o=-1,a=s.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=s[o]).type)i[n]=Sn(i[n],t.name,e);else if(null==e)for(n in i)i[n]=Sn(i[n],t.name,null);return this}for(;++o<a;)if((n=(t=s[o]).type)&&(n=An(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new kn(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(r=this._[t]).length;s<n;++s)r[s].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};const En=xn;var Cn,Tn,In=0,Mn=0,Pn=0,On=0,zn=0,$n=0,Zn="object"==typeof performance&&performance.now?performance:Date,Wn="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Xn(){return zn||(Wn(Nn),zn=Zn.now()+$n)}function Nn(){zn=0}function Dn(){this._call=this._time=this._next=null}function Yn(t,e,n){var r=new Dn;return r.restart(t,e,n),r}function Rn(){zn=(On=Zn.now())+$n,In=Mn=0;try{!function(){Xn(),++In;for(var t,e=Cn;e;)(t=zn-e._time)>=0&&e._call.call(void 0,t),e=e._next;--In}()}finally{In=0,function(){for(var t,e,n=Cn,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Cn=e);Tn=t,Ln(r)}(),zn=0}}function jn(){var t=Zn.now(),e=t-On;e>1e3&&($n-=e,On=t)}function Ln(t){In||(Mn&&(Mn=clearTimeout(Mn)),t-zn>24?(t<1/0&&(Mn=setTimeout(Rn,t-Zn.now()-$n)),Pn&&(Pn=clearInterval(Pn))):(Pn||(On=Zn.now(),Pn=setInterval(jn,1e3)),In=1,Wn(Rn)))}function Vn(t,e,n){var r=new Dn;return e=null==e?0:+e,r.restart(n=>{r.stop(),t(n+e)},e,n),r}Dn.prototype=Yn.prototype={constructor:Dn,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Xn():+n)+(null==e?0:+e),this._next||Tn===this||(Tn?Tn._next=this:Cn=this,Tn=this),this._call=t,this._time=n,Ln()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ln())}};var Bn=En("start","end","cancel","interrupt"),Fn=[];function Hn(t,e,n,r,i,s){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function s(l){var u,c,h,f;if(1!==n.state)return a();for(u in i)if((f=i[u]).name===n.name){if(3===f.state)return Vn(s);4===f.state?(f.state=6,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete i[u]):+u<e&&(f.state=6,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete i[u])}if(Vn(function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(l))}),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),u=0,c=-1;u<h;++u)(f=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++c]=f);r.length=c+1}}function o(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(a),n.state=5,1),s=-1,o=r.length;++s<o;)r[s].call(t,i);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){for(var r in n.state=6,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=Yn(function(t){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=t&&s(t-n.delay)},0,n.time)}(t,n,{name:e,index:r,group:i,on:Bn,tween:Fn,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function Kn(t,e){var n=qn(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Gn(t,e){var n=qn(t,e);if(n.state>3)throw new Error("too late; already running");return n}function qn(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Un(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Jn,Qn=180/Math.PI,tr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function er(t,e,n,r,i,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),t*r<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*Qn,skewX:Math.atan(l)*Qn,scaleX:o,scaleY:a}}function nr(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],l=[];return s=t(s),o=t(o),function(t,r,i,s,o,a){if(t!==i||r!==s){var l=o.push("translate(",null,e,null,n);a.push({i:l-4,x:Un(t,i)},{i:l-2,x:Un(r,s)})}else(i||s)&&o.push("translate("+i+e+s+n)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(t,e,n,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Un(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(s.rotate,o.rotate,a,l),function(t,e,n,s){t!==e?s.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Un(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(s.skewX,o.skewX,a,l),function(t,e,n,r,s,o){if(t!==n||e!==r){var a=s.push(i(s)+"scale(",null,",",null,")");o.push({i:a-4,x:Un(t,n)},{i:a-2,x:Un(e,r)})}else 1===n&&1===r||s.push(i(s)+"scale("+n+","+r+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(t){for(var e,n=-1,r=l.length;++n<r;)a[(e=l[n]).i]=e.x(t);return a.join("")}}}var rr=nr(function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?tr:er(e.a,e.b,e.c,e.d,e.e,e.f)},"px, ","px)","deg)"),ir=nr(function(t){return null==t?tr:(Jn||(Jn=document.createElementNS("http://www.w3.org/2000/svg","g")),Jn.setAttribute("transform",t),(t=Jn.transform.baseVal.consolidate())?er((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):tr)},", ",")",")");function sr(t,e){var n,r;return function(){var i=Gn(this,t),s=i.tween;if(s!==n)for(var o=0,a=(r=n=s).length;o<a;++o)if(r[o].name===e){(r=r.slice()).splice(o,1);break}i.tween=r}}function or(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var s=Gn(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:e,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===e){i[l]=a;break}l===u&&i.push(a)}s.tween=i}}function ar(t,e,n){var r=t._id;return t.each(function(){var t=Gn(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return qn(t,r).value[e]}}function lr(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function ur(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function cr(){}var hr=.7,fr=1/hr,pr="\\s*([+-]?\\d+)\\s*",dr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",yr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gr=/^#([0-9a-f]{3,8})$/,vr=new RegExp(`^rgb\\(${pr},${pr},${pr}\\)$`),mr=new RegExp(`^rgb\\(${yr},${yr},${yr}\\)$`),_r=new RegExp(`^rgba\\(${pr},${pr},${pr},${dr}\\)$`),wr=new RegExp(`^rgba\\(${yr},${yr},${yr},${dr}\\)$`),br=new RegExp(`^hsl\\(${dr},${yr},${yr}\\)$`),xr=new RegExp(`^hsla\\(${dr},${yr},${yr},${dr}\\)$`),kr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ar(){return this.rgb().formatHex()}function Sr(){return this.rgb().formatRgb()}function Er(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=gr.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Cr(e):3===n?new Mr(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Tr(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Tr(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=vr.exec(t))?new Mr(e[1],e[2],e[3],1):(e=mr.exec(t))?new Mr(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=_r.exec(t))?Tr(e[1],e[2],e[3],e[4]):(e=wr.exec(t))?Tr(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=br.exec(t))?Wr(e[1],e[2]/100,e[3]/100,1):(e=xr.exec(t))?Wr(e[1],e[2]/100,e[3]/100,e[4]):kr.hasOwnProperty(t)?Cr(kr[t]):"transparent"===t?new Mr(NaN,NaN,NaN,0):null}function Cr(t){return new Mr(t>>16&255,t>>8&255,255&t,1)}function Tr(t,e,n,r){return r<=0&&(t=e=n=NaN),new Mr(t,e,n,r)}function Ir(t,e,n,r){return 1===arguments.length?((i=t)instanceof cr||(i=Er(i)),i?new Mr((i=i.rgb()).r,i.g,i.b,i.opacity):new Mr):new Mr(t,e,n,null==r?1:r);var i}function Mr(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Pr(){return`#${Zr(this.r)}${Zr(this.g)}${Zr(this.b)}`}function Or(){const t=zr(this.opacity);return`${1===t?"rgb(":"rgba("}${$r(this.r)}, ${$r(this.g)}, ${$r(this.b)}${1===t?")":`, ${t})`}`}function zr(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function $r(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Zr(t){return((t=$r(t))<16?"0":"")+t.toString(16)}function Wr(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Nr(t,e,n,r)}function Xr(t){if(t instanceof Nr)return new Nr(t.h,t.s,t.l,t.opacity);if(t instanceof cr||(t=Er(t)),!t)return new Nr;if(t instanceof Nr)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(o=e===s?(n-r)/a+6*(n<r):n===s?(r-e)/a+2:(e-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new Nr(o,a,l,t.opacity)}function Nr(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Dr(t){return(t=(t||0)%360)<0?t+360:t}function Yr(t){return Math.max(0,Math.min(1,t||0))}function Rr(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function jr(t,e,n,r,i){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*n+(1+3*t+3*s-3*o)*r+o*i)/6}lr(cr,Er,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Ar,formatHex:Ar,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Xr(this).formatHsl()},formatRgb:Sr,toString:Sr}),lr(Mr,Ir,ur(cr,{brighter(t){return t=null==t?fr:Math.pow(fr,t),new Mr(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?hr:Math.pow(hr,t),new Mr(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Mr($r(this.r),$r(this.g),$r(this.b),zr(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Pr,formatHex:Pr,formatHex8:function(){return`#${Zr(this.r)}${Zr(this.g)}${Zr(this.b)}${Zr(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Or,toString:Or})),lr(Nr,function(t,e,n,r){return 1===arguments.length?Xr(t):new Nr(t,e,n,null==r?1:r)},ur(cr,{brighter(t){return t=null==t?fr:Math.pow(fr,t),new Nr(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?hr:Math.pow(hr,t),new Nr(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Mr(Rr(t>=240?t-240:t+120,i,r),Rr(t,i,r),Rr(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Nr(Dr(this.h),Yr(this.s),Yr(this.l),zr(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=zr(this.opacity);return`${1===t?"hsl(":"hsla("}${Dr(this.h)}, ${100*Yr(this.s)}%, ${100*Yr(this.l)}%${1===t?")":`, ${t})`}`}}));const Lr=t=>()=>t;function Vr(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):Lr(isNaN(t)?e:t)}const Br=function t(e){var n=function(t){return 1===(t=+t)?Vr:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Lr(isNaN(e)?n:e)}}(e);function r(t,e){var r=n((t=Ir(t)).r,(e=Ir(e)).r),i=n(t.g,e.g),s=n(t.b,e.b),o=Vr(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=s(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function Fr(t){return function(e){var n,r,i=e.length,s=new Array(i),o=new Array(i),a=new Array(i);for(n=0;n<i;++n)r=Ir(e[n]),s[n]=r.r||0,o[n]=r.g||0,a[n]=r.b||0;return s=t(s),o=t(o),a=t(a),r.opacity=1,function(t){return r.r=s(t),r.g=o(t),r.b=a(t),r+""}}}Fr(function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],s=t[r+1],o=r>0?t[r-1]:2*i-s,a=r<e-1?t[r+2]:2*s-i;return jr((n-r/e)*e,o,i,s,a)}}),Fr(function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],s=t[r%e],o=t[(r+1)%e],a=t[(r+2)%e];return jr((n-r/e)*e,i,s,o,a)}});var Hr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Kr=new RegExp(Hr.source,"g");function Gr(t,e){var n,r,i,s=Hr.lastIndex=Kr.lastIndex=0,o=-1,a=[],l=[];for(t+="",e+="";(n=Hr.exec(t))&&(r=Kr.exec(e));)(i=r.index)>s&&(i=e.slice(s,i),a[o]?a[o]+=i:a[++o]=i),(n=n[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:Un(n,r)})),s=Kr.lastIndex;return s<e.length&&(i=e.slice(s),a[o]?a[o]+=i:a[++o]=i),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,r=0;r<e;++r)a[(n=l[r]).i]=n.x(t);return a.join("")})}function qr(t,e){var n;return("number"==typeof e?Un:e instanceof Er?Br:(n=Er(e))?(e=n,Br):Gr)(t,e)}function Ur(t){return function(){this.removeAttribute(t)}}function Jr(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Qr(t,e,n){var r,i,s=n+"";return function(){var o=this.getAttribute(t);return o===s?null:o===r?i:i=e(r=o,n)}}function ti(t,e,n){var r,i,s=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===r?i:i=e(r=o,n)}}function ei(t,e,n){var r,i,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttribute(t))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=e(r=o,l));this.removeAttribute(t)}}function ni(t,e,n){var r,i,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=e(r=o,l));this.removeAttributeNS(t.space,t.local)}}function ri(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,i)),n}return i._value=e,i}function ii(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,i)),n}return i._value=e,i}function si(t,e){return function(){Kn(this,t).delay=+e.apply(this,arguments)}}function oi(t,e){return e=+e,function(){Kn(this,t).delay=e}}function ai(t,e){return function(){Gn(this,t).duration=+e.apply(this,arguments)}}function li(t,e){return e=+e,function(){Gn(this,t).duration=e}}var ui=wn.prototype.constructor;function ci(t){return function(){this.style.removeProperty(t)}}var hi=0;function fi(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function pi(){return++hi}var di=wn.prototype;fi.prototype=function(t){return wn().transition(t)}.prototype={constructor:fi,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=ue(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a,l,u=r[o],c=u.length,h=s[o]=new Array(c),f=0;f<c;++f)(a=u[f])&&(l=t.call(a,a.__data__,f,u))&&("__data__"in a&&(l.__data__=a.__data__),h[f]=l,Hn(h[f],e,n,f,h,qn(a,n)));return new fi(s,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=he(t));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l,u=r[a],c=u.length,h=0;h<c;++h)if(l=u[h]){for(var f,p=t.call(l,l.__data__,h,u),d=qn(l,n),y=0,g=p.length;y<g;++y)(f=p[y])&&Hn(f,e,n,y,p,d);s.push(p),o.push(l)}return new fi(s,o,e,n)},selectChild:di.selectChild,selectChildren:di.selectChildren,filter:function(t){"function"!=typeof t&&(t=fe(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o=e[i],a=o.length,l=r[i]=[],u=0;u<a;++u)(s=o[u])&&t.call(s,s.__data__,u,o)&&l.push(s);return new fi(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l,u=e[a],c=n[a],h=u.length,f=o[a]=new Array(h),p=0;p<h;++p)(l=u[p]||c[p])&&(f[p]=l);for(;a<r;++a)o[a]=e[a];return new fi(o,this._parents,this._name,this._id)},selection:function(){return new ui(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=pi(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o,a=r[s],l=a.length,u=0;u<l;++u)if(o=a[u]){var c=qn(o,e);Hn(o,t,n,u,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new fi(r,this._parents,t,n)},call:di.call,nodes:di.nodes,node:di.node,size:di.size,empty:di.empty,each:di.each,on:function(t,e){var n=this._id;return arguments.length<2?qn(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,s=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?Kn:Gn;return function(){var o=s(this,t),a=o.on;a!==r&&(i=(r=a).copy()).on(e,n),o.on=i}}(n,t,e))},attr:function(t,e){var n=Ce(t),r="transform"===n?ir:qr;return this.attrTween(t,"function"==typeof e?(n.local?ni:ei)(n,r,ar(this,"attr."+t,e)):null==e?(n.local?Jr:Ur)(n):(n.local?ti:Qr)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=Ce(t);return this.tween(n,(r.local?ri:ii)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?rr:qr;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var s=Ne(this,t),o=(this.style.removeProperty(t),Ne(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}(t,r)).on("end.style."+t,ci(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,i,s;return function(){var o=Ne(this,t),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=Ne(this,t)),o===l?null:o===r&&l===i?s:(i=l,s=e(r=o,a))}}(t,r,ar(this,"style."+t,e))).each(function(t,e){var n,r,i,s,o="style."+e,a="end."+o;return function(){var l=Gn(this,t),u=l.on,c=null==l.value[o]?s||(s=ci(e)):void 0;u===n&&i===c||(r=(n=u).copy()).on(a,i=c),l.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,i,s=n+"";return function(){var o=Ne(this,t);return o===s?null:o===r?i:i=e(r=o,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){var r,i;function s(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&function(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}(t,s,n)),r}return s._value=e,s}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(ar(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&function(t){return function(e){this.textContent=t.call(this,e)}}(r)),e}return r._value=t,r}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=qn(this.node(),n).tween,s=0,o=i.length;s<o;++s)if((r=i[s]).name===t)return r.value;return null}return this.each((null==e?sr:or)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?si:oi)(e,t)):qn(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?ai:li)(e,t)):qn(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Gn(this,t).ease=e}}(e,t)):qn(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Gn(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){0===--i&&s()}};n.each(function(){var n=Gn(this,r),i=n.on;i!==t&&((e=(t=i).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),n.on=e}),0===i&&s()})},[Symbol.iterator]:di[Symbol.iterator]};var yi={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function gi(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}wn.prototype.interrupt=function(t){return this.each(function(){!function(t,e){var n,r,i,s=t.__transition,o=!0;if(s){for(i in e=null==e?null:e+"",s)(n=s[i]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete s[i]):o=!1;o&&delete t.__transition}}(this,t)})},wn.prototype.transition=function(t){var e,n;t instanceof fi?(e=t._id,t=t._name):(e=pi(),(n=yi).time=Xn(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o,a=r[s],l=a.length,u=0;u<l;++u)(o=a[u])&&Hn(o,t,e,u,a,n||gi(o,e));return new fi(r,this._parents,t,e)};const{abs:vi,max:mi,min:_i}=Math;function wi(t){return{type:t}}function bi(t){return"string"==typeof t?new mn([[document.querySelector(t)]],[document.documentElement]):new mn([[t]],vn)}function xi(t,e,n){this.k=t,this.x=e,this.y=n}["w","e"].map(wi),["n","s"].map(wi),["n","w","e","s","nw","ne","sw","se"].map(wi),xi.prototype={constructor:xi,scale:function(t){return 1===t?this:new xi(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new xi(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new xi(1,0,0),xi.prototype;class ki{constructor(t){this._current=null,null!=t&&(this._current=t)}set(t){var e;null===(e=this._current)||void 0===e||e.unsubscribe(),this._current=t}unsubscribe(){var t;null===(t=this._current)||void 0===t||t.unsubscribe(),this._current=null}}class Ai{constructor(){this._current=new Map}set(t,e){if(this._current.has(t)){let n=this._current.get(t);null==n||n.set(e)}else this._current.set(t,new ki(e))}unsubscribe(t){if(this._current.has(t)){let e=this._current.get(t);null==e||e.unsubscribe(),this._current.delete(t)}else console.error(-`No subscription for ${t} found.`)}}const Si="circle",Ei="path",Ci="text",Ti="svg-shape--invisible";class Ii{constructor(t){this._subscriptions=new Ai,this._created=new Set;const e=document.getElementById(t);this._width=(null==e?void 0:e.clientWidth)?e.clientWidth:0,this._height=(null==e?void 0:e.clientHeight)?e.clientHeight:0,this.addSvgCss(),this._svgg=bi(`#${t}`).append("svg").attr("id","svgMain").attr("width",this._width).attr("height",this._height).append("g").attr("transform","translate(.5, .5)")}registerShapes(t,e,n){bi("svg#svgMain").style("background",n),this._subscriptions.set(t.id,t.collection$.subscribe(n=>{this._created.has(t.id)?this.updateShapes(t.id,n):this.createShapes(t.id,n,e)}))}unregisterShapes(t){this.removeShapes(t),this._subscriptions.unsubscribe(t),this._created.delete(t)}addSvgCss(){var t=window.document.styleSheets[0];t.insertRule(`.${Ti} { visibility: hidden;}`,t.cssRules.length)}createShapes(t,e,n){console.log("#createShapes",{id:t,collection:e}),n.forEach(n=>{switch(n){case Bt.CIRCLE:this.createCircles(t,e.circles);break;case Bt.PATH:this.createPaths(t,e.paths);break;case Bt.RECTANGLE:this.createRectangles(t,e.rectangles);break;case Bt.TEXT:this.createTexts(t,e.texts)}}),this._created.add(t)}updateShapes(t,e){this.updateCircles(t,e.circles),this.updatePaths(t,e.paths),this.updateRectangles(t,e.rectangles),this.updateTexts(t,e.texts),this._created.add(t)}createCircles(t,e){console.log("#createCircles",{id:t,length:e.length}),this._svgg.selectAll(`${Si}.${Bt.CIRCLE}.${t}`).data(e).enter().append(Si).attr("id",t=>t.id).classed(Bt.CIRCLE,!0).classed(t,!0).style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("cx",t=>t.attr.cx).attr("cy",t=>t.attr.cy).attr("r",t=>t.attr.r),this._created.add(t)}updateCircles(t,e){this._svgg.selectAll(`${Si}.${Bt.CIRCLE}.${t}`).data(e).classed(Ti,t=>!t.isVisible).style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("cx",t=>t.attr.cx).attr("cy",t=>t.attr.cy).attr("r",t=>t.attr.r)}createPaths(t,e){console.log("#createPaths",{id:t,length:e.length}),this._svgg.selectAll(`${Ei}.${Bt.PATH}.${t}`).data(e).enter().append(Ei).attr("id",t=>t.id).classed(Bt.PATH,!0).classed(t,!0).style("fill","none").style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).attr("d",t=>t.attr.d),this._created.add(t)}updatePaths(t,e){this._svgg.selectAll(`${Ei}.${Bt.PATH}.${t}`).data(e).classed(Ti,t=>!t.isVisible).style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).attr("d",t=>t.attr.d)}createRectangles(t,e){console.log("#createRectangles",{id:t,length:e.length}),this._svgg.selectAll(`${Ei}.${Bt.RECTANGLE}.${t}`).data(e).enter().append(Ei).attr("id",t=>t.id).classed(Bt.RECTANGLE,!0).classed(t,!0).style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("d",t=>t.attr.d),this._created.add(t)}updateRectangles(t,e){this._svgg.selectAll(`${Ei}.${Bt.RECTANGLE}.${t}`).data(e).classed(Ti,t=>!t.isVisible).style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("d",t=>t.attr.d)}createTexts(t,e){console.log("#createTexts",{id:t,length:e.length}),this._svgg.selectAll(`${Ci}.${Bt.TEXT}.${t}`).data(e).enter().append(Ci).attr("id",t=>t.id).classed(Bt.TEXT,!0).classed(t,!0).style("fill",t=>t.style.fill).style("fillOpacity",t=>t.style.fillOpacity).style("alignment-baseline",t=>t.style.alignmentBaseline).attr("x",t=>t.attr.x).attr("y",t=>t.attr.y).style("font-size",t=>t.attr.fontSize).text(t=>t.attr.text),this._created.add(t)}updateTexts(t,e){this._svgg.selectAll(`${Ci}.${Bt.TEXT}.${t}`).data(e).classed(Ti,t=>!t.isVisible).classed(Bt.TEXT,!0).classed(t,!0).style("fill",t=>t.style.fill).style("fillOpacity",t=>t.style.fillOpacity).style("alignment-baseline",t=>t.style.alignmentBaseline).attr("x",t=>t.attr.x).attr("y",t=>t.attr.y).style("font-size",t=>t.attr.fontSize).each(t=>{let e=this._svgg.select(`#${t.id}`);e.text()!==t.attr.text&&e.text(t.attr.text)})}removeShapes(t){this._svgg.selectAll(`.${t}`).remove()}}function Mi(t,e,n){return void 0===n&&(n=1/0),a(e)?Mi(function(n,r){return Ot(function(t,i){return e(n,t,r,i)})(ft(t(n,r)))},n):("number"==typeof e&&(n=e),tt(function(e,r){return function(t,e,n,r){var i=[],s=0,o=0,a=!1,l=function(){!a||i.length||s||e.complete()},u=function(t){return s<r?c(t):i.push(t)},c=function(t){s++;var a=!1;ft(n(t,o++)).subscribe(et(e,function(t){e.next(t)},function(){a=!0},void 0,function(){if(a)try{s--;for(var t=function(){var t=i.shift();c(t)};i.length&&s<r;)t();l()}catch(t){e.error(t)}}))};return t.subscribe(et(e,u,function(){a=!0,l()})),function(){}}(e,r,t,n)}))}function Pi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Xt(t),r=function(t){return"number"==typeof Wt(t)?t.pop():1/0}(t),i=t;return i.length?1===i.length?ft(i[0]):function(t){return void 0===t&&(t=1/0),Mi(W,t)}(r)(Pt(i,n)):xt}var Oi=["addListener","removeListener"],zi=["addEventListener","removeEventListener"],$i=["on","off"];function Zi(t,e,n,r){if(a(n)&&(r=n,n=void 0),r)return Zi(t,e,n).pipe(Zt(r));var s=i(function(t){return a(t.addEventListener)&&a(t.removeEventListener)}(t)?zi.map(function(r){return function(i){return t[r](e,i,n)}}):function(t){return a(t.addListener)&&a(t.removeListener)}(t)?Oi.map(Wi(t,e)):function(t){return a(t.on)&&a(t.off)}(t)?$i.map(Wi(t,e)):[],2),o=s[0],l=s[1];if(!o&&rt(t))return Mi(function(t){return Zi(t,e,n)})(ft(t));if(!o)throw new TypeError("Invalid event target");return new X(function(t){var e=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.next(1<e.length?e:e[0])};return o(e),function(){return l(e)}})}function Wi(t,e){return function(n){return function(r){return t[n](e,r)}}}function Xi(t,e){return t===e}class Ni{constructor(){var t,e;this._t=0,this._cameraSubscription=new ki,this.circles=[],this.paths=[],this.rectangles=[],this.texts=[],this._state$=new j({circles:this.circles.map(t=>t.attributes),paths:this.paths.map(t=>t.attributes),rectangles:this.rectangles.map(t=>t.attributes),texts:this.texts.map(t=>t.attributes)}),this.state$=this._state$.pipe((void 0===e&&(e=W),t=null!=(t=(t,e)=>function(t,e){return JSON.stringify(t)===JSON.stringify(e)}(t,e))?t:Xi,tt(function(n,r){var i,s=!0;n.subscribe(et(r,function(n){var o=e(n);!s&&t(i,o)||(s=!1,i=o,r.next(n))}))}))),this.config=new yt({cameraPerspective:vt()}),this.backgroundColor="#fff"}init(){this.emit()}tick(){this._t++,this.transitionToStateAt(this._t),this.emit()}mountCamera(t){t.mountCamera(this.config.data.cameraPerspective),this._cameraSubscription.set(t.state$.subscribe({next:t=>{this.config.data.cameraPerspective=t}}))}resetConfig(){this.config.reset()}onDestroy(){this.config.save(),this._cameraSubscription.unsubscribe()}emit(){this._state$.next({circles:this.circles.map(t=>t.attributes),paths:this.paths.map(t=>t.attributes),rectangles:this.rectangles.map(t=>t.attributes),texts:this.texts.map(t=>t.attributes)})}}class Di extends Ni{constructor(){super(),this.config=new yt({cameraPerspective:{position:{x:0,y:.5,z:-3.6},angleX:20*gt,angleY:0*gt,angleZ:0*gt}},"bellCurveConfig"),this.name="Bell Curve";for(let t=-Di.SIZE;t<Di.SIZE;t++)for(let e=-Di.SIZE;e<Di.SIZE;e++)this.circles.push(new Gt({x:Di.DIST*t,y:0,z:Di.DIST*e},1.25));this.init()}transitionToStateAt(t){const e=3*Math.sin(t*Math.PI/180);this.circles.forEach(t=>{t.position.y=e*Math.exp(-(t.position.x*t.position.x+t.position.z*t.position.z))})}}Di.SIZE=15,Di.DIST=.15;class Yi extends Ni{constructor(){super(),this._rectangleStyleBottom={strokeWidth:.75,stroke:"#00f",strokeOpacity:1,fill:"#4af",fillOpacity:.2},this._rectangleStyleSides1={strokeWidth:.25,stroke:"#999",strokeOpacity:.5,fill:"#6cf",fillOpacity:.2},this._rectangleStyleSides2={strokeWidth:.25,stroke:"#999",strokeOpacity:.5,fill:"none",fillOpacity:0},this.config=new yt({cameraPerspective:{position:{x:0,y:2,z:-7.3},angleX:15*gt,angleY:40*gt,angleZ:0}},"bouncingParticlesConfig"),this.name="Bouncing Particles",this.rectangles=[new ne({x:0,y:0,z:0},6,6,{rotateX:90,rotateY:0,rotateZ:0},this._rectangleStyleBottom),new ne({x:3,y:2,z:0},6,4,{rotateX:0,rotateY:90,rotateZ:0},this._rectangleStyleSides1),new ne({x:0,y:2,z:3},4,6,{rotateX:0,rotateY:0,rotateZ:90},this._rectangleStyleSides1),new ne({x:-3,y:2,z:0},6,4,{rotateX:0,rotateY:90,rotateZ:0},this._rectangleStyleSides2),new ne({x:0,y:2,z:-3},4,6,{rotateX:0,rotateY:0,rotateZ:90},this._rectangleStyleSides2)],this.particles=[];for(let t=0;t<1500;t++){let t=2*Math.PI*Math.random(),e=.1*Math.random();this.particles.push({position:{x:0,y:.01,z:0},velocity:{x:e*Math.sin(t),y:.35*Math.random(),z:e*Math.cos(t)},staticX:!1,staticY:!1,staticZ:!1,outOfBounds:!1})}this.updateCirclesFromParticles(),this.init()}transitionToStateAt(t){this.particles.forEach(t=>{t.staticX&&t.staticY&&t.staticZ||(t.position.y<=0&&t.velocity.y<0?(t.velocity.x*=.8,t.velocity.y*=-.8,t.velocity.z*=.8):t.velocity.y-=Yi.ACCELERATION,t.outOfBounds||(Math.abs(t.position.x)>=2.9&&(t.position.y>4?t.outOfBounds=!0:t.velocity.x*=-1),Math.abs(t.position.z)>=2.9&&(t.position.y>4?t.outOfBounds=!0:t.velocity.z*=-1)),Math.abs(t.velocity.x)<.001&&(t.staticX=!0),Math.abs(t.velocity.y)<.001&&Math.abs(t.position.y)<.001&&(t.staticY=!0),Math.abs(t.velocity.z)<.001&&(t.staticZ=!0),t.staticX||(t.position.x+=t.velocity.x),t.staticX||(t.position.y+=t.velocity.y),t.staticX||(t.position.z+=t.velocity.z))}),this.updateCirclesFromParticles()}updateCirclesFromParticles(){this.circles=this.particles.map(t=>new Gt(t.position,1.5))}}Yi.ACCELERATION=.0095;class Ri extends Ni{constructor(){super(),this.angleX=6*Math.PI/5-Math.PI,this.angleY=5*Math.PI/4-Math.PI,this.styleBlack={strokeWidth:1,stroke:"#000",strokeOpacity:.75,fill:"#fff",fillOpacity:1},this.styleRed={strokeWidth:0,stroke:"#000",strokeOpacity:0,fill:"#f00",fillOpacity:.5},this.styleGreen={strokeWidth:0,stroke:"#000",strokeOpacity:0,fill:"#0f0",fillOpacity:.5},this.styleBlue={strokeWidth:0,stroke:"#000",strokeOpacity:0,fill:"#00f",fillOpacity:.5},this.config=new yt({cameraPerspective:vt()},"cartesianAxesConfig"),this.name="Cartesian Axes",this.createCircles(0),this.init()}transitionToStateAt(t){let e=Math.floor(t/50)%3;this.createCircles(e)}createCircles(t){let e=this.styleRed,n=this.styleGreen,r=this.styleBlue;switch(t){case 1:e=this.styleGreen,n=this.styleBlue,r=this.styleRed;break;case 2:e=this.styleBlue,n=this.styleRed,r=this.styleGreen}this.circles=[new Gt({x:0,y:0,z:0},2,this.styleBlack)];for(let t=Ri.DIST;t<=Ri.SIZE;t+=Ri.DIST)this.circles.push(new Gt({x:-t,y:0,z:0},1,e)),this.circles.push(new Gt({x:t,y:0,z:0},1,e)),this.circles.push(new Gt({x:0,y:-t,z:0},1,n)),this.circles.push(new Gt({x:0,y:t,z:0},1,n)),this.circles.push(new Gt({x:0,y:0,z:-t},1,r)),this.circles.push(new Gt({x:0,y:0,z:t},1,r))}}Ri.SIZE=5,Ri.DIST=.15;const ji=9.81;class Li extends Ni{constructor(){super(),this._zDistance=5,this._current=[],this._origins=[],this._circleStyle={strokeWidth:1.5,stroke:"#f80",strokeOpacity:1,fill:"#fff",fillOpacity:1},this._pathStyle={strokeWidth:2,stroke:"#88a",strokeOpacity:1},this.config=new yt({cameraPerspective:{position:{x:0,y:-2,z:-6},angleX:0*gt,angleY:0*gt,angleZ:0*gt},m1:1,m2:1,l1:1,l2:1,friction:1},"doublePendulumConfig"),this.name="Double Pendulum";for(let t=-17;t<18;t+=4)for(let e=-9;e<10;e+=4)for(let n=1;n<2;n++)this._origins.push({x:t,y:e,z:n*this._zDistance}),this._current.push({theta1:t/Math.PI/2,theta2:e/Math.PI/2,omega1:1*(n-1),omega2:1*-(n-1)});this.updateWithCurrent(),this.init()}transitionToStateAt(t){const e=.025*t;this._current=this._current.map(t=>{const n=this.rk4Step(this.doublePendulumODE,e,this.pendulumStateAsArray(t),.025,this.config.data);return n[2]*=this.config.data.friction,n[3]*=this.config.data.friction,this.pendulumStateFromArray(n)}),this.updateWithCurrent()}updateWithCurrent(){const t=this._current.map((t,e)=>{const n=this.toCartesian(t.theta1,t.theta2);return[{x:this._origins[e].x,y:this._origins[e].y,z:this._origins[e].z},{x:this._origins[e].x+n[0],y:this._origins[e].y+n[1],z:this._origins[e].z},{x:this._origins[e].x+n[2],y:this._origins[e].y+n[3],z:this._origins[e].z}]}),e=t.map(t=>new Ut(t,!1,this._pathStyle));this.paths=e,this.circles=t.flat().map(t=>new Gt(t,3,this._circleStyle))}toCartesian(t,e){const n=this.config.data.l1*Math.sin(t),r=-this.config.data.l1*Math.cos(t);return[n,r,n+this.config.data.l2*Math.sin(e),r-this.config.data.l2*Math.cos(e)]}pendulumStateAsArray(t){return[t.theta1,t.theta2,t.omega1,t.omega2]}pendulumStateFromArray(t){return{theta1:t[0],theta2:t[1],omega1:t[2],omega2:t[3]}}doublePendulumODE(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=i-r,l=Math.sin(a),u=Math.cos(a);return[s,o,(n.m2*n.l1*Math.pow(s,2)*l*u+n.m2*ji*Math.sin(i)*u+n.m2*n.l2*Math.pow(o,2)*l-(n.m1+n.m2)*ji*Math.sin(r))/(n.l1*(n.m1+n.m2-n.m2*Math.pow(u,2))),(-n.m2*n.l2*Math.pow(o,2)*l*u+(n.m1+n.m2)*(ji*Math.sin(r)*u-n.l1*Math.pow(s,2)*l)-(n.m1+n.m2)*ji*Math.sin(i))/(n.l2*(n.m1+n.m2-n.m2*Math.pow(u,2)))]}rk4Step(t,e,n,r,i){const s=t(e,n,i),o=t(e+r/2,n.map((t,e)=>t+r/2*s[e]),i),a=t(e+r/2,n.map((t,e)=>t+r/2*o[e]),i),l=t(e+r,n.map((t,e)=>t+r*a[e]),i);return n.map((t,e)=>t+r/6*(s[e]+2*o[e]+2*a[e]+l[e]))}}class Vi extends Ni{constructor(){super(),this.config=new yt({cameraPerspective:{position:{x:0,y:0,z:-3},angleX:30*gt,angleY:60*gt,angleZ:0}},"gridConfig"),this.name="Grid";for(let t=-Vi.SIZE;t<=Vi.SIZE;t+=Vi.DIST)for(let e=-Vi.SIZE;e<=Vi.SIZE;e+=Vi.DIST)for(let n=-Vi.SIZE;n<=Vi.SIZE;n+=Vi.DIST)this.circles.push(new Gt({x:t,y:e,z:n},1.5));this.init()}transitionToStateAt(t){}}Vi.SIZE=1,Vi.DIST=.2;class Bi extends Ni{constructor(){super(),this.cnt=0,this.maxCnt=4095,this.minZ=-3,this.maxZ=-15,this._pathStyle={strokeWidth:1,stroke:"#77a",strokeOpacity:1},this.config=new yt({cameraPerspective:{position:{x:-1,y:4.7,z:-5},angleX:25*gt,angleY:50*gt,angleZ:0}},"hilbertCurveConfig"),this.name="Hilbert Curve",this.hilbert=new Gi(1,Fi.XYZ),this.paths=[new Ut([{x:0,y:0,z:0}],!1,this._pathStyle)],this.init()}transitionToStateAt(t){if(this.cnt>this.maxCnt)return;let e;for(let t=0;t<1;t++)if(e=this.hilbert.xyz(this.cnt++),this.paths[0].path.push({x:.5*e.x,y:.5*e.y,z:.5*e.z}),this.cnt>this.maxCnt)return}}var Fi,Hi;!function(t){t.XYZ="XYZ",t.XZY="XZY",t.YXZ="YXZ",t.YZX="YZX",t.ZXY="ZXY",t.ZYX="ZYX"}(Fi||(Fi={}));class Ki{constructor(t,e,n,r){t&&(e=t[0],n=t[1],r=t[2]),this.x=Math.round(e)||0,this.y=Math.round(n)||0,this.z=Math.round(r)||0,this.arr=[this.x,this.y,this.z],this.n=4*this.z+2*this.y+this.x}floor(){return new Ki([this.x,this.y,this.z].map(Math.floor),0,0,0)}mult(t){return new Ki(null,this.x*t,this.y*t,this.z*t)}add(t){return"number"==typeof t?new Ki(null,this.x+t,this.y+t,this.z+t):new Ki(null,this.x+t.x,this.y+t.y,this.z+t.z)}mod(t){return new Ki(null,this.x%t,this.y%t,this.z%t)}rotate(t,e){return 0==t.n?new Ki(null,this.z,this.x,this.y):1==t.n||3==t.n?new Ki(null,this.y,this.z,this.x):2==t.n||6==t.n?new Ki(null,e-this.x,e-this.y,this.z):5==t.n||7==t.n?new Ki(null,this.y,e-this.z,e-this.x):new Ki(null,e-this.z,this.x,e-this.y)}unrotate(t,e){return 0==t.n?new Ki(null,this.y,this.z,this.x):1==t.n||3==t.n?new Ki(null,this.z,this.x,this.y):2==t.n||6==t.n?new Ki(null,e-this.x,e-this.y,this.z):5==t.n||7==t.n?new Ki(null,e-this.z,this.x,e-this.y):new Ki(null,this.y,e-this.z,e-this.x)}rotateLeft(t){return t%3==0?this:t%3==1?new Ki(null,this.y,this.z,this.x):new Ki(null,this.z,this.x,this.y)}rotateRight(t){return t%3==0?this:t%3==1?new Ki(null,this.z,this.x,this.y):new Ki(null,this.y,this.z,this.x)}shuffle(t){return t?new Ki(null,this.extractFromAnchorAxisOrder(t,0),this.extractFromAnchorAxisOrder(t,1),this.extractFromAnchorAxisOrder(t,2)):this}pp(){return[this.x,this.y,this.z].join(",")}manhattanDistance(t){return Math.abs(t.x-this.x)+Math.abs(t.y-this.y)+Math.abs(t.z-this.z)}extractFromAnchorAxisOrder(t,e){switch(t[e]){case"X":return this.x;case"Y":return this.y;case"Z":return this.z}throw new Error(`Invalid template and/or index: template=${t}, index=${e}`)}}class Gi{constructor(t,e){if(this.horseshoe2d=[0,1,3,2,7,6,4,5],this.xyz=this.d2xyz,this.d=this.xyz2d,this.size=t,this.anchorAxisOrder=e,this.anchorAxisOrder==Fi.XYZ&&(this.anchorAxisOrder=null),this.anchorAxisOrder)switch(this.anchorAxisOrder){case Fi.XZY:this.reverseAnchorAxisOrder=Fi.XZY;break;case Fi.YXZ:this.reverseAnchorAxisOrder=Fi.YXZ;break;case Fi.YZX:this.reverseAnchorAxisOrder=Fi.ZXY;break;case Fi.ZXY:this.reverseAnchorAxisOrder=Fi.YZX;break;case Fi.ZYX:this.reverseAnchorAxisOrder=Fi.ZYX}if(this.size){this.log2size=0;let t=1;for(;t<this.size;t*=2,this.log2size++);if(t!=this.size)throw new Error("Invalid size: "+this.size+". Must be a power of 2.");this.log2parity=this.log2size%3}}d2xyz(t){t=Math.floor(t);let e,n,r,i=new Ki(null,0,0,0),s=1,o=2,a=this.size||0;for(;t>0||s<a;){e=1&t,n=t/2&1,r=t/4&1;let a=new Ki(null,e^n,n^r,r);i=i.rotate(a,s-1).add(a.mult(s)),t=Math.floor(t/8),s*=2,o++}return i=this.size?i.rotateLeft(o-this.log2parity+1):i.rotateLeft(o),i.shuffle(this.reverseAnchorAxisOrder)}xyz2d(t,e,n){let r=new Ki(null,t,e,n).floor(),i=1,s=0;const o=Math.max.apply(Math,r.arr);for(;2*i<=o;i*=2)s=(s+1)%3;null!=this.anchorAxisOrder&&(r=r.shuffle(this.anchorAxisOrder)),r=this.size?r.rotateRight(s-this.log2parity+1):r.rotateRight(s);let a=0;for(;i>0;){var l=new Ki(null,r.x&i&&1,r.y&i&&1,r.z&i&&1);a*=8,a+=this.horseshoe2d[l.n],s=(s+2)%3,r=r.mod(i),r=r.unrotate(l,i-1),i=Math.floor(i/2)}return a}}class qi extends Ni{constructor(){super(),this._circleStyle={strokeWidth:.5,stroke:"#fff",strokeOpacity:1,fill:"#f80",fillOpacity:1},this._rectangleStyle={strokeWidth:1,stroke:"#00f",strokeOpacity:1,fill:"#4af",fillOpacity:.2},this.config=new yt({cameraPerspective:vt()},"playgroundConfig"),this.name="Playground",this.circles=[new Gt({x:0,y:0,z:0},2.5,this._circleStyle)],this.paths=[new Ut([{x:-1,y:0,z:0},{x:1,y:0,z:0}],!1,this.pathStyle("#f00")),new Ut([{x:0,y:-1,z:0},{x:0,y:1,z:0}],!1,this.pathStyle("#0f0")),new Ut([{x:0,y:0,z:-1},{x:0,y:0,z:1}],!1,this.pathStyle("#00f"))],this.rectangles=[new ne({x:0,y:0,z:0},3,3,{rotateX:90,rotateY:0,rotateZ:0},this._rectangleStyle)],this.texts=[new oe({x:1,y:0,z:0},"Hello")],this.init()}transitionToStateAt(t){let e=t%100<50;this.texts[0].text=e?"Hello":"World"}pathStyle(t){return{strokeWidth:2,stroke:t,strokeOpacity:.5}}}!function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.FORWARD=4]="FORWARD",t[t.BACKWARD=5]="BACKWARD"}(Hi||(Hi={}));class Ui extends Ni{constructor(){super(),this.config=new yt({cameraPerspective:vt()},"randomPointsConfig"),this.name="Random Points",this.circles.push(new Gt({x:0,y:0,z:0},1.5));let t,e=structuredClone(this.circles[0].position),n=structuredClone(this.circles[0].position);for(let r=0;r<1500;r++){switch(t=Math.floor(6*Math.random()),e=structuredClone(n),t){case Hi.UP:e.y+=Ui.DIST;break;case Hi.DOWN:e.y-=Ui.DIST;break;case Hi.LEFT:e.x+=Ui.DIST;break;case Hi.RIGHT:e.x-=Ui.DIST;break;case Hi.FORWARD:e.z-=Ui.DIST;break;case Hi.BACKWARD:e.z+=Ui.DIST;break;default:console.log("NOK",t)}Math.abs(e.x)>Ui.AREA||Math.abs(e.y)>Ui.AREA||Math.abs(e.z)>Ui.AREA||(n=structuredClone(e),this.circles.push(new Gt(structuredClone(n),1.5)))}this.init()}transitionToStateAt(t){}}Ui.AREA=20,Ui.DIST=.15;const Ji=.35,Qi=2,ts=4.0923373,es=.88,ns=2.5,rs=1.6021303,is=.92,ss=2.85,os=.9856474,as=.49,ls=3.3,us=.5240335,cs=10.5,hs=4.5,fs=.0830864,ps=8.86,ds=6,ys=.0334597,gs=3.76,vs=7.2,ms=.0117299,_s=3.65,ws=8,bs=.005981,xs=.3,ks=.1,As=13.176358,Ss=.312,Es=.65,Cs=203.489,Ts=.27,Is=.7,Ms=101.376,Ps=.45,Os=.75,zs=50.316,$s=.414,Zs=.83,Ws=21.569,Xs=.441,Ns=.55,Ds=22.571,Ys=.135,Rs=.3,js=41.351,Ls=.234,Vs=.3,Bs=-61.736,Fs={strokeWidth:2,stroke:"#fe8",strokeOpacity:.7,fill:"#fdd800",fillOpacity:1},Hs={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#A9A9A9",fillOpacity:1},Ks={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#E6C229",fillOpacity:1},Gs={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#1DA1F2",fillOpacity:1},qs={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#C1440E",fillOpacity:1},Us={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#F7CC7F",fillOpacity:1},Js={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#F5DEB3",fillOpacity:1},Qs={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#AFD2E1",fillOpacity:1},to={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#1E90FF",fillOpacity:1},eo={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#fff",fillOpacity:1};class no extends Ni{constructor(){super(),this._orbitalAngles=this.calculateInitialPositions(1977,7,8),this._sun=new Gt({x:0,y:0,z:0},25,Fs),this._mercury=new Gt(this.planetPosition(Qi,this._orbitalAngles.mercury),Ji,Hs),this._venus=new Gt(this.planetPosition(ns,this._orbitalAngles.venus),es,Ks),this._earth=new Gt(this.planetPosition(ss,this._orbitalAngles.earth),is,Gs),this._earthMoon1=new Gt(this.moonPosition(ss,this._orbitalAngles.earth,ks,this._orbitalAngles.earthLuna),xs,eo),this._mars=new Gt(this.planetPosition(ls,this._orbitalAngles.mars),as,qs),this._jupiter=new Gt(this.planetPosition(hs,this._orbitalAngles.jupiter),cs,Us),this._jupiterMoon1Io=new Gt(this.moonPosition(hs,this._orbitalAngles.jupiter,Es,this._orbitalAngles.jupiterIo),Ss,eo),this._jupiterMoon2Europa=new Gt(this.moonPosition(hs,this._orbitalAngles.jupiter,Is,this._orbitalAngles.jupiterEuropa),Ts,eo),this._jupiterMoon3Ganymede=new Gt(this.moonPosition(hs,this._orbitalAngles.jupiter,Os,this._orbitalAngles.jupiterGanymede),Ps,eo),this._jupiterMoon4Calisto=new Gt(this.moonPosition(hs,this._orbitalAngles.jupiter,Zs,this._orbitalAngles.jupiterCallisto),$s,eo),this._saturn=new Gt(this.planetPosition(ds,this._orbitalAngles.saturn),ps,Js),this._saturnMoon1Titan=new Gt(this.moonPosition(ds,this._orbitalAngles.saturn,Ns,this._orbitalAngles.saturnTitan),Xs,eo),this._uranus=new Gt(this.planetPosition(vs,this._orbitalAngles.uranus),gs,Qs),this._uranusMoon1Titania=new Gt(this.moonPosition(vs,this._orbitalAngles.uranus,Rs,this._orbitalAngles.uranusTitania),Ys,eo),this._neptune=new Gt(this.planetPosition(ws,this._orbitalAngles.neptune),_s,to),this._neptuneMoon1Triton=new Gt(this.moonPosition(ws,this._orbitalAngles.neptune,Vs,this._orbitalAngles.neptuneTriton),Ls,eo),this.config=new yt({cameraPerspective:{position:{x:0,y:-1,z:-8.5},angleX:35*gt,angleY:330*gt,angleZ:0*gt},speed:1/24},"solarSystemConfig"),this.backgroundColor="#000",this.name="SolarSystem",this.circles=[this._sun,this._mercury,this._venus,this._earth,this._earthMoon1,this._mars,this._jupiter,this._jupiterMoon1Io,this._jupiterMoon2Europa,this._jupiterMoon3Ganymede,this._jupiterMoon4Calisto,this._saturn,this._saturnMoon1Titan,this._uranus,this._uranusMoon1Titania,this._neptune,this._neptuneMoon1Triton],this.init()}transitionToStateAt(t){const e=this.config.data.speed;this._orbitalAngles.mercury+=ts*e,this._mercury.position=this.planetPosition(Qi,this._orbitalAngles.mercury),this._orbitalAngles.venus+=rs*e,this._venus.position=this.planetPosition(ns,this._orbitalAngles.venus),this._orbitalAngles.earth+=os*e,this._earth.position=this.planetPosition(ss,this._orbitalAngles.earth),this._orbitalAngles.earthLuna+=As*e,this._earthMoon1.position=this.moonPosition(ss,this._orbitalAngles.earth,ks,this._orbitalAngles.earthLuna),this._orbitalAngles.mars+=us*e,this._mars.position=this.planetPosition(ls,this._orbitalAngles.mars),this._orbitalAngles.jupiter+=fs*e,this._jupiter.position=this.planetPosition(hs,this._orbitalAngles.jupiter),this._orbitalAngles.jupiterIo+=Cs*e,this._jupiterMoon1Io.position=this.moonPosition(hs,this._orbitalAngles.jupiter,Es,this._orbitalAngles.jupiterIo),this._orbitalAngles.jupiterEuropa+=Ms*e,this._jupiterMoon2Europa.position=this.moonPosition(hs,this._orbitalAngles.jupiter,Is,this._orbitalAngles.jupiterEuropa),this._orbitalAngles.jupiterGanymede+=zs*e,this._jupiterMoon3Ganymede.position=this.moonPosition(hs,this._orbitalAngles.jupiter,Os,this._orbitalAngles.jupiterGanymede),this._orbitalAngles.jupiterCallisto+=Ws*e,this._jupiterMoon4Calisto.position=this.moonPosition(hs,this._orbitalAngles.jupiter,Zs,this._orbitalAngles.jupiterCallisto),this._orbitalAngles.saturn+=ys*e,this._saturn.position=this.planetPosition(ds,this._orbitalAngles.saturn),this._orbitalAngles.saturnTitan+=Ds*e,this._saturnMoon1Titan.position=this.moonPosition(ds,this._orbitalAngles.saturn,Ns,this._orbitalAngles.saturnTitan),this._orbitalAngles.uranus+=ms*e,this._uranus.position=this.planetPosition(vs,this._orbitalAngles.uranus),this._orbitalAngles.uranusTitania+=js*e,this._uranusMoon1Titania.position=this.moonPosition(vs,this._orbitalAngles.uranus,Rs,this._orbitalAngles.uranusTitania),this._orbitalAngles.neptune+=bs*e,this._neptune.position=this.planetPosition(ws,this._orbitalAngles.neptune),this._orbitalAngles.neptuneTriton-=Bs*e,this._neptuneMoon1Triton.position=this.moonPosition(ws,this._orbitalAngles.neptune,Vs,this._orbitalAngles.neptuneTriton)}planetPosition(t,e){return{x:t*Math.cos(e*gt),y:0,z:t*Math.sin(e*gt)}}moonPosition(t,e,n,r){return{x:t*Math.cos(e*gt)+n*Math.cos(r*gt),y:0,z:t*Math.sin(e*gt)+n*Math.sin(r*gt)}}calculateInitialPositions(t,e,n){const r=new Date(2e3,0,1),i=(new Date(t,e-1,n).getTime()-r.getTime())/864e5;return{mercury:252.2509+i*ts%360,venus:181.9798+i*rs%360,earth:100.4644+i*os%360,earthLuna:360*Math.random(),mars:355.4333+i*us%360,jupiter:34.3515+i*fs%360,jupiterIo:360*Math.random(),jupiterEuropa:360*Math.random(),jupiterGanymede:360*Math.random(),jupiterCallisto:360*Math.random(),saturn:49.9443+i*ys%360,saturnTitan:360*Math.random(),uranus:313.2322+i*ms%360,uranusTitania:360*Math.random(),neptune:304.88+i*bs%360,neptuneTriton:360*Math.random()}}}new class{constructor(){this._stage=new Ii("main"),this._camera=new mt,this._cameraControl=new wt(this._camera),this._world=null,this._abortWorldTick$=new Y,this._newWorldSubscription=new ki,this._worldTitleArea=document.getElementById("worldTitle"),this._cameraInfoArea=document.getElementById("cameraInfo"),this._keyboardAnimationManager=new bt,this._config=new yt({currentWorldId:1,worldTick:40},"mainConfig"),this._currentWorldId$=new j(this._config.data.currentWorldId),this._currentWorldIdSubscriontion=new ki,console.log("#constructor(Start) - ZetaSVG - Version:0.0.7"),function(t){const e="app-version",n=localStorage.getItem(e);n!==t&&(console.info(`#configVersionCheck - storedVersion=${n} does not match appVersion=${t}`),localStorage.clear(),caches.keys().then(t=>{t.forEach(t=>{caches.delete(t)})}),localStorage.setItem(e,t),window.location.reload())}("0.0.7"),this.handlePhysicalKeyboardEvents(),this.appendVirtualKeyboard(),this.updateCameraInfo(),this.runWorld()}handlePhysicalKeyboardEvents(){document.addEventListener("keydown",t=>{this.signalPhysicalEventToVirtualKeyboard(t.key),this.handleKeyPress(t.key)},!1)}appendVirtualKeyboard(){fetch("virtual-keyboard.html").then(t=>t.text()).then(t=>{const e=document.getElementById("virtual-keyboard-container");null!=e?e.innerHTML=t:console.error("virtual-keyboard-container not found to append virtual keyboard html")}).then(t=>{Array.from(document.getElementsByClassName("virtual-key")).forEach(t=>function(t,e,n){const r=t.dataset.key||"",i=Pi(Zi(t,"mousedown"),Zi(t,"touchstart")),s=Pi(Zi(t,"mouseup"),Zi(t,"touchend"),Zi(t,"mouseleave"));var o;Zi(t,"touchstart").subscribe(t=>t.preventDefault()),i.pipe((o=()=>(n(e,r),J(300,50).pipe(dt(s))),tt(function(t,e){var n=null,r=!1,i=function(){return r&&!n&&e.complete()};t.subscribe(et(e,function(t){null==n||n.unsubscribe(),ft(o()).subscribe(n=et(e,function(t){return e.next(t)},function(){n=null,i()}))},function(){r=!0,i()}))}))).subscribe(()=>{n(e,r)})}(t,this,this.handleKeyPressViaVirtualKeyboard)),this._currentWorldIdSubscriontion.set(this._currentWorldId$.subscribe(t=>{for(let e=1;e<10;e++){const n=document.getElementById(`virtual-key-${e}`);e==t?null==n||n.classList.add("virtual-key--selected"):null==n||n.classList.remove("virtual-key--selected")}}))})}signalPhysicalEventToVirtualKeyboard(t){this._keyboardAnimationManager.triggerAnimation(t)}handleKeyPressViaVirtualKeyboard(t,e){t.handleKeyPress(e)}handleKeyPress(t){var e,n;if(!this._cameraControl.onNextEvent(t))switch(t){case"":console.log("invalid key");case"Escape":null===(e=this._world)||void 0===e||e.resetConfig(),null===(n=this._world)||void 0===n||n.mountCamera(this._camera);break;case"1":this.switchWorld(1);break;case"2":this.switchWorld(2);break;case"3":this.switchWorld(3);break;case"4":this.switchWorld(4);break;case"5":this.switchWorld(5);break;case"6":this.switchWorld(6);break;case"7":this.switchWorld(7);break;case"8":this.switchWorld(8);break;case"9":this.switchWorld(9)}}switchWorld(t){console.log(`switching world to (${t})`),this._currentWorldId$.next(t),this._config.data.currentWorldId=t,this._abortWorldTick$.next(),this._newWorldSubscription.set(J(100).subscribe(()=>{this.runWorld()}))}runWorld(){var t;null===(t=this._world)||void 0===t||t.onDestroy(),this._world=this.createWorldById(this._config.data.currentWorldId),this._world.mountCamera(this._camera),this.updateWorldTitle(this._world.name);const e=new ae(this._world,this._camera);this._stage.registerShapes(e.shapes,new Set([Bt.RECTANGLE,Bt.PATH,Bt.CIRCLE,Bt.TEXT]),this._world.backgroundColor),Q(this._config.data.worldTick).pipe(dt(this._abortWorldTick$)).subscribe({next:()=>{var t;null===(t=this._world)||void 0===t||t.tick()},complete:()=>{console.log("Old world completed - unregistering shapes"),this._stage.unregisterShapes(e.shapes.id)}})}createWorldById(t){switch(t){case 1:return new Ri;case 2:return new qi;case 3:return new Vi;case 4:return new Di;case 5:return new Yi;case 6:return new Ui;case 7:return new Bi;case 8:return new no;case 9:return new Li;default:return console.error("Unnown world id",t),new Ri}}updateWorldTitle(t){null!=this._worldTitleArea&&(this._worldTitleArea.textContent=`World: ${t} (${this._config.data.currentWorldId})`)}updateCameraInfo(){this._camera.state$.subscribe({next:t=>{const e=`Perspective: Position (X ${(n=t).position.x.toFixed(1)}, Y ${n.position.y.toFixed(1)}, Z ${n.position.z.toFixed(1)}), Angle-X ${(180*n.angleX/Math.PI).toFixed(0)}, Angle-Y ${(180*n.angleY/Math.PI).toFixed(0)}, Angle-Z ${(180*n.angleZ/Math.PI).toFixed(0)})`;var n;null!=this._cameraInfoArea&&(this._cameraInfoArea.textContent=e)}})}}})();