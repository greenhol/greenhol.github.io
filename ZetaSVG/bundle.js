(()=>{"use strict";var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};function e(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}function i(t,e){var i,n,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function n(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function r(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,s=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o}function s(t,e,i){if(i||2===arguments.length)for(var n,r=0,s=e.length;r<s;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))}function o(t){return this instanceof o?(this.v=t,this):new o(t)}function a(t){return"function"==typeof t}function l(t){var e=t(function(t){Error.call(t),t.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}Object.create,Object.create;var h=l(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}});function u(t,e){if(t){var i=t.indexOf(e);0<=i&&t.splice(i,1)}}var c=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,i,o,l;if(!this.closed){this.closed=!0;var u=this._parentage;if(u)if(this._parentage=null,Array.isArray(u))try{for(var c=n(u),p=c.next();!p.done;p=c.next())p.value.remove(this)}catch(e){t={error:e}}finally{try{p&&!p.done&&(e=c.return)&&e.call(c)}finally{if(t)throw t.error}}else u.remove(this);var d=this.initialTeardown;if(a(d))try{d()}catch(t){l=t instanceof h?t.errors:[t]}var y=this._finalizers;if(y){this._finalizers=null;try{for(var g=n(y),_=g.next();!_.done;_=g.next()){var m=_.value;try{f(m)}catch(t){l=null!=l?l:[],t instanceof h?l=s(s([],r(l)),r(t.errors)):l.push(t)}}}catch(t){i={error:t}}finally{try{_&&!_.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}}if(l)throw new h(l)}},t.prototype.add=function(e){var i;if(e&&e!==this)if(this.closed)f(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&u(e,t)},t.prototype.remove=function(e){var i=this._finalizers;i&&u(i,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t;var e}(),p=c.EMPTY;function d(t){return t instanceof c||t&&"closed"in t&&a(t.remove)&&a(t.add)&&a(t.unsubscribe)}function f(t){a(t)?t():t.unsubscribe()}var y=null,g=null,_=void 0,m=!1,v=!1,w={setTimeout:function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var o=w.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,s([t,e],r(i))):setTimeout.apply(void 0,s([t,e],r(i)))},clearTimeout:function(t){var e=w.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function b(t){w.setTimeout(function(){if(!y)throw t;y(t)})}function x(){}var S=k("C",void 0,void 0);function k(t,e,i){return{kind:t,value:e,error:i}}var A=null;function C(t){if(m){var e=!A;if(e&&(A={errorThrown:!1,error:null}),t(),e){var i=A,n=i.errorThrown,r=i.error;if(A=null,n)throw r}}else t()}var E=function(t){function i(e){var i=t.call(this)||this;return i.isStopped=!1,e?(i.destination=e,d(e)&&e.add(i)):i.destination=O,i}return e(i,t),i.create=function(t,e,i){return new T(t,e,i)},i.prototype.next=function(t){this.isStopped?$(function(t){return k("N",t,void 0)}(t),this):this._next(t)},i.prototype.error=function(t){this.isStopped?$(k("E",void 0,t),this):(this.isStopped=!0,this._error(t))},i.prototype.complete=function(){this.isStopped?$(S,this):(this.isStopped=!0,this._complete())},i.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},i.prototype._next=function(t){this.destination.next(t)},i.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},i.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},i}(c),I=Function.prototype.bind;function P(t,e){return I.call(t,e)}var M=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){z(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){z(t)}else z(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){z(t)}},t}(),T=function(t){function i(e,i,n){var r,s,o=t.call(this)||this;return a(e)||!e?r={next:null!=e?e:void 0,error:null!=i?i:void 0,complete:null!=n?n:void 0}:o&&v?((s=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},r={next:e.next&&P(e.next,s),error:e.error&&P(e.error,s),complete:e.complete&&P(e.complete,s)}):r=e,o.destination=new M(r),o}return e(i,t),i}(E);function z(t){var e;m?(e=t,m&&A&&(A.errorThrown=!0,A.error=e)):b(t)}function $(t,e){var i=g;i&&w.setTimeout(function(){return i(t,e)})}var O={closed:!0,next:x,error:function(t){throw t},complete:x},R="function"==typeof Symbol&&Symbol.observable||"@@observable";function W(t){return t}var D=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var i=new t;return i.source=this,i.operator=e,i},t.prototype.subscribe=function(t,e,i){var n,r=this,s=(n=t)&&n instanceof E||function(t){return t&&a(t.next)&&a(t.error)&&a(t.complete)}(n)&&d(n)?t:new T(t,e,i);return C(function(){var t=r,e=t.operator,i=t.source;s.add(e?e.call(s,i):i?r._subscribe(s):r._trySubscribe(s))}),s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var i=this;return new(e=Z(e))(function(e,n){var r=new T({next:function(e){try{t(e)}catch(t){n(t),r.unsubscribe()}},error:n,complete:e});i.subscribe(r)})},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[R]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0===(i=t).length?W:1===i.length?i[0]:function(t){return i.reduce(function(t,e){return e(t)},t)})(this);var i},t.prototype.toPromise=function(t){var e=this;return new(t=Z(t))(function(t,i){var n;e.subscribe(function(t){return n=t},function(t){return i(t)},function(){return t(n)})})},t.create=function(e){return new t(e)},t}();function Z(t){var e;return null!==(e=null!=t?t:_)&&void 0!==e?e:Promise}var L=l(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),N=function(t){function i(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(i,t),i.prototype.lift=function(t){var e=new X(this,this);return e.operator=t,e},i.prototype._throwIfClosed=function(){if(this.closed)throw new L},i.prototype.next=function(t){var e=this;C(function(){var i,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var s=n(e.currentObservers),o=s.next();!o.done;o=s.next())o.value.next(t)}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}}})},i.prototype.error=function(t){var e=this;C(function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var i=e.observers;i.length;)i.shift().error(t)}})},i.prototype.complete=function(){var t=this;C(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},i.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(i.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),i.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},i.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},i.prototype._innerSubscribe=function(t){var e=this,i=this,n=i.hasError,r=i.isStopped,s=i.observers;return n||r?p:(this.currentObservers=null,s.push(t),new c(function(){e.currentObservers=null,u(s,t)}))},i.prototype._checkFinalizedStatuses=function(t){var e=this,i=e.hasError,n=e.thrownError,r=e.isStopped;i?t.error(n):r&&t.complete()},i.prototype.asObservable=function(){var t=new D;return t.source=this,t},i.create=function(t,e){return new X(t,e)},i}(D),X=function(t){function i(e,i){var n=t.call(this)||this;return n.destination=e,n.source=i,n}return e(i,t),i.prototype.next=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)},i.prototype.error=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)},i.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},i.prototype._subscribe=function(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:p},i}(N),j=function(t){function i(e){var i=t.call(this)||this;return i._value=e,i}return e(i,t),Object.defineProperty(i.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),i.prototype._subscribe=function(e){var i=t.prototype._subscribe.call(this,e);return!i.closed&&e.next(this._value),i},i.prototype.getValue=function(){var t=this,e=t.hasError,i=t.thrownError,n=t._value;if(e)throw i;return this._throwIfClosed(),n},i.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},i}(N),Y=function(t){function i(e,i){return t.call(this)||this}return e(i,t),i.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},i}(c),F={setInterval:function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var o=F.delegate;return(null==o?void 0:o.setInterval)?o.setInterval.apply(o,s([t,e],r(i))):setInterval.apply(void 0,s([t,e],r(i)))},clearInterval:function(t){var e=F.delegate;return((null==e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},B=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n.scheduler=e,n.work=i,n.pending=!1,n}return e(i,t),i.prototype.schedule=function(t,e){var i;if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(r,this.id,e),this},i.prototype.requestAsyncId=function(t,e,i){return void 0===i&&(i=0),F.setInterval(t.flush.bind(t,this),i)},i.prototype.recycleAsyncId=function(t,e,i){if(void 0===i&&(i=0),null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&F.clearInterval(e)},i.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},i.prototype._execute=function(t,e){var i,n=!1;try{this.work(t)}catch(t){n=!0,i=t||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),i},i.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,i=this.scheduler,n=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,u(n,this),null!=e&&(this.id=this.recycleAsyncId(i,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},i}(Y),V={now:function(){return(V.delegate||Date).now()},delegate:void 0},G=function(){function t(e,i){void 0===i&&(i=t.now),this.schedulerActionCtor=e,this.now=i}return t.prototype.schedule=function(t,e,i){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(i,e)},t.now=V.now,t}(),H=function(t){function i(e,i){void 0===i&&(i=G.now);var n=t.call(this,e,i)||this;return n.actions=[],n._active=!1,n}return e(i,t),i.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}},i}(G),K=new H(B),U=K;function q(t){return t&&a(t.schedule)}function J(t,e,i){void 0===t&&(t=0),void 0===i&&(i=U);var n=-1;return null!=e&&(q(e)?i=e:n=e),new D(function(e){var r,s=(r=t)instanceof Date&&!isNaN(r)?+t-i.now():t;s<0&&(s=0);var o=0;return i.schedule(function(){e.closed||(e.next(o++),0<=n?this.schedule(void 0,n):e.complete())},s)})}function Q(t,e){return void 0===t&&(t=0),void 0===e&&(e=K),t<0&&(t=0),J(t,t,e)}function tt(t){return function(e){if(function(t){return a(null==t?void 0:t.lift)}(e))return e.lift(function(e){try{return t(e,this)}catch(t){this.error(t)}});throw new TypeError("Unable to lift unknown Observable type")}}function et(t,e,i,n,r){return new it(t,e,i,n,r)}var it=function(t){function i(e,i,n,r,s,o){var a=t.call(this,e)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=i?function(t){try{i(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=r?function(t){try{r(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return e(i,t),i.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},i}(E),nt=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function rt(t){return a(null==t?void 0:t.then)}function st(t){return a(t[R])}function ot(t){return Symbol.asyncIterator&&a(null==t?void 0:t[Symbol.asyncIterator])}function at(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var lt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ht(t){return a(null==t?void 0:t[lt])}function ut(t){return function(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,r=i.apply(t,e||[]),s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(t){r[t]&&(n[t]=function(e){return new Promise(function(i,n){s.push([t,e,i,n])>1||l(t,e)})})}function l(t,e){try{(i=r[t](e)).value instanceof o?Promise.resolve(i.value.v).then(h,u):c(s[0][2],i)}catch(t){c(s[0][3],t)}var i}function h(t){l("next",t)}function u(t){l("throw",t)}function c(t,e){t(e),s.shift(),s.length&&l(s[0][0],s[0][1])}}(this,arguments,function(){var e,n,r;return i(this,function(i){switch(i.label){case 0:e=t.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,o(e.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,o(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,o(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function ct(t){return a(null==t?void 0:t.getReader)}function pt(t){if(t instanceof D)return t;if(null!=t){if(st(t))return s=t,new D(function(t){var e=s[R]();if(a(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(nt(t))return e=t,new D(function(t){for(var i=0;i<e.length&&!t.closed;i++)t.next(e[i]);t.complete()});if(rt(t))return r=t,new D(function(t){r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,b)});if(ot(t))return dt(t);if(ht(t))return i=t,new D(function(t){var e,r;try{for(var s=n(i),o=s.next();!o.done;o=s.next()){var a=o.value;if(t.next(a),t.closed)return}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}t.complete()});if(ct(t))return dt(ut(t))}var e,i,r,s;throw at(t)}function dt(t){return new D(function(e){(function(t,e){var r,s,o,a,l,h,u,c;return l=this,h=void 0,c=function(){var l,h;return i(this,function(i){switch(i.label){case 0:i.trys.push([0,5,6,11]),r=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=n(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(e){return new Promise(function(n,r){!function(t,e,i,n){Promise.resolve(n).then(function(e){t({value:e,done:i})},e)}(n,r,(e=t[i](e)).done,e.value)})}}}(t),i.label=1;case 1:return[4,r.next()];case 2:if((s=i.sent()).done)return[3,4];if(l=s.value,e.next(l),e.closed)return[2];i.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return h=i.sent(),o={error:h},[3,11];case 6:return i.trys.push([6,,9,10]),s&&!s.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:i.sent(),i.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})},new((u=void 0)||(u=Promise))(function(t,e){function i(t){try{r(c.next(t))}catch(t){e(t)}}function n(t){try{r(c.throw(t))}catch(t){e(t)}}function r(e){var r;e.done?t(e.value):(r=e.value,r instanceof u?r:new u(function(t){t(r)})).then(i,n)}r((c=c.apply(l,h||[])).next())})})(t,e).catch(function(t){return e.error(t)})})}function ft(t){return tt(function(e,i){pt(t).subscribe(et(i,function(){return i.complete()},x)),!i.closed&&e.subscribe(i)})}class yt{constructor(t,e="",i="local"){this._initialConfig=t,this._storageKey=e,this._persistable=!!e,this._storageType=i,this.load()||(this.data=Object.assign({},this._initialConfig)),this.init()}init(){null==window.zetaConfig&&(window.zetaConfig=[]),null==window.zetaConfigCtrl&&(window.zetaConfigCtrl=[]),window.zetaConfig[this._storageKey]=this.data,window.zetaConfigCtrl[this._storageKey]=this,window.addEventListener("beforeunload",()=>{this.save()})}save(){this._persistable?(("local"===this._storageType?localStorage:sessionStorage).setItem(this._storageKey,JSON.stringify(this.data)),console.log(`Configuration ${this._storageKey} saved to ${this._storageType}`)):console.log(`Configuration ${this._storageKey} not persistable`)}load(){if(!this._persistable)return!1;{const t=("local"===this._storageType?localStorage:sessionStorage).getItem(this._storageKey);if(!t)return console.log(`No Configuration ${this._storageKey} found in ${this._storageType}`),!1;try{return this.data=JSON.parse(t),console.log(`Configuration ${this._storageKey} loaded from ${this._storageType}`),!0}catch(t){return console.error("Error loading configuration ${this._storageKey}:",t),!1}}}clear(){("local"===this._storageType?localStorage:sessionStorage).removeItem(this._storageKey),console.log(`Configuration ${this._storageKey} cleared from ${this._storageType}`)}print(){console.log("Current configuration ${this._storageKey}:",this.data)}reset(){this.data=Object.assign({},this._initialConfig),console.log(`Configuration ${this._storageKey} reset ${JSON.stringify(this.data)}`)}}const gt=Math.PI/180;function _t(){return{position:{x:0,y:0,z:-7.5},angleX:45*gt,angleY:45*gt,angleZ:0*gt}}class mt{constructor(){this.state$=new j(_t())}get position(){return this.state$.getValue().position}get angleX(){return this.state$.getValue().angleX}get angleY(){return this.state$.getValue().angleY}get angleZ(){return this.state$.getValue().angleZ}moveX(t){const e=structuredClone(this.state$.getValue());e.position.x+=t,this.state$.next(e)}moveY(t){const e=structuredClone(this.state$.getValue());e.position.y+=t,this.state$.next(e)}moveZ(t){const e=structuredClone(this.state$.getValue());e.position.z+=t,this.state$.next(e)}rotateX(t){const e=structuredClone(this.state$.getValue());e.angleX+=t,this.state$.next(e)}rotateY(t){const e=structuredClone(this.state$.getValue());e.angleY+=t,this.state$.next(e)}rotateZ(t){const e=structuredClone(this.state$.getValue());e.angleZ+=t,this.state$.next(e)}mountCamera(t){const e=structuredClone(t);this.state$.next(e)}}var vt;!function(t){t.W="w",t.A="a",t.S="s",t.D="d",t.R="r",t.F="f",t.Up="ArrowUp",t.Left="ArrowLeft",t.Down="ArrowDown",t.Right="ArrowRight",t.Comma=",",t.Dot="."}(vt||(vt={}));class wt{constructor(t){this._camera=t}onNextEvent(t){switch(t){case vt.W:return this._camera.moveZ(.1),!0;case vt.A:return this._camera.moveX(-.1),!0;case vt.S:return this._camera.moveZ(-.1),!0;case vt.D:return this._camera.moveX(.1),!0;case vt.R:return this._camera.moveY(.1),!0;case vt.F:return this._camera.moveY(-.1),!0;case vt.Up:return this._camera.rotateX(gt),!0;case vt.Left:return this._camera.rotateY(gt),!0;case vt.Down:return this._camera.rotateX(-gt),!0;case vt.Right:return this._camera.rotateY(-gt),!0;case vt.Comma:return this._camera.rotateZ(-gt),!0;case vt.Dot:return this._camera.rotateZ(gt),!0;default:return!1}}}class bt{constructor(){this._listeners=new Map,this._animationClassName="physical-key-pressed-detected",this._animationEndEvent="animationend"}triggerAnimation(t){const e=this.getElementFromKeyValue(t);if(null!=e){const t=()=>{e.classList.remove(this._animationClassName),this._listeners.delete(e)};this.cleanupListener(e),e.classList.remove(this._animationClassName),e.offsetWidth,e.classList.add(this._animationClassName),e.addEventListener(this._animationEndEvent,t,{once:!0}),this._listeners.set(e,t)}}cleanupAll(){this._listeners.forEach((t,e)=>{e.removeEventListener(this._animationEndEvent,t)}),this._listeners.clear()}cleanupListener(t){const e=this._listeners.get(t);e&&(t.removeEventListener(this._animationEndEvent,e),this._listeners.delete(t))}getElementFromKeyValue(t){switch(t){case vt.W:case vt.A:case vt.S:case vt.D:case vt.R:case vt.F:case vt.Up:case vt.Left:case vt.Down:case vt.Right:return document.getElementById(`virtual-key-${t}`);case vt.Comma:return document.getElementById("virtual-key-Comma");case vt.Dot:return document.getElementById("virtual-key-Period");case"Escape":return document.getElementById("virtual-key-Escape");default:return null}}}var xt=new D(function(t){return t.complete()}),St=Array.isArray,kt=Object.getPrototypeOf,At=Object.prototype,Ct=Object.keys;function Et(t,e,i,n,r){void 0===n&&(n=0),void 0===r&&(r=!1);var s=e.schedule(function(){i(),r?t.add(this.schedule(null,n)):this.unsubscribe()},n);if(t.add(s),!r)return s}function It(t,e){return void 0===e&&(e=0),tt(function(i,n){i.subscribe(et(n,function(i){return Et(n,t,function(){return n.next(i)},e)},function(){return Et(n,t,function(){return n.complete()},e)},function(i){return Et(n,t,function(){return n.error(i)},e)}))})}function Pt(t,e){return void 0===e&&(e=0),tt(function(i,n){n.add(t.schedule(function(){return i.subscribe(n)},e))})}function Mt(t,e){if(!t)throw new Error("Iterable cannot be null");return new D(function(i){Et(i,e,function(){var n=t[Symbol.asyncIterator]();Et(i,e,function(){n.next().then(function(t){t.done?i.complete():i.next(t.value)})},0,!0)})})}function Tt(t,e){return e?function(t,e){if(null!=t){if(st(t))return function(t,e){return pt(t).pipe(Pt(e),It(e))}(t,e);if(nt(t))return function(t,e){return new D(function(i){var n=0;return e.schedule(function(){n===t.length?i.complete():(i.next(t[n++]),i.closed||this.schedule())})})}(t,e);if(rt(t))return function(t,e){return pt(t).pipe(Pt(e),It(e))}(t,e);if(ot(t))return Mt(t,e);if(ht(t))return function(t,e){return new D(function(i){var n;return Et(i,e,function(){n=t[lt](),Et(i,e,function(){var t,e,r;try{e=(t=n.next()).value,r=t.done}catch(t){return void i.error(t)}r?i.complete():i.next(e)},0,!0)}),function(){return a(null==n?void 0:n.return)&&n.return()}})}(t,e);if(ct(t))return function(t,e){return Mt(ut(t),e)}(t,e)}throw at(t)}(t,e):pt(t)}function zt(t,e){return tt(function(i,n){var r=0;i.subscribe(et(n,function(i){n.next(t.call(e,i,r++))}))})}var $t,Ot=Array.isArray;function Rt(t){return zt(function(e){return function(t,e){return Ot(e)?t.apply(void 0,s([],r(e))):t(e)}(t,e)})}function Wt(t){return t[t.length-1]}function Dt(t){return q(Wt(t))?t.pop():void 0}function Zt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Dt(t),n=function(t){return a(Wt(t))?t.pop():void 0}(t),r=function(t){if(1===t.length){var e=t[0];if(St(e))return{args:e,keys:null};if((n=e)&&"object"==typeof n&&kt(n)===At){var i=Ct(e);return{args:i.map(function(t){return e[t]}),keys:i}}}var n;return{args:t,keys:null}}(t),s=r.args,o=r.keys;if(0===s.length)return Tt([],i);var l=new D(function(t,e,i){return void 0===i&&(i=W),function(n){Lt(e,function(){for(var r=t.length,s=new Array(r),o=r,a=r,l=function(r){Lt(e,function(){var l=Tt(t[r],e),h=!1;l.subscribe(et(n,function(t){s[r]=t,h||(h=!0,a--),a||n.next(i(s.slice()))},function(){--o||n.complete()}))},n)},h=0;h<r;h++)l(h)},n)}}(s,i,o?function(t){return function(t,e){return t.reduce(function(t,i,n){return t[i]=e[n],t},{})}(o,t)}:W));return n?l.pipe(Rt(n)):l}function Lt(t,e,i){t?Et(i,t,e):e()}!function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"}($t||($t={}));class Nt{constructor(){this.m=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}static multiply(t,e){let i=new Nt;for(let n=0;n<Nt.SIZE;n++)for(let r=0;r<Nt.SIZE;r++)for(let s=0;s<Nt.SIZE;s++)i.m[n][r]+=t.m[n][s]*e.m[s][r];return i}get det(){let t=this.m;return t[0][0]*t[1][1]*t[2][2]*t[3][3]+t[0][0]*t[1][2]*t[2][3]*t[3][1]+t[0][0]*t[1][3]*t[2][1]*t[3][2]+t[0][1]*t[1][0]*t[2][3]*t[3][2]+t[0][1]*t[1][2]*t[2][0]*t[3][3]+t[0][1]*t[1][3]*t[2][2]*t[3][0]+t[0][2]*t[1][0]*t[2][1]*t[3][3]+t[0][2]*t[1][1]*t[2][3]*t[3][0]+t[0][2]*t[1][3]*t[2][0]*t[3][1]+t[0][3]*t[1][0]*t[2][2]*t[3][1]+t[0][3]*t[1][1]*t[2][0]*t[3][2]+t[0][3]*t[1][2]*t[2][1]*t[3][0]-t[0][0]*t[1][1]*t[2][3]*t[3][2]-t[0][0]*t[1][2]*t[2][1]*t[3][3]-t[0][0]*t[1][3]*t[2][2]*t[3][1]-t[0][1]*t[1][0]*t[2][2]*t[3][3]-t[0][1]*t[1][2]*t[2][3]*t[3][0]-t[0][1]*t[1][3]*t[2][0]*t[3][2]-t[0][2]*t[1][0]*t[2][3]*t[3][1]-t[0][2]*t[1][1]*t[2][0]*t[3][3]-t[0][2]*t[1][3]*t[2][1]*t[3][0]-t[0][3]*t[1][0]*t[2][1]*t[3][2]-t[0][3]*t[1][1]*t[2][2]*t[3][0]-t[0][3]*t[1][2]*t[2][0]*t[3][1]}get inv(){let t=this.det;if(!t)return null;let e=this.m,i=new Nt;return i.m[0][0]=e[1][1]*e[2][2]*e[3][3]+e[1][2]*e[2][3]*e[3][1]+e[1][3]*e[2][1]*e[3][2]-e[1][1]*e[2][3]*e[3][2]-e[1][2]*e[2][1]*e[3][3]-e[1][3]*e[2][2]*e[3][1],i.m[0][1]=e[0][1]*e[2][3]*e[3][2]+e[0][2]*e[2][1]*e[3][3]+e[0][3]*e[2][2]*e[3][1]-e[0][1]*e[2][2]*e[3][3]-e[0][2]*e[2][3]*e[3][1]-e[0][3]*e[2][1]*e[3][2],i.m[0][2]=e[0][1]*e[1][2]*e[3][3]+e[0][2]*e[1][3]*e[3][1]+e[0][3]*e[1][1]*e[3][2]-e[0][1]*e[1][3]*e[3][2]-e[0][2]*e[1][1]*e[3][3]-e[0][3]*e[1][2]*e[3][1],i.m[0][3]=e[0][1]*e[1][3]*e[2][2]+e[0][2]*e[1][1]*e[2][3]+e[0][3]*e[1][2]*e[2][1]-e[0][1]*e[1][2]*e[2][3]-e[0][2]*e[1][3]*e[2][1]-e[0][3]*e[1][1]*e[2][2],i.m[1][0]=e[1][0]*e[2][3]*e[3][2]+e[1][2]*e[2][0]*e[3][3]+e[1][3]*e[2][2]*e[3][0]-e[1][0]*e[2][2]*e[3][3]-e[1][2]*e[2][3]*e[3][0]-e[1][3]*e[2][0]*e[3][2],i.m[1][1]=e[0][0]*e[2][2]*e[3][3]+e[0][2]*e[2][3]*e[3][0]+e[0][3]*e[2][0]*e[3][2]-e[0][0]*e[2][3]*e[3][2]-e[0][2]*e[2][0]*e[3][3]-e[0][3]*e[2][2]*e[3][0],i.m[1][2]=e[0][0]*e[1][3]*e[3][2]+e[0][2]*e[1][0]*e[3][3]+e[0][3]*e[1][2]*e[3][0]-e[0][0]*e[1][2]*e[3][3]-e[0][2]*e[1][3]*e[3][0]-e[0][3]*e[1][0]*e[3][2],i.m[1][3]=e[0][0]*e[1][2]*e[2][3]+e[0][2]*e[1][3]*e[2][0]+e[0][3]*e[1][0]*e[2][2]-e[0][0]*e[1][3]*e[2][2]-e[0][2]*e[1][0]*e[2][3]-e[0][3]*e[1][2]*e[2][0],i.m[2][0]=e[1][0]*e[2][1]*e[3][3]+e[1][1]*e[2][3]*e[3][0]+e[1][3]*e[2][0]*e[3][1]-e[1][0]*e[2][3]*e[3][1]-e[1][1]*e[2][0]*e[3][3]-e[1][3]*e[2][1]*e[3][0],i.m[2][1]=e[0][0]*e[2][3]*e[3][1]+e[0][1]*e[2][0]*e[3][3]+e[0][3]*e[2][1]*e[3][0]-e[0][0]*e[2][1]*e[3][3]-e[0][1]*e[2][3]*e[3][0]-e[0][3]*e[2][0]*e[3][1],i.m[2][2]=e[0][0]*e[1][1]*e[3][3]+e[0][1]*e[1][3]*e[3][0]+e[0][3]*e[1][0]*e[3][1]-e[0][0]*e[1][3]*e[3][1]-e[0][1]*e[1][0]*e[3][3]-e[0][3]*e[1][1]*e[3][0],i.m[2][3]=e[0][0]*e[1][3]*e[2][1]+e[0][1]*e[1][0]*e[2][3]+e[0][3]*e[1][1]*e[2][0]-e[0][0]*e[1][1]*e[2][3]-e[0][1]*e[1][3]*e[2][0]-e[0][3]*e[1][0]*e[2][1],i.m[3][0]=e[1][0]*e[2][2]*e[3][1]+e[1][1]*e[2][0]*e[3][2]+e[1][2]*e[2][1]*e[3][0]-e[1][0]*e[2][1]*e[3][2]-e[1][1]*e[2][2]*e[3][0]-e[1][2]*e[2][0]*e[3][1],i.m[3][1]=e[0][0]*e[2][1]*e[3][2]+e[0][1]*e[2][2]*e[3][0]+e[0][2]*e[2][0]*e[3][1]-e[0][0]*e[2][2]*e[3][1]-e[0][1]*e[2][0]*e[3][2]-e[0][2]*e[2][1]*e[3][0],i.m[3][2]=e[0][0]*e[1][2]*e[3][1]+e[0][1]*e[1][0]*e[3][2]+e[0][2]*e[1][1]*e[3][0]-e[0][0]*e[1][1]*e[3][2]-e[0][1]*e[1][2]*e[3][0]-e[0][2]*e[1][0]*e[3][1],i.m[3][3]=e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[1][0]*e[2][1]-e[0][0]*e[1][2]*e[2][1]-e[0][1]*e[1][0]*e[2][2]-e[0][2]*e[1][1]*e[2][0],i.scalarMultiply(1/t),i}scalarMultiply(t){for(let e=0;e<Nt.SIZE;e++)for(let i=0;i<Nt.SIZE;i++)this.m[e][i]*=t}vector3Multiply(t){let e,i=[t.x,t.y,t.z,1],n=[];for(let t=0;t<Nt.SIZE;t++){e=0;for(let n=0;n<Nt.SIZE;n++)e+=this.m[t][n]*i[n];n.push(e)}return{x:n[0],y:n[1],z:n[2]}}vector4Multiply(t){let e,i=[t.x,t.y,t.z,t.u],n=[];for(let t=0;t<Nt.SIZE;t++){e=0;for(let n=0;n<Nt.SIZE;n++)e+=this.m[t][n]*i[n];n.push(e)}return{x:n[0],y:n[1],z:n[2],u:n[3]}}log(){let t="";for(let e=0;e<Nt.SIZE;e++){for(let i=0;i<Nt.SIZE;i++)t+=this.m[e][i].toFixed(5)+" ";t+="\n"}console.log(t)}}Nt.SIZE=4;class Xt extends Nt{constructor(){super();for(let t=0;t<Nt.SIZE;t++)this.m[t][t]=1}}class jt extends Xt{constructor(t,e){super(),this.axis=t,this.angle=e}set angle(t){const e=Math.cos(t),i=Math.sin(t);switch(this.axis){case $t.X:this.m[1][1]=e,this.m[1][2]=-i,this.m[2][1]=i,this.m[2][2]=e;break;case $t.Y:this.m[0][0]=e,this.m[0][2]=i,this.m[2][0]=-i,this.m[2][2]=e;break;case $t.Z:this.m[0][0]=e,this.m[0][1]=-i,this.m[1][0]=i,this.m[1][1]=e}}}class Yt extends Xt{constructor(t){super(),this.vector=t}set vector(t){this.m[0][3]=t.x,this.m[1][3]=t.y,this.m[2][3]=t.z}set x(t){this.m[0][3]=t}set y(t){this.m[1][3]=t}set z(t){this.m[2][3]=t}}const Ft=new class{constructor(t,e){this.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",this.list=new Set,this.partSize=t,this.parts=e}newId(t){let e=this.createCandidate(t),i=0;for(;this.exists(e);)if(console.warn(`Candidate ${e} already exists. Retry.`),e=this.createCandidate(t),i++,i>10)return console.error("Could not create a unique id, returning empty string",this.list),"";return this.list.add(e),e}createCandidate(t){for(let e=0;e<this.parts;e++)t+=`_${this.createPart()}`;return t}createPart(){return[...Array(this.partSize).keys()].map(()=>this.getRandomChar()).join("")}getRandomChar(){return this.CHARS.charAt(Math.floor(Math.random()*this.CHARS.length))}exists(t){return this.list.has(t)}}(4,2);var Bt,Vt;!function(t){t.GROUP="GROUP",t.CIRCLE="CIRCLE",t.RECTANGLE="RECTANGLE",t.PATH="PATH",t.TEXT="TEXT"}(Bt||(Bt={}));class Gt{constructor(){this._dist=0,this._index=0,this._visibility=!0}set dist(t){this._dist=t}get dist(){return this._dist}set index(t){this._index=t}get index(){return this._index}get isVisible(){return this._visibility}set visible(t){this._visibility=t}}class Ht extends Gt{constructor(t,e,i,n,r){super(),this.id=Ft.newId(Bt.CIRCLE),this.type=Bt.CIRCLE,this.attr={cx:t,cy:e,r:i},this.dist=n,this.style=r}setPosition(t,e,i){this.attr.cx=t,this.attr.cy=e,this.attr.r=i}}class Kt{}class Ut extends Kt{constructor(t,e=1,i={strokeWidth:.15,stroke:"#aaa",strokeOpacity:1,fill:"#ddd",fillOpacity:1}){super(),this.type=Bt.CIRCLE,this.position=t,this.radius=e,this.style=i}get position(){return this._position}set position(t){this._position=t}get radius(){return this._radius}set radius(t){this._radius=t}get style(){return this._style}set style(t){this._style=t}get attributes(){return{type:this.type,position:structuredClone(this._position),radius:this._radius,style:structuredClone(this._style)}}}!function(t){t.DISTANCE="DISTANCE",t.INDEX="INDEX"}(Vt||(Vt={}));class qt extends Gt{constructor(t,e,i){super(),this.id=Ft.newId(Bt.GROUP),this.type=Bt.GROUP,this.attr={children:t,sortBy:e},this.dist=i}get children(){return this.attr.children}set sortBy(t){this.attr.sortBy=t}}class Jt extends Kt{constructor(t,e,i=Vt.DISTANCE){super(),this.type=Bt.GROUP,this.position=t,this._children=e,this._sortBy=i}get position(){return this._position}set position(t){this._position=t}get children(){return this._children}set children(t){this._children=t}get attributes(){return{type:this.type,position:structuredClone(this._position),children:structuredClone(this._children.map(t=>t.attributes)),sortBy:this._sortBy}}}class Qt extends Gt{constructor(t,e,i){super(),this.id=Ft.newId(Bt.PATH),this.type=Bt.PATH,this.attr={d:t},this.dist=e,this.style=i}setPath(t){this.attr.d=t}}class te extends Kt{constructor(t,e=!1,i=!1,n={strokeWidth:1.5,stroke:"#aaa",strokeOpacity:1}){super(),this.type=Bt.PATH,this.path=t,this._close=e,this._lockStrokeWidth=i,this.style=n}get path(){return this._path}set path(t){this._path=t}get style(){return this._style}set style(t){this._style=t}get attributes(){return{type:this.type,path:structuredClone(this._path),close:this._close,lockStrokeWidth:this._lockStrokeWidth,style:structuredClone(this._style)}}}class ee extends Gt{constructor(t,e,i){super(),this.id=Ft.newId(Bt.RECTANGLE),this.type=Bt.RECTANGLE,this.attr={d:t},this.dist=e,this.style=i}setPath(t){this.attr.d=t}}class ie{constructor(){this.m=[[0,0,0],[0,0,0],[0,0,0]]}static multiply(t,e){let i=new ie;for(let n=0;n<ie.SIZE;n++)for(let r=0;r<ie.SIZE;r++)for(let s=0;s<ie.SIZE;s++)i.m[n][r]+=t.m[n][s]*e.m[s][r];return i}scalarMultiply(t){for(let e=0;e<ie.SIZE;e++)for(let i=0;i<ie.SIZE;i++)this.m[e][i]*=t}vector3Multiply(t){let e,i=[t.x,t.y,t.z,1],n=[];for(let t=0;t<ie.SIZE;t++){e=0;for(let n=0;n<ie.SIZE;n++)e+=this.m[t][n]*i[n];n.push(e)}return{x:n[0],y:n[1],z:n[2]}}log(){let t="";for(let e=0;e<ie.SIZE;e++){for(let i=0;i<ie.SIZE;i++)t+=this.m[e][i].toFixed(5)+" ";t+="\n"}console.log(t)}}ie.SIZE=3;class ne extends ie{constructor(){super();for(let t=0;t<ie.SIZE;t++)this.m[t][t]=1}}class re extends ne{constructor(t,e){super(),this.axis=t,this.angle=e}set angle(t){const e=Math.cos(t),i=Math.sin(t);switch(this.axis){case $t.X:this.m[1][1]=e,this.m[1][2]=-i,this.m[2][1]=i,this.m[2][2]=e;break;case $t.Y:this.m[0][0]=e,this.m[0][2]=i,this.m[2][0]=-i,this.m[2][2]=e;break;case $t.Z:this.m[0][0]=e,this.m[0][1]=-i,this.m[1][0]=i,this.m[1][1]=e}}}function se(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}}class oe extends Kt{constructor(t,e,i,n={rotateX:0,rotateY:0,rotateZ:0},r={strokeWidth:1.5,stroke:"#aaa",strokeOpacity:1,fill:"#ddd",fillOpacity:1}){super(),this.type=Bt.RECTANGLE,this._position=t,this._width=e,this._height=i,this._rotateX=n.rotateX*gt,this._rotateY=n.rotateY*gt,this._rotateZ=n.rotateZ*gt,this._style=r,this.evaluatePath()}set position(t){this._position=t,this.evaluatePath()}set width(t){this._width=t,this.evaluatePath()}set height(t){this._height=t,this.evaluatePath()}get orientation(){return{rotateX:this._rotateX/gt,rotateY:this._rotateY/gt,rotateZ:this._rotateZ/gt}}set orientation(t){this._rotateX=t.rotateX*gt,this._rotateY=t.rotateY*gt,this._rotateZ=t.rotateZ*gt,this.evaluatePath()}set style(t){this._style=t}get attributes(){return{type:this.type,path:structuredClone(this._path),style:structuredClone(this._style)}}evaluatePath(){const t=new re($t.X,this._rotateX),e=new re($t.Y,this._rotateY),i=new re($t.Z,this._rotateZ);let n=new ne;n=ie.multiply(n,i),n=ie.multiply(n,e),n=ie.multiply(n,t);const r=this._width/2,s=this._height/2,o=[{x:-r,y:s,z:0},{x:r,y:s,z:0},{x:r,y:-s,z:0},{x:-r,y:-s,z:0}];this._path=o.map(t=>se(n.vector3Multiply(t),this._position))}}var ae=function(t){function i(e,i,n){void 0===e&&(e=1/0),void 0===i&&(i=1/0),void 0===n&&(n=V);var r=t.call(this)||this;return r._bufferSize=e,r._windowTime=i,r._timestampProvider=n,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=i===1/0,r._bufferSize=Math.max(1,e),r._windowTime=Math.max(1,i),r}return e(i,t),i.prototype.next=function(e){var i=this,n=i.isStopped,r=i._buffer,s=i._infiniteTimeWindow,o=i._timestampProvider,a=i._windowTime;n||(r.push(e),!s&&r.push(o.now()+a)),this._trimBuffer(),t.prototype.next.call(this,e)},i.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(t),i=this._infiniteTimeWindow,n=this._buffer.slice(),r=0;r<n.length&&!t.closed;r+=i?1:2)t.next(n[r]);return this._checkFinalizedStatuses(t),e},i.prototype._trimBuffer=function(){var t=this,e=t._bufferSize,i=t._timestampProvider,n=t._buffer,r=t._infiniteTimeWindow,s=(r?1:2)*e;if(e<1/0&&s<n.length&&n.splice(0,n.length-s),!r){for(var o=i.now(),a=0,l=1;l<n.length&&n[l]<=o;l+=2)a=l;a&&n.splice(0,a+1)}},i}(N);class le{constructor(t,e){this._collection$=new ae(1),this.collection$=this._collection$,this.id=Ft.newId(t),this._collection=e,this.emitList()}update(t){t(this._collection),this.emitList()}emitList(){this._collection$.next(this._collection)}}class he extends Gt{constructor(t,e,i,n,r,s){super(),this.id=Ft.newId(Bt.TEXT),this.type=Bt.TEXT,this.attr={x:t,y:e,fontSize:i,text:n},this.dist=r,this.style=s}setPosition(t,e,i){this.attr.x=t,this.attr.y=e,this.attr.fontSize=i}setText(t){this.attr.text=t}}class ue extends Kt{constructor(t,e,i=!1,n={fontSize:12,fontFamily:"sans-serif",fill:"#666",fillOpacity:1,alignmentBaseline:"baseline"}){super(),this.type=Bt.TEXT,this.position=t,this.text=e,this._lockFontSize=i,this.style=n}get position(){return this._position}set position(t){this._position=t}get text(){return this._text}set text(t){this._text=t}get style(){return this._style}set style(t){this._style=t}get attributes(){return{type:this.type,position:structuredClone(this._position),text:this._text,lockFontSize:this._lockFontSize,style:structuredClone(this._style)}}}class ce{constructor(t,e,i,n){var r,s,o;this._stageWidthHalf=i/2,this._stageHeightHalf=n/2,this._stageRatioInverted=n/i,this._stageNear=1,this._stageFar=30,this._elementStageSizeFactor=i/1280,this._world=t,this._camera=e,this._world.state$.pipe(tt(function(t,e){var i=0;t.subscribe(et(e,function(t){++i<=1&&(e.next(t),1<=i&&e.complete())}))})).subscribe(t=>{this.createShapes(this.createData(t))}),Zt([this._world.state$,this._camera.state$]).pipe((r=40,void 0===s&&(s=K),o=Q(r,s),tt(function(t,e){var i=!1,n=null;t.subscribe(et(e,function(t){i=!0,n=t})),pt(o).subscribe(et(e,function(){if(i){i=!1;var t=n;n=null,e.next(t)}},x))}))).subscribe(t=>{this.updateShapes(this.createData(t[0]))})}get shapes(){return this._shapes}createData(t){const e=new jt($t.X,this._camera.angleX),i=new jt($t.Y,this._camera.angleY),n=new jt($t.Z,this._camera.angleZ),r=new Yt(this._camera.position);let s=new Xt;return s=Nt.multiply(s,n),s=Nt.multiply(s,i),s=Nt.multiply(s,e),s=Nt.multiply(s,r),s=s.inv,{groups:t.groups.map(t=>{let e=s.vector3Multiply(t.position);const i=[];return t.children.forEach((e,n)=>{switch(e.type){case Bt.CIRCLE:i.push({child:this.projectCircle(this.translateCircle(e,t.position),s),index:n});break;case Bt.PATH:i.push({child:this.projectPath(this.translatePath(e,t.position),s),index:n})}}),{type:t.type,children:t.children,sortBy:t.sortBy,projectedChildren:i,dist:this.distanceToCamera(e),position:t.position}}),circles:t.circles.map(t=>this.projectCircle(t,s)),paths:t.paths.map(t=>this.projectPath(t,s)),rectangles:t.rectangles.map(t=>this.projectRectangle(t,s)),texts:t.texts.map(t=>this.projectText(t,s))}}translateCircle(t,e){return{type:t.type,position:se(t.position,e),radius:t.radius,style:t.style}}translatePath(t,e){return{type:t.type,path:t.path.map(t=>se(t,e)),close:t.close,lockStrokeWidth:t.lockStrokeWidth,style:t.style}}projectCircle(t,e){let i=e.vector3Multiply(t.position);return{type:t.type,pixel:this.spaceToPixel(i),dist:this.distanceToCamera(i),position:{x:t.position.x,y:t.position.y,z:t.position.z},radius:t.radius,style:t.style}}projectPath(t,e){let i,n=e.vector3Multiply(t.path[0]),r=this.spaceToPixel(n),s=this.distanceToCamera(n),o="M"+r.left+" "+r.top+" ";for(let a=1;a<t.path.length;a++)n=e.vector3Multiply(t.path[a]),r=this.spaceToPixel(n),i=this.distanceToCamera(n),s=Math.min(s,i),o+="L"+r.left+" "+r.top+" ";return{type:t.type,path:t.path,close:t.close,d:t.close?o+"Z":o,dist:s,lockStrokeWidth:t.lockStrokeWidth,style:t.style}}projectRectangle(t,e){let i,n=e.vector3Multiply(t.path[0]),r=this.spaceToPixel(n),s=this.distanceToCamera(n),o="M"+r.left+" "+r.top+" ";for(let a=1;a<t.path.length;a++)n=e.vector3Multiply(t.path[a]),r=this.spaceToPixel(n),i=this.distanceToCamera(n),s=Math.min(s,i),o+="L"+r.left+" "+r.top+" ";return{type:t.type,path:t.path,d:o+"Z",dist:s,style:t.style}}projectText(t,e){let i=e.vector3Multiply(t.position);return{type:t.type,pixel:this.spaceToPixel(i),dist:this.distanceToCamera(i),position:{x:t.position.x,y:t.position.y,z:t.position.z},text:t.text,lockFontSize:t.lockFontSize,style:t.style}}createShapes(t){this._shapes=new le("PRJ",{groups:t.groups.map(t=>{const e=[];return t.projectedChildren.forEach(t=>{switch(t.child.type){case Bt.CIRCLE:e.push({child:this.createCircle(t.child),index:t.index});break;case Bt.PATH:e.push({child:this.createPath(t.child),index:t.index})}}),new qt(e,t.sortBy,t.dist)}),circles:t.circles.map(t=>this.createCircle(t)),paths:t.paths.map(t=>this.createPath(t)),rectangles:t.rectangles.map(t=>this.createRectangle(t)),texts:t.texts.map(t=>this.createText(t))})}createCircle(t){return new Ht(t.pixel.left,t.pixel.top,this.getDistantDependentValue(t.radius,t.dist),t.dist,{strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity,fill:t.style.fill,fillOpacity:t.style.fillOpacity})}createPath(t){return new Qt(t.d,t.dist,{strokeWidth:t.lockStrokeWidth?t.style.strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity})}createRectangle(t){return new ee(t.d,t.dist,{strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity,fill:t.style.fill,fillOpacity:t.style.fillOpacity})}createText(t){return new he(t.pixel.left,t.pixel.top,t.lockFontSize?t.style.fontSize:this.getDistantDependentValue(t.style.fontSize,t.dist),t.text,t.dist,t.style)}updateShapes(t){this._shapes.update(e=>{e.groups.forEach((e,i)=>this.updateGroup(e,t.groups[i])),e.circles.forEach((e,i)=>this.updateCircle(e,t.circles[i])),e.paths.forEach((e,i)=>this.updatePath(e,t.paths[i])),e.rectangles.forEach((e,i)=>this.updateRectangles(e,t.rectangles[i])),e.texts.forEach((e,i)=>this.updateText(e,t.texts[i]))})}updateGroup(t,e){t.children.forEach((t,i)=>{switch(t.child.type){case Bt.CIRCLE:{const n=t.child,r=e.projectedChildren[i].child;n.type==Bt.CIRCLE&&r.type==Bt.CIRCLE||console.error(`#updateGroup: Error in Child Elements shape=${n} and projectedShape=${r} should be ${Bt.CIRCLE}!`),this.updateCircle(n,r,t.index);break}case Bt.PATH:{const n=t.child,r=e.projectedChildren[i].child;n.type==Bt.PATH&&r.type==Bt.PATH||console.error(`#updateGroup: Error in Child Elements shape=${n} and projectedShape=${r} should be ${Bt.PATH}!`),this.updatePath(n,r,t.index);break}}}),t.dist=e.dist,t.sortBy=e.sortBy,t.visible=e.dist>0}updateCircle(t,e,i=null){t.setPosition(e.pixel.left,e.pixel.top,this.getDistantDependentValue(e.radius,e.dist)),t.dist=e.dist,t.style={strokeWidth:this.getDistantDependentValue(e.style.strokeWidth,e.dist),stroke:e.style.stroke,strokeOpacity:e.style.strokeOpacity,fill:e.style.fill,fillOpacity:e.style.fillOpacity},null!=i&&(t.index=i),t.visible=e.dist>0}updateRectangles(t,e){t.setPath(e.d),t.dist=e.dist,t.style={strokeWidth:this.getDistantDependentValue(e.style.strokeWidth,e.dist),stroke:e.style.stroke,strokeOpacity:e.style.strokeOpacity,fill:e.style.fill,fillOpacity:e.style.fillOpacity},t.visible=e.dist>0}updatePath(t,e,i=null){t.setPath(e.d),t.dist=e.dist,t.style={strokeWidth:e.lockStrokeWidth?e.style.strokeWidth:this.getDistantDependentValue(e.style.strokeWidth,e.dist),stroke:e.style.stroke,strokeOpacity:e.style.strokeOpacity},null!=i&&(t.index=i),t.visible=e.dist>0}updateText(t,e){t.setPosition(e.pixel.left,e.pixel.top,e.lockFontSize?t.style.fontSize:this.getDistantDependentValue(t.style.fontSize,t.dist)),t.dist=e.dist,t.style=e.style,t.visible=e.dist>0,t.setText(e.text)}getDistantDependentValue(t,e){return e>0?t/e*20*this._elementStageSizeFactor:0}spaceToPixel(t){return this.planeToPixel(this.spaceToPlane(t))}spaceToPlane(t){if(t.z<this._stageNear)return{x:0,y:0};const e=1/t.z;return{x:e*t.x,y:e*t.y}}distanceToCamera(t){return t.z<this._stageNear?-1:t.z*(this._stageFar-this._stageNear)/(this._stageNear*(this._stageFar-t.z))}planeToPixel(t){return{left:this._stageWidthHalf*t.x*this._stageRatioInverted+this._stageWidthHalf,top:-this._stageHeightHalf*t.y+this._stageHeightHalf}}}function pe(){}function de(t){return null==t?pe:function(){return this.querySelector(t)}}function fe(){return[]}function ye(t){return null==t?fe:function(){return this.querySelectorAll(t)}}function ge(t){return function(){return this.matches(t)}}function _e(t){return function(e){return e.matches(t)}}var me=Array.prototype.find;function ve(){return this.firstElementChild}var we=Array.prototype.filter;function be(){return Array.from(this.children)}function xe(t){return new Array(t.length)}function Se(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function ke(t,e,i,n,r,s){for(var o,a=0,l=e.length,h=s.length;a<h;++a)(o=e[a])?(o.__data__=s[a],n[a]=o):i[a]=new Se(t,s[a]);for(;a<l;++a)(o=e[a])&&(r[a]=o)}function Ae(t,e,i,n,r,s,o){var a,l,h,u=new Map,c=e.length,p=s.length,d=new Array(c);for(a=0;a<c;++a)(l=e[a])&&(d[a]=h=o.call(l,l.__data__,a,e)+"",u.has(h)?r[a]=l:u.set(h,l));for(a=0;a<p;++a)h=o.call(t,s[a],a,s)+"",(l=u.get(h))?(n[a]=l,l.__data__=s[a],u.delete(h)):i[a]=new Se(t,s[a]);for(a=0;a<c;++a)(l=e[a])&&u.get(d[a])===l&&(r[a]=l)}function Ce(t){return t.__data__}function Ee(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Ie(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}Se.prototype={constructor:Se,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var Pe="http://www.w3.org/1999/xhtml";const Me={svg:"http://www.w3.org/2000/svg",xhtml:Pe,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Te(t){var e=t+="",i=e.indexOf(":");return i>=0&&"xmlns"!==(e=t.slice(0,i))&&(t=t.slice(i+1)),Me.hasOwnProperty(e)?{space:Me[e],local:t}:t}function ze(t){return function(){this.removeAttribute(t)}}function $e(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Oe(t,e){return function(){this.setAttribute(t,e)}}function Re(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function We(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttribute(t):this.setAttribute(t,i)}}function De(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function Ze(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Le(t){return function(){this.style.removeProperty(t)}}function Ne(t,e,i){return function(){this.style.setProperty(t,e,i)}}function Xe(t,e,i){return function(){var n=e.apply(this,arguments);null==n?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function je(t,e){return t.style.getPropertyValue(e)||Ze(t).getComputedStyle(t,null).getPropertyValue(e)}function Ye(t){return function(){delete this[t]}}function Fe(t,e){return function(){this[t]=e}}function Be(t,e){return function(){var i=e.apply(this,arguments);null==i?delete this[t]:this[t]=i}}function Ve(t){return t.trim().split(/^|\s+/)}function Ge(t){return t.classList||new He(t)}function He(t){this._node=t,this._names=Ve(t.getAttribute("class")||"")}function Ke(t,e){for(var i=Ge(t),n=-1,r=e.length;++n<r;)i.add(e[n])}function Ue(t,e){for(var i=Ge(t),n=-1,r=e.length;++n<r;)i.remove(e[n])}function qe(t){return function(){Ke(this,t)}}function Je(t){return function(){Ue(this,t)}}function Qe(t,e){return function(){(e.apply(this,arguments)?Ke:Ue)(this,t)}}function ti(){this.textContent=""}function ei(t){return function(){this.textContent=t}}function ii(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function ni(){this.innerHTML=""}function ri(t){return function(){this.innerHTML=t}}function si(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function oi(){this.nextSibling&&this.parentNode.appendChild(this)}function ai(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function li(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===Pe&&e.documentElement.namespaceURI===Pe?e.createElement(t):e.createElementNS(i,t)}}function hi(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function ui(t){var e=Te(t);return(e.local?hi:li)(e)}function ci(){return null}function pi(){var t=this.parentNode;t&&t.removeChild(this)}function di(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function fi(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function yi(t){return function(){var e=this.__on;if(e){for(var i,n=0,r=-1,s=e.length;n<s;++n)i=e[n],t.type&&i.type!==t.type||i.name!==t.name?e[++r]=i:this.removeEventListener(i.type,i.listener,i.options);++r?e.length=r:delete this.__on}}}function gi(t,e,i){return function(){var n,r=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var o=0,a=r.length;o<a;++o)if((n=r[o]).type===t.type&&n.name===t.name)return this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=i),void(n.value=e);this.addEventListener(t.type,s,i),n={type:t.type,name:t.name,value:e,listener:s,options:i},r?r.push(n):this.__on=[n]}}function _i(t,e,i){var n=Ze(t),r=n.CustomEvent;"function"==typeof r?r=new r(e,i):(r=n.document.createEvent("Event"),i?(r.initEvent(e,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function mi(t,e){return function(){return _i(this,t,e)}}function vi(t,e){return function(){return _i(this,t,e.apply(this,arguments))}}He.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var wi=[null];function bi(t,e){this._groups=t,this._parents=e}function xi(){return new bi([[document.documentElement]],wi)}bi.prototype=xi.prototype={constructor:bi,select:function(t){"function"!=typeof t&&(t=de(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var s,o,a=e[r],l=a.length,h=n[r]=new Array(l),u=0;u<l;++u)(s=a[u])&&(o=t.call(s,s.__data__,u,a))&&("__data__"in s&&(o.__data__=s.__data__),h[u]=o);return new bi(n,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):ye(t);for(var e=this._groups,i=e.length,n=[],r=[],s=0;s<i;++s)for(var o,a=e[s],l=a.length,h=0;h<l;++h)(o=a[h])&&(n.push(t.call(o,o.__data__,h,a)),r.push(o));return new bi(n,r)},selectChild:function(t){return this.select(null==t?ve:function(t){return function(){return me.call(this.children,t)}}("function"==typeof t?t:_e(t)))},selectChildren:function(t){return this.selectAll(null==t?be:function(t){return function(){return we.call(this.children,t)}}("function"==typeof t?t:_e(t)))},filter:function(t){"function"!=typeof t&&(t=ge(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var s,o=e[r],a=o.length,l=n[r]=[],h=0;h<a;++h)(s=o[h])&&t.call(s,s.__data__,h,o)&&l.push(s);return new bi(n,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,Ce);var i,n=e?Ae:ke,r=this._parents,s=this._groups;"function"!=typeof t&&(i=t,t=function(){return i});for(var o=s.length,a=new Array(o),l=new Array(o),h=new Array(o),u=0;u<o;++u){var c=r[u],p=s[u],d=p.length,f=Ee(t.call(c,c&&c.__data__,u,r)),y=f.length,g=l[u]=new Array(y),_=a[u]=new Array(y);n(c,p,g,_,h[u]=new Array(d),f,e);for(var m,v,w=0,b=0;w<y;++w)if(m=g[w]){for(w>=b&&(b=w+1);!(v=_[b])&&++b<y;);m._next=v||null}}return(a=new bi(a,r))._enter=l,a._exit=h,a},enter:function(){return new bi(this._enter||this._groups.map(xe),this._parents)},exit:function(){return new bi(this._exit||this._groups.map(xe),this._parents)},join:function(t,e,i){var n=this.enter(),r=this,s=this.exit();return"function"==typeof t?(n=t(n))&&(n=n.selection()):n=n.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==i?s.remove():i(s),n&&r?n.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,i=this._groups,n=e._groups,r=i.length,s=n.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var h,u=i[l],c=n[l],p=u.length,d=a[l]=new Array(p),f=0;f<p;++f)(h=u[f]||c[f])&&(d[f]=h);for(;l<r;++l)a[l]=i[l];return new bi(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n,r=t[e],s=r.length-1,o=r[s];--s>=0;)(n=r[s])&&(o&&4^n.compareDocumentPosition(o)&&o.parentNode.insertBefore(n,o),o=n);return this},sort:function(t){function e(e,i){return e&&i?t(e.__data__,i.__data__):!e-!i}t||(t=Ie);for(var i=this._groups,n=i.length,r=new Array(n),s=0;s<n;++s){for(var o,a=i[s],l=a.length,h=r[s]=new Array(l),u=0;u<l;++u)(o=a[u])&&(h[u]=o);h.sort(e)}return new bi(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],r=0,s=n.length;r<s;++r){var o=n[r];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var r,s=e[i],o=0,a=s.length;o<a;++o)(r=s[o])&&t.call(r,r.__data__,o,s);return this},attr:function(t,e){var i=Te(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((null==e?i.local?$e:ze:"function"==typeof e?i.local?De:We:i.local?Re:Oe)(i,e))},style:function(t,e,i){return arguments.length>1?this.each((null==e?Le:"function"==typeof e?Xe:Ne)(t,e,null==i?"":i)):je(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?Ye:"function"==typeof e?Be:Fe)(t,e)):this.node()[t]},classed:function(t,e){var i=Ve(t+"");if(arguments.length<2){for(var n=Ge(this.node()),r=-1,s=i.length;++r<s;)if(!n.contains(i[r]))return!1;return!0}return this.each(("function"==typeof e?Qe:e?qe:Je)(i,e))},text:function(t){return arguments.length?this.each(null==t?ti:("function"==typeof t?ii:ei)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?ni:("function"==typeof t?si:ri)(t)):this.node().innerHTML},raise:function(){return this.each(oi)},lower:function(){return this.each(ai)},append:function(t){var e="function"==typeof t?t:ui(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var i="function"==typeof t?t:ui(t),n=null==e?ci:"function"==typeof e?e:de(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})},remove:function(){return this.each(pi)},clone:function(t){return this.select(t?fi:di)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,i){var n,r,s=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}})}(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?gi:yi,n=0;n<o;++n)this.each(a(s[n],e,i));return this}var a=this.node().__on;if(a)for(var l,h=0,u=a.length;h<u;++h)for(n=0,l=a[h];n<o;++n)if((r=s[n]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?vi:mi)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n,r=t[e],s=0,o=r.length;s<o;++s)(n=r[s])&&(yield n)}};const Si=xi;var ki={value:()=>{}};function Ai(){for(var t,e=0,i=arguments.length,n={};e<i;++e){if(!(t=arguments[e]+"")||t in n||/[\s.]/.test(t))throw new Error("illegal type: "+t);n[t]=[]}return new Ci(n)}function Ci(t){this._=t}function Ei(t,e){for(var i,n=0,r=t.length;n<r;++n)if((i=t[n]).name===e)return i.value}function Ii(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=ki,t=t.slice(0,n).concat(t.slice(n+1));break}return null!=i&&t.push({name:e,value:i}),t}Ci.prototype=Ai.prototype={constructor:Ci,on:function(t,e){var i,n,r=this._,s=(n=r,(t+"").trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),o=-1,a=s.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(i=(t=s[o]).type)r[i]=Ii(r[i],t.name,e);else if(null==e)for(i in r)r[i]=Ii(r[i],t.name,null);return this}for(;++o<a;)if((i=(t=s[o]).type)&&(i=Ei(r[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new Ci(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,n,r=new Array(i),s=0;s<i;++s)r[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,i=(n=this._[t]).length;s<i;++s)n[s].value.apply(e,r)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,s=n.length;r<s;++r)n[r].value.apply(e,i)}};const Pi=Ai;var Mi,Ti,zi=0,$i=0,Oi=0,Ri=0,Wi=0,Di=0,Zi="object"==typeof performance&&performance.now?performance:Date,Li="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Ni(){return Wi||(Li(Xi),Wi=Zi.now()+Di)}function Xi(){Wi=0}function ji(){this._call=this._time=this._next=null}function Yi(t,e,i){var n=new ji;return n.restart(t,e,i),n}function Fi(){Wi=(Ri=Zi.now())+Di,zi=$i=0;try{!function(){Ni(),++zi;for(var t,e=Mi;e;)(t=Wi-e._time)>=0&&e._call.call(void 0,t),e=e._next;--zi}()}finally{zi=0,function(){for(var t,e,i=Mi,n=1/0;i;)i._call?(n>i._time&&(n=i._time),t=i,i=i._next):(e=i._next,i._next=null,i=t?t._next=e:Mi=e);Ti=t,Vi(n)}(),Wi=0}}function Bi(){var t=Zi.now(),e=t-Ri;e>1e3&&(Di-=e,Ri=t)}function Vi(t){zi||($i&&($i=clearTimeout($i)),t-Wi>24?(t<1/0&&($i=setTimeout(Fi,t-Zi.now()-Di)),Oi&&(Oi=clearInterval(Oi))):(Oi||(Ri=Zi.now(),Oi=setInterval(Bi,1e3)),zi=1,Li(Fi)))}function Gi(t,e,i){var n=new ji;return e=null==e?0:+e,n.restart(i=>{n.stop(),t(i+e)},e,i),n}ji.prototype=Yi.prototype={constructor:ji,restart:function(t,e,i){if("function"!=typeof t)throw new TypeError("callback is not a function");i=(null==i?Ni():+i)+(null==e?0:+e),this._next||Ti===this||(Ti?Ti._next=this:Mi=this,Ti=this),this._call=t,this._time=i,Vi()},stop:function(){this._call&&(this._call=null,this._time=1/0,Vi())}};var Hi=Pi("start","end","cancel","interrupt"),Ki=[];function Ui(t,e,i,n,r,s){var o=t.__transition;if(o){if(i in o)return}else t.__transition={};!function(t,e,i){var n,r=t.__transition;function s(l){var h,u,c,p;if(1!==i.state)return a();for(h in r)if((p=r[h]).name===i.name){if(3===p.state)return Gi(s);4===p.state?(p.state=6,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[h]):+h<e&&(p.state=6,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[h])}if(Gi(function(){3===i.state&&(i.state=4,i.timer.restart(o,i.delay,i.time),o(l))}),i.state=2,i.on.call("start",t,t.__data__,i.index,i.group),2===i.state){for(i.state=3,n=new Array(c=i.tween.length),h=0,u=-1;h<c;++h)(p=i.tween[h].value.call(t,t.__data__,i.index,i.group))&&(n[++u]=p);n.length=u+1}}function o(e){for(var r=e<i.duration?i.ease.call(null,e/i.duration):(i.timer.restart(a),i.state=5,1),s=-1,o=n.length;++s<o;)n[s].call(t,r);5===i.state&&(i.on.call("end",t,t.__data__,i.index,i.group),a())}function a(){for(var n in i.state=6,i.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=i,i.timer=Yi(function(t){i.state=1,i.timer.restart(s,i.delay,i.time),i.delay<=t&&s(t-i.delay)},0,i.time)}(t,i,{name:e,index:n,group:r,on:Hi,tween:Ki,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function qi(t,e){var i=Qi(t,e);if(i.state>0)throw new Error("too late; already scheduled");return i}function Ji(t,e){var i=Qi(t,e);if(i.state>3)throw new Error("too late; already running");return i}function Qi(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function tn(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var en,nn=180/Math.PI,rn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function sn(t,e,i,n,r,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(a=Math.sqrt(i*i+n*n))&&(i/=a,n/=a,l/=a),t*n<e*i&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*nn,skewX:Math.atan(l)*nn,scaleX:o,scaleY:a}}function on(t,e,i,n){function r(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],l=[];return s=t(s),o=t(o),function(t,n,r,s,o,a){if(t!==r||n!==s){var l=o.push("translate(",null,e,null,i);a.push({i:l-4,x:tn(t,r)},{i:l-2,x:tn(n,s)})}else(r||s)&&o.push("translate("+r+e+s+i)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(t,e,i,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:i.push(r(i)+"rotate(",null,n)-2,x:tn(t,e)})):e&&i.push(r(i)+"rotate("+e+n)}(s.rotate,o.rotate,a,l),function(t,e,i,s){t!==e?s.push({i:i.push(r(i)+"skewX(",null,n)-2,x:tn(t,e)}):e&&i.push(r(i)+"skewX("+e+n)}(s.skewX,o.skewX,a,l),function(t,e,i,n,s,o){if(t!==i||e!==n){var a=s.push(r(s)+"scale(",null,",",null,")");o.push({i:a-4,x:tn(t,i)},{i:a-2,x:tn(e,n)})}else 1===i&&1===n||s.push(r(s)+"scale("+i+","+n+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(t){for(var e,i=-1,n=l.length;++i<n;)a[(e=l[i]).i]=e.x(t);return a.join("")}}}var an=on(function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?rn:sn(e.a,e.b,e.c,e.d,e.e,e.f)},"px, ","px)","deg)"),ln=on(function(t){return null==t?rn:(en||(en=document.createElementNS("http://www.w3.org/2000/svg","g")),en.setAttribute("transform",t),(t=en.transform.baseVal.consolidate())?sn((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):rn)},", ",")",")");function hn(t,e){var i,n;return function(){var r=Ji(this,t),s=r.tween;if(s!==i)for(var o=0,a=(n=i=s).length;o<a;++o)if(n[o].name===e){(n=n.slice()).splice(o,1);break}r.tween=n}}function un(t,e,i){var n,r;if("function"!=typeof i)throw new Error;return function(){var s=Ji(this,t),o=s.tween;if(o!==n){r=(n=o).slice();for(var a={name:e,value:i},l=0,h=r.length;l<h;++l)if(r[l].name===e){r[l]=a;break}l===h&&r.push(a)}s.tween=r}}function cn(t,e,i){var n=t._id;return t.each(function(){var t=Ji(this,n);(t.value||(t.value={}))[e]=i.apply(this,arguments)}),function(t){return Qi(t,n).value[e]}}function pn(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function dn(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function fn(){}var yn=.7,gn=1/yn,_n="\\s*([+-]?\\d+)\\s*",mn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",vn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",wn=/^#([0-9a-f]{3,8})$/,bn=new RegExp(`^rgb\\(${_n},${_n},${_n}\\)$`),xn=new RegExp(`^rgb\\(${vn},${vn},${vn}\\)$`),Sn=new RegExp(`^rgba\\(${_n},${_n},${_n},${mn}\\)$`),kn=new RegExp(`^rgba\\(${vn},${vn},${vn},${mn}\\)$`),An=new RegExp(`^hsl\\(${mn},${vn},${vn}\\)$`),Cn=new RegExp(`^hsla\\(${mn},${vn},${vn},${mn}\\)$`),En={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function In(){return this.rgb().formatHex()}function Pn(){return this.rgb().formatRgb()}function Mn(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=wn.exec(t))?(i=e[1].length,e=parseInt(e[1],16),6===i?Tn(e):3===i?new On(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===i?zn(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===i?zn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=bn.exec(t))?new On(e[1],e[2],e[3],1):(e=xn.exec(t))?new On(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Sn.exec(t))?zn(e[1],e[2],e[3],e[4]):(e=kn.exec(t))?zn(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=An.exec(t))?Nn(e[1],e[2]/100,e[3]/100,1):(e=Cn.exec(t))?Nn(e[1],e[2]/100,e[3]/100,e[4]):En.hasOwnProperty(t)?Tn(En[t]):"transparent"===t?new On(NaN,NaN,NaN,0):null}function Tn(t){return new On(t>>16&255,t>>8&255,255&t,1)}function zn(t,e,i,n){return n<=0&&(t=e=i=NaN),new On(t,e,i,n)}function $n(t,e,i,n){return 1===arguments.length?((r=t)instanceof fn||(r=Mn(r)),r?new On((r=r.rgb()).r,r.g,r.b,r.opacity):new On):new On(t,e,i,null==n?1:n);var r}function On(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}function Rn(){return`#${Ln(this.r)}${Ln(this.g)}${Ln(this.b)}`}function Wn(){const t=Dn(this.opacity);return`${1===t?"rgb(":"rgba("}${Zn(this.r)}, ${Zn(this.g)}, ${Zn(this.b)}${1===t?")":`, ${t})`}`}function Dn(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Zn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Ln(t){return((t=Zn(t))<16?"0":"")+t.toString(16)}function Nn(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new jn(t,e,i,n)}function Xn(t){if(t instanceof jn)return new jn(t.h,t.s,t.l,t.opacity);if(t instanceof fn||(t=Mn(t)),!t)return new jn;if(t instanceof jn)return t;var e=(t=t.rgb()).r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),s=Math.max(e,i,n),o=NaN,a=s-r,l=(s+r)/2;return a?(o=e===s?(i-n)/a+6*(i<n):i===s?(n-e)/a+2:(e-i)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new jn(o,a,l,t.opacity)}function jn(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}function Yn(t){return(t=(t||0)%360)<0?t+360:t}function Fn(t){return Math.max(0,Math.min(1,t||0))}function Bn(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}function Vn(t,e,i,n,r){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*i+(1+3*t+3*s-3*o)*n+o*r)/6}pn(fn,Mn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:In,formatHex:In,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Xn(this).formatHsl()},formatRgb:Pn,toString:Pn}),pn(On,$n,dn(fn,{brighter(t){return t=null==t?gn:Math.pow(gn,t),new On(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?yn:Math.pow(yn,t),new On(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new On(Zn(this.r),Zn(this.g),Zn(this.b),Dn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Rn,formatHex:Rn,formatHex8:function(){return`#${Ln(this.r)}${Ln(this.g)}${Ln(this.b)}${Ln(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Wn,toString:Wn})),pn(jn,function(t,e,i,n){return 1===arguments.length?Xn(t):new jn(t,e,i,null==n?1:n)},dn(fn,{brighter(t){return t=null==t?gn:Math.pow(gn,t),new jn(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?yn:Math.pow(yn,t),new jn(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new On(Bn(t>=240?t-240:t+120,r,n),Bn(t,r,n),Bn(t<120?t+240:t-120,r,n),this.opacity)},clamp(){return new jn(Yn(this.h),Fn(this.s),Fn(this.l),Dn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Dn(this.opacity);return`${1===t?"hsl(":"hsla("}${Yn(this.h)}, ${100*Fn(this.s)}%, ${100*Fn(this.l)}%${1===t?")":`, ${t})`}`}}));const Gn=t=>()=>t;function Hn(t,e){var i=e-t;return i?function(t,e){return function(i){return t+i*e}}(t,i):Gn(isNaN(t)?e:t)}const Kn=function t(e){var i=function(t){return 1===(t=+t)?Hn:function(e,i){return i-e?function(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}(e,i,t):Gn(isNaN(e)?i:e)}}(e);function n(t,e){var n=i((t=$n(t)).r,(e=$n(e)).r),r=i(t.g,e.g),s=i(t.b,e.b),o=Hn(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=r(e),t.b=s(e),t.opacity=o(e),t+""}}return n.gamma=t,n}(1);function Un(t){return function(e){var i,n,r=e.length,s=new Array(r),o=new Array(r),a=new Array(r);for(i=0;i<r;++i)n=$n(e[i]),s[i]=n.r||0,o[i]=n.g||0,a[i]=n.b||0;return s=t(s),o=t(o),a=t(a),n.opacity=1,function(t){return n.r=s(t),n.g=o(t),n.b=a(t),n+""}}}Un(function(t){var e=t.length-1;return function(i){var n=i<=0?i=0:i>=1?(i=1,e-1):Math.floor(i*e),r=t[n],s=t[n+1],o=n>0?t[n-1]:2*r-s,a=n<e-1?t[n+2]:2*s-r;return Vn((i-n/e)*e,o,r,s,a)}}),Un(function(t){var e=t.length;return function(i){var n=Math.floor(((i%=1)<0?++i:i)*e),r=t[(n+e-1)%e],s=t[n%e],o=t[(n+1)%e],a=t[(n+2)%e];return Vn((i-n/e)*e,r,s,o,a)}});var qn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Jn=new RegExp(qn.source,"g");function Qn(t,e){var i,n,r,s=qn.lastIndex=Jn.lastIndex=0,o=-1,a=[],l=[];for(t+="",e+="";(i=qn.exec(t))&&(n=Jn.exec(e));)(r=n.index)>s&&(r=e.slice(s,r),a[o]?a[o]+=r:a[++o]=r),(i=i[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,l.push({i:o,x:tn(i,n)})),s=Jn.lastIndex;return s<e.length&&(r=e.slice(s),a[o]?a[o]+=r:a[++o]=r),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var i,n=0;n<e;++n)a[(i=l[n]).i]=i.x(t);return a.join("")})}function tr(t,e){var i;return("number"==typeof e?tn:e instanceof Mn?Kn:(i=Mn(e))?(e=i,Kn):Qn)(t,e)}function er(t){return function(){this.removeAttribute(t)}}function ir(t){return function(){this.removeAttributeNS(t.space,t.local)}}function nr(t,e,i){var n,r,s=i+"";return function(){var o=this.getAttribute(t);return o===s?null:o===n?r:r=e(n=o,i)}}function rr(t,e,i){var n,r,s=i+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===n?r:r=e(n=o,i)}}function sr(t,e,i){var n,r,s;return function(){var o,a,l=i(this);if(null!=l)return(o=this.getAttribute(t))===(a=l+"")?null:o===n&&a===r?s:(r=a,s=e(n=o,l));this.removeAttribute(t)}}function or(t,e,i){var n,r,s;return function(){var o,a,l=i(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:o===n&&a===r?s:(r=a,s=e(n=o,l));this.removeAttributeNS(t.space,t.local)}}function ar(t,e){var i,n;function r(){var r=e.apply(this,arguments);return r!==n&&(i=(n=r)&&function(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}(t,r)),i}return r._value=e,r}function lr(t,e){var i,n;function r(){var r=e.apply(this,arguments);return r!==n&&(i=(n=r)&&function(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}(t,r)),i}return r._value=e,r}function hr(t,e){return function(){qi(this,t).delay=+e.apply(this,arguments)}}function ur(t,e){return e=+e,function(){qi(this,t).delay=e}}function cr(t,e){return function(){Ji(this,t).duration=+e.apply(this,arguments)}}function pr(t,e){return e=+e,function(){Ji(this,t).duration=e}}var dr=Si.prototype.constructor;function fr(t){return function(){this.style.removeProperty(t)}}var yr=0;function gr(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function _r(){return++yr}var mr=Si.prototype;gr.prototype=function(t){return Si().transition(t)}.prototype={constructor:gr,select:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=de(t));for(var n=this._groups,r=n.length,s=new Array(r),o=0;o<r;++o)for(var a,l,h=n[o],u=h.length,c=s[o]=new Array(u),p=0;p<u;++p)(a=h[p])&&(l=t.call(a,a.__data__,p,h))&&("__data__"in a&&(l.__data__=a.__data__),c[p]=l,Ui(c[p],e,i,p,c,Qi(a,i)));return new gr(s,this._parents,e,i)},selectAll:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=ye(t));for(var n=this._groups,r=n.length,s=[],o=[],a=0;a<r;++a)for(var l,h=n[a],u=h.length,c=0;c<u;++c)if(l=h[c]){for(var p,d=t.call(l,l.__data__,c,h),f=Qi(l,i),y=0,g=d.length;y<g;++y)(p=d[y])&&Ui(p,e,i,y,d,f);s.push(d),o.push(l)}return new gr(s,o,e,i)},selectChild:mr.selectChild,selectChildren:mr.selectChildren,filter:function(t){"function"!=typeof t&&(t=ge(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var s,o=e[r],a=o.length,l=n[r]=[],h=0;h<a;++h)(s=o[h])&&t.call(s,s.__data__,h,o)&&l.push(s);return new gr(n,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,r=i.length,s=Math.min(n,r),o=new Array(n),a=0;a<s;++a)for(var l,h=e[a],u=i[a],c=h.length,p=o[a]=new Array(c),d=0;d<c;++d)(l=h[d]||u[d])&&(p[d]=l);for(;a<n;++a)o[a]=e[a];return new gr(o,this._parents,this._name,this._id)},selection:function(){return new dr(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,i=_r(),n=this._groups,r=n.length,s=0;s<r;++s)for(var o,a=n[s],l=a.length,h=0;h<l;++h)if(o=a[h]){var u=Qi(o,e);Ui(o,t,i,h,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new gr(n,this._parents,t,i)},call:mr.call,nodes:mr.nodes,node:mr.node,size:mr.size,empty:mr.empty,each:mr.each,on:function(t,e){var i=this._id;return arguments.length<2?Qi(this.node(),i).on.on(t):this.each(function(t,e,i){var n,r,s=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?qi:Ji;return function(){var o=s(this,t),a=o.on;a!==n&&(r=(n=a).copy()).on(e,i),o.on=r}}(i,t,e))},attr:function(t,e){var i=Te(t),n="transform"===i?ln:tr;return this.attrTween(t,"function"==typeof e?(i.local?or:sr)(i,n,cn(this,"attr."+t,e)):null==e?(i.local?ir:er)(i):(i.local?rr:nr)(i,n,e))},attrTween:function(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;var n=Te(t);return this.tween(i,(n.local?ar:lr)(n,e))},style:function(t,e,i){var n="transform"==(t+="")?an:tr;return null==e?this.styleTween(t,function(t,e){var i,n,r;return function(){var s=je(this,t),o=(this.style.removeProperty(t),je(this,t));return s===o?null:s===i&&o===n?r:r=e(i=s,n=o)}}(t,n)).on("end.style."+t,fr(t)):"function"==typeof e?this.styleTween(t,function(t,e,i){var n,r,s;return function(){var o=je(this,t),a=i(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=je(this,t)),o===l?null:o===n&&l===r?s:(r=l,s=e(n=o,a))}}(t,n,cn(this,"style."+t,e))).each(function(t,e){var i,n,r,s,o="style."+e,a="end."+o;return function(){var l=Ji(this,t),h=l.on,u=null==l.value[o]?s||(s=fr(e)):void 0;h===i&&r===u||(n=(i=h).copy()).on(a,r=u),l.on=n}}(this._id,t)):this.styleTween(t,function(t,e,i){var n,r,s=i+"";return function(){var o=je(this,t);return o===s?null:o===n?r:r=e(n=o,i)}}(t,n,e),i).on("end.style."+t,null)},styleTween:function(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;return this.tween(n,function(t,e,i){var n,r;function s(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&function(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}(t,s,i)),n}return s._value=e,s}(t,e,null==i?"":i))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(cn(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,i;function n(){var n=t.apply(this,arguments);return n!==i&&(e=(i=n)&&function(t){return function(e){this.textContent=t.call(this,e)}}(n)),e}return n._value=t,n}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n,r=Qi(this.node(),i).tween,s=0,o=r.length;s<o;++s)if((n=r[s]).name===t)return n.value;return null}return this.each((null==e?hn:un)(i,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?hr:ur)(e,t)):Qi(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?cr:pr)(e,t)):Qi(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Ji(this,t).ease=e}}(e,t)):Qi(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var i=e.apply(this,arguments);if("function"!=typeof i)throw new Error;Ji(this,t).ease=i}}(this._id,t))},end:function(){var t,e,i=this,n=i._id,r=i.size();return new Promise(function(s,o){var a={value:o},l={value:function(){0===--r&&s()}};i.each(function(){var i=Ji(this,n),r=i.on;r!==t&&((e=(t=r).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),i.on=e}),0===r&&s()})},[Symbol.iterator]:mr[Symbol.iterator]};var vr={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function wr(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}Si.prototype.interrupt=function(t){return this.each(function(){!function(t,e){var i,n,r,s=t.__transition,o=!0;if(s){for(r in e=null==e?null:e+"",s)(i=s[r]).name===e?(n=i.state>2&&i.state<5,i.state=6,i.timer.stop(),i.on.call(n?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete s[r]):o=!1;o&&delete t.__transition}}(this,t)})},Si.prototype.transition=function(t){var e,i;t instanceof gr?(e=t._id,t=t._name):(e=_r(),(i=vr).time=Ni(),t=null==t?null:t+"");for(var n=this._groups,r=n.length,s=0;s<r;++s)for(var o,a=n[s],l=a.length,h=0;h<l;++h)(o=a[h])&&Ui(o,t,e,h,a,i||wr(o,e));return new gr(n,this._parents,t,e)};const{abs:br,max:xr,min:Sr}=Math;function kr(t){return{type:t}}function Ar(t){return"string"==typeof t?new bi([[document.querySelector(t)]],[document.documentElement]):new bi([[t]],wi)}function Cr(t,e,i){this.k=t,this.x=e,this.y=i}["w","e"].map(kr),["n","s"].map(kr),["n","w","e","s","nw","ne","sw","se"].map(kr),Cr.prototype={constructor:Cr,scale:function(t){return 1===t?this:new Cr(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Cr(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new Cr(1,0,0),Cr.prototype;class Er{constructor(t){this._current=null,null!=t&&(this._current=t)}set(t){var e;null===(e=this._current)||void 0===e||e.unsubscribe(),this._current=t}unsubscribe(){var t;null===(t=this._current)||void 0===t||t.unsubscribe(),this._current=null}}class Ir{constructor(){this._current=new Map}set(t,e){if(this._current.has(t)){let i=this._current.get(t);null==i||i.set(e)}else this._current.set(t,new Er(e))}unsubscribe(t){if(this._current.has(t)){let e=this._current.get(t);null==e||e.unsubscribe(),this._current.delete(t)}else console.error(-`No subscription for ${t} found.`)}}const Pr="circle",Mr="path",Tr="text",zr="svg-shape--invisible";class $r{constructor(t){this._subscriptions=new Ir,this._created=new Set;const e=document.getElementById(t);this._width=(null==e?void 0:e.clientWidth)?e.clientWidth:0,this._height=(null==e?void 0:e.clientHeight)?e.clientHeight:0,this.addSvgCss(),this._svgg=Ar(`#${t}`).append("svg").attr("id","svgMain").attr("width",this._width).attr("height",this._height).append("g").attr("transform","translate(.5, .5)")}registerShapes(t,e){Ar("svg#svgMain").style("background",e),this._subscriptions.set(t.id,t.collection$.subscribe(e=>{this._created.has(t.id)?this.updateShapes(t.id,e):this.createShapes(t.id,e)}))}unregisterShapes(t){this.removeShapes(t),this._subscriptions.unsubscribe(t),this._created.delete(t)}addSvgCss(){var t=window.document.styleSheets[0];t.insertRule(`.${zr} { visibility: hidden;}`,t.cssRules.length)}createShapes(t,e){console.log("#createShapes",{id:t,collection:e}),this.createGroups(t,e.groups),this.createCircles(t,e.circles),this.createPaths(t,e.paths),this.createRectangles(t,e.rectangles),this.createTexts(t,e.texts),this.updateShapes(t,e),this._created.add(t)}updateShapes(t,e){this.updateGroups(t,e.groups),this.updateCircles(t,e.circles),this.updatePaths(t,e.paths),this.updateRectangles(t,e.rectangles),this.updateTexts(t,e.texts),this.sortAllShapesByDistance(t)}createGroups(t,e){console.log(`#createGroups - id=${t}, cnt=${e.length}`),this._svgg.selectAll(`g.${Bt.GROUP}.${t}`).data(e,t=>t.id).enter().append("g").attr("id",t=>t.id).classed(Bt.GROUP,!0).classed(t,!0),e.forEach(t=>{const e=this._svgg.select(`#${t.id}`);switch(this.createCirclesForGroup(e,t.id,t.children.filter(t=>t.child.type==Bt.CIRCLE).map(t=>t.child)),this.createPathsForGroup(e,t.id,t.children.filter(t=>t.child.type==Bt.PATH).map(t=>t.child)),t.attr.sortBy){case Vt.DISTANCE:this.sortAllShapesByDistance(t.id);break;case Vt.INDEX:this.sortAllGroupChildsByIndex(e,t.id)}})}updateGroups(t,e){this._svgg.selectAll(`g.${Bt.GROUP}.${t}`).data(e,t=>t.id).classed(zr,t=>!t.isVisible),e.forEach(t=>{const e=this._svgg.select(`#${t.id}`);switch(this.updateCirclesForGroup(e,t.id,t.children.filter(t=>t.child.type==Bt.CIRCLE).map(t=>t.child)),this.updatePathsForGroup(e,t.id,t.children.filter(t=>t.child.type==Bt.PATH).map(t=>t.child)),t.attr.sortBy){case Vt.DISTANCE:this.sortAllShapesByDistance(t.id);break;case Vt.INDEX:this.sortAllGroupChildsByIndex(e,t.id)}})}createCircles(t,e){console.log(`#createCircles - id=${t}, cnt=${e.length}`),this._svgg.selectAll(`${Pr}.${Bt.CIRCLE}.${t}`).data(e,t=>t.id).enter().append(Pr).attr("id",t=>t.id).classed(Bt.CIRCLE,!0).classed(t,!0)}createCirclesForGroup(t,e,i){t.selectAll(`${Pr}.${Bt.CIRCLE}.${e}`).data(i,t=>t.id).enter().append(Pr).attr("id",t=>t.id).classed(Bt.CIRCLE,!0).classed(e,!0)}updateCircles(t,e){this.setCircleAttributes(this._svgg.selectAll(`${Pr}.${Bt.CIRCLE}.${t}`).data(e,t=>t.id).classed(zr,t=>!t.isVisible))}updateCirclesForGroup(t,e,i){this.setCircleAttributes(t.selectAll(`${Pr}.${Bt.CIRCLE}.${e}`).data(i).classed(zr,t=>!t.isVisible))}setCircleAttributes(t){t.style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("cx",t=>t.attr.cx).attr("cy",t=>t.attr.cy).attr("r",t=>t.attr.r)}createPaths(t,e){console.log(`#createPaths - id=${t}, cnt=${e.length}`),this._svgg.selectAll(`${Mr}.${Bt.PATH}.${t}`).data(e,t=>t.id).enter().append(Mr).attr("id",t=>t.id).classed(Bt.PATH,!0).classed(t,!0).style("stroke-linejoin","round").style("fill","none")}createPathsForGroup(t,e,i){t.selectAll(`${Mr}.${Bt.PATH}.${e}`).data(i,t=>t.id).enter().append(Mr).attr("id",t=>t.id).classed(Bt.PATH,!0).classed(e,!0).style("stroke-linejoin","round").style("stroke-linecap","round").style("fill","none")}updatePaths(t,e){this.setPathAttributes(this._svgg.selectAll(`${Mr}.${Bt.PATH}.${t}`).data(e,t=>t.id).classed(zr,t=>!t.isVisible))}updatePathsForGroup(t,e,i){this.setPathAttributes(t.selectAll(`${Mr}.${Bt.PATH}.${e}`).data(i,t=>t.id).classed(zr,t=>!t.isVisible))}setPathAttributes(t){t.style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).attr("d",t=>t.attr.d)}createRectangles(t,e){console.log(`#createRectangles - id=${t}, cnt=${e.length}`),this._svgg.selectAll(`${Mr}.${Bt.RECTANGLE}.${t}`).data(e,t=>t.id).enter().append(Mr).attr("id",t=>t.id).classed(Bt.RECTANGLE,!0).classed(t,!0)}updateRectangles(t,e){this.setRectangleAttributes(this._svgg.selectAll(`${Mr}.${Bt.RECTANGLE}.${t}`).data(e,t=>t.id).classed(zr,t=>!t.isVisible))}setRectangleAttributes(t){t.style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("d",t=>t.attr.d)}createTexts(t,e){console.log(`#createTexts - id=${t}, cnt=${e.length}`),this._svgg.selectAll(`${Tr}.${Bt.TEXT}.${t}`).data(e,t=>t.id).enter().append(Tr).attr("id",t=>t.id).classed(Bt.TEXT,!0).classed(t,!0)}updateTexts(t,e){this.setTextAttributes(this._svgg.selectAll(`${Tr}.${Bt.TEXT}.${t}`).data(e,t=>t.id).classed(zr,t=>!t.isVisible).classed(Bt.TEXT,!0))}setTextAttributes(t){t.style("fill",t=>t.style.fill).style("fillOpacity",t=>t.style.fillOpacity).style("alignment-baseline",t=>t.style.alignmentBaseline).attr("x",t=>t.attr.x).attr("y",t=>t.attr.y).style("font-size",t=>t.attr.fontSize).text(t=>t.attr.text)}sortAllShapesByDistance(t){this._svgg.selectAll(`.${t}`).sort((t,e)=>e.dist-t.dist)}sortAllGroupChildsByIndex(t,e){t.selectAll(`.${e}`).sort((t,e)=>t.index-e.index)}removeShapes(t){this._svgg.selectAll(`.${t}`).remove()}}var Or;function Rr(){return window.innerWidth==screen.width&&window.innerHeight==screen.height?Or.IMMERSIVE:window.innerWidth<1300?Or.SMALL:Or.DEFAULT}function Wr(t,e,i){return void 0===i&&(i=1/0),a(e)?Wr(function(i,n){return zt(function(t,r){return e(i,t,n,r)})(pt(t(i,n)))},i):("number"==typeof e&&(i=e),tt(function(e,n){return function(t,e,i,n){var r=[],s=0,o=0,a=!1,l=function(){!a||r.length||s||e.complete()},h=function(t){return s<n?u(t):r.push(t)},u=function(t){s++;var a=!1;pt(i(t,o++)).subscribe(et(e,function(t){e.next(t)},function(){a=!0},void 0,function(){if(a)try{s--;for(var t=function(){var t=r.shift();u(t)};r.length&&s<n;)t();l()}catch(t){e.error(t)}}))};return t.subscribe(et(e,h,function(){a=!0,l()})),function(){}}(e,n,t,i)}))}function Dr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Dt(t),n=function(t){return"number"==typeof Wt(t)?t.pop():1/0}(t),r=t;return r.length?1===r.length?pt(r[0]):function(t){return void 0===t&&(t=1/0),Wr(W,t)}(n)(Tt(r,i)):xt}!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SMALL=1]="SMALL",t[t.IMMERSIVE=2]="IMMERSIVE"}(Or||(Or={}));var Zr,Lr,Nr=["addListener","removeListener"],Xr=["addEventListener","removeEventListener"],jr=["on","off"];function Yr(t,e,i,n){if(a(i)&&(n=i,i=void 0),n)return Yr(t,e,i).pipe(Rt(n));var s=r(function(t){return a(t.addEventListener)&&a(t.removeEventListener)}(t)?Xr.map(function(n){return function(r){return t[n](e,r,i)}}):function(t){return a(t.addListener)&&a(t.removeListener)}(t)?Nr.map(Fr(t,e)):function(t){return a(t.on)&&a(t.off)}(t)?jr.map(Fr(t,e)):[],2),o=s[0],l=s[1];if(!o&&nt(t))return Wr(function(t){return Yr(t,e,i)})(pt(t));if(!o)throw new TypeError("Invalid event target");return new D(function(t){var e=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.next(1<e.length?e:e[0])};return o(e),function(){return l(e)}})}function Fr(t,e){return function(i){return function(n){return t[i](e,n)}}}function Br(t,e){return t===e}class Vr{constructor(){var t,e;this._t=0,this._cameraSubscription=new Er,this.groups=[],this.circles=[],this.paths=[],this.rectangles=[],this.texts=[],this._state$=new j({groups:this.groups.map(t=>t.attributes),circles:this.circles.map(t=>t.attributes),paths:this.paths.map(t=>t.attributes),rectangles:this.rectangles.map(t=>t.attributes),texts:this.texts.map(t=>t.attributes)}),this.state$=this._state$.pipe((void 0===e&&(e=W),t=null!=(t=(t,e)=>function(t,e){return JSON.stringify(t)===JSON.stringify(e)}(t,e))?t:Br,tt(function(i,n){var r,s=!0;i.subscribe(et(n,function(i){var o=e(i);!s&&t(r,o)||(s=!1,r=o,n.next(i))}))}))),this.config=new yt({cameraPerspective:_t()}),this.backgroundColor="#fff"}init(){this.emit()}tick(){this._t++,this.transitionToStateAt(this._t),this.emit()}mountCamera(t){t.mountCamera(this.config.data.cameraPerspective),this._cameraSubscription.set(t.state$.subscribe({next:t=>{this.config.data.cameraPerspective=t}}))}resetConfig(){this.config.reset()}onDestroy(){this.config.save(),this._cameraSubscription.unsubscribe()}emit(){this._state$.next({groups:this.groups.map(t=>t.attributes),circles:this.circles.map(t=>t.attributes),paths:this.paths.map(t=>t.attributes),rectangles:this.rectangles.map(t=>t.attributes),texts:this.texts.map(t=>t.attributes)})}}class Gr extends Vr{constructor(){super(),this.config=new yt({cameraPerspective:{position:{x:0,y:.5,z:-3.6},angleX:20*gt,angleY:0*gt,angleZ:0*gt}},"bellCurveConfig"),this.name="Bell Curve";for(let t=-Gr.SIZE;t<Gr.SIZE;t++)for(let e=-Gr.SIZE;e<Gr.SIZE;e++)this.circles.push(new Ut({x:Gr.DIST*t,y:0,z:Gr.DIST*e},1.25));this.init()}transitionToStateAt(t){const e=3*Math.sin(t*Math.PI/180);this.circles.forEach(t=>{t.position.y=e*Math.exp(-(t.position.x*t.position.x+t.position.z*t.position.z))})}}Gr.SIZE=15,Gr.DIST=.15;class Hr extends Vr{constructor(){super(),this._rectangleStyleBottom={strokeWidth:.75,stroke:"#88f",strokeOpacity:.5,fill:"none",fillOpacity:0},this._rectangleStyleSides1={strokeWidth:.25,stroke:"#999",strokeOpacity:.5,fill:"none",fillOpacity:0},this._rectangleStyleSides2={strokeWidth:.25,stroke:"#999",strokeOpacity:.5,fill:"none",fillOpacity:0},this.config=new yt({cameraPerspective:{position:{x:0,y:2,z:-7.3},angleX:15*gt,angleY:40*gt,angleZ:0}},"bouncingParticlesConfig"),this.name="Bouncing Particles",this.rectangles=[new oe({x:0,y:0,z:0},6,6,{rotateX:90,rotateY:0,rotateZ:0},this._rectangleStyleBottom),new oe({x:3,y:2,z:0},6,4,{rotateX:0,rotateY:90,rotateZ:0},this._rectangleStyleSides1),new oe({x:0,y:2,z:3},4,6,{rotateX:0,rotateY:0,rotateZ:90},this._rectangleStyleSides1),new oe({x:-3,y:2,z:0},6,4,{rotateX:0,rotateY:90,rotateZ:0},this._rectangleStyleSides2),new oe({x:0,y:2,z:-3},4,6,{rotateX:0,rotateY:0,rotateZ:90},this._rectangleStyleSides2)],this.particles=[];for(let t=0;t<1500;t++){let t=2*Math.PI*Math.random(),e=.1*Math.random();this.particles.push({position:{x:0,y:.01,z:0},velocity:{x:e*Math.sin(t),y:.35*Math.random(),z:e*Math.cos(t)},staticX:!1,staticY:!1,staticZ:!1,outOfBounds:!1})}this.updateCirclesFromParticles(),this.init()}transitionToStateAt(t){this.particles.forEach(t=>{t.staticX&&t.staticY&&t.staticZ||(t.position.y<=0&&t.velocity.y<0?(t.velocity.x*=.8,t.velocity.y*=-.8,t.velocity.z*=.8):t.velocity.y-=Hr.ACCELERATION,t.outOfBounds||(Math.abs(t.position.x)>=2.9&&(t.position.y>4?t.outOfBounds=!0:t.velocity.x*=-1),Math.abs(t.position.z)>=2.9&&(t.position.y>4?t.outOfBounds=!0:t.velocity.z*=-1)),Math.abs(t.velocity.x)<.001&&(t.staticX=!0),Math.abs(t.velocity.y)<.001&&Math.abs(t.position.y)<.001&&(t.staticY=!0),Math.abs(t.velocity.z)<.001&&(t.staticZ=!0),t.staticX||(t.position.x+=t.velocity.x),t.staticX||(t.position.y+=t.velocity.y),t.staticX||(t.position.z+=t.velocity.z))}),this.updateCirclesFromParticles()}updateCirclesFromParticles(){this.circles=this.particles.map(t=>new Ut(t.position,1.5))}}function Kr(t,e,i){const n=i/100,r=e.x-t.x,s=e.y-t.y,o=e.z-t.z;return[{x:t.x+r*n,y:t.y+s*n,z:t.z+o*n},{x:e.x-r*n,y:e.y-s*n,z:e.z-o*n}]}Hr.ACCELERATION=.0095;class Ur extends Vr{constructor(){super(),this._zDistance=5,this._current=[],this._circleStyle={strokeWidth:1.5,stroke:"#f80",strokeOpacity:1,fill:"#fff",fillOpacity:1},this._pathStyle={strokeWidth:2,stroke:"#88a",strokeOpacity:1},this.config=new yt({cameraPerspective:{position:{x:0,y:-2,z:-6},angleX:0*gt,angleY:0*gt,angleZ:0*gt},parameters:{m1:1,m2:1,l1:1,l2:1,g:9.81,friction:1}},"doublePendulum2dConfig"),this.name="Double Pendulum 2D";for(let t=-17;t<18;t+=4)for(let e=-9;e<10;e+=4)for(let i=1;i<2;i++)this.groups.push(new Jt({x:t,y:e,z:i*this._zDistance},[])),this._current.push({theta1:t/Math.PI/2,theta2:e/Math.PI/2,omega1:1*(i-1),omega2:1*-(i-1)});this.updateWithCurrent(),this.init()}transitionToStateAt(t){this._current=this._current.map(t=>{const e=this.rungeKutta4Step(this.doublePendulumODE,this.pendulumStateAsArray(t),.025,this.config.data);return e[2]*=this.config.data.parameters.friction,e[3]*=this.config.data.parameters.friction,this.pendulumStateFromArray(e)}),this.updateWithCurrent()}updateWithCurrent(){const t=this._current.map((t,e)=>{const i=this.toCartesian(t.theta1,t.theta2);return[{x:0,y:0,z:0},{x:i[0],y:i[1],z:0},{x:i[2],y:i[3],z:0}]});this.groups.forEach((e,i)=>{const n=Kr(t[i][0],t[i][1],20),r=Kr(t[i][1],t[i][2],20);e.children=[new te(n,!1,!1,this._pathStyle),new te(r,!1,!1,this._pathStyle),new Ut(t[i][0],3,this._circleStyle),new Ut(t[i][1],3*Math.cbrt(this.config.data.parameters.m1),this._circleStyle),new Ut(t[i][2],3*Math.cbrt(this.config.data.parameters.m2),this._circleStyle)]})}toCartesian(t,e){const i=this.config.data.parameters.l1*Math.sin(t),n=-this.config.data.parameters.l1*Math.cos(t);return[i,n,i+this.config.data.parameters.l2*Math.sin(e),n-this.config.data.parameters.l2*Math.cos(e)]}pendulumStateAsArray(t){return[t.theta1,t.theta2,t.omega1,t.omega2]}pendulumStateFromArray(t){return{theta1:t[0],theta2:t[1],omega1:t[2],omega2:t[3]}}doublePendulumODE(t,e){const i=e.parameters,n=t[0],r=t[1],s=t[2],o=t[3],a=r-n,l=Math.sin(a),h=Math.cos(a);return[s,o,(i.m2*i.l1*Math.pow(s,2)*l*h+i.m2*i.g*Math.sin(r)*h+i.m2*i.l2*Math.pow(o,2)*l-(i.m1+i.m2)*i.g*Math.sin(n))/(i.l1*(i.m1+i.m2-i.m2*Math.pow(h,2))),(-i.m2*i.l2*Math.pow(o,2)*l*h+(i.m1+i.m2)*(i.g*Math.sin(n)*h-i.l1*Math.pow(s,2)*l)-(i.m1+i.m2)*i.g*Math.sin(r))/(i.l2*(i.m1+i.m2-i.m2*Math.pow(h,2)))]}rungeKutta4Step(t,e,i,n){const r=t(e,n),s=t(e.map((t,e)=>t+i/2*r[e]),n),o=t(e.map((t,e)=>t+i/2*s[e]),n),a=t(e.map((t,e)=>t+i*o[e]),n);return e.map((t,e)=>t+i/6*(r[e]+2*s[e]+2*o[e]+a[e]))}}class qr{constructor(t,e){this._params=t,this._timeStep=e}}class Jr extends qr{updateState(t){return this.rungeKutta4Step(t,this._timeStep)}getTotalEnergy(t){const e=this._params.m1,i=this._params.m2,n=this._params.l1,r=this._params.l2,s=-n*Math.cos(t.theta1),o=s-r*Math.cos(t.theta2),a=n*(Math.cos(t.theta1)*Math.cos(t.phi1)*t.dtheta1-Math.sin(t.theta1)*Math.sin(t.phi1)*t.dphi1),l=n*(Math.sin(t.theta1)*t.dtheta1),h=n*(Math.cos(t.theta1)*Math.sin(t.phi1)*t.dtheta1+Math.sin(t.theta1)*Math.cos(t.phi1)*t.dphi1),u=a+r*(Math.cos(t.theta2)*Math.cos(t.phi2)*t.dtheta2-Math.sin(t.theta2)*Math.sin(t.phi2)*t.dphi2),c=l+r*(Math.sin(t.theta2)*t.dtheta2),p=h+r*(Math.cos(t.theta2)*Math.sin(t.phi2)*t.dtheta2+Math.sin(t.theta2)*Math.cos(t.phi2)*t.dphi2);return.5*e*(a*a+l*l+h*h)+.5*i*(u*u+c*c+p*p)+(e*this._params.g*(s+n)+i*this._params.g*(o+n+r))}rungeKutta4Step(t,e){const i=this.doublePendulumODE(t);if(null==i)return null;const n=this.addScaledDerivatives(t,i,e/2),r=this.doublePendulumODE(n);if(null==r)return null;const s=this.addScaledDerivatives(t,r,e/2),o=this.doublePendulumODE(s);if(null==o)return null;const a=this.addScaledDerivatives(t,o,e),l=this.doublePendulumODE(a);return null==l?null:{theta1:t.theta1+(i.dtheta1+2*r.dtheta1+2*o.dtheta1+l.dtheta1)*e/6,phi1:t.phi1+(i.dphi1+2*r.dphi1+2*o.dphi1+l.dphi1)*e/6,theta2:t.theta2+(i.dtheta2+2*r.dtheta2+2*o.dtheta2+l.dtheta2)*e/6,phi2:t.phi2+(i.dphi2+2*r.dphi2+2*o.dphi2+l.dphi2)*e/6,dtheta1:t.dtheta1+(i.ddtheta1+2*r.ddtheta1+2*o.ddtheta1+l.ddtheta1)*e/6,dphi1:t.dphi1+(i.ddphi1+2*r.ddphi1+2*o.ddphi1+l.ddphi1)*e/6,dtheta2:t.dtheta2+(i.ddtheta2+2*r.ddtheta2+2*o.ddtheta2+l.ddtheta2)*e/6,dphi2:t.dphi2+(i.ddphi2+2*r.ddphi2+2*o.ddphi2+l.ddphi2)*e/6}}addScaledDerivatives(t,e,i){return{theta1:t.theta1+e.dtheta1*i,phi1:t.phi1+e.dphi1*i,theta2:t.theta2+e.dtheta2*i,phi2:t.phi2+e.dphi2*i,dtheta1:t.dtheta1+e.ddtheta1*i,dphi1:t.dphi1+e.ddphi1*i,dtheta2:t.dtheta2+e.ddtheta2*i,dphi2:t.dphi2+e.ddphi2*i}}doublePendulumODE(t){const e=this._params.m1,i=this._params.m2,n=e+i,r=this._params.l1,s=this._params.l2,o=this._params.g,a=t.theta1,l=t.phi1,h=t.theta2,u=t.phi2,c=t.dtheta1,p=t.dphi1,d=t.dtheta2,f=t.dphi2,y=Math.sin(a),g=Math.sin(h),_=Math.cos(a),m=Math.cos(h),v=(Math.sin(l),Math.sin(u),Math.cos(l),Math.cos(u),u+l),w=u-l,b=(Math.sin(v),Math.cos(v),-Math.sin(w)),x=Math.cos(w),S=Math.sin(2*a),k=(Math.sin(2*l),Math.sin(2*h)),A=(Math.cos(2*h),Math.cos(2*u),Math.pow(y*g,2)),C=Math.pow(_*m,2),E=Math.pow(g,2),I=Math.pow(_,2),P=Math.pow(m,2),M=Math.pow(y,2),T=Math.pow(x,2),z=Math.pow(c,2),$=Math.pow(d,2),O=Math.pow(p,2),R=Math.pow(f,2),W=R+$,D=O+z,Z=Math.pow(_,3),L=Math.pow(m,3),N=-(i*A*T+.5*i*S*k*x+i*C-n),X=(i*y*E*(r*_*z+o)*T+(-s*_*R*P+(r*(O+2*z)*I+o*_-r*D)*m+s*_*W)*i*g*x-y*(-s*i*R*L+i*r*_*D*P+s*i*W*m+n*(-r*O*_+o)))/(r*N),j=-(-.5*k*$*s*i*M*T-y*(-m*O*r*n*I+(s*i*(R+2*$)*P+o*n*m-s*i*W)*_+m*r*D*n)*x+(-O*r*n*Z+(s*i*W*m+o*n)*I+r*D*n*_-m*R*s*n)*g)/(s*N),Y=-(i*(y*E*(-r*O*I+o*_+r*D)*x+g*(-r*m*O*Z+o*I*m+r*_*m*D-s*(P*R-W)))*b-2*c*r*(i*A*T+.5*i*S*k*x+i*C-n)*p*_)/(r*N*y),F=((-i*s*g*(P*R-W)*M*x+y*(-r*O*n*I+(-s*i*R*L+s*i*W*m+o*n)*_+r*D*n))*b+2*m*(i*A*T+.5*S*k*x*i+C*i-n)*d*f*s)/(s*N*g);return this.isInvalidNumber(X)||this.isInvalidNumber(j)||this.isInvalidNumber(Y)||this.isInvalidNumber(F)?null:{dtheta1:c,dphi1:p,dtheta2:d,dphi2:f,ddtheta1:X,ddphi1:Y,ddtheta2:j,ddphi2:F}}isInvalidNumber(t){return!isFinite(t)||isNaN(t)||null==t}}class Qr extends Vr{constructor(){super(),this._running=!0,this._circleStyle={strokeWidth:1.5,stroke:"#f80",strokeOpacity:1,fill:"#fff",fillOpacity:1},this._pathStyleCs={strokeWidth:.5,stroke:"#000",strokeOpacity:.5},this._pathStyle={strokeWidth:2,stroke:"#88a",strokeOpacity:1},this.config=new yt({cameraPerspective:{position:{x:0,y:0,z:-3.5},angleX:20*gt,angleY:-30*gt,angleZ:0*gt},parameters:{m1:1,m2:1,l1:1,l2:1,g:9.81},initialState:{theta1:1,phi1:0,theta2:1,phi2:0,dtheta1:1,dphi1:1.2300575,dtheta2:0,dphi2:2.460115}},"doublePendulum3dConfig"),this.name="Double Pendulum 3D";this._csPaths=[new te([{x:-2.5,y:0,z:0},{x:2.5,y:0,z:0}],!1,!0,this._pathStyleCs),new te([{x:0,y:-2.5,z:0},{x:0,y:2.5,z:0}],!1,!0,this._pathStyleCs),new te([{x:0,y:0,z:-2.5},{x:0,y:0,z:2.5}],!1,!0,this._pathStyleCs)],this._g=new Jt({x:0,y:0,z:0},[]),this._current=structuredClone(this.config.data.initialState),this._calculator=new Jr(this.config.data.parameters,.001),this.paths=this._csPaths,this.groups=[this._g],this.updateWithCurrent(),this.init()}transitionToStateAt(t){if(!this._running)return;let e=structuredClone(this._current),i=structuredClone(this._current),n=structuredClone(this._current);for(let r=0;r<20;r++){if(e=structuredClone(n),i=this._calculator.updateState(e),null==i)return console.error(`#transitionToStateAt - Problem at t=${t}, aborting`),void(this._running=!1);n=i}this._current=n,this.updateWithCurrent()}updateWithCurrent(){const t=this.toCartesian(this._current.theta1,this._current.phi1,this._current.theta2,this._current.phi2),e=[{x:0,y:0,z:0},{x:t[0],y:t[1],z:t[2]},{x:t[3],y:t[4],z:t[5]}],i=Kr(e[0],e[1],20),n=Kr(e[1],e[2],20);this._g.children=[new te(i,!1,!1,this._pathStyle),new te(n,!1,!1,this._pathStyle),new Ut(e[0],3,this._circleStyle),new Ut(e[1],3*Math.cbrt(this.config.data.parameters.m1),this._circleStyle),new Ut(e[2],3*Math.cbrt(this.config.data.parameters.m2),this._circleStyle)]}toCartesian(t,e,i,n){const r=this.config.data.parameters.l1*Math.sin(t)*Math.cos(e),s=-this.config.data.parameters.l1*Math.cos(t),o=this.config.data.parameters.l1*Math.sin(t)*Math.sin(e);return[r,s,o,r+this.config.data.parameters.l2*Math.sin(i)*Math.cos(n),s-this.config.data.parameters.l2*Math.cos(i),o+this.config.data.parameters.l2*Math.sin(i)*Math.sin(n)]}}class ts extends Vr{constructor(){super(),this.config=new yt({cameraPerspective:{position:{x:0,y:0,z:-3},angleX:30*gt,angleY:60*gt,angleZ:0}},"gridConfig"),this.name="Grid";for(let t=-ts.SIZE;t<=ts.SIZE;t+=ts.DIST)for(let e=-ts.SIZE;e<=ts.SIZE;e+=ts.DIST)for(let i=-ts.SIZE;i<=ts.SIZE;i+=ts.DIST)this.circles.push(new Ut({x:t,y:e,z:i},1.5));this.init()}transitionToStateAt(t){}}ts.SIZE=1,ts.DIST=.2;class es extends Vr{constructor(){super(),this.cnt=0,this.maxCnt=4095,this.minZ=-3,this.maxZ=-15,this._pathStyle={strokeWidth:1,stroke:"#77a",strokeOpacity:1},this.config=new yt({cameraPerspective:{position:{x:-1,y:4.7,z:-5},angleX:25*gt,angleY:50*gt,angleZ:0}},"hilbertCurveConfig"),this.name="Hilbert Curve",this.hilbert=new ns(1,Zr.XYZ),this.paths=[new te([{x:0,y:0,z:0}],!1,!0,this._pathStyle)],this.init()}transitionToStateAt(t){if(this.cnt>this.maxCnt)return;let e;for(let t=0;t<1;t++)if(e=this.hilbert.xyz(this.cnt++),this.paths[0].path.push({x:.5*e.x,y:.5*e.y,z:.5*e.z}),this.cnt>this.maxCnt)return}}!function(t){t.XYZ="XYZ",t.XZY="XZY",t.YXZ="YXZ",t.YZX="YZX",t.ZXY="ZXY",t.ZYX="ZYX"}(Zr||(Zr={}));class is{constructor(t,e,i,n){t&&(e=t[0],i=t[1],n=t[2]),this.x=Math.round(e)||0,this.y=Math.round(i)||0,this.z=Math.round(n)||0,this.arr=[this.x,this.y,this.z],this.n=4*this.z+2*this.y+this.x}floor(){return new is([this.x,this.y,this.z].map(Math.floor),0,0,0)}mult(t){return new is(null,this.x*t,this.y*t,this.z*t)}add(t){return"number"==typeof t?new is(null,this.x+t,this.y+t,this.z+t):new is(null,this.x+t.x,this.y+t.y,this.z+t.z)}mod(t){return new is(null,this.x%t,this.y%t,this.z%t)}rotate(t,e){return 0==t.n?new is(null,this.z,this.x,this.y):1==t.n||3==t.n?new is(null,this.y,this.z,this.x):2==t.n||6==t.n?new is(null,e-this.x,e-this.y,this.z):5==t.n||7==t.n?new is(null,this.y,e-this.z,e-this.x):new is(null,e-this.z,this.x,e-this.y)}unrotate(t,e){return 0==t.n?new is(null,this.y,this.z,this.x):1==t.n||3==t.n?new is(null,this.z,this.x,this.y):2==t.n||6==t.n?new is(null,e-this.x,e-this.y,this.z):5==t.n||7==t.n?new is(null,e-this.z,this.x,e-this.y):new is(null,this.y,e-this.z,e-this.x)}rotateLeft(t){return t%3==0?this:t%3==1?new is(null,this.y,this.z,this.x):new is(null,this.z,this.x,this.y)}rotateRight(t){return t%3==0?this:t%3==1?new is(null,this.z,this.x,this.y):new is(null,this.y,this.z,this.x)}shuffle(t){return t?new is(null,this.extractFromAnchorAxisOrder(t,0),this.extractFromAnchorAxisOrder(t,1),this.extractFromAnchorAxisOrder(t,2)):this}pp(){return[this.x,this.y,this.z].join(",")}manhattanDistance(t){return Math.abs(t.x-this.x)+Math.abs(t.y-this.y)+Math.abs(t.z-this.z)}extractFromAnchorAxisOrder(t,e){switch(t[e]){case"X":return this.x;case"Y":return this.y;case"Z":return this.z}throw new Error(`Invalid template and/or index: template=${t}, index=${e}`)}}class ns{constructor(t,e){if(this.horseshoe2d=[0,1,3,2,7,6,4,5],this.xyz=this.d2xyz,this.d=this.xyz2d,this.size=t,this.anchorAxisOrder=e,this.anchorAxisOrder==Zr.XYZ&&(this.anchorAxisOrder=null),this.anchorAxisOrder)switch(this.anchorAxisOrder){case Zr.XZY:this.reverseAnchorAxisOrder=Zr.XZY;break;case Zr.YXZ:this.reverseAnchorAxisOrder=Zr.YXZ;break;case Zr.YZX:this.reverseAnchorAxisOrder=Zr.ZXY;break;case Zr.ZXY:this.reverseAnchorAxisOrder=Zr.YZX;break;case Zr.ZYX:this.reverseAnchorAxisOrder=Zr.ZYX}if(this.size){this.log2size=0;let t=1;for(;t<this.size;t*=2,this.log2size++);if(t!=this.size)throw new Error("Invalid size: "+this.size+". Must be a power of 2.");this.log2parity=this.log2size%3}}d2xyz(t){t=Math.floor(t);let e,i,n,r=new is(null,0,0,0),s=1,o=2,a=this.size||0;for(;t>0||s<a;){e=1&t,i=t/2&1,n=t/4&1;let a=new is(null,e^i,i^n,n);r=r.rotate(a,s-1).add(a.mult(s)),t=Math.floor(t/8),s*=2,o++}return r=this.size?r.rotateLeft(o-this.log2parity+1):r.rotateLeft(o),r.shuffle(this.reverseAnchorAxisOrder)}xyz2d(t,e,i){let n=new is(null,t,e,i).floor(),r=1,s=0;const o=Math.max.apply(Math,n.arr);for(;2*r<=o;r*=2)s=(s+1)%3;null!=this.anchorAxisOrder&&(n=n.shuffle(this.anchorAxisOrder)),n=this.size?n.rotateRight(s-this.log2parity+1):n.rotateRight(s);let a=0;for(;r>0;){var l=new is(null,n.x&r&&1,n.y&r&&1,n.z&r&&1);a*=8,a+=this.horseshoe2d[l.n],s=(s+2)%3,n=n.mod(r),n=n.unrotate(l,r-1),r=Math.floor(r/2)}return a}}class rs extends Vr{constructor(){super(),this._circleStyle={strokeWidth:.5,stroke:"#fff",strokeOpacity:1,fill:"#f80",fillOpacity:1},this._groupCircleStyle={strokeWidth:2,stroke:"#000",strokeOpacity:1,fill:"#fff",fillOpacity:1},this._rectangleStyle={strokeWidth:1,stroke:"#00f",strokeOpacity:1,fill:"#4af",fillOpacity:.2},this._darkRed="#b00",this._darkGreen="#0b0",this._darkBlue="#00b",this._xCircles=[],this._yCircles=[],this._zCircles=[],this.config=new yt({cameraPerspective:_t()},"playgroundConfig"),this.backgroundColor="#d0e4ff",this.name="Playground",this._textStyle={fontSize:12,fontFamily:"sans-serif",fill:"#666",fillOpacity:1,alignmentBaseline:"baseline"},this._textStyle.fontSize=20;for(let t=1.15;t<=20;t+=.15)this._xCircles.push(new Ut({x:t,y:0,z:0},1,this.circleStyle(this._darkRed))),this._xCircles.push(new Ut({x:-t,y:0,z:0},1,this.circleStyle(this._darkRed))),this._yCircles.push(new Ut({x:0,y:t,z:0},1,this.circleStyle(this._darkGreen))),this._yCircles.push(new Ut({x:0,y:-t,z:0},1,this.circleStyle(this._darkGreen))),this._zCircles.push(new Ut({x:0,y:0,z:t},1,this.circleStyle(this._darkBlue))),this._zCircles.push(new Ut({x:0,y:0,z:-t},1,this.circleStyle(this._darkBlue)));this.circles=[new Ut({x:0,y:0,z:0},3,this._circleStyle)],this.circles=[...this.circles,...this._xCircles,...this._yCircles,...this._zCircles],this.paths=[new te([{x:-1,y:0,z:0},{x:1,y:0,z:0}],!1,!1,this.pathStyle("#f80")),new te([{x:0,y:-1,z:0},{x:0,y:1,z:0}],!1,!1,this.pathStyle("#0f0")),new te([{x:0,y:0,z:-1},{x:0,y:0,z:1}],!1,!1,this.pathStyle("#00f"))],this.rectangles=[new oe({x:0,y:0,z:0},3,3,{rotateX:90,rotateY:0,rotateZ:0},this._rectangleStyle)],this.texts=[new ue({x:1,y:0,z:0},"Hello",!1,this._textStyle)],this.groups=[new Jt({x:-3,y:0,z:0},[new te([{x:0,y:2,z:0},{x:0,y:0,z:0}],!1,!1,this.pathStyle("#f00")),new Ut({x:0,y:2,z:0},5,this._groupCircleStyle),new Ut({x:0,y:0,z:0},5,this._groupCircleStyle)],Vt.INDEX),new Jt({x:3,y:0,z:0},[new Ut({x:0,y:2,z:0},5,this._groupCircleStyle),new te([{x:0,y:2,z:0},{x:0,y:0,z:0}],!1,!1,this.pathStyle("#f00")),new Ut({x:0,y:0,z:0},5,this._groupCircleStyle)])],this.init()}transitionToStateAt(t){const e=t%150<75;this.texts[0].text=e?"Hello":"World";const i=Math.floor(t/50)%3;let n=this._darkRed,r=this._darkGreen,s=this._darkBlue;switch(i){case 1:n=this._darkGreen,r=this._darkBlue,s=this._darkRed;break;case 2:n=this._darkBlue,r=this._darkRed,s=this._darkGreen}this._xCircles.forEach(t=>t.style=this.circleStyle(n)),this._yCircles.forEach(t=>t.style=this.circleStyle(r)),this._zCircles.forEach(t=>t.style=this.circleStyle(s))}pathStyle(t){return{strokeWidth:2,stroke:t,strokeOpacity:.5}}circleStyle(t){return{strokeWidth:0,stroke:"#000",strokeOpacity:0,fill:t,fillOpacity:.5}}}!function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.FORWARD=4]="FORWARD",t[t.BACKWARD=5]="BACKWARD"}(Lr||(Lr={}));class ss extends Vr{constructor(){super(),this.config=new yt({cameraPerspective:_t()},"randomPointsConfig"),this.name="Random Points",this.circles.push(new Ut({x:0,y:0,z:0},1.5));let t,e=structuredClone(this.circles[0].position),i=structuredClone(this.circles[0].position);for(let n=0;n<1500;n++){switch(t=Math.floor(6*Math.random()),e=structuredClone(i),t){case Lr.UP:e.y+=ss.DIST;break;case Lr.DOWN:e.y-=ss.DIST;break;case Lr.LEFT:e.x+=ss.DIST;break;case Lr.RIGHT:e.x-=ss.DIST;break;case Lr.FORWARD:e.z-=ss.DIST;break;case Lr.BACKWARD:e.z+=ss.DIST;break;default:console.log("NOK",t)}Math.abs(e.x)>ss.AREA||Math.abs(e.y)>ss.AREA||Math.abs(e.z)>ss.AREA||(i=structuredClone(e),this.circles.push(new Ut(structuredClone(i),1.5)))}this.init()}transitionToStateAt(t){}}ss.AREA=20,ss.DIST=.15;const os=["#1d1417","#0a1a34","#0f1a27","#131b1c","#122e4c","#32292c","#12323d","#232d3b","#38291f","#512124","#272e2e","#1d3230","#2c3022","#523e3e","#284a4e","#1e4c5e","#314942","#3e4452","#434440","#1d4c77","#504734","#3d4e35","#a6342d","#a03a42","#8a433a","#7d4651","#685c3d","#52633b","#366973","#516357","#2d699c","#3b6c5c","#5b616f","#64605a","#c15d53","#c5603b","#368695","#4a80af","#6e7e80","#2f93bb","#c26c7a","#878974","#539791","#9681a6","#bf7b5b","#c88242","#9f8c67","#a6878a","#649d7c","#bf818c","#7e95ae","#859a69","#b09655","#5ca9b8","#94a1a4","#dca27b","#e7aa58","#d6b258","#cdb0c1","#8ac7d0","#d8b2b1","#cfbc76","#c9bc94","#b4c0c6","#9ecaba","#c2c1b6","#eed06e","#e8d890","#e1d8aa","#d0dbdd","#e0dbc3","#dcddd6"];class as extends Vr{constructor(){super(),this._rows=8,this._columns=8,this._layers=8,this.config=new yt({cameraPerspective:{position:{x:-0,y:0,z:-8},angleX:0*gt,angleY:90*gt,angleZ:0*gt}},"richtersRectanglesConfig"),this.name="Richters Rectangles",this.backgroundColor="#ccc";const t=this._rows*this._columns*this._layers;for(this.rectangles=os.map(t=>this.createRectangle(t));this.rectangles.length<t;){const t=os[Math.floor(Math.random()*os.length)];this.rectangles.push(this.createRectangle(t))}this.rectangles.sort(()=>Math.random()-.5);for(let t=0;t<this._layers;t++)for(let e=0;e<this._rows;e++)for(let i=0;i<this._columns;i++)this.rectangles[t*this._rows*this._columns+e*this._columns+i].position={x:-i+this._columns/2-.5,y:-e+this._rows/2-.5,z:t-this._layers/2+.5};this._speedX=Array.from({length:t},()=>5*Math.random()),this._speedY=Array.from({length:t},()=>5*Math.random()),this._speedZ=Array.from({length:t},()=>5*Math.random()),this.init()}transitionToStateAt(t){const e=[30,46,60,72,82,90,96,100].map(e=>Math.max(t-e,0));this.rectangles.forEach((t,i)=>{const n=Math.floor(i/(this._rows*this._columns));t.orientation={rotateX:this._speedX[i]*e[n],rotateY:this._speedY[i]*e[n],rotateZ:this._speedZ[i]*e[n]}})}createRectangle(t){return new oe({x:0,y:0,z:0},1,1,void 0,this.createCircleStyle(t))}createCircleStyle(t){return{strokeWidth:0,stroke:"#000",strokeOpacity:0,fill:t,fillOpacity:.6}}}const ls=.35,hs=2,us=4.0923373,cs=.88,ps=2.5,ds=1.6021303,fs=.92,ys=2.85,gs=.9856474,_s=.49,ms=3.3,vs=.5240335,ws=10.5,bs=4.5,xs=.0830864,Ss=8.86,ks=6,As=.0334597,Cs=3.76,Es=7.2,Is=.0117299,Ps=3.65,Ms=8,Ts=.005981,zs=.3,$s=.1,Os=13.176358,Rs=.312,Ws=.65,Ds=203.489,Zs=.27,Ls=.7,Ns=101.376,Xs=.45,js=.75,Ys=50.316,Fs=.414,Bs=.83,Vs=21.569,Gs=.441,Hs=.85,Ks=22.571,Us=.135,qs=.3,Js=41.351,Qs=.234,to=.3,eo=-61.736,io=[.54,.57,.6,.63,.66];function no(t,e){if(!/^#([0-9A-Fa-f]{3}){1,2}$/.test(t)||e<0||e>1)return console.warn(`darkenColor - invalid inputs color=${t}, factor=${e}`),t;let i=t.replace("#","");3===i.length&&(i=i.split("").map(t=>t+t).join(""));const n=parseInt(i.substring(0,2),16),r=parseInt(i.substring(2,4),16),s=parseInt(i.substring(4,6),16),o=Math.round(n*e),a=Math.round(r*e),l=Math.round(s*e),h=t=>t.toString(16).padStart(2,"0");return`#${h(o)}${h(a)}${h(l)}`}const ro={strokeWidth:3,stroke:"rgba(255, 231, 98, 1)",strokeOpacity:.7,fill:"#ffca1aff",fillOpacity:1},so={strokeWidth:3,stroke:"#fe8",strokeOpacity:.5,fill:"#fff",fillOpacity:0},oo={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#A9A9A9",fillOpacity:1},ao={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#E6C229",fillOpacity:1},lo={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#1DA1F2",fillOpacity:1},ho={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#C1440E",fillOpacity:1},uo={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#F7CC7F",fillOpacity:1},co={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#F5DEB3",fillOpacity:1},po={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#AFD2E1",fillOpacity:1},fo={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#1E90FF",fillOpacity:1},yo={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#fff",fillOpacity:1},go={strokeWidth:1,stroke:co.fill,strokeOpacity:.5};function _o(t){return{fontSize:14,fontFamily:"sans-serif",fill:no(t,.5),fillOpacity:1,alignmentBaseline:"baseline"}}class mo extends Vr{constructor(){super(),this._orbitalAngles=this.calculateInitialPositions(1977,7,8),this.config=new yt({cameraPerspective:{position:{x:0,y:-1,z:-8.5},angleX:35*gt,angleY:330*gt,angleZ:0*gt},speed:1/24},"solarSystemConfig"),this.backgroundColor="#000",this.name="SolarSystem";const t={x:0,y:0,z:0};this._innerSun=new Ut(t,25,ro),this._outerSun=new Ut(t,28,so),this._sunInfo=new ue(this.planetInfoPosition(t,28),"Sun",!0,_o(ro.fill));const e=this.planetPosition(hs,this._orbitalAngles.mercury);this._mercury=new Ut(e,ls,oo),this._mercuryInfo=new ue(this.planetInfoPosition(e,ls),"Mercury",!0,_o(oo.fill));const i=this.planetPosition(ps,this._orbitalAngles.venus);this._venus=new Ut(i,cs,ao),this._venusInfo=new ue(this.planetInfoPosition(i,cs),"Venus",!0,_o(ao.fill));const n=this.planetPosition(ys,this._orbitalAngles.earth);this._earth=new Ut(n,fs,lo),this._earthInfo=new ue(this.planetInfoPosition(n,fs),"Earth",!0,_o(lo.fill)),this._earthLuna=new Ut(this.moonPosition(n,$s,this._orbitalAngles.earthLuna),zs,yo);const r=this.planetPosition(ms,this._orbitalAngles.mars);this._mars=new Ut(r,_s,ho),this._marsInfo=new ue(this.planetInfoPosition(r,_s),"Mars",!0,_o(ho.fill));const s=this.planetPosition(bs,this._orbitalAngles.jupiter);this._jupiter=new Ut(s,ws,uo),this._jupiterInfo=new ue(this.planetInfoPosition(s,ws),"Jupiter",!0,_o(uo.fill)),this._jupiterIo=new Ut(this.moonPosition(s,Ws,this._orbitalAngles.jupiterIo),Rs,yo),this._jupiterEuropa=new Ut(this.moonPosition(s,Ls,this._orbitalAngles.jupiterEuropa),Zs,yo),this._jupiterGanymede=new Ut(this.moonPosition(s,js,this._orbitalAngles.jupiterGanymede),Xs,yo),this._jupiterCalisto=new Ut(this.moonPosition(s,Bs,this._orbitalAngles.jupiterCallisto),Fs,yo);const o=this.planetPosition(ks,this._orbitalAngles.saturn);this._saturn=new Ut(o,Ss,co),this._saturnInfo=new ue(this.planetInfoPosition(o,Ss),"Saturn",!0,_o(co.fill)),this._saturnTitan=new Ut(this.moonPosition(o,Hs,this._orbitalAngles.saturnTitan),Gs,yo),this._saturnRing1=new te(this.ringPositions(o,io[0]),!0,!1,go),this._saturnRing2=new te(this.ringPositions(o,io[1]),!0,!1,go),this._saturnRing3=new te(this.ringPositions(o,io[2]),!0,!1,go),this._saturnRing4=new te(this.ringPositions(o,io[3]),!0,!1,go),this._saturnRing5=new te(this.ringPositions(o,io[4]),!0,!1,go);const a=this.planetPosition(Es,this._orbitalAngles.uranus);this._uranus=new Ut(a,Cs,po),this._uranusInfo=new ue(this.planetInfoPosition(a,Cs),"Uranus",!0,_o(po.fill)),this._uranusTitania=new Ut(this.moonPosition(a,qs,this._orbitalAngles.uranusTitania),Us,yo);const l=this.planetPosition(Ms,this._orbitalAngles.neptune);this._neptune=new Ut(l,Ps,fo),this._neptuneInfo=new ue(this.planetInfoPosition(l,Ps),"Neptune",!0,_o(fo.fill)),this._neptuneTriton=new Ut(this.moonPosition(l,to,this._orbitalAngles.neptuneTriton),Qs,yo),this.circles=[this._innerSun,this._outerSun,this._mercury,this._venus,this._earth,this._earthLuna,this._mars,this._jupiter,this._jupiterIo,this._jupiterEuropa,this._jupiterGanymede,this._jupiterCalisto,this._saturn,this._saturnTitan,this._uranus,this._uranusTitania,this._neptune,this._neptuneTriton],this.paths=[this._saturnRing1,this._saturnRing2,this._saturnRing3,this._saturnRing4,this._saturnRing5],this.texts=[this._sunInfo,this._mercuryInfo,this._venusInfo,this._earthInfo,this._marsInfo,this._jupiterInfo,this._saturnInfo,this._uranusInfo,this._neptuneInfo],this.init()}transitionToStateAt(t){const e=this.config.data.speed;this._orbitalAngles.mercury+=us*e,this._mercury.position=this.planetPosition(hs,this._orbitalAngles.mercury),this._mercuryInfo.position=this.planetInfoPosition(this._mercury.position,ls),this._orbitalAngles.venus+=ds*e,this._venus.position=this.planetPosition(ps,this._orbitalAngles.venus),this._venusInfo.position=this.planetInfoPosition(this._venus.position,cs),this._orbitalAngles.earth+=gs*e,this._earth.position=this.planetPosition(ys,this._orbitalAngles.earth),this._earthInfo.position=this.planetInfoPosition(this._earth.position,fs),this._orbitalAngles.earthLuna+=Os*e,this._earthLuna.position=this.moonPosition(this._earth.position,$s,this._orbitalAngles.earthLuna),this._orbitalAngles.mars+=vs*e,this._mars.position=this.planetPosition(ms,this._orbitalAngles.mars),this._marsInfo.position=this.planetInfoPosition(this._mars.position,_s),this._orbitalAngles.jupiter+=xs*e,this._jupiter.position=this.planetPosition(bs,this._orbitalAngles.jupiter),this._jupiterInfo.position=this.planetInfoPosition(this._jupiter.position,ws),this._orbitalAngles.jupiterIo+=Ds*e,this._jupiterIo.position=this.moonPosition(this._jupiter.position,Ws,this._orbitalAngles.jupiterIo),this._orbitalAngles.jupiterEuropa+=Ns*e,this._jupiterEuropa.position=this.moonPosition(this._jupiter.position,Ls,this._orbitalAngles.jupiterEuropa),this._orbitalAngles.jupiterGanymede+=Ys*e,this._jupiterGanymede.position=this.moonPosition(this._jupiter.position,js,this._orbitalAngles.jupiterGanymede),this._orbitalAngles.jupiterCallisto+=Vs*e,this._jupiterCalisto.position=this.moonPosition(this._jupiter.position,Bs,this._orbitalAngles.jupiterCallisto),this._orbitalAngles.saturn+=As*e,this._saturn.position=this.planetPosition(ks,this._orbitalAngles.saturn),this._saturnInfo.position=this.planetInfoPosition(this._saturn.position,Ss),this._orbitalAngles.saturnTitan+=Ks*e,this._saturnTitan.position=this.moonPosition(this._saturn.position,Hs,this._orbitalAngles.saturnTitan),this._saturnRing1.path=this.ringPositions(this._saturn.position,io[0]),this._saturnRing2.path=this.ringPositions(this._saturn.position,io[1]),this._saturnRing3.path=this.ringPositions(this._saturn.position,io[2]),this._saturnRing4.path=this.ringPositions(this._saturn.position,io[3]),this._saturnRing5.path=this.ringPositions(this._saturn.position,io[4]),this._orbitalAngles.uranus+=Is*e,this._uranus.position=this.planetPosition(Es,this._orbitalAngles.uranus),this._uranusInfo.position=this.planetInfoPosition(this._uranus.position,Cs),this._orbitalAngles.uranusTitania+=Js*e,this._uranusTitania.position=this.moonPosition(this._uranus.position,qs,this._orbitalAngles.uranusTitania),this._orbitalAngles.neptune+=Ts*e,this._neptune.position=this.planetPosition(Ms,this._orbitalAngles.neptune),this._neptuneInfo.position=this.planetInfoPosition(this._neptune.position,Ps),this._orbitalAngles.neptuneTriton-=eo*e,this._neptuneTriton.position=this.moonPosition(this._neptune.position,to,this._orbitalAngles.neptuneTriton)}planetPosition(t,e){return{x:t*Math.cos(e*gt),y:0,z:t*Math.sin(e*gt)}}planetInfoPosition(t,e){return{x:t.x,y:.15+e/20,z:t.z}}moonPosition(t,e,i){return{x:t.x+e*Math.cos(i*gt),y:0,z:t.z+e*Math.sin(i*gt)}}ringPositions(t,e){return Array.from({length:36},(t,e)=>10*e).map(i=>({x:t.x+e*Math.cos(i*gt),y:0,z:t.z+e*Math.sin(i*gt)}))}calculateInitialPositions(t,e,i){const n=new Date(2e3,0,1),r=(new Date(t,e-1,i).getTime()-n.getTime())/864e5;return{mercury:252.2509+r*us%360,venus:181.9798+r*ds%360,earth:100.4644+r*gs%360,earthLuna:360*Math.random(),mars:355.4333+r*vs%360,jupiter:34.3515+r*xs%360,jupiterIo:360*Math.random(),jupiterEuropa:360*Math.random(),jupiterGanymede:360*Math.random(),jupiterCallisto:360*Math.random(),saturn:49.9443+r*As%360,saturnTitan:360*Math.random(),uranus:313.2322+r*Is%360,uranusTitania:360*Math.random(),neptune:304.88+r*Ts%360,neptuneTriton:360*Math.random()}}}new class{constructor(){this._keyboardAnimationManager=new bt,this._abortWorldTick$=new N,this._newWorldSubscription=new Er,this._currentWorldIdSubscriontion=new Er,this._worldTitleArea=document.getElementById("worldTitle"),this._cameraInfoArea=document.getElementById("cameraInfo"),console.log("#constructor(Start) - ZetaSVG - Version:0.0.17"),function(t){const e="app-version",i=localStorage.getItem(e);i!==t&&(console.info(`#configVersionCheck - storedVersion=${i} does not match appVersion=${t}`),localStorage.clear(),caches.keys().then(t=>{t.forEach(t=>{caches.delete(t)})}),localStorage.setItem(e,t),window.location.reload())}("0.0.17"),this._stageMode=Rr();const t=document.getElementById("main");if(null==t)return void console.error("Critical: Main div element not found");this.setupStage(t),this._stage=new $r("main"),this._camera=new mt,this._cameraControl=new wt(this._camera),this._world=null,this._config=new yt({currentWorldId:1,worldTick:40},"mainConfig"),this._currentWorldId$=new j(this._config.data.currentWorldId);const e=this._stageMode==Or.IMMERSIVE;this.handlePhysicalKeyboardEvents(!e),e||(this.appendVirtualKeyboard(),this.updateCameraInfo()),this.runWorld()}setupStage(t){const e=document.getElementById("info"),i=document.getElementById("virtual-keyboard-container");switch(this._stageMode){case Or.DEFAULT:t.classList.add("main--default"),null==e||e.classList.add("info--default");break;case Or.SMALL:t.classList.add("main--small"),null==e||e.classList.add("info--small");break;case Or.IMMERSIVE:console.log("Fullscreen detected - going immersive!"),t.classList.add("main--immersive"),null==e||e.classList.add("element--gone"),null==i||i.classList.add("element--gone")}window.addEventListener("resize",()=>{Rr()!==this._stageMode&&window.location.reload()})}handlePhysicalKeyboardEvents(t){t?document.addEventListener("keydown",t=>{this.signalPhysicalEventToVirtualKeyboard(t.key),this.handleKeyPress(t.key)},!1):document.addEventListener("keydown",t=>{this.handleKeyPress(t.key)},!1)}appendVirtualKeyboard(){fetch("virtual-keyboard.html").then(t=>t.text()).then(t=>{const e=document.getElementById("virtual-keyboard-container");null!=e?e.innerHTML=t:console.error("virtual-keyboard-container not found to append virtual keyboard html")}).then(t=>{Array.from(document.getElementsByClassName("virtual-key")).forEach(t=>function(t,e,i){const n=t.dataset.key||"",r=Dr(Yr(t,"mousedown"),Yr(t,"touchstart")),s=Dr(Yr(t,"mouseup"),Yr(t,"touchend"),Yr(t,"mouseleave"));var o;Yr(t,"touchstart").subscribe(t=>t.preventDefault()),r.pipe((o=()=>(i(e,n),J(300,50).pipe(ft(s))),tt(function(t,e){var i=null,n=!1,r=function(){return n&&!i&&e.complete()};t.subscribe(et(e,function(t){null==i||i.unsubscribe(),pt(o()).subscribe(i=et(e,function(t){return e.next(t)},function(){i=null,r()}))},function(){n=!0,r()}))}))).subscribe(()=>{i(e,n)})}(t,this,this.handleKeyPressViaVirtualKeyboard)),this._currentWorldIdSubscriontion.set(this._currentWorldId$.subscribe(t=>{for(let e=0;e<10;e++){const i=document.getElementById(`virtual-key-${e}`);e==t?null==i||i.classList.add("virtual-key--selected"):null==i||i.classList.remove("virtual-key--selected")}}))})}signalPhysicalEventToVirtualKeyboard(t){this._keyboardAnimationManager.triggerAnimation(t)}handleKeyPressViaVirtualKeyboard(t,e){t.handleKeyPress(e)}handleKeyPress(t){var e,i;if(!this._cameraControl.onNextEvent(t))switch(t){case"":console.log("invalid key");case"Escape":null===(e=this._world)||void 0===e||e.resetConfig(),null===(i=this._world)||void 0===i||i.mountCamera(this._camera);break;case"1":this.switchWorld(1);break;case"2":this.switchWorld(2);break;case"3":this.switchWorld(3);break;case"4":this.switchWorld(4);break;case"5":this.switchWorld(5);break;case"6":this.switchWorld(6);break;case"7":this.switchWorld(7);break;case"8":this.switchWorld(8);break;case"9":this.switchWorld(9);break;case"0":this.switchWorld(0)}}switchWorld(t){console.log(`switching world to (${t})`),this._currentWorldId$.next(t),this._config.data.currentWorldId=t,this._abortWorldTick$.next(),this._newWorldSubscription.set(J(100).subscribe(()=>{this.runWorld()}))}runWorld(){var t;null===(t=this._world)||void 0===t||t.onDestroy(),this._world=this.createWorldById(this._config.data.currentWorldId),console.log(`                       ${"_".repeat(this._world.name.length+2)}`),console.log(`-> initializing world | ${this._world.name} |`),console.log(`                       ${"".repeat(this._world.name.length+2)}`),this._world.mountCamera(this._camera),this.updateWorldTitle(this._world.name);const e=new ce(this._world,this._camera,function(t){var e;const i=null!==(e=window.devicePixelRatio)&&void 0!==e?e:1;switch(t){case Or.DEFAULT:return 1280;case Or.SMALL:return 800;case Or.IMMERSIVE:return window.innerWidth*i}}(this._stageMode),function(t){var e;const i=null!==(e=window.devicePixelRatio)&&void 0!==e?e:1;switch(t){case Or.DEFAULT:return 720;case Or.SMALL:return 450;case Or.IMMERSIVE:return window.innerHeight*i}}(this._stageMode));this._stage.registerShapes(e.shapes,this._world.backgroundColor),Q(this._config.data.worldTick).pipe(ft(this._abortWorldTick$)).subscribe({next:()=>{var t;null===(t=this._world)||void 0===t||t.tick()},complete:()=>{console.log("Old world completed - unregistering shapes"),this._stage.unregisterShapes(e.shapes.id)}})}createWorldById(t){switch(t){case 1:return new rs;case 2:return new as;case 3:return new ts;case 4:return new Gr;case 5:return new Hr;case 6:return new ss;case 7:return new es;case 8:return new mo;case 9:return new Ur;case 0:return new Qr;default:return console.error("Unnown world id",t),new rs}}updateWorldTitle(t){null!=this._worldTitleArea&&(this._worldTitleArea.textContent=`World: ${t} (${this._config.data.currentWorldId})`)}updateCameraInfo(){this._camera.state$.subscribe({next:t=>{const e=`Perspective: Position (X ${(i=t).position.x.toFixed(1)}, Y ${i.position.y.toFixed(1)}, Z ${i.position.z.toFixed(1)}), Angle-X ${(180*i.angleX/Math.PI).toFixed(0)}, Angle-Y ${(180*i.angleY/Math.PI).toFixed(0)}, Angle-Z ${(180*i.angleZ/Math.PI).toFixed(0)})`;var i;null!=this._cameraInfoArea&&(this._cameraInfoArea.textContent=e)}})}}})();