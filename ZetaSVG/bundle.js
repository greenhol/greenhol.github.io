(()=>{"use strict";var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}function n(t,e){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function i(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function r(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}function s(t,e,n){if(n||2===arguments.length)for(var i,r=0,s=e.length;r<s;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}function o(t){return this instanceof o?(this.v=t,this):new o(t)}function a(t){return"function"==typeof t}function l(t){var e=t(function(t){Error.call(t),t.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}Object.create,Object.create;var h=l(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}});function u(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var c=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,n,o,l;if(!this.closed){this.closed=!0;var u=this._parentage;if(u)if(this._parentage=null,Array.isArray(u))try{for(var c=i(u),f=c.next();!f.done;f=c.next())f.value.remove(this)}catch(e){t={error:e}}finally{try{f&&!f.done&&(e=c.return)&&e.call(c)}finally{if(t)throw t.error}}else u.remove(this);var p=this.initialTeardown;if(a(p))try{p()}catch(t){l=t instanceof h?t.errors:[t]}var y=this._finalizers;if(y){this._finalizers=null;try{for(var _=i(y),g=_.next();!g.done;g=_.next()){var m=g.value;try{d(m)}catch(t){l=null!=l?l:[],t instanceof h?l=s(s([],r(l)),r(t.errors)):l.push(t)}}}catch(t){n={error:t}}finally{try{g&&!g.done&&(o=_.return)&&o.call(_)}finally{if(n)throw n.error}}}if(l)throw new h(l)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)d(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&u(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&u(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t;var e}(),f=c.EMPTY;function p(t){return t instanceof c||t&&"closed"in t&&a(t.remove)&&a(t.add)&&a(t.unsubscribe)}function d(t){a(t)?t():t.unsubscribe()}var y=null,_=null,g=void 0,m=!1,v=!1,w={setTimeout:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=w.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,s([t,e],r(n))):setTimeout.apply(void 0,s([t,e],r(n)))},clearTimeout:function(t){var e=w.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function b(t){w.setTimeout(function(){if(!y)throw t;y(t)})}function x(){}var k=S("C",void 0,void 0);function S(t,e,n){return{kind:t,value:e,error:n}}var A=null;function E(t){if(m){var e=!A;if(e&&(A={errorThrown:!1,error:null}),t(),e){var n=A,i=n.errorThrown,r=n.error;if(A=null,i)throw r}}else t()}var M=function(t){function n(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,p(e)&&e.add(n)):n.destination=$,n}return e(n,t),n.create=function(t,e,n){return new z(t,e,n)},n.prototype.next=function(t){this.isStopped?O(function(t){return S("N",t,void 0)}(t),this):this._next(t)},n.prototype.error=function(t){this.isStopped?O(S("E",void 0,t),this):(this.isStopped=!0,this._error(t))},n.prototype.complete=function(){this.isStopped?O(k,this):(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},n.prototype._next=function(t){this.destination.next(t)},n.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},n.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},n}(c),I=Function.prototype.bind;function C(t,e){return I.call(t,e)}var P=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){T(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){T(t)}else T(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){T(t)}},t}(),z=function(t){function n(e,n,i){var r,s,o=t.call(this)||this;return a(e)||!e?r={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=i?i:void 0}:o&&v?((s=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},r={next:e.next&&C(e.next,s),error:e.error&&C(e.error,s),complete:e.complete&&C(e.complete,s)}):r=e,o.destination=new P(r),o}return e(n,t),n}(M);function T(t){var e;m?(e=t,m&&A&&(A.errorThrown=!0,A.error=e)):b(t)}function O(t,e){var n=_;n&&w.setTimeout(function(){return n(t,e)})}var $={closed:!0,next:x,error:function(t){throw t},complete:x},W="function"==typeof Symbol&&Symbol.observable||"@@observable";function Z(t){return t}var R=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var i,r=this,s=(i=t)&&i instanceof M||function(t){return t&&a(t.next)&&a(t.error)&&a(t.complete)}(i)&&p(i)?t:new z(t,e,n);return E(function(){var t=r,e=t.operator,n=t.source;s.add(e?e.call(s,n):n?r._subscribe(s):r._trySubscribe(s))}),s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=X(e))(function(e,i){var r=new z({next:function(e){try{t(e)}catch(t){i(t),r.unsubscribe()}},error:i,complete:e});n.subscribe(r)})},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[W]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0===(n=t).length?Z:1===n.length?n[0]:function(t){return n.reduce(function(t,e){return e(t)},t)})(this);var n},t.prototype.toPromise=function(t){var e=this;return new(t=X(t))(function(t,n){var i;e.subscribe(function(t){return i=t},function(t){return n(t)},function(){return t(i)})})},t.create=function(e){return new t(e)},t}();function X(t){var e;return null!==(e=null!=t?t:g)&&void 0!==e?e:Promise}var D=l(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),N=function(t){function n(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(n,t),n.prototype.lift=function(t){var e=new L(this,this);return e.operator=t,e},n.prototype._throwIfClosed=function(){if(this.closed)throw new D},n.prototype.next=function(t){var e=this;E(function(){var n,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var s=i(e.currentObservers),o=s.next();!o.done;o=s.next())o.value.next(t)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}})},n.prototype.error=function(t){var e=this;E(function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}})},n.prototype.complete=function(){var t=this;E(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},n.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(n.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),n.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},n.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},n.prototype._innerSubscribe=function(t){var e=this,n=this,i=n.hasError,r=n.isStopped,s=n.observers;return i||r?f:(this.currentObservers=null,s.push(t),new c(function(){e.currentObservers=null,u(s,t)}))},n.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,i=e.thrownError,r=e.isStopped;n?t.error(i):r&&t.complete()},n.prototype.asObservable=function(){var t=new R;return t.source=this,t},n.create=function(t,e){return new L(t,e)},n}(R),L=function(t){function n(e,n){var i=t.call(this)||this;return i.destination=e,i.source=n,i}return e(n,t),n.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},n.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},n.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},n.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:f},n}(N),Y=function(t){function n(e){var n=t.call(this)||this;return n._value=e,n}return e(n,t),Object.defineProperty(n.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),n.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return!n.closed&&e.next(this._value),n},n.prototype.getValue=function(){var t=this,e=t.hasError,n=t.thrownError,i=t._value;if(e)throw n;return this._throwIfClosed(),i},n.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},n}(N),j=function(t){function n(e,n){return t.call(this)||this}return e(n,t),n.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},n}(c),F={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=F.delegate;return(null==o?void 0:o.setInterval)?o.setInterval.apply(o,s([t,e],r(n))):setInterval.apply(void 0,s([t,e],r(n)))},clearInterval:function(t){var e=F.delegate;return((null==e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},V=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.pending=!1,i}return e(n,t),n.prototype.schedule=function(t,e){var n;if(void 0===e&&(e=0),this.closed)return this;this.state=t;var i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,e)),this.pending=!0,this.delay=e,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(r,this.id,e),this},n.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),F.setInterval(t.flush.bind(t,this),n)},n.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return e;null!=e&&F.clearInterval(e)},n.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},n.prototype._execute=function(t,e){var n,i=!1;try{this.work(t)}catch(t){i=!0,n=t||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),n},n.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,n=this.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,u(i,this),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},n}(j),B={now:function(){return(B.delegate||Date).now()},delegate:void 0},H=function(){function t(e,n){void 0===n&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(n,e)},t.now=B.now,t}(),K=function(t){function n(e,n){void 0===n&&(n=H.now);var i=t.call(this,e,n)||this;return i.actions=[],i._active=!1,i}return e(n,t),n.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},n}(H),G=new K(V),U=G;function q(t){return t&&a(t.schedule)}function J(t,e,n){void 0===t&&(t=0),void 0===n&&(n=U);var i=-1;return null!=e&&(q(e)?n=e:i=e),new R(function(e){var r,s=(r=t)instanceof Date&&!isNaN(r)?+t-n.now():t;s<0&&(s=0);var o=0;return n.schedule(function(){e.closed||(e.next(o++),0<=i?this.schedule(void 0,i):e.complete())},s)})}function Q(t,e){return void 0===t&&(t=0),void 0===e&&(e=G),t<0&&(t=0),J(t,t,e)}function tt(t){return function(e){if(function(t){return a(null==t?void 0:t.lift)}(e))return e.lift(function(e){try{return t(e,this)}catch(t){this.error(t)}});throw new TypeError("Unable to lift unknown Observable type")}}function et(t,e,n,i,r){return new nt(t,e,n,i,r)}var nt=function(t){function n(e,n,i,r,s,o){var a=t.call(this,e)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=n?function(t){try{n(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=r?function(t){try{r(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=i?function(){try{i()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return e(n,t),n.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},n}(M),it=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function rt(t){return a(null==t?void 0:t.then)}function st(t){return a(t[W])}function ot(t){return Symbol.asyncIterator&&a(null==t?void 0:t[Symbol.asyncIterator])}function at(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var lt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ht(t){return a(null==t?void 0:t[lt])}function ut(t){return function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(t,e||[]),s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(t){r[t]&&(i[t]=function(e){return new Promise(function(n,i){s.push([t,e,n,i])>1||l(t,e)})})}function l(t,e){try{(n=r[t](e)).value instanceof o?Promise.resolve(n.value.v).then(h,u):c(s[0][2],n)}catch(t){c(s[0][3],t)}var n}function h(t){l("next",t)}function u(t){l("throw",t)}function c(t,e){t(e),s.shift(),s.length&&l(s[0][0],s[0][1])}}(this,arguments,function(){var e,i,r;return n(this,function(n){switch(n.label){case 0:e=t.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,o(e.read())];case 3:return i=n.sent(),r=i.value,i.done?[4,o(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,o(r)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function ct(t){return a(null==t?void 0:t.getReader)}function ft(t){if(t instanceof R)return t;if(null!=t){if(st(t))return s=t,new R(function(t){var e=s[W]();if(a(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(it(t))return e=t,new R(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()});if(rt(t))return r=t,new R(function(t){r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,b)});if(ot(t))return pt(t);if(ht(t))return n=t,new R(function(t){var e,r;try{for(var s=i(n),o=s.next();!o.done;o=s.next()){var a=o.value;if(t.next(a),t.closed)return}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}t.complete()});if(ct(t))return pt(ut(t))}var e,n,r,s;throw at(t)}function pt(t){return new R(function(e){(function(t,e){var r,s,o,a,l,h,u,c;return l=this,h=void 0,c=function(){var l,h;return n(this,function(n){switch(n.label){case 0:n.trys.push([0,5,6,11]),r=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=i(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise(function(i,r){!function(t,e,n,i){Promise.resolve(i).then(function(e){t({value:e,done:n})},e)}(i,r,(e=t[n](e)).done,e.value)})}}}(t),n.label=1;case 1:return[4,r.next()];case 2:if((s=n.sent()).done)return[3,4];if(l=s.value,e.next(l),e.closed)return[2];n.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return h=n.sent(),o={error:h},[3,11];case 6:return n.trys.push([6,,9,10]),s&&!s.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:n.sent(),n.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})},new((u=void 0)||(u=Promise))(function(t,e){function n(t){try{r(c.next(t))}catch(t){e(t)}}function i(t){try{r(c.throw(t))}catch(t){e(t)}}function r(e){var r;e.done?t(e.value):(r=e.value,r instanceof u?r:new u(function(t){t(r)})).then(n,i)}r((c=c.apply(l,h||[])).next())})})(t,e).catch(function(t){return e.error(t)})})}function dt(t){return tt(function(e,n){ft(t).subscribe(et(n,function(){return n.complete()},x)),!n.closed&&e.subscribe(n)})}class yt{constructor(t,e="",n="local"){this._initialConfig=t,this._storageKey=e,this._persistable=!!e,this._storageType=n,this.load()||(this.data=Object.assign({},this._initialConfig)),this.init()}init(){null==window.zetaConfig&&(window.zetaConfig=[]),null==window.zetaConfigCtrl&&(window.zetaConfigCtrl=[]),window.zetaConfig[this._storageKey]=this.data,window.zetaConfigCtrl[this._storageKey]=this,window.addEventListener("beforeunload",()=>{this.save()})}save(){this._persistable?(("local"===this._storageType?localStorage:sessionStorage).setItem(this._storageKey,JSON.stringify(this.data)),console.log(`Configuration ${this._storageKey} saved to ${this._storageType}`)):console.log(`Configuration ${this._storageKey} not persistable`)}load(){if(!this._persistable)return!1;{const t=("local"===this._storageType?localStorage:sessionStorage).getItem(this._storageKey);if(!t)return console.log(`No Configuration ${this._storageKey} found in ${this._storageType}`),!1;try{return this.data=JSON.parse(t),console.log(`Configuration ${this._storageKey} loaded from ${this._storageType}`),!0}catch(t){return console.error("Error loading configuration ${this._storageKey}:",t),!1}}}clear(){("local"===this._storageType?localStorage:sessionStorage).removeItem(this._storageKey),console.log(`Configuration ${this._storageKey} cleared from ${this._storageType}`)}print(){console.log("Current configuration ${this._storageKey}:",this.data)}reset(){this.data=Object.assign({},this._initialConfig),console.log(`Configuration ${this._storageKey} reset ${JSON.stringify(this.data)}`)}}const _t=Math.PI/180;function gt(){return{position:{x:0,y:0,z:-7.5},angleX:45*_t,angleY:45*_t,angleZ:0*_t}}class mt{constructor(){this.state$=new Y(gt())}get position(){return this.state$.getValue().position}get angleX(){return this.state$.getValue().angleX}get angleY(){return this.state$.getValue().angleY}get angleZ(){return this.state$.getValue().angleZ}moveX(t){const e=structuredClone(this.state$.getValue());e.position.x+=t,this.state$.next(e)}moveY(t){const e=structuredClone(this.state$.getValue());e.position.y+=t,this.state$.next(e)}moveZ(t){const e=structuredClone(this.state$.getValue());e.position.z+=t,this.state$.next(e)}rotateX(t){const e=structuredClone(this.state$.getValue());e.angleX+=t,this.state$.next(e)}rotateY(t){const e=structuredClone(this.state$.getValue());e.angleY+=t,this.state$.next(e)}rotateZ(t){const e=structuredClone(this.state$.getValue());e.angleZ+=t,this.state$.next(e)}mountCamera(t){const e=structuredClone(t);this.state$.next(e)}}var vt;!function(t){t.W="w",t.A="a",t.S="s",t.D="d",t.R="r",t.F="f",t.Up="ArrowUp",t.Left="ArrowLeft",t.Down="ArrowDown",t.Right="ArrowRight",t.Comma=",",t.Dot="."}(vt||(vt={}));class wt{constructor(t){this._camera=t}onNextEvent(t){switch(t){case vt.W:return this._camera.moveZ(.1),!0;case vt.A:return this._camera.moveX(-.1),!0;case vt.S:return this._camera.moveZ(-.1),!0;case vt.D:return this._camera.moveX(.1),!0;case vt.R:return this._camera.moveY(.1),!0;case vt.F:return this._camera.moveY(-.1),!0;case vt.Up:return this._camera.rotateX(_t),!0;case vt.Left:return this._camera.rotateY(_t),!0;case vt.Down:return this._camera.rotateX(-_t),!0;case vt.Right:return this._camera.rotateY(-_t),!0;case vt.Comma:return this._camera.rotateZ(-_t),!0;case vt.Dot:return this._camera.rotateZ(_t),!0;default:return!1}}}class bt{constructor(){this._listeners=new Map,this._animationClassName="physical-key-pressed-detected",this._animationEndEvent="animationend"}triggerAnimation(t){const e=this.getElementFromKeyValue(t);if(null!=e){const t=()=>{e.classList.remove(this._animationClassName),this._listeners.delete(e)};this.cleanupListener(e),e.classList.remove(this._animationClassName),e.offsetWidth,e.classList.add(this._animationClassName),e.addEventListener(this._animationEndEvent,t,{once:!0}),this._listeners.set(e,t)}}cleanupAll(){this._listeners.forEach((t,e)=>{e.removeEventListener(this._animationEndEvent,t)}),this._listeners.clear()}cleanupListener(t){const e=this._listeners.get(t);e&&(t.removeEventListener(this._animationEndEvent,e),this._listeners.delete(t))}getElementFromKeyValue(t){switch(t){case vt.W:case vt.A:case vt.S:case vt.D:case vt.R:case vt.F:case vt.Up:case vt.Left:case vt.Down:case vt.Right:return document.getElementById(`virtual-key-${t}`);case vt.Comma:return document.getElementById("virtual-key-Comma");case vt.Dot:return document.getElementById("virtual-key-Period");case"Escape":return document.getElementById("virtual-key-Escape");default:return null}}}var xt=new R(function(t){return t.complete()}),kt=Array.isArray,St=Object.getPrototypeOf,At=Object.prototype,Et=Object.keys;function Mt(t,e,n,i,r){void 0===i&&(i=0),void 0===r&&(r=!1);var s=e.schedule(function(){n(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(s),!r)return s}function It(t,e){return void 0===e&&(e=0),tt(function(n,i){n.subscribe(et(i,function(n){return Mt(i,t,function(){return i.next(n)},e)},function(){return Mt(i,t,function(){return i.complete()},e)},function(n){return Mt(i,t,function(){return i.error(n)},e)}))})}function Ct(t,e){return void 0===e&&(e=0),tt(function(n,i){i.add(t.schedule(function(){return n.subscribe(i)},e))})}function Pt(t,e){if(!t)throw new Error("Iterable cannot be null");return new R(function(n){Mt(n,e,function(){var i=t[Symbol.asyncIterator]();Mt(n,e,function(){i.next().then(function(t){t.done?n.complete():n.next(t.value)})},0,!0)})})}function zt(t,e){return e?function(t,e){if(null!=t){if(st(t))return function(t,e){return ft(t).pipe(Ct(e),It(e))}(t,e);if(it(t))return function(t,e){return new R(function(n){var i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}(t,e);if(rt(t))return function(t,e){return ft(t).pipe(Ct(e),It(e))}(t,e);if(ot(t))return Pt(t,e);if(ht(t))return function(t,e){return new R(function(n){var i;return Mt(n,e,function(){i=t[lt](),Mt(n,e,function(){var t,e,r;try{e=(t=i.next()).value,r=t.done}catch(t){return void n.error(t)}r?n.complete():n.next(e)},0,!0)}),function(){return a(null==i?void 0:i.return)&&i.return()}})}(t,e);if(ct(t))return function(t,e){return Pt(ut(t),e)}(t,e)}throw at(t)}(t,e):ft(t)}function Tt(t,e){return tt(function(n,i){var r=0;n.subscribe(et(i,function(n){i.next(t.call(e,n,r++))}))})}var Ot,$t=Array.isArray;function Wt(t){return Tt(function(e){return function(t,e){return $t(e)?t.apply(void 0,s([],r(e))):t(e)}(t,e)})}function Zt(t){return t[t.length-1]}function Rt(t){return q(Zt(t))?t.pop():void 0}function Xt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Rt(t),i=function(t){return a(Zt(t))?t.pop():void 0}(t),r=function(t){if(1===t.length){var e=t[0];if(kt(e))return{args:e,keys:null};if((i=e)&&"object"==typeof i&&St(i)===At){var n=Et(e);return{args:n.map(function(t){return e[t]}),keys:n}}}var i;return{args:t,keys:null}}(t),s=r.args,o=r.keys;if(0===s.length)return zt([],n);var l=new R(function(t,e,n){return void 0===n&&(n=Z),function(i){Dt(e,function(){for(var r=t.length,s=new Array(r),o=r,a=r,l=function(r){Dt(e,function(){var l=zt(t[r],e),h=!1;l.subscribe(et(i,function(t){s[r]=t,h||(h=!0,a--),a||i.next(n(s.slice()))},function(){--o||i.complete()}))},i)},h=0;h<r;h++)l(h)},i)}}(s,n,o?function(t){return function(t,e){return t.reduce(function(t,n,i){return t[n]=e[i],t},{})}(o,t)}:Z));return i?l.pipe(Wt(i)):l}function Dt(t,e,n){t?Mt(n,t,e):e()}!function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"}(Ot||(Ot={}));class Nt{constructor(){this.m=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}static multiply(t,e){let n=new Nt;for(let i=0;i<Nt.SIZE;i++)for(let r=0;r<Nt.SIZE;r++)for(let s=0;s<Nt.SIZE;s++)n.m[i][r]+=t.m[i][s]*e.m[s][r];return n}get det(){let t=this.m;return t[0][0]*t[1][1]*t[2][2]*t[3][3]+t[0][0]*t[1][2]*t[2][3]*t[3][1]+t[0][0]*t[1][3]*t[2][1]*t[3][2]+t[0][1]*t[1][0]*t[2][3]*t[3][2]+t[0][1]*t[1][2]*t[2][0]*t[3][3]+t[0][1]*t[1][3]*t[2][2]*t[3][0]+t[0][2]*t[1][0]*t[2][1]*t[3][3]+t[0][2]*t[1][1]*t[2][3]*t[3][0]+t[0][2]*t[1][3]*t[2][0]*t[3][1]+t[0][3]*t[1][0]*t[2][2]*t[3][1]+t[0][3]*t[1][1]*t[2][0]*t[3][2]+t[0][3]*t[1][2]*t[2][1]*t[3][0]-t[0][0]*t[1][1]*t[2][3]*t[3][2]-t[0][0]*t[1][2]*t[2][1]*t[3][3]-t[0][0]*t[1][3]*t[2][2]*t[3][1]-t[0][1]*t[1][0]*t[2][2]*t[3][3]-t[0][1]*t[1][2]*t[2][3]*t[3][0]-t[0][1]*t[1][3]*t[2][0]*t[3][2]-t[0][2]*t[1][0]*t[2][3]*t[3][1]-t[0][2]*t[1][1]*t[2][0]*t[3][3]-t[0][2]*t[1][3]*t[2][1]*t[3][0]-t[0][3]*t[1][0]*t[2][1]*t[3][2]-t[0][3]*t[1][1]*t[2][2]*t[3][0]-t[0][3]*t[1][2]*t[2][0]*t[3][1]}get inv(){let t=this.det;if(!t)return null;let e=this.m,n=new Nt;return n.m[0][0]=e[1][1]*e[2][2]*e[3][3]+e[1][2]*e[2][3]*e[3][1]+e[1][3]*e[2][1]*e[3][2]-e[1][1]*e[2][3]*e[3][2]-e[1][2]*e[2][1]*e[3][3]-e[1][3]*e[2][2]*e[3][1],n.m[0][1]=e[0][1]*e[2][3]*e[3][2]+e[0][2]*e[2][1]*e[3][3]+e[0][3]*e[2][2]*e[3][1]-e[0][1]*e[2][2]*e[3][3]-e[0][2]*e[2][3]*e[3][1]-e[0][3]*e[2][1]*e[3][2],n.m[0][2]=e[0][1]*e[1][2]*e[3][3]+e[0][2]*e[1][3]*e[3][1]+e[0][3]*e[1][1]*e[3][2]-e[0][1]*e[1][3]*e[3][2]-e[0][2]*e[1][1]*e[3][3]-e[0][3]*e[1][2]*e[3][1],n.m[0][3]=e[0][1]*e[1][3]*e[2][2]+e[0][2]*e[1][1]*e[2][3]+e[0][3]*e[1][2]*e[2][1]-e[0][1]*e[1][2]*e[2][3]-e[0][2]*e[1][3]*e[2][1]-e[0][3]*e[1][1]*e[2][2],n.m[1][0]=e[1][0]*e[2][3]*e[3][2]+e[1][2]*e[2][0]*e[3][3]+e[1][3]*e[2][2]*e[3][0]-e[1][0]*e[2][2]*e[3][3]-e[1][2]*e[2][3]*e[3][0]-e[1][3]*e[2][0]*e[3][2],n.m[1][1]=e[0][0]*e[2][2]*e[3][3]+e[0][2]*e[2][3]*e[3][0]+e[0][3]*e[2][0]*e[3][2]-e[0][0]*e[2][3]*e[3][2]-e[0][2]*e[2][0]*e[3][3]-e[0][3]*e[2][2]*e[3][0],n.m[1][2]=e[0][0]*e[1][3]*e[3][2]+e[0][2]*e[1][0]*e[3][3]+e[0][3]*e[1][2]*e[3][0]-e[0][0]*e[1][2]*e[3][3]-e[0][2]*e[1][3]*e[3][0]-e[0][3]*e[1][0]*e[3][2],n.m[1][3]=e[0][0]*e[1][2]*e[2][3]+e[0][2]*e[1][3]*e[2][0]+e[0][3]*e[1][0]*e[2][2]-e[0][0]*e[1][3]*e[2][2]-e[0][2]*e[1][0]*e[2][3]-e[0][3]*e[1][2]*e[2][0],n.m[2][0]=e[1][0]*e[2][1]*e[3][3]+e[1][1]*e[2][3]*e[3][0]+e[1][3]*e[2][0]*e[3][1]-e[1][0]*e[2][3]*e[3][1]-e[1][1]*e[2][0]*e[3][3]-e[1][3]*e[2][1]*e[3][0],n.m[2][1]=e[0][0]*e[2][3]*e[3][1]+e[0][1]*e[2][0]*e[3][3]+e[0][3]*e[2][1]*e[3][0]-e[0][0]*e[2][1]*e[3][3]-e[0][1]*e[2][3]*e[3][0]-e[0][3]*e[2][0]*e[3][1],n.m[2][2]=e[0][0]*e[1][1]*e[3][3]+e[0][1]*e[1][3]*e[3][0]+e[0][3]*e[1][0]*e[3][1]-e[0][0]*e[1][3]*e[3][1]-e[0][1]*e[1][0]*e[3][3]-e[0][3]*e[1][1]*e[3][0],n.m[2][3]=e[0][0]*e[1][3]*e[2][1]+e[0][1]*e[1][0]*e[2][3]+e[0][3]*e[1][1]*e[2][0]-e[0][0]*e[1][1]*e[2][3]-e[0][1]*e[1][3]*e[2][0]-e[0][3]*e[1][0]*e[2][1],n.m[3][0]=e[1][0]*e[2][2]*e[3][1]+e[1][1]*e[2][0]*e[3][2]+e[1][2]*e[2][1]*e[3][0]-e[1][0]*e[2][1]*e[3][2]-e[1][1]*e[2][2]*e[3][0]-e[1][2]*e[2][0]*e[3][1],n.m[3][1]=e[0][0]*e[2][1]*e[3][2]+e[0][1]*e[2][2]*e[3][0]+e[0][2]*e[2][0]*e[3][1]-e[0][0]*e[2][2]*e[3][1]-e[0][1]*e[2][0]*e[3][2]-e[0][2]*e[2][1]*e[3][0],n.m[3][2]=e[0][0]*e[1][2]*e[3][1]+e[0][1]*e[1][0]*e[3][2]+e[0][2]*e[1][1]*e[3][0]-e[0][0]*e[1][1]*e[3][2]-e[0][1]*e[1][2]*e[3][0]-e[0][2]*e[1][0]*e[3][1],n.m[3][3]=e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[1][0]*e[2][1]-e[0][0]*e[1][2]*e[2][1]-e[0][1]*e[1][0]*e[2][2]-e[0][2]*e[1][1]*e[2][0],n.scalarMultiply(1/t),n}scalarMultiply(t){for(let e=0;e<Nt.SIZE;e++)for(let n=0;n<Nt.SIZE;n++)this.m[e][n]*=t}vector3Multiply(t){let e,n=[t.x,t.y,t.z,1],i=[];for(let t=0;t<Nt.SIZE;t++){e=0;for(let i=0;i<Nt.SIZE;i++)e+=this.m[t][i]*n[i];i.push(e)}return{x:i[0],y:i[1],z:i[2]}}vector4Multiply(t){let e,n=[t.x,t.y,t.z,t.u],i=[];for(let t=0;t<Nt.SIZE;t++){e=0;for(let i=0;i<Nt.SIZE;i++)e+=this.m[t][i]*n[i];i.push(e)}return{x:i[0],y:i[1],z:i[2],u:i[3]}}log(){let t="";for(let e=0;e<Nt.SIZE;e++){for(let n=0;n<Nt.SIZE;n++)t+=this.m[e][n].toFixed(5)+" ";t+="\n"}console.log(t)}}Nt.SIZE=4;class Lt extends Nt{constructor(){super();for(let t=0;t<Nt.SIZE;t++)this.m[t][t]=1}}class Yt extends Lt{constructor(t,e){super(),this.axis=t,this.angle=e}set angle(t){const e=Math.cos(t),n=Math.sin(t);switch(this.axis){case Ot.X:this.m[1][1]=e,this.m[1][2]=-n,this.m[2][1]=n,this.m[2][2]=e;break;case Ot.Y:this.m[0][0]=e,this.m[0][2]=n,this.m[2][0]=-n,this.m[2][2]=e;break;case Ot.Z:this.m[0][0]=e,this.m[0][1]=-n,this.m[1][0]=n,this.m[1][1]=e}}}class jt extends Lt{constructor(t){super(),this.vector=t}set vector(t){this.m[0][3]=t.x,this.m[1][3]=t.y,this.m[2][3]=t.z}set x(t){this.m[0][3]=t}set y(t){this.m[1][3]=t}set z(t){this.m[2][3]=t}}const Ft=new class{constructor(t,e){this.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",this.list=new Set,this.partSize=t,this.parts=e}newId(t){let e=this.createCandidate(t),n=0;for(;this.exists(e);)if(console.warn(`Candidate ${e} already exists. Retry.`),e=this.createCandidate(t),n++,n>10)return console.error("Could not create a unique id, returning empty string",this.list),"";return this.list.add(e),e}createCandidate(t){for(let e=0;e<this.parts;e++)t+=`_${this.createPart()}`;return t}createPart(){return[...Array(this.partSize).keys()].map(()=>this.getRandomChar()).join("")}getRandomChar(){return this.CHARS.charAt(Math.floor(Math.random()*this.CHARS.length))}exists(t){return this.list.has(t)}}(4,2);var Vt;!function(t){t.CIRCLE="CIRCLE",t.RECTANGLE="RECTANGLE",t.PATH="PATH",t.TEXT="TEXT"}(Vt||(Vt={}));class Bt{constructor(){this._dist=0,this._visibility=!0}set dist(t){this._dist=t}get dist(){return this._dist}get isVisible(){return this._visibility}set visible(t){this._visibility=t}}class Ht extends Bt{constructor(t,e,n,i,r){super(),this.id=Ft.newId(Vt.CIRCLE),this.type=Vt.CIRCLE,this.attr={cx:t,cy:e,r:n},this.dist=i,this.style=r}setPosition(t,e,n){this.attr.cx=t,this.attr.cy=e,this.attr.r=n}}class Kt{}class Gt extends Kt{constructor(t,e=1,n={strokeWidth:.15,stroke:"#aaa",strokeOpacity:1,fill:"#ddd",fillOpacity:1}){super(),this.position=t,this.radius=e,this.style=n}get position(){return this._position}set position(t){this._position=t}get radius(){return this._radius}set radius(t){this._radius=t}get style(){return this._style}set style(t){this._style=t}get attributes(){return{position:structuredClone(this._position),radius:this._radius,style:structuredClone(this._style)}}}class Ut extends Bt{constructor(t,e,n){super(),this.id=Ft.newId(Vt.PATH),this.type=Vt.PATH,this.attr={d:t},this.dist=e,this.style=n}setPath(t){this.attr.d=t}}class qt extends Kt{constructor(t,e=!1,n=!1,i={strokeWidth:1.5,stroke:"#aaa",strokeOpacity:1}){super(),this.path=t,this._close=e,this._lockStrokeWidth=n,this.style=i}get path(){return this._path}set path(t){this._path=t}get style(){return this._style}set style(t){this._style=t}get attributes(){return{path:structuredClone(this._path),close:this._close,lockStrokeWidth:this._lockStrokeWidth,style:structuredClone(this._style)}}}class Jt extends Bt{constructor(t,e,n){super(),this.id=Ft.newId(Vt.RECTANGLE),this.type=Vt.RECTANGLE,this.attr={d:t},this.dist=e,this.style=n}setPath(t){this.attr.d=t}}class Qt{constructor(){this.m=[[0,0,0],[0,0,0],[0,0,0]]}static multiply(t,e){let n=new Qt;for(let i=0;i<Qt.SIZE;i++)for(let r=0;r<Qt.SIZE;r++)for(let s=0;s<Qt.SIZE;s++)n.m[i][r]+=t.m[i][s]*e.m[s][r];return n}scalarMultiply(t){for(let e=0;e<Qt.SIZE;e++)for(let n=0;n<Qt.SIZE;n++)this.m[e][n]*=t}vector3Multiply(t){let e,n=[t.x,t.y,t.z,1],i=[];for(let t=0;t<Qt.SIZE;t++){e=0;for(let i=0;i<Qt.SIZE;i++)e+=this.m[t][i]*n[i];i.push(e)}return{x:i[0],y:i[1],z:i[2]}}log(){let t="";for(let e=0;e<Qt.SIZE;e++){for(let n=0;n<Qt.SIZE;n++)t+=this.m[e][n].toFixed(5)+" ";t+="\n"}console.log(t)}}Qt.SIZE=3;class te extends Qt{constructor(){super();for(let t=0;t<Qt.SIZE;t++)this.m[t][t]=1}}class ee extends te{constructor(t,e){super(),this.axis=t,this.angle=e}set angle(t){const e=Math.cos(t),n=Math.sin(t);switch(this.axis){case Ot.X:this.m[1][1]=e,this.m[1][2]=-n,this.m[2][1]=n,this.m[2][2]=e;break;case Ot.Y:this.m[0][0]=e,this.m[0][2]=n,this.m[2][0]=-n,this.m[2][2]=e;break;case Ot.Z:this.m[0][0]=e,this.m[0][1]=-n,this.m[1][0]=n,this.m[1][1]=e}}}class ne extends Kt{constructor(t,e,n,i={rotateX:0,rotateY:0,rotateZ:0},r={strokeWidth:1.5,stroke:"#aaa",strokeOpacity:1,fill:"#ddd",fillOpacity:1}){super(),this._position=t,this._width=e,this._height=n,this._rotateX=i.rotateX*_t,this._rotateY=i.rotateY*_t,this._rotateZ=i.rotateZ*_t,this._style=r,this.evaluatePath()}set position(t){this._position=t,this.evaluatePath()}set width(t){this._width=t,this.evaluatePath()}set height(t){this._height=t,this.evaluatePath()}get orientation(){return{rotateX:this._rotateX/_t,rotateY:this._rotateY/_t,rotateZ:this._rotateZ/_t}}set orientation(t){this._rotateX=t.rotateX*_t,this._rotateY=t.rotateY*_t,this._rotateZ=t.rotateZ*_t,this.evaluatePath()}set style(t){this._style=t}get attributes(){return{path:structuredClone(this._path),style:structuredClone(this._style)}}evaluatePath(){const t=new ee(Ot.X,this._rotateX),e=new ee(Ot.Y,this._rotateY),n=new ee(Ot.Z,this._rotateZ);let i=new te;i=Qt.multiply(i,n),i=Qt.multiply(i,e),i=Qt.multiply(i,t);const r=this._width/2,s=this._height/2,o=[{x:-r,y:s,z:0},{x:r,y:s,z:0},{x:r,y:-s,z:0},{x:-r,y:-s,z:0}];this._path=o.map(t=>{return e=i.vector3Multiply(t),n=this._position,{x:e.x+n.x,y:e.y+n.y,z:e.z+n.z};var e,n})}}var ie=function(t){function n(e,n,i){void 0===e&&(e=1/0),void 0===n&&(n=1/0),void 0===i&&(i=B);var r=t.call(this)||this;return r._bufferSize=e,r._windowTime=n,r._timestampProvider=i,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=n===1/0,r._bufferSize=Math.max(1,e),r._windowTime=Math.max(1,n),r}return e(n,t),n.prototype.next=function(e){var n=this,i=n.isStopped,r=n._buffer,s=n._infiniteTimeWindow,o=n._timestampProvider,a=n._windowTime;i||(r.push(e),!s&&r.push(o.now()+a)),this._trimBuffer(),t.prototype.next.call(this,e)},n.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(t),n=this._infiniteTimeWindow,i=this._buffer.slice(),r=0;r<i.length&&!t.closed;r+=n?1:2)t.next(i[r]);return this._checkFinalizedStatuses(t),e},n.prototype._trimBuffer=function(){var t=this,e=t._bufferSize,n=t._timestampProvider,i=t._buffer,r=t._infiniteTimeWindow,s=(r?1:2)*e;if(e<1/0&&s<i.length&&i.splice(0,i.length-s),!r){for(var o=n.now(),a=0,l=1;l<i.length&&i[l]<=o;l+=2)a=l;a&&i.splice(0,a+1)}},n}(N);class re{constructor(t,e){this._collection$=new ie(1),this.collection$=this._collection$,this.id=Ft.newId(t),this._collection=e,this.emitList()}update(t){t(this._collection),this.emitList()}emitList(){this._collection$.next(this._collection)}}class se extends Bt{constructor(t,e,n,i,r,s){super(),this.id=Ft.newId(Vt.TEXT),this.type=Vt.TEXT,this.attr={x:t,y:e,fontSize:n,text:i},this.dist=r,this.style=s}setPosition(t,e,n){this.attr.x=t,this.attr.y=e,this.attr.fontSize=n}setText(t){this.attr.text=t}}class oe extends Kt{constructor(t,e,n=!1,i={fontSize:12,fontFamily:"sans-serif",fill:"#666",fillOpacity:1,alignmentBaseline:"baseline"}){super(),this.position=t,this.text=e,this._lockFontSize=n,this.style=i}get position(){return this._position}set position(t){this._position=t}get text(){return this._text}set text(t){this._text=t}get style(){return this._style}set style(t){this._style=t}get attributes(){return{position:structuredClone(this._position),text:this._text,lockFontSize:this._lockFontSize,style:structuredClone(this._style)}}}class ae{constructor(t,e,n,i){var r,s,o;this._stageWidthHalf=n/2,this._stageHeightHalf=i/2,this._stageRatioInverted=i/n,this._stageNear=1,this._stageFar=30,this._elementStageSizeFactor=n/1280,this._world=t,this._camera=e,this._world.state$.pipe(tt(function(t,e){var n=0;t.subscribe(et(e,function(t){++n<=1&&(e.next(t),1<=n&&e.complete())}))})).subscribe(t=>{this.createShapes(this.createData(t))}),Xt([this._world.state$,this._camera.state$]).pipe((r=40,void 0===s&&(s=G),o=Q(r,s),tt(function(t,e){var n=!1,i=null;t.subscribe(et(e,function(t){n=!0,i=t})),ft(o).subscribe(et(e,function(){if(n){n=!1;var t=i;i=null,e.next(t)}},x))}))).subscribe(t=>{this.updateShapes(this.createData(t[0]))})}get shapes(){return this._shapes}createData(t){const e=new Yt(Ot.X,this._camera.angleX),n=new Yt(Ot.Y,this._camera.angleY),i=new Yt(Ot.Z,this._camera.angleZ),r=new jt(this._camera.position);let s=new Lt;return s=Nt.multiply(s,i),s=Nt.multiply(s,n),s=Nt.multiply(s,e),s=Nt.multiply(s,r),s=s.inv,{circles:t.circles.map(t=>{let e=s.vector3Multiply(t.position);return{pixel:this.spaceToPixel(e),dist:this.distanceToCamera(e),position:{x:t.position.x,y:t.position.y,z:t.position.z},radius:t.radius,style:t.style}}),paths:t.paths.map(t=>{let e=this.spaceToPixel(s.vector3Multiply(t.path[0])),n=this.distanceToCamera(s.vector3Multiply(t.path[0])),i="M"+e.left+" "+e.top+" ";for(let r=1;r<t.path.length;r++){e=this.spaceToPixel(s.vector3Multiply(t.path[r]));let o=this.distanceToCamera(s.vector3Multiply(t.path[r]));n=Math.min(n,o),i+="L"+e.left+" "+e.top+" "}return{path:t.path,close:t.close,d:t.close?i+"Z":i,dist:n,lockStrokeWidth:t.lockStrokeWidth,style:t.style}}),rectangles:t.rectangles.map(t=>{let e=this.spaceToPixel(s.vector3Multiply(t.path[0])),n=this.distanceToCamera(s.vector3Multiply(t.path[0])),i="M"+e.left+" "+e.top+" ";for(let r=1;r<t.path.length;r++){e=this.spaceToPixel(s.vector3Multiply(t.path[r]));let o=this.distanceToCamera(s.vector3Multiply(t.path[r]));n=Math.min(n,o),i+="L"+e.left+" "+e.top+" "}return{path:t.path,d:i+"Z",dist:n,style:t.style}}),texts:t.texts.map(t=>{let e=s.vector3Multiply(t.position);return{pixel:this.spaceToPixel(e),dist:this.distanceToCamera(e),position:{x:t.position.x,y:t.position.y,z:t.position.z},text:t.text,lockFontSize:t.lockFontSize,style:t.style}})}}createShapes(t){this._shapes=new re("PRJ",{circles:t.circles.map(t=>new Ht(t.pixel.left,t.pixel.top,this.getDistantDependentValue(t.radius,t.dist),t.dist,{strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity,fill:t.style.fill,fillOpacity:t.style.fillOpacity})),paths:t.paths.map(t=>new Ut(t.d,t.dist,{strokeWidth:t.lockStrokeWidth?t.style.strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity})),rectangles:t.rectangles.map(t=>new Jt(t.d,t.dist,{strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity,fill:t.style.fill,fillOpacity:t.style.fillOpacity})),texts:t.texts.map(t=>new se(t.pixel.left,t.pixel.top,t.lockFontSize?t.style.fontSize:this.getDistantDependentValue(t.style.fontSize,t.dist),t.text,t.dist,t.style))})}updateShapes(t){this._shapes.update(e=>{e.circles.forEach((e,n)=>{let i=t.circles[n];e.setPosition(i.pixel.left,i.pixel.top,this.getDistantDependentValue(i.radius,i.dist)),e.dist=i.dist,e.style={strokeWidth:this.getDistantDependentValue(i.style.strokeWidth,i.dist),stroke:i.style.stroke,strokeOpacity:i.style.strokeOpacity,fill:i.style.fill,fillOpacity:i.style.fillOpacity},e.visible=i.dist>0}),e.paths.forEach((e,n)=>{let i=t.paths[n];e.setPath(i.d),e.dist=i.dist,e.style={strokeWidth:i.lockStrokeWidth?i.style.strokeWidth:this.getDistantDependentValue(i.style.strokeWidth,i.dist),stroke:i.style.stroke,strokeOpacity:i.style.strokeOpacity},e.visible=i.dist>0}),e.rectangles.forEach((e,n)=>{let i=t.rectangles[n];e.setPath(i.d),e.dist=i.dist,e.style={strokeWidth:this.getDistantDependentValue(i.style.strokeWidth,i.dist),stroke:i.style.stroke,strokeOpacity:i.style.strokeOpacity,fill:i.style.fill,fillOpacity:i.style.fillOpacity},e.visible=i.dist>0}),e.texts.forEach((e,n)=>{let i=t.texts[n];e.setPosition(i.pixel.left,i.pixel.top,i.lockFontSize?e.style.fontSize:this.getDistantDependentValue(e.style.fontSize,e.dist)),e.dist=i.dist,e.style=i.style,e.visible=i.dist>0,e.setText(i.text)})})}getDistantDependentValue(t,e){return e>0?t/e*20*this._elementStageSizeFactor:0}spaceToPixel(t){return this.planeToPixel(this.spaceToPlane(t))}spaceToPlane(t){if(t.z<this._stageNear)return{x:0,y:0};const e=1/t.z;return{x:e*t.x,y:e*t.y}}distanceToCamera(t){return t.z<this._stageNear?-1:t.z*(this._stageFar-this._stageNear)/(this._stageNear*(this._stageFar-t.z))}planeToPixel(t){return{left:this._stageWidthHalf*t.x*this._stageRatioInverted+this._stageWidthHalf,top:-this._stageHeightHalf*t.y+this._stageHeightHalf}}}function le(){}function he(t){return null==t?le:function(){return this.querySelector(t)}}function ue(){return[]}function ce(t){return null==t?ue:function(){return this.querySelectorAll(t)}}function fe(t){return function(){return this.matches(t)}}function pe(t){return function(e){return e.matches(t)}}var de=Array.prototype.find;function ye(){return this.firstElementChild}var _e=Array.prototype.filter;function ge(){return Array.from(this.children)}function me(t){return new Array(t.length)}function ve(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function we(t,e,n,i,r,s){for(var o,a=0,l=e.length,h=s.length;a<h;++a)(o=e[a])?(o.__data__=s[a],i[a]=o):n[a]=new ve(t,s[a]);for(;a<l;++a)(o=e[a])&&(r[a]=o)}function be(t,e,n,i,r,s,o){var a,l,h,u=new Map,c=e.length,f=s.length,p=new Array(c);for(a=0;a<c;++a)(l=e[a])&&(p[a]=h=o.call(l,l.__data__,a,e)+"",u.has(h)?r[a]=l:u.set(h,l));for(a=0;a<f;++a)h=o.call(t,s[a],a,s)+"",(l=u.get(h))?(i[a]=l,l.__data__=s[a],u.delete(h)):n[a]=new ve(t,s[a]);for(a=0;a<c;++a)(l=e[a])&&u.get(p[a])===l&&(r[a]=l)}function xe(t){return t.__data__}function ke(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Se(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}ve.prototype={constructor:ve,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var Ae="http://www.w3.org/1999/xhtml";const Ee={svg:"http://www.w3.org/2000/svg",xhtml:Ae,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Me(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),Ee.hasOwnProperty(e)?{space:Ee[e],local:t}:t}function Ie(t){return function(){this.removeAttribute(t)}}function Ce(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Pe(t,e){return function(){this.setAttribute(t,e)}}function ze(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Te(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function Oe(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function $e(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function We(t){return function(){this.style.removeProperty(t)}}function Ze(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Re(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Xe(t,e){return t.style.getPropertyValue(e)||$e(t).getComputedStyle(t,null).getPropertyValue(e)}function De(t){return function(){delete this[t]}}function Ne(t,e){return function(){this[t]=e}}function Le(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function Ye(t){return t.trim().split(/^|\s+/)}function je(t){return t.classList||new Fe(t)}function Fe(t){this._node=t,this._names=Ye(t.getAttribute("class")||"")}function Ve(t,e){for(var n=je(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Be(t,e){for(var n=je(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function He(t){return function(){Ve(this,t)}}function Ke(t){return function(){Be(this,t)}}function Ge(t,e){return function(){(e.apply(this,arguments)?Ve:Be)(this,t)}}function Ue(){this.textContent=""}function qe(t){return function(){this.textContent=t}}function Je(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Qe(){this.innerHTML=""}function tn(t){return function(){this.innerHTML=t}}function en(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function nn(){this.nextSibling&&this.parentNode.appendChild(this)}function rn(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function sn(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Ae&&e.documentElement.namespaceURI===Ae?e.createElement(t):e.createElementNS(n,t)}}function on(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function an(t){var e=Me(t);return(e.local?on:sn)(e)}function ln(){return null}function hn(){var t=this.parentNode;t&&t.removeChild(this)}function un(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function cn(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function fn(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,s=e.length;i<s;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function pn(t,e,n){return function(){var i,r=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),void(i.value=e);this.addEventListener(t.type,s,n),i={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(i):this.__on=[i]}}function dn(t,e,n){var i=$e(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function yn(t,e){return function(){return dn(this,t,e)}}function _n(t,e){return function(){return dn(this,t,e.apply(this,arguments))}}Fe.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var gn=[null];function mn(t,e){this._groups=t,this._parents=e}function vn(){return new mn([[document.documentElement]],gn)}mn.prototype=vn.prototype={constructor:mn,select:function(t){"function"!=typeof t&&(t=he(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s,o,a=e[r],l=a.length,h=i[r]=new Array(l),u=0;u<l;++u)(s=a[u])&&(o=t.call(s,s.__data__,u,a))&&("__data__"in s&&(o.__data__=s.__data__),h[u]=o);return new mn(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):ce(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o,a=e[s],l=a.length,h=0;h<l;++h)(o=a[h])&&(i.push(t.call(o,o.__data__,h,a)),r.push(o));return new mn(i,r)},selectChild:function(t){return this.select(null==t?ye:function(t){return function(){return de.call(this.children,t)}}("function"==typeof t?t:pe(t)))},selectChildren:function(t){return this.selectAll(null==t?ge:function(t){return function(){return _e.call(this.children,t)}}("function"==typeof t?t:pe(t)))},filter:function(t){"function"!=typeof t&&(t=fe(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s,o=e[r],a=o.length,l=i[r]=[],h=0;h<a;++h)(s=o[h])&&t.call(s,s.__data__,h,o)&&l.push(s);return new mn(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,xe);var n,i=e?be:we,r=this._parents,s=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=s.length,a=new Array(o),l=new Array(o),h=new Array(o),u=0;u<o;++u){var c=r[u],f=s[u],p=f.length,d=ke(t.call(c,c&&c.__data__,u,r)),y=d.length,_=l[u]=new Array(y),g=a[u]=new Array(y);i(c,f,_,g,h[u]=new Array(p),d,e);for(var m,v,w=0,b=0;w<y;++w)if(m=_[w]){for(w>=b&&(b=w+1);!(v=g[b])&&++b<y;);m._next=v||null}}return(a=new mn(a,r))._enter=l,a._exit=h,a},enter:function(){return new mn(this._enter||this._groups.map(me),this._parents)},exit:function(){return new mn(this._exit||this._groups.map(me),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,s=this.exit();return"function"==typeof t?(i=t(i))&&(i=i.selection()):i=i.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==n?s.remove():n(s),i&&r?i.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,s=i.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var h,u=n[l],c=i[l],f=u.length,p=a[l]=new Array(f),d=0;d<f;++d)(h=u[d]||c[d])&&(p[d]=h);for(;l<r;++l)a[l]=n[l];return new mn(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],s=r.length-1,o=r[s];--s>=0;)(i=r[s])&&(o&&4^i.compareDocumentPosition(o)&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Se);for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o,a=n[s],l=a.length,h=r[s]=new Array(l),u=0;u<l;++u)(o=a[u])&&(h[u]=o);h.sort(e)}return new mn(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,s=e[n],o=0,a=s.length;o<a;++o)(r=s[o])&&t.call(r,r.__data__,o,s);return this},attr:function(t,e){var n=Me(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?Ce:Ie:"function"==typeof e?n.local?Oe:Te:n.local?ze:Pe)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?We:"function"==typeof e?Re:Ze)(t,e,null==n?"":n)):Xe(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?De:"function"==typeof e?Le:Ne)(t,e)):this.node()[t]},classed:function(t,e){var n=Ye(t+"");if(arguments.length<2){for(var i=je(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?Ge:e?He:Ke)(n,e))},text:function(t){return arguments.length?this.each(null==t?Ue:("function"==typeof t?Je:qe)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Qe:("function"==typeof t?en:tn)(t)):this.node().innerHTML},raise:function(){return this.each(nn)},lower:function(){return this.each(rn)},append:function(t){var e="function"==typeof t?t:an(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:an(t),i=null==e?ln:"function"==typeof e?e:he(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(hn)},clone:function(t){return this.select(t?cn:un)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,s=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?pn:fn,i=0;i<o;++i)this.each(a(s[i],e,n));return this}var a=this.node().__on;if(a)for(var l,h=0,u=a.length;h<u;++h)for(i=0,l=a[h];i<o;++i)if((r=s[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?_n:yn)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],s=0,o=r.length;s<o;++s)(i=r[s])&&(yield i)}};const wn=vn;var bn={value:()=>{}};function xn(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new kn(i)}function kn(t){this._=t}function Sn(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function An(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=bn,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}kn.prototype=xn.prototype={constructor:kn,on:function(t,e){var n,i,r=this._,s=(i=r,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!i.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),o=-1,a=s.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=s[o]).type)r[n]=An(r[n],t.name,e);else if(null==e)for(n in r)r[n]=An(r[n],t.name,null);return this}for(;++o<a;)if((n=(t=s[o]).type)&&(n=Sn(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new kn(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),s=0;s<n;++s)r[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(i=this._[t]).length;s<n;++s)i[s].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};const En=xn;var Mn,In,Cn=0,Pn=0,zn=0,Tn=0,On=0,$n=0,Wn="object"==typeof performance&&performance.now?performance:Date,Zn="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Rn(){return On||(Zn(Xn),On=Wn.now()+$n)}function Xn(){On=0}function Dn(){this._call=this._time=this._next=null}function Nn(t,e,n){var i=new Dn;return i.restart(t,e,n),i}function Ln(){On=(Tn=Wn.now())+$n,Cn=Pn=0;try{!function(){Rn(),++Cn;for(var t,e=Mn;e;)(t=On-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Cn}()}finally{Cn=0,function(){for(var t,e,n=Mn,i=1/0;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Mn=e);In=t,jn(i)}(),On=0}}function Yn(){var t=Wn.now(),e=t-Tn;e>1e3&&($n-=e,Tn=t)}function jn(t){Cn||(Pn&&(Pn=clearTimeout(Pn)),t-On>24?(t<1/0&&(Pn=setTimeout(Ln,t-Wn.now()-$n)),zn&&(zn=clearInterval(zn))):(zn||(Tn=Wn.now(),zn=setInterval(Yn,1e3)),Cn=1,Zn(Ln)))}function Fn(t,e,n){var i=new Dn;return e=null==e?0:+e,i.restart(n=>{i.stop(),t(n+e)},e,n),i}Dn.prototype=Nn.prototype={constructor:Dn,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Rn():+n)+(null==e?0:+e),this._next||In===this||(In?In._next=this:Mn=this,In=this),this._call=t,this._time=n,jn()},stop:function(){this._call&&(this._call=null,this._time=1/0,jn())}};var Vn=En("start","end","cancel","interrupt"),Bn=[];function Hn(t,e,n,i,r,s){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function s(l){var h,u,c,f;if(1!==n.state)return a();for(h in r)if((f=r[h]).name===n.name){if(3===f.state)return Fn(s);4===f.state?(f.state=6,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete r[h]):+h<e&&(f.state=6,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete r[h])}if(Fn(function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(l))}),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(c=n.tween.length),h=0,u=-1;h<c;++h)(f=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(i[++u]=f);i.length=u+1}}function o(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(a),n.state=5,1),s=-1,o=i.length;++s<o;)i[s].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=Nn(function(t){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=t&&s(t-n.delay)},0,n.time)}(t,n,{name:e,index:i,group:r,on:Vn,tween:Bn,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function Kn(t,e){var n=Un(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Gn(t,e){var n=Un(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Un(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function qn(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Jn,Qn=180/Math.PI,ti={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ei(t,e,n,i,r,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),t*i<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*Qn,skewX:Math.atan(l)*Qn,scaleX:o,scaleY:a}}function ni(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],l=[];return s=t(s),o=t(o),function(t,i,r,s,o,a){if(t!==r||i!==s){var l=o.push("translate(",null,e,null,n);a.push({i:l-4,x:qn(t,r)},{i:l-2,x:qn(i,s)})}else(r||s)&&o.push("translate("+r+e+s+n)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(t,e,n,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:n.push(r(n)+"rotate(",null,i)-2,x:qn(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(s.rotate,o.rotate,a,l),function(t,e,n,s){t!==e?s.push({i:n.push(r(n)+"skewX(",null,i)-2,x:qn(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(s.skewX,o.skewX,a,l),function(t,e,n,i,s,o){if(t!==n||e!==i){var a=s.push(r(s)+"scale(",null,",",null,")");o.push({i:a-4,x:qn(t,n)},{i:a-2,x:qn(e,i)})}else 1===n&&1===i||s.push(r(s)+"scale("+n+","+i+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(t){for(var e,n=-1,i=l.length;++n<i;)a[(e=l[n]).i]=e.x(t);return a.join("")}}}var ii=ni(function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?ti:ei(e.a,e.b,e.c,e.d,e.e,e.f)},"px, ","px)","deg)"),ri=ni(function(t){return null==t?ti:(Jn||(Jn=document.createElementNS("http://www.w3.org/2000/svg","g")),Jn.setAttribute("transform",t),(t=Jn.transform.baseVal.consolidate())?ei((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):ti)},", ",")",")");function si(t,e){var n,i;return function(){var r=Gn(this,t),s=r.tween;if(s!==n)for(var o=0,a=(i=n=s).length;o<a;++o)if(i[o].name===e){(i=i.slice()).splice(o,1);break}r.tween=i}}function oi(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var s=Gn(this,t),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:e,value:n},l=0,h=r.length;l<h;++l)if(r[l].name===e){r[l]=a;break}l===h&&r.push(a)}s.tween=r}}function ai(t,e,n){var i=t._id;return t.each(function(){var t=Gn(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return Un(t,i).value[e]}}function li(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function hi(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function ui(){}var ci=.7,fi=1/ci,pi="\\s*([+-]?\\d+)\\s*",di="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",yi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",_i=/^#([0-9a-f]{3,8})$/,gi=new RegExp(`^rgb\\(${pi},${pi},${pi}\\)$`),mi=new RegExp(`^rgb\\(${yi},${yi},${yi}\\)$`),vi=new RegExp(`^rgba\\(${pi},${pi},${pi},${di}\\)$`),wi=new RegExp(`^rgba\\(${yi},${yi},${yi},${di}\\)$`),bi=new RegExp(`^hsl\\(${di},${yi},${yi}\\)$`),xi=new RegExp(`^hsla\\(${di},${yi},${yi},${di}\\)$`),ki={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Si(){return this.rgb().formatHex()}function Ai(){return this.rgb().formatRgb()}function Ei(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=_i.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Mi(e):3===n?new Pi(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Ii(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Ii(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=gi.exec(t))?new Pi(e[1],e[2],e[3],1):(e=mi.exec(t))?new Pi(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=vi.exec(t))?Ii(e[1],e[2],e[3],e[4]):(e=wi.exec(t))?Ii(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=bi.exec(t))?Zi(e[1],e[2]/100,e[3]/100,1):(e=xi.exec(t))?Zi(e[1],e[2]/100,e[3]/100,e[4]):ki.hasOwnProperty(t)?Mi(ki[t]):"transparent"===t?new Pi(NaN,NaN,NaN,0):null}function Mi(t){return new Pi(t>>16&255,t>>8&255,255&t,1)}function Ii(t,e,n,i){return i<=0&&(t=e=n=NaN),new Pi(t,e,n,i)}function Ci(t,e,n,i){return 1===arguments.length?((r=t)instanceof ui||(r=Ei(r)),r?new Pi((r=r.rgb()).r,r.g,r.b,r.opacity):new Pi):new Pi(t,e,n,null==i?1:i);var r}function Pi(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function zi(){return`#${Wi(this.r)}${Wi(this.g)}${Wi(this.b)}`}function Ti(){const t=Oi(this.opacity);return`${1===t?"rgb(":"rgba("}${$i(this.r)}, ${$i(this.g)}, ${$i(this.b)}${1===t?")":`, ${t})`}`}function Oi(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function $i(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Wi(t){return((t=$i(t))<16?"0":"")+t.toString(16)}function Zi(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Xi(t,e,n,i)}function Ri(t){if(t instanceof Xi)return new Xi(t.h,t.s,t.l,t.opacity);if(t instanceof ui||(t=Ei(t)),!t)return new Xi;if(t instanceof Xi)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,a=s-r,l=(s+r)/2;return a?(o=e===s?(n-i)/a+6*(n<i):n===s?(i-e)/a+2:(e-n)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new Xi(o,a,l,t.opacity)}function Xi(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function Di(t){return(t=(t||0)%360)<0?t+360:t}function Ni(t){return Math.max(0,Math.min(1,t||0))}function Li(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function Yi(t,e,n,i,r){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*n+(1+3*t+3*s-3*o)*i+o*r)/6}li(ui,Ei,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Si,formatHex:Si,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Ri(this).formatHsl()},formatRgb:Ai,toString:Ai}),li(Pi,Ci,hi(ui,{brighter(t){return t=null==t?fi:Math.pow(fi,t),new Pi(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?ci:Math.pow(ci,t),new Pi(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Pi($i(this.r),$i(this.g),$i(this.b),Oi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:zi,formatHex:zi,formatHex8:function(){return`#${Wi(this.r)}${Wi(this.g)}${Wi(this.b)}${Wi(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Ti,toString:Ti})),li(Xi,function(t,e,n,i){return 1===arguments.length?Ri(t):new Xi(t,e,n,null==i?1:i)},hi(ui,{brighter(t){return t=null==t?fi:Math.pow(fi,t),new Xi(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?ci:Math.pow(ci,t),new Xi(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Pi(Li(t>=240?t-240:t+120,r,i),Li(t,r,i),Li(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new Xi(Di(this.h),Ni(this.s),Ni(this.l),Oi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Oi(this.opacity);return`${1===t?"hsl(":"hsla("}${Di(this.h)}, ${100*Ni(this.s)}%, ${100*Ni(this.l)}%${1===t?")":`, ${t})`}`}}));const ji=t=>()=>t;function Fi(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):ji(isNaN(t)?e:t)}const Vi=function t(e){var n=function(t){return 1===(t=+t)?Fi:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):ji(isNaN(e)?n:e)}}(e);function i(t,e){var i=n((t=Ci(t)).r,(e=Ci(e)).r),r=n(t.g,e.g),s=n(t.b,e.b),o=Fi(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=s(e),t.opacity=o(e),t+""}}return i.gamma=t,i}(1);function Bi(t){return function(e){var n,i,r=e.length,s=new Array(r),o=new Array(r),a=new Array(r);for(n=0;n<r;++n)i=Ci(e[n]),s[n]=i.r||0,o[n]=i.g||0,a[n]=i.b||0;return s=t(s),o=t(o),a=t(a),i.opacity=1,function(t){return i.r=s(t),i.g=o(t),i.b=a(t),i+""}}}Bi(function(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],s=t[i+1],o=i>0?t[i-1]:2*r-s,a=i<e-1?t[i+2]:2*s-r;return Yi((n-i/e)*e,o,r,s,a)}}),Bi(function(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],s=t[i%e],o=t[(i+1)%e],a=t[(i+2)%e];return Yi((n-i/e)*e,r,s,o,a)}});var Hi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ki=new RegExp(Hi.source,"g");function Gi(t,e){var n,i,r,s=Hi.lastIndex=Ki.lastIndex=0,o=-1,a=[],l=[];for(t+="",e+="";(n=Hi.exec(t))&&(i=Ki.exec(e));)(r=i.index)>s&&(r=e.slice(s,r),a[o]?a[o]+=r:a[++o]=r),(n=n[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:qn(n,i)})),s=Ki.lastIndex;return s<e.length&&(r=e.slice(s),a[o]?a[o]+=r:a[++o]=r),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,i=0;i<e;++i)a[(n=l[i]).i]=n.x(t);return a.join("")})}function Ui(t,e){var n;return("number"==typeof e?qn:e instanceof Ei?Vi:(n=Ei(e))?(e=n,Vi):Gi)(t,e)}function qi(t){return function(){this.removeAttribute(t)}}function Ji(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Qi(t,e,n){var i,r,s=n+"";return function(){var o=this.getAttribute(t);return o===s?null:o===i?r:r=e(i=o,n)}}function tr(t,e,n){var i,r,s=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===i?r:r=e(i=o,n)}}function er(t,e,n){var i,r,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttribute(t))===(a=l+"")?null:o===i&&a===r?s:(r=a,s=e(i=o,l));this.removeAttribute(t)}}function nr(t,e,n){var i,r,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:o===i&&a===r?s:(r=a,s=e(i=o,l));this.removeAttributeNS(t.space,t.local)}}function ir(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,r)),n}return r._value=e,r}function rr(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,r)),n}return r._value=e,r}function sr(t,e){return function(){Kn(this,t).delay=+e.apply(this,arguments)}}function or(t,e){return e=+e,function(){Kn(this,t).delay=e}}function ar(t,e){return function(){Gn(this,t).duration=+e.apply(this,arguments)}}function lr(t,e){return e=+e,function(){Gn(this,t).duration=e}}var hr=wn.prototype.constructor;function ur(t){return function(){this.style.removeProperty(t)}}var cr=0;function fr(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function pr(){return++cr}var dr=wn.prototype;fr.prototype=function(t){return wn().transition(t)}.prototype={constructor:fr,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=he(t));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a,l,h=i[o],u=h.length,c=s[o]=new Array(u),f=0;f<u;++f)(a=h[f])&&(l=t.call(a,a.__data__,f,h))&&("__data__"in a&&(l.__data__=a.__data__),c[f]=l,Hn(c[f],e,n,f,c,Un(a,n)));return new fr(s,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=ce(t));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var l,h=i[a],u=h.length,c=0;c<u;++c)if(l=h[c]){for(var f,p=t.call(l,l.__data__,c,h),d=Un(l,n),y=0,_=p.length;y<_;++y)(f=p[y])&&Hn(f,e,n,y,p,d);s.push(p),o.push(l)}return new fr(s,o,e,n)},selectChild:dr.selectChild,selectChildren:dr.selectChildren,filter:function(t){"function"!=typeof t&&(t=fe(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s,o=e[r],a=o.length,l=i[r]=[],h=0;h<a;++h)(s=o[h])&&t.call(s,s.__data__,h,o)&&l.push(s);return new fr(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var l,h=e[a],u=n[a],c=h.length,f=o[a]=new Array(c),p=0;p<c;++p)(l=h[p]||u[p])&&(f[p]=l);for(;a<i;++a)o[a]=e[a];return new fr(o,this._parents,this._name,this._id)},selection:function(){return new hr(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=pr(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o,a=i[s],l=a.length,h=0;h<l;++h)if(o=a[h]){var u=Un(o,e);Hn(o,t,n,h,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new fr(i,this._parents,t,n)},call:dr.call,nodes:dr.nodes,node:dr.node,size:dr.size,empty:dr.empty,each:dr.each,on:function(t,e){var n=this._id;return arguments.length<2?Un(this.node(),n).on.on(t):this.each(function(t,e,n){var i,r,s=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?Kn:Gn;return function(){var o=s(this,t),a=o.on;a!==i&&(r=(i=a).copy()).on(e,n),o.on=r}}(n,t,e))},attr:function(t,e){var n=Me(t),i="transform"===n?ri:Ui;return this.attrTween(t,"function"==typeof e?(n.local?nr:er)(n,i,ai(this,"attr."+t,e)):null==e?(n.local?Ji:qi)(n):(n.local?tr:Qi)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=Me(t);return this.tween(n,(i.local?ir:rr)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?ii:Ui;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var s=Xe(this,t),o=(this.style.removeProperty(t),Xe(this,t));return s===o?null:s===n&&o===i?r:r=e(n=s,i=o)}}(t,i)).on("end.style."+t,ur(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,s;return function(){var o=Xe(this,t),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=Xe(this,t)),o===l?null:o===i&&l===r?s:(r=l,s=e(i=o,a))}}(t,i,ai(this,"style."+t,e))).each(function(t,e){var n,i,r,s,o="style."+e,a="end."+o;return function(){var l=Gn(this,t),h=l.on,u=null==l.value[o]?s||(s=ur(e)):void 0;h===n&&r===u||(i=(n=h).copy()).on(a,r=u),l.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,s=n+"";return function(){var o=Xe(this,t);return o===s?null:o===i?r:r=e(i=o,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,function(t,e,n){var i,r;function s(){var s=e.apply(this,arguments);return s!==r&&(i=(r=s)&&function(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}(t,s,n)),i}return s._value=e,s}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(ai(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&function(t){return function(e){this.textContent=t.call(this,e)}}(i)),e}return i._value=t,i}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=Un(this.node(),n).tween,s=0,o=r.length;s<o;++s)if((i=r[s]).name===t)return i.value;return null}return this.each((null==e?si:oi)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?sr:or)(e,t)):Un(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?ar:lr)(e,t)):Un(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Gn(this,t).ease=e}}(e,t)):Un(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Gn(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){0===--r&&s()}};n.each(function(){var n=Gn(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),n.on=e}),0===r&&s()})},[Symbol.iterator]:dr[Symbol.iterator]};var yr={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function _r(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}wn.prototype.interrupt=function(t){return this.each(function(){!function(t,e){var n,i,r,s=t.__transition,o=!0;if(s){for(r in e=null==e?null:e+"",s)(n=s[r]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete s[r]):o=!1;o&&delete t.__transition}}(this,t)})},wn.prototype.transition=function(t){var e,n;t instanceof fr?(e=t._id,t=t._name):(e=pr(),(n=yr).time=Rn(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o,a=i[s],l=a.length,h=0;h<l;++h)(o=a[h])&&Hn(o,t,e,h,a,n||_r(o,e));return new fr(i,this._parents,t,e)};const{abs:gr,max:mr,min:vr}=Math;function wr(t){return{type:t}}function br(t){return"string"==typeof t?new mn([[document.querySelector(t)]],[document.documentElement]):new mn([[t]],gn)}function xr(t,e,n){this.k=t,this.x=e,this.y=n}["w","e"].map(wr),["n","s"].map(wr),["n","w","e","s","nw","ne","sw","se"].map(wr),xr.prototype={constructor:xr,scale:function(t){return 1===t?this:new xr(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new xr(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new xr(1,0,0),xr.prototype;class kr{constructor(t){this._current=null,null!=t&&(this._current=t)}set(t){var e;null===(e=this._current)||void 0===e||e.unsubscribe(),this._current=t}unsubscribe(){var t;null===(t=this._current)||void 0===t||t.unsubscribe(),this._current=null}}class Sr{constructor(){this._current=new Map}set(t,e){if(this._current.has(t)){let n=this._current.get(t);null==n||n.set(e)}else this._current.set(t,new kr(e))}unsubscribe(t){if(this._current.has(t)){let e=this._current.get(t);null==e||e.unsubscribe(),this._current.delete(t)}else console.error(-`No subscription for ${t} found.`)}}const Ar="circle",Er="path",Mr="text",Ir="svg-shape--invisible";class Cr{constructor(t){this._subscriptions=new Sr,this._created=new Set;const e=document.getElementById(t);this._width=(null==e?void 0:e.clientWidth)?e.clientWidth:0,this._height=(null==e?void 0:e.clientHeight)?e.clientHeight:0,this.addSvgCss(),this._svgg=br(`#${t}`).append("svg").attr("id","svgMain").attr("width",this._width).attr("height",this._height).append("g").attr("transform","translate(.5, .5)")}registerShapes(t,e){br("svg#svgMain").style("background",e),this._subscriptions.set(t.id,t.collection$.subscribe(e=>{this._created.has(t.id)?this.updateShapes(t.id,e):this.createShapes(t.id,e)}))}unregisterShapes(t){this.removeShapes(t),this._subscriptions.unsubscribe(t),this._created.delete(t)}addSvgCss(){var t=window.document.styleSheets[0];t.insertRule(`.${Ir} { visibility: hidden;}`,t.cssRules.length)}createShapes(t,e){console.log("#createShapes",{id:t,collection:e}),this.createCircles(t,e.circles),this.createPaths(t,e.paths),this.createRectangles(t,e.rectangles),this.createTexts(t,e.texts),this.sortAllShapes(t),this._created.add(t)}updateShapes(t,e){this.updateCircles(t,e.circles),this.updatePaths(t,e.paths),this.updateRectangles(t,e.rectangles),this.updateTexts(t,e.texts),this.sortAllShapes(t),this._created.add(t)}createCircles(t,e){console.log("#createCircles",{id:t,length:e.length}),this._svgg.selectAll(`${Ar}.${Vt.CIRCLE}.${t}`).data(e).enter().append(Ar).attr("id",t=>t.id).classed(Vt.CIRCLE,!0).classed(t,!0).style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("cx",t=>t.attr.cx).attr("cy",t=>t.attr.cy).attr("r",t=>t.attr.r),this._created.add(t)}updateCircles(t,e){this._svgg.selectAll(`${Ar}.${Vt.CIRCLE}.${t}`).data(e).classed(Ir,t=>!t.isVisible).style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("cx",t=>t.attr.cx).attr("cy",t=>t.attr.cy).attr("r",t=>t.attr.r)}createPaths(t,e){console.log("#createPaths",{id:t,length:e.length}),this._svgg.selectAll(`${Er}.${Vt.PATH}.${t}`).data(e).enter().append(Er).attr("id",t=>t.id).classed(Vt.PATH,!0).classed(t,!0).style("fill","none").style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).attr("d",t=>t.attr.d),this._created.add(t)}updatePaths(t,e){this._svgg.selectAll(`${Er}.${Vt.PATH}.${t}`).data(e).classed(Ir,t=>!t.isVisible).style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).attr("d",t=>t.attr.d)}createRectangles(t,e){console.log("#createRectangles",{id:t,length:e.length}),this._svgg.selectAll(`${Er}.${Vt.RECTANGLE}.${t}`).data(e).enter().append(Er).attr("id",t=>t.id).classed(Vt.RECTANGLE,!0).classed(t,!0).style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("d",t=>t.attr.d),this._created.add(t)}updateRectangles(t,e){this._svgg.selectAll(`${Er}.${Vt.RECTANGLE}.${t}`).data(e).classed(Ir,t=>!t.isVisible).style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("d",t=>t.attr.d)}createTexts(t,e){console.log("#createTexts",{id:t,length:e.length}),this._svgg.selectAll(`${Mr}.${Vt.TEXT}.${t}`).data(e).enter().append(Mr).attr("id",t=>t.id).classed(Vt.TEXT,!0).classed(t,!0).style("fill",t=>t.style.fill).style("fillOpacity",t=>t.style.fillOpacity).style("alignment-baseline",t=>t.style.alignmentBaseline).attr("x",t=>t.attr.x).attr("y",t=>t.attr.y).style("font-size",t=>t.attr.fontSize).text(t=>t.attr.text),this._created.add(t)}updateTexts(t,e){this._svgg.selectAll(`${Mr}.${Vt.TEXT}.${t}`).data(e).classed(Ir,t=>!t.isVisible).classed(Vt.TEXT,!0).style("fill",t=>t.style.fill).style("fillOpacity",t=>t.style.fillOpacity).style("alignment-baseline",t=>t.style.alignmentBaseline).attr("x",t=>t.attr.x).attr("y",t=>t.attr.y).style("font-size",t=>t.attr.fontSize).text(t=>t.attr.text)}sortAllShapes(t){this._svgg.selectAll(`.${t}`).sort((t,e)=>e.dist-t.dist)}removeShapes(t){this._svgg.selectAll(`.${t}`).remove()}}var Pr;function zr(){return window.innerWidth==screen.width&&window.innerHeight==screen.height?Pr.IMMERSIVE:window.innerWidth<1300?Pr.SMALL:Pr.DEFAULT}function Tr(t,e,n){return void 0===n&&(n=1/0),a(e)?Tr(function(n,i){return Tt(function(t,r){return e(n,t,i,r)})(ft(t(n,i)))},n):("number"==typeof e&&(n=e),tt(function(e,i){return function(t,e,n,i){var r=[],s=0,o=0,a=!1,l=function(){!a||r.length||s||e.complete()},h=function(t){return s<i?u(t):r.push(t)},u=function(t){s++;var a=!1;ft(n(t,o++)).subscribe(et(e,function(t){e.next(t)},function(){a=!0},void 0,function(){if(a)try{s--;for(var t=function(){var t=r.shift();u(t)};r.length&&s<i;)t();l()}catch(t){e.error(t)}}))};return t.subscribe(et(e,h,function(){a=!0,l()})),function(){}}(e,i,t,n)}))}function Or(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Rt(t),i=function(t){return"number"==typeof Zt(t)?t.pop():1/0}(t),r=t;return r.length?1===r.length?ft(r[0]):function(t){return void 0===t&&(t=1/0),Tr(Z,t)}(i)(zt(r,n)):xt}!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SMALL=1]="SMALL",t[t.IMMERSIVE=2]="IMMERSIVE"}(Pr||(Pr={}));var $r=["addListener","removeListener"],Wr=["addEventListener","removeEventListener"],Zr=["on","off"];function Rr(t,e,n,i){if(a(n)&&(i=n,n=void 0),i)return Rr(t,e,n).pipe(Wt(i));var s=r(function(t){return a(t.addEventListener)&&a(t.removeEventListener)}(t)?Wr.map(function(i){return function(r){return t[i](e,r,n)}}):function(t){return a(t.addListener)&&a(t.removeListener)}(t)?$r.map(Xr(t,e)):function(t){return a(t.on)&&a(t.off)}(t)?Zr.map(Xr(t,e)):[],2),o=s[0],l=s[1];if(!o&&it(t))return Tr(function(t){return Rr(t,e,n)})(ft(t));if(!o)throw new TypeError("Invalid event target");return new R(function(t){var e=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.next(1<e.length?e:e[0])};return o(e),function(){return l(e)}})}function Xr(t,e){return function(n){return function(i){return t[n](e,i)}}}function Dr(t,e){return t===e}class Nr{constructor(){var t,e;this._t=0,this._cameraSubscription=new kr,this.circles=[],this.paths=[],this.rectangles=[],this.texts=[],this._state$=new Y({circles:this.circles.map(t=>t.attributes),paths:this.paths.map(t=>t.attributes),rectangles:this.rectangles.map(t=>t.attributes),texts:this.texts.map(t=>t.attributes)}),this.state$=this._state$.pipe((void 0===e&&(e=Z),t=null!=(t=(t,e)=>function(t,e){return JSON.stringify(t)===JSON.stringify(e)}(t,e))?t:Dr,tt(function(n,i){var r,s=!0;n.subscribe(et(i,function(n){var o=e(n);!s&&t(r,o)||(s=!1,r=o,i.next(n))}))}))),this.config=new yt({cameraPerspective:gt()}),this.backgroundColor="#fff"}init(){this.emit()}tick(){this._t++,this.transitionToStateAt(this._t),this.emit()}mountCamera(t){t.mountCamera(this.config.data.cameraPerspective),this._cameraSubscription.set(t.state$.subscribe({next:t=>{this.config.data.cameraPerspective=t}}))}resetConfig(){this.config.reset()}onDestroy(){this.config.save(),this._cameraSubscription.unsubscribe()}emit(){this._state$.next({circles:this.circles.map(t=>t.attributes),paths:this.paths.map(t=>t.attributes),rectangles:this.rectangles.map(t=>t.attributes),texts:this.texts.map(t=>t.attributes)})}}class Lr extends Nr{constructor(){super(),this.config=new yt({cameraPerspective:{position:{x:0,y:.5,z:-3.6},angleX:20*_t,angleY:0*_t,angleZ:0*_t}},"bellCurveConfig"),this.name="Bell Curve";for(let t=-Lr.SIZE;t<Lr.SIZE;t++)for(let e=-Lr.SIZE;e<Lr.SIZE;e++)this.circles.push(new Gt({x:Lr.DIST*t,y:0,z:Lr.DIST*e},1.25));this.init()}transitionToStateAt(t){const e=3*Math.sin(t*Math.PI/180);this.circles.forEach(t=>{t.position.y=e*Math.exp(-(t.position.x*t.position.x+t.position.z*t.position.z))})}}Lr.SIZE=15,Lr.DIST=.15;class Yr extends Nr{constructor(){super(),this._rectangleStyleBottom={strokeWidth:.75,stroke:"#88f",strokeOpacity:.5,fill:"none",fillOpacity:0},this._rectangleStyleSides1={strokeWidth:.25,stroke:"#999",strokeOpacity:.5,fill:"none",fillOpacity:0},this._rectangleStyleSides2={strokeWidth:.25,stroke:"#999",strokeOpacity:.5,fill:"none",fillOpacity:0},this.config=new yt({cameraPerspective:{position:{x:0,y:2,z:-7.3},angleX:15*_t,angleY:40*_t,angleZ:0}},"bouncingParticlesConfig"),this.name="Bouncing Particles",this.rectangles=[new ne({x:0,y:0,z:0},6,6,{rotateX:90,rotateY:0,rotateZ:0},this._rectangleStyleBottom),new ne({x:3,y:2,z:0},6,4,{rotateX:0,rotateY:90,rotateZ:0},this._rectangleStyleSides1),new ne({x:0,y:2,z:3},4,6,{rotateX:0,rotateY:0,rotateZ:90},this._rectangleStyleSides1),new ne({x:-3,y:2,z:0},6,4,{rotateX:0,rotateY:90,rotateZ:0},this._rectangleStyleSides2),new ne({x:0,y:2,z:-3},4,6,{rotateX:0,rotateY:0,rotateZ:90},this._rectangleStyleSides2)],this.particles=[];for(let t=0;t<1500;t++){let t=2*Math.PI*Math.random(),e=.1*Math.random();this.particles.push({position:{x:0,y:.01,z:0},velocity:{x:e*Math.sin(t),y:.35*Math.random(),z:e*Math.cos(t)},staticX:!1,staticY:!1,staticZ:!1,outOfBounds:!1})}this.updateCirclesFromParticles(),this.init()}transitionToStateAt(t){this.particles.forEach(t=>{t.staticX&&t.staticY&&t.staticZ||(t.position.y<=0&&t.velocity.y<0?(t.velocity.x*=.8,t.velocity.y*=-.8,t.velocity.z*=.8):t.velocity.y-=Yr.ACCELERATION,t.outOfBounds||(Math.abs(t.position.x)>=2.9&&(t.position.y>4?t.outOfBounds=!0:t.velocity.x*=-1),Math.abs(t.position.z)>=2.9&&(t.position.y>4?t.outOfBounds=!0:t.velocity.z*=-1)),Math.abs(t.velocity.x)<.001&&(t.staticX=!0),Math.abs(t.velocity.y)<.001&&Math.abs(t.position.y)<.001&&(t.staticY=!0),Math.abs(t.velocity.z)<.001&&(t.staticZ=!0),t.staticX||(t.position.x+=t.velocity.x),t.staticX||(t.position.y+=t.velocity.y),t.staticX||(t.position.z+=t.velocity.z))}),this.updateCirclesFromParticles()}updateCirclesFromParticles(){this.circles=this.particles.map(t=>new Gt(t.position,1.5))}}Yr.ACCELERATION=.0095;const jr=9.81;class Fr extends Nr{constructor(){super(),this._zDistance=5,this._current=[],this._origins=[],this._circleStyle={strokeWidth:1.5,stroke:"#f80",strokeOpacity:1,fill:"#fff",fillOpacity:1},this._pathStyle={strokeWidth:2,stroke:"#88a",strokeOpacity:1},this.config=new yt({cameraPerspective:{position:{x:0,y:-2,z:-6},angleX:0*_t,angleY:0*_t,angleZ:0*_t},m1:1,m2:1,l1:1,l2:1,friction:1},"doublePendulum2dConfig"),this.name="Double Pendulum 2D";for(let t=-17;t<18;t+=4)for(let e=-9;e<10;e+=4)for(let n=1;n<2;n++)this._origins.push({x:t,y:e,z:n*this._zDistance}),this._current.push({theta1:t/Math.PI/2,theta2:e/Math.PI/2,omega1:1*(n-1),omega2:1*-(n-1)});this.updateWithCurrent(),this.init()}transitionToStateAt(t){const e=.025*t;this._current=this._current.map(t=>{const n=this.rungeKutta4Step(this.doublePendulumODE,e,this.pendulumStateAsArray(t),.025,this.config.data);return n[2]*=this.config.data.friction,n[3]*=this.config.data.friction,this.pendulumStateFromArray(n)}),this.updateWithCurrent()}updateWithCurrent(){const t=this._current.map((t,e)=>{const n=this.toCartesian(t.theta1,t.theta2);return[{x:this._origins[e].x,y:this._origins[e].y,z:this._origins[e].z},{x:this._origins[e].x+n[0],y:this._origins[e].y+n[1],z:this._origins[e].z},{x:this._origins[e].x+n[2],y:this._origins[e].y+n[3],z:this._origins[e].z}]}),e=t.map(t=>new qt(t,!1,!1,this._pathStyle));this.paths=e,this.circles=t.flat().map(t=>new Gt(t,3,this._circleStyle))}toCartesian(t,e){const n=this.config.data.l1*Math.sin(t),i=-this.config.data.l1*Math.cos(t);return[n,i,n+this.config.data.l2*Math.sin(e),i-this.config.data.l2*Math.cos(e)]}pendulumStateAsArray(t){return[t.theta1,t.theta2,t.omega1,t.omega2]}pendulumStateFromArray(t){return{theta1:t[0],theta2:t[1],omega1:t[2],omega2:t[3]}}doublePendulumODE(t,e,n){const i=e[0],r=e[1],s=e[2],o=e[3],a=r-i,l=Math.sin(a),h=Math.cos(a);return[s,o,(n.m2*n.l1*Math.pow(s,2)*l*h+n.m2*jr*Math.sin(r)*h+n.m2*n.l2*Math.pow(o,2)*l-(n.m1+n.m2)*jr*Math.sin(i))/(n.l1*(n.m1+n.m2-n.m2*Math.pow(h,2))),(-n.m2*n.l2*Math.pow(o,2)*l*h+(n.m1+n.m2)*(jr*Math.sin(i)*h-n.l1*Math.pow(s,2)*l)-(n.m1+n.m2)*jr*Math.sin(r))/(n.l2*(n.m1+n.m2-n.m2*Math.pow(h,2)))]}rungeKutta4Step(t,e,n,i,r){const s=t(e,n,r),o=t(e+i/2,n.map((t,e)=>t+i/2*s[e]),r),a=t(e+i/2,n.map((t,e)=>t+i/2*o[e]),r),l=t(e+i,n.map((t,e)=>t+i*a[e]),r);return n.map((t,e)=>t+i/6*(s[e]+2*o[e]+2*a[e]+l[e]))}}class Vr{constructor(t,e){this._params=t,this._timeStep=e}}class Br extends Vr{updateState(t){return this.rungeKutta4Step(t,this._timeStep)}getTotalEnergy(t){const e=this._params.m1,n=this._params.m2,i=this._params.l1,r=this._params.l2,s=-i*Math.cos(t.theta1),o=s-r*Math.cos(t.theta2),a=i*(Math.cos(t.theta1)*Math.cos(t.phi1)*t.dtheta1-Math.sin(t.theta1)*Math.sin(t.phi1)*t.dphi1),l=i*(Math.sin(t.theta1)*t.dtheta1),h=i*(Math.cos(t.theta1)*Math.sin(t.phi1)*t.dtheta1+Math.sin(t.theta1)*Math.cos(t.phi1)*t.dphi1),u=a+r*(Math.cos(t.theta2)*Math.cos(t.phi2)*t.dtheta2-Math.sin(t.theta2)*Math.sin(t.phi2)*t.dphi2),c=l+r*(Math.sin(t.theta2)*t.dtheta2),f=h+r*(Math.cos(t.theta2)*Math.sin(t.phi2)*t.dtheta2+Math.sin(t.theta2)*Math.cos(t.phi2)*t.dphi2);return.5*e*(a*a+l*l+h*h)+.5*n*(u*u+c*c+f*f)+(e*this._params.g*(s+i)+n*this._params.g*(o+i+r))}rungeKutta4Step(t,e){const n=this.doublePendulumODE(t);if(null==n)return null;const i=this.addScaledDerivatives(t,n,e/2),r=this.doublePendulumODE(i);if(null==r)return null;const s=this.addScaledDerivatives(t,r,e/2),o=this.doublePendulumODE(s);if(null==o)return null;const a=this.addScaledDerivatives(t,o,e),l=this.doublePendulumODE(a);return null==l?null:{theta1:t.theta1+(n.dtheta1+2*r.dtheta1+2*o.dtheta1+l.dtheta1)*e/6,phi1:t.phi1+(n.dphi1+2*r.dphi1+2*o.dphi1+l.dphi1)*e/6,theta2:t.theta2+(n.dtheta2+2*r.dtheta2+2*o.dtheta2+l.dtheta2)*e/6,phi2:t.phi2+(n.dphi2+2*r.dphi2+2*o.dphi2+l.dphi2)*e/6,dtheta1:t.dtheta1+(n.ddtheta1+2*r.ddtheta1+2*o.ddtheta1+l.ddtheta1)*e/6,dphi1:t.dphi1+(n.ddphi1+2*r.ddphi1+2*o.ddphi1+l.ddphi1)*e/6,dtheta2:t.dtheta2+(n.ddtheta2+2*r.ddtheta2+2*o.ddtheta2+l.ddtheta2)*e/6,dphi2:t.dphi2+(n.ddphi2+2*r.ddphi2+2*o.ddphi2+l.ddphi2)*e/6}}addScaledDerivatives(t,e,n){return{theta1:t.theta1+e.dtheta1*n,phi1:t.phi1+e.dphi1*n,theta2:t.theta2+e.dtheta2*n,phi2:t.phi2+e.dphi2*n,dtheta1:t.dtheta1+e.ddtheta1*n,dphi1:t.dphi1+e.ddphi1*n,dtheta2:t.dtheta2+e.ddtheta2*n,dphi2:t.dphi2+e.ddphi2*n}}doublePendulumODE(t){const e=this._params.m1,n=this._params.m2,i=e+n,r=this._params.l1,s=this._params.l2,o=this._params.g,a=t.theta1,l=t.phi1,h=t.theta2,u=t.phi2,c=t.dtheta1,f=t.dphi1,p=t.dtheta2,d=t.dphi2,y=Math.sin(a),_=Math.sin(h),g=Math.cos(a),m=Math.cos(h),v=(Math.sin(l),Math.sin(u),Math.cos(l),Math.cos(u),u+l),w=u-l,b=(Math.sin(v),Math.cos(v),-Math.sin(w)),x=Math.cos(w),k=Math.sin(2*a),S=(Math.sin(2*l),Math.sin(2*h)),A=(Math.cos(2*h),Math.cos(2*u),Math.pow(y*_,2)),E=Math.pow(g*m,2),M=Math.pow(_,2),I=Math.pow(g,2),C=Math.pow(m,2),P=Math.pow(y,2),z=Math.pow(x,2),T=Math.pow(c,2),O=Math.pow(p,2),$=Math.pow(f,2),W=Math.pow(d,2),Z=W+O,R=$+T,X=Math.pow(g,3),D=Math.pow(m,3),N=-(n*A*z+.5*n*k*S*x+n*E-i),L=(n*y*M*(r*g*T+o)*z+(-s*g*W*C+(r*($+2*T)*I+o*g-r*R)*m+s*g*Z)*n*_*x-y*(-s*n*W*D+n*r*g*R*C+s*n*Z*m+i*(-r*$*g+o)))/(r*N),Y=-(-.5*S*O*s*n*P*z-y*(-m*$*r*i*I+(s*n*(W+2*O)*C+o*i*m-s*n*Z)*g+m*r*R*i)*x+(-$*r*i*X+(s*n*Z*m+o*i)*I+r*R*i*g-m*W*s*i)*_)/(s*N),j=-(n*(y*M*(-r*$*I+o*g+r*R)*x+_*(-r*m*$*X+o*I*m+r*g*m*R-s*(C*W-Z)))*b-2*c*r*(n*A*z+.5*n*k*S*x+n*E-i)*f*g)/(r*N*y),F=((-n*s*_*(C*W-Z)*P*x+y*(-r*$*i*I+(-s*n*W*D+s*n*Z*m+o*i)*g+r*R*i))*b+2*m*(n*A*z+.5*k*S*x*n+E*n-i)*p*d*s)/(s*N*_);return this.isInvalidNumber(L)||this.isInvalidNumber(Y)||this.isInvalidNumber(j)||this.isInvalidNumber(F)?null:{dtheta1:c,dphi1:f,dtheta2:p,dphi2:d,ddtheta1:L,ddphi1:j,ddtheta2:Y,ddphi2:F}}isInvalidNumber(t){return!isFinite(t)||isNaN(t)||null==t}}class Hr extends Nr{constructor(){super(),this._running=!0,this._circleStyle={strokeWidth:1.5,stroke:"#f80",strokeOpacity:1,fill:"#fff",fillOpacity:1},this._pathStyleCs={strokeWidth:.5,stroke:"#000",strokeOpacity:.5},this._pathStyle={strokeWidth:2,stroke:"#88a",strokeOpacity:1},this.config=new yt({cameraPerspective:{position:{x:0,y:0,z:-3.5},angleX:20*_t,angleY:-30*_t,angleZ:0*_t},m1:1,m2:1,l1:1,l2:1,friction:1},"doublePendulum3dConfig"),this.name="Double Pendulum 3D";this._csPaths=[new qt([{x:-2.5,y:0,z:0},{x:2.5,y:0,z:0}],!1,!0,this._pathStyleCs),new qt([{x:0,y:-2.5,z:0},{x:0,y:2.5,z:0}],!1,!0,this._pathStyleCs),new qt([{x:0,y:0,z:-2.5},{x:0,y:0,z:2.5}],!1,!0,this._pathStyleCs)],this._current=[{theta1:1,phi1:0,theta2:1,phi2:0,dtheta1:1,dphi1:1.2300575,dtheta2:0,dphi2:2.460115}],this._origins=[{x:0,y:0,z:0}],this._calculator=new Br({l1:this.config.data.l1,l2:this.config.data.l2,m1:this.config.data.m1,m2:this.config.data.m2,g:9.81},.001),this.updateWithCurrent(),this.init()}transitionToStateAt(t){if(!this._running)return;let e=structuredClone(this._current[0]),n=structuredClone(this._current[0]),i=structuredClone(this._current[0]);for(let r=0;r<20;r++){if(e=structuredClone(i),n=this._calculator.updateState(e),null==n)return console.error(`#transitionToStateAt - Problem at t=${t}, aborting`),void(this._running=!1);i=n}this._current[0]=i,this.updateWithCurrent()}updateWithCurrent(){const t=this._current.map((t,e)=>{const n=this.toCartesian(t.theta1,t.phi1,t.theta2,t.phi2);return[{x:this._origins[e].x,y:this._origins[e].y,z:this._origins[e].z},{x:this._origins[e].x+n[0],y:this._origins[e].y+n[1],z:this._origins[e].z+n[2]},{x:this._origins[e].x+n[3],y:this._origins[e].y+n[4],z:this._origins[e].z+n[5]}]}),e=t.map(t=>new qt(t,!1,!1,this._pathStyle));this.paths=[...this._csPaths,...e],this.circles=t.flat().map(t=>new Gt(t,3,this._circleStyle))}toCartesian(t,e,n,i){const r=this.config.data.l1*Math.sin(t)*Math.cos(e),s=-this.config.data.l1*Math.cos(t),o=this.config.data.l1*Math.sin(t)*Math.sin(e);return[r,s,o,r+this.config.data.l2*Math.sin(n)*Math.cos(i),s-this.config.data.l2*Math.cos(n),o+this.config.data.l2*Math.sin(n)*Math.sin(i)]}}class Kr extends Nr{constructor(){super(),this.config=new yt({cameraPerspective:{position:{x:0,y:0,z:-3},angleX:30*_t,angleY:60*_t,angleZ:0}},"gridConfig"),this.name="Grid";for(let t=-Kr.SIZE;t<=Kr.SIZE;t+=Kr.DIST)for(let e=-Kr.SIZE;e<=Kr.SIZE;e+=Kr.DIST)for(let n=-Kr.SIZE;n<=Kr.SIZE;n+=Kr.DIST)this.circles.push(new Gt({x:t,y:e,z:n},1.5));this.init()}transitionToStateAt(t){}}Kr.SIZE=1,Kr.DIST=.2;class Gr extends Nr{constructor(){super(),this.cnt=0,this.maxCnt=4095,this.minZ=-3,this.maxZ=-15,this._pathStyle={strokeWidth:1,stroke:"#77a",strokeOpacity:1},this.config=new yt({cameraPerspective:{position:{x:-1,y:4.7,z:-5},angleX:25*_t,angleY:50*_t,angleZ:0}},"hilbertCurveConfig"),this.name="Hilbert Curve",this.hilbert=new Qr(1,Ur.XYZ),this.paths=[new qt([{x:0,y:0,z:0}],!1,!0,this._pathStyle)],this.init()}transitionToStateAt(t){if(this.cnt>this.maxCnt)return;let e;for(let t=0;t<1;t++)if(e=this.hilbert.xyz(this.cnt++),this.paths[0].path.push({x:.5*e.x,y:.5*e.y,z:.5*e.z}),this.cnt>this.maxCnt)return}}var Ur,qr;!function(t){t.XYZ="XYZ",t.XZY="XZY",t.YXZ="YXZ",t.YZX="YZX",t.ZXY="ZXY",t.ZYX="ZYX"}(Ur||(Ur={}));class Jr{constructor(t,e,n,i){t&&(e=t[0],n=t[1],i=t[2]),this.x=Math.round(e)||0,this.y=Math.round(n)||0,this.z=Math.round(i)||0,this.arr=[this.x,this.y,this.z],this.n=4*this.z+2*this.y+this.x}floor(){return new Jr([this.x,this.y,this.z].map(Math.floor),0,0,0)}mult(t){return new Jr(null,this.x*t,this.y*t,this.z*t)}add(t){return"number"==typeof t?new Jr(null,this.x+t,this.y+t,this.z+t):new Jr(null,this.x+t.x,this.y+t.y,this.z+t.z)}mod(t){return new Jr(null,this.x%t,this.y%t,this.z%t)}rotate(t,e){return 0==t.n?new Jr(null,this.z,this.x,this.y):1==t.n||3==t.n?new Jr(null,this.y,this.z,this.x):2==t.n||6==t.n?new Jr(null,e-this.x,e-this.y,this.z):5==t.n||7==t.n?new Jr(null,this.y,e-this.z,e-this.x):new Jr(null,e-this.z,this.x,e-this.y)}unrotate(t,e){return 0==t.n?new Jr(null,this.y,this.z,this.x):1==t.n||3==t.n?new Jr(null,this.z,this.x,this.y):2==t.n||6==t.n?new Jr(null,e-this.x,e-this.y,this.z):5==t.n||7==t.n?new Jr(null,e-this.z,this.x,e-this.y):new Jr(null,this.y,e-this.z,e-this.x)}rotateLeft(t){return t%3==0?this:t%3==1?new Jr(null,this.y,this.z,this.x):new Jr(null,this.z,this.x,this.y)}rotateRight(t){return t%3==0?this:t%3==1?new Jr(null,this.z,this.x,this.y):new Jr(null,this.y,this.z,this.x)}shuffle(t){return t?new Jr(null,this.extractFromAnchorAxisOrder(t,0),this.extractFromAnchorAxisOrder(t,1),this.extractFromAnchorAxisOrder(t,2)):this}pp(){return[this.x,this.y,this.z].join(",")}manhattanDistance(t){return Math.abs(t.x-this.x)+Math.abs(t.y-this.y)+Math.abs(t.z-this.z)}extractFromAnchorAxisOrder(t,e){switch(t[e]){case"X":return this.x;case"Y":return this.y;case"Z":return this.z}throw new Error(`Invalid template and/or index: template=${t}, index=${e}`)}}class Qr{constructor(t,e){if(this.horseshoe2d=[0,1,3,2,7,6,4,5],this.xyz=this.d2xyz,this.d=this.xyz2d,this.size=t,this.anchorAxisOrder=e,this.anchorAxisOrder==Ur.XYZ&&(this.anchorAxisOrder=null),this.anchorAxisOrder)switch(this.anchorAxisOrder){case Ur.XZY:this.reverseAnchorAxisOrder=Ur.XZY;break;case Ur.YXZ:this.reverseAnchorAxisOrder=Ur.YXZ;break;case Ur.YZX:this.reverseAnchorAxisOrder=Ur.ZXY;break;case Ur.ZXY:this.reverseAnchorAxisOrder=Ur.YZX;break;case Ur.ZYX:this.reverseAnchorAxisOrder=Ur.ZYX}if(this.size){this.log2size=0;let t=1;for(;t<this.size;t*=2,this.log2size++);if(t!=this.size)throw new Error("Invalid size: "+this.size+". Must be a power of 2.");this.log2parity=this.log2size%3}}d2xyz(t){t=Math.floor(t);let e,n,i,r=new Jr(null,0,0,0),s=1,o=2,a=this.size||0;for(;t>0||s<a;){e=1&t,n=t/2&1,i=t/4&1;let a=new Jr(null,e^n,n^i,i);r=r.rotate(a,s-1).add(a.mult(s)),t=Math.floor(t/8),s*=2,o++}return r=this.size?r.rotateLeft(o-this.log2parity+1):r.rotateLeft(o),r.shuffle(this.reverseAnchorAxisOrder)}xyz2d(t,e,n){let i=new Jr(null,t,e,n).floor(),r=1,s=0;const o=Math.max.apply(Math,i.arr);for(;2*r<=o;r*=2)s=(s+1)%3;null!=this.anchorAxisOrder&&(i=i.shuffle(this.anchorAxisOrder)),i=this.size?i.rotateRight(s-this.log2parity+1):i.rotateRight(s);let a=0;for(;r>0;){var l=new Jr(null,i.x&r&&1,i.y&r&&1,i.z&r&&1);a*=8,a+=this.horseshoe2d[l.n],s=(s+2)%3,i=i.mod(r),i=i.unrotate(l,r-1),r=Math.floor(r/2)}return a}}class ts extends Nr{constructor(){super(),this._circleStyle={strokeWidth:.5,stroke:"#fff",strokeOpacity:1,fill:"#f80",fillOpacity:1},this._rectangleStyle={strokeWidth:1,stroke:"#00f",strokeOpacity:1,fill:"#4af",fillOpacity:.2},this._darkRed="#b00",this._darkGreen="#0b0",this._darkBlue="#00b",this._xCircles=[],this._yCircles=[],this._zCircles=[],this.config=new yt({cameraPerspective:gt()},"playgroundConfig"),this.name="Playground",this._textStyle={fontSize:12,fontFamily:"sans-serif",fill:"#666",fillOpacity:1,alignmentBaseline:"baseline"},this._textStyle.fontSize=20;for(let t=1.15;t<=20;t+=.15)this._xCircles.push(new Gt({x:t,y:0,z:0},1,this.circleStyle(this._darkRed))),this._xCircles.push(new Gt({x:-t,y:0,z:0},1,this.circleStyle(this._darkRed))),this._yCircles.push(new Gt({x:0,y:t,z:0},1,this.circleStyle(this._darkGreen))),this._yCircles.push(new Gt({x:0,y:-t,z:0},1,this.circleStyle(this._darkGreen))),this._zCircles.push(new Gt({x:0,y:0,z:t},1,this.circleStyle(this._darkBlue))),this._zCircles.push(new Gt({x:0,y:0,z:-t},1,this.circleStyle(this._darkBlue)));this.circles=[new Gt({x:0,y:0,z:0},2.5,this._circleStyle)],this.circles=[...this.circles,...this._xCircles,...this._yCircles,...this._zCircles],this.paths=[new qt([{x:-1,y:0,z:0},{x:1,y:0,z:0}],!1,!1,this.pathStyle("#f00")),new qt([{x:0,y:-1,z:0},{x:0,y:1,z:0}],!1,!1,this.pathStyle("#0f0")),new qt([{x:0,y:0,z:-1},{x:0,y:0,z:1}],!1,!1,this.pathStyle("#00f"))],this.rectangles=[new ne({x:0,y:0,z:0},3,3,{rotateX:90,rotateY:0,rotateZ:0},this._rectangleStyle)],this.texts=[new oe({x:1,y:0,z:0},"Hello",!1,this._textStyle)],this.init()}transitionToStateAt(t){const e=t%150<75;this.texts[0].text=e?"Hello":"World";const n=Math.floor(t/50)%3;let i=this._darkRed,r=this._darkGreen,s=this._darkBlue;switch(n){case 1:i=this._darkGreen,r=this._darkBlue,s=this._darkRed;break;case 2:i=this._darkBlue,r=this._darkRed,s=this._darkGreen}this._xCircles.forEach(t=>t.style=this.circleStyle(i)),this._yCircles.forEach(t=>t.style=this.circleStyle(r)),this._zCircles.forEach(t=>t.style=this.circleStyle(s))}pathStyle(t){return{strokeWidth:2,stroke:t,strokeOpacity:.5}}circleStyle(t){return{strokeWidth:0,stroke:"#000",strokeOpacity:0,fill:t,fillOpacity:.5}}}!function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.FORWARD=4]="FORWARD",t[t.BACKWARD=5]="BACKWARD"}(qr||(qr={}));class es extends Nr{constructor(){super(),this.config=new yt({cameraPerspective:gt()},"randomPointsConfig"),this.name="Random Points",this.circles.push(new Gt({x:0,y:0,z:0},1.5));let t,e=structuredClone(this.circles[0].position),n=structuredClone(this.circles[0].position);for(let i=0;i<1500;i++){switch(t=Math.floor(6*Math.random()),e=structuredClone(n),t){case qr.UP:e.y+=es.DIST;break;case qr.DOWN:e.y-=es.DIST;break;case qr.LEFT:e.x+=es.DIST;break;case qr.RIGHT:e.x-=es.DIST;break;case qr.FORWARD:e.z-=es.DIST;break;case qr.BACKWARD:e.z+=es.DIST;break;default:console.log("NOK",t)}Math.abs(e.x)>es.AREA||Math.abs(e.y)>es.AREA||Math.abs(e.z)>es.AREA||(n=structuredClone(e),this.circles.push(new Gt(structuredClone(n),1.5)))}this.init()}transitionToStateAt(t){}}es.AREA=20,es.DIST=.15;const ns=["#1d1417","#0a1a34","#0f1a27","#131b1c","#122e4c","#32292c","#12323d","#232d3b","#38291f","#512124","#272e2e","#1d3230","#2c3022","#523e3e","#284a4e","#1e4c5e","#314942","#3e4452","#434440","#1d4c77","#504734","#3d4e35","#a6342d","#a03a42","#8a433a","#7d4651","#685c3d","#52633b","#366973","#516357","#2d699c","#3b6c5c","#5b616f","#64605a","#c15d53","#c5603b","#368695","#4a80af","#6e7e80","#2f93bb","#c26c7a","#878974","#539791","#9681a6","#bf7b5b","#c88242","#9f8c67","#a6878a","#649d7c","#bf818c","#7e95ae","#859a69","#b09655","#5ca9b8","#94a1a4","#dca27b","#e7aa58","#d6b258","#cdb0c1","#8ac7d0","#d8b2b1","#cfbc76","#c9bc94","#b4c0c6","#9ecaba","#c2c1b6","#eed06e","#e8d890","#e1d8aa","#d0dbdd","#e0dbc3","#dcddd6"];class is extends Nr{constructor(){super(),this._rows=8,this._columns=8,this._layers=8,this.config=new yt({cameraPerspective:{position:{x:-0,y:0,z:-8},angleX:0*_t,angleY:90*_t,angleZ:0*_t}},"richtersRectanglesConfig"),this.name="Richters Rectangles",this.backgroundColor="#ccc";const t=this._rows*this._columns*this._layers;for(this.rectangles=ns.map(t=>this.createRectangle(t));this.rectangles.length<t;){const t=ns[Math.floor(Math.random()*ns.length)];this.rectangles.push(this.createRectangle(t))}this.rectangles.sort(()=>Math.random()-.5);for(let t=0;t<this._layers;t++)for(let e=0;e<this._rows;e++)for(let n=0;n<this._columns;n++)this.rectangles[t*this._rows*this._columns+e*this._columns+n].position={x:-n+this._columns/2-.5,y:-e+this._rows/2-.5,z:t-this._layers/2+.5};this._speedX=Array.from({length:t},()=>5*Math.random()),this._speedY=Array.from({length:t},()=>5*Math.random()),this._speedZ=Array.from({length:t},()=>5*Math.random()),this.init()}transitionToStateAt(t){const e=[30,46,60,72,82,90,96,100].map(e=>Math.max(t-e,0));this.rectangles.forEach((t,n)=>{const i=Math.floor(n/(this._rows*this._columns));t.orientation={rotateX:this._speedX[n]*e[i],rotateY:this._speedY[n]*e[i],rotateZ:this._speedZ[n]*e[i]}})}createRectangle(t){return new ne({x:0,y:0,z:0},1,1,void 0,this.createCircleStyle(t))}createCircleStyle(t){return{strokeWidth:0,stroke:"#000",strokeOpacity:0,fill:t,fillOpacity:.6}}}const rs=.35,ss=2,os=4.0923373,as=.88,ls=2.5,hs=1.6021303,us=.92,cs=2.85,fs=.9856474,ps=.49,ds=3.3,ys=.5240335,_s=10.5,gs=4.5,ms=.0830864,vs=8.86,ws=6,bs=.0334597,xs=3.76,ks=7.2,Ss=.0117299,As=3.65,Es=8,Ms=.005981,Is=.3,Cs=.1,Ps=13.176358,zs=.312,Ts=.65,Os=203.489,$s=.27,Ws=.7,Zs=101.376,Rs=.45,Xs=.75,Ds=50.316,Ns=.414,Ls=.83,Ys=21.569,js=.441,Fs=.85,Vs=22.571,Bs=.135,Hs=.3,Ks=41.351,Gs=.234,Us=.3,qs=-61.736,Js=[.54,.57,.6,.63,.66];function Qs(t,e){if(!/^#([0-9A-Fa-f]{3}){1,2}$/.test(t)||e<0||e>1)return console.warn(`darkenColor - invalid inputs color=${t}, factor=${e}`),t;let n=t.replace("#","");3===n.length&&(n=n.split("").map(t=>t+t).join(""));const i=parseInt(n.substring(0,2),16),r=parseInt(n.substring(2,4),16),s=parseInt(n.substring(4,6),16),o=Math.round(i*e),a=Math.round(r*e),l=Math.round(s*e),h=t=>t.toString(16).padStart(2,"0");return`#${h(o)}${h(a)}${h(l)}`}const to={strokeWidth:3,stroke:"rgba(255, 231, 98, 1)",strokeOpacity:.7,fill:"#ffca1aff",fillOpacity:1},eo={strokeWidth:3,stroke:"#fe8",strokeOpacity:.5,fill:"#fff",fillOpacity:0},no={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#A9A9A9",fillOpacity:1},io={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#E6C229",fillOpacity:1},ro={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#1DA1F2",fillOpacity:1},so={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#C1440E",fillOpacity:1},oo={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#F7CC7F",fillOpacity:1},ao={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#F5DEB3",fillOpacity:1},lo={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#AFD2E1",fillOpacity:1},ho={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#1E90FF",fillOpacity:1},uo={strokeWidth:0,stroke:"#000",strokeOpacity:1,fill:"#fff",fillOpacity:1},co={strokeWidth:1,stroke:ao.fill,strokeOpacity:.5};function fo(t){return{fontSize:14,fontFamily:"sans-serif",fill:Qs(t,.5),fillOpacity:1,alignmentBaseline:"baseline"}}class po extends Nr{constructor(){super(),this._orbitalAngles=this.calculateInitialPositions(1977,7,8),this.config=new yt({cameraPerspective:{position:{x:0,y:-1,z:-8.5},angleX:35*_t,angleY:330*_t,angleZ:0*_t},speed:1/24},"solarSystemConfig"),this.backgroundColor="#000",this.name="SolarSystem";const t={x:0,y:0,z:0};this._innerSun=new Gt(t,25,to),this._outerSun=new Gt(t,28,eo),this._sunInfo=new oe(this.planetInfoPosition(t,28),"Sun",!0,fo(to.fill));const e=this.planetPosition(ss,this._orbitalAngles.mercury);this._mercury=new Gt(e,rs,no),this._mercuryInfo=new oe(this.planetInfoPosition(e,rs),"Mercury",!0,fo(no.fill));const n=this.planetPosition(ls,this._orbitalAngles.venus);this._venus=new Gt(n,as,io),this._venusInfo=new oe(this.planetInfoPosition(n,as),"Venus",!0,fo(io.fill));const i=this.planetPosition(cs,this._orbitalAngles.earth);this._earth=new Gt(i,us,ro),this._earthInfo=new oe(this.planetInfoPosition(i,us),"Earth",!0,fo(ro.fill)),this._earthLuna=new Gt(this.moonPosition(i,Cs,this._orbitalAngles.earthLuna),Is,uo);const r=this.planetPosition(ds,this._orbitalAngles.mars);this._mars=new Gt(r,ps,so),this._marsInfo=new oe(this.planetInfoPosition(r,ps),"Mars",!0,fo(so.fill));const s=this.planetPosition(gs,this._orbitalAngles.jupiter);this._jupiter=new Gt(s,_s,oo),this._jupiterInfo=new oe(this.planetInfoPosition(s,_s),"Jupiter",!0,fo(oo.fill)),this._jupiterIo=new Gt(this.moonPosition(s,Ts,this._orbitalAngles.jupiterIo),zs,uo),this._jupiterEuropa=new Gt(this.moonPosition(s,Ws,this._orbitalAngles.jupiterEuropa),$s,uo),this._jupiterGanymede=new Gt(this.moonPosition(s,Xs,this._orbitalAngles.jupiterGanymede),Rs,uo),this._jupiterCalisto=new Gt(this.moonPosition(s,Ls,this._orbitalAngles.jupiterCallisto),Ns,uo);const o=this.planetPosition(ws,this._orbitalAngles.saturn);this._saturn=new Gt(o,vs,ao),this._saturnInfo=new oe(this.planetInfoPosition(o,vs),"Saturn",!0,fo(ao.fill)),this._saturnTitan=new Gt(this.moonPosition(o,Fs,this._orbitalAngles.saturnTitan),js,uo),this._saturnRing1=new qt(this.ringPositions(o,Js[0]),!0,!1,co),this._saturnRing2=new qt(this.ringPositions(o,Js[1]),!0,!1,co),this._saturnRing3=new qt(this.ringPositions(o,Js[2]),!0,!1,co),this._saturnRing4=new qt(this.ringPositions(o,Js[3]),!0,!1,co),this._saturnRing5=new qt(this.ringPositions(o,Js[4]),!0,!1,co);const a=this.planetPosition(ks,this._orbitalAngles.uranus);this._uranus=new Gt(a,xs,lo),this._uranusInfo=new oe(this.planetInfoPosition(a,xs),"Uranus",!0,fo(lo.fill)),this._uranusTitania=new Gt(this.moonPosition(a,Hs,this._orbitalAngles.uranusTitania),Bs,uo);const l=this.planetPosition(Es,this._orbitalAngles.neptune);this._neptune=new Gt(l,As,ho),this._neptuneInfo=new oe(this.planetInfoPosition(l,As),"Neptune",!0,fo(ho.fill)),this._neptuneTriton=new Gt(this.moonPosition(l,Us,this._orbitalAngles.neptuneTriton),Gs,uo),this.circles=[this._innerSun,this._outerSun,this._mercury,this._venus,this._earth,this._earthLuna,this._mars,this._jupiter,this._jupiterIo,this._jupiterEuropa,this._jupiterGanymede,this._jupiterCalisto,this._saturn,this._saturnTitan,this._uranus,this._uranusTitania,this._neptune,this._neptuneTriton],this.paths=[this._saturnRing1,this._saturnRing2,this._saturnRing3,this._saturnRing4,this._saturnRing5],this.texts=[this._sunInfo,this._mercuryInfo,this._venusInfo,this._earthInfo,this._marsInfo,this._jupiterInfo,this._saturnInfo,this._uranusInfo,this._neptuneInfo],this.init()}transitionToStateAt(t){const e=this.config.data.speed;this._orbitalAngles.mercury+=os*e,this._mercury.position=this.planetPosition(ss,this._orbitalAngles.mercury),this._mercuryInfo.position=this.planetInfoPosition(this._mercury.position,rs),this._orbitalAngles.venus+=hs*e,this._venus.position=this.planetPosition(ls,this._orbitalAngles.venus),this._venusInfo.position=this.planetInfoPosition(this._venus.position,as),this._orbitalAngles.earth+=fs*e,this._earth.position=this.planetPosition(cs,this._orbitalAngles.earth),this._earthInfo.position=this.planetInfoPosition(this._earth.position,us),this._orbitalAngles.earthLuna+=Ps*e,this._earthLuna.position=this.moonPosition(this._earth.position,Cs,this._orbitalAngles.earthLuna),this._orbitalAngles.mars+=ys*e,this._mars.position=this.planetPosition(ds,this._orbitalAngles.mars),this._marsInfo.position=this.planetInfoPosition(this._mars.position,ps),this._orbitalAngles.jupiter+=ms*e,this._jupiter.position=this.planetPosition(gs,this._orbitalAngles.jupiter),this._jupiterInfo.position=this.planetInfoPosition(this._jupiter.position,_s),this._orbitalAngles.jupiterIo+=Os*e,this._jupiterIo.position=this.moonPosition(this._jupiter.position,Ts,this._orbitalAngles.jupiterIo),this._orbitalAngles.jupiterEuropa+=Zs*e,this._jupiterEuropa.position=this.moonPosition(this._jupiter.position,Ws,this._orbitalAngles.jupiterEuropa),this._orbitalAngles.jupiterGanymede+=Ds*e,this._jupiterGanymede.position=this.moonPosition(this._jupiter.position,Xs,this._orbitalAngles.jupiterGanymede),this._orbitalAngles.jupiterCallisto+=Ys*e,this._jupiterCalisto.position=this.moonPosition(this._jupiter.position,Ls,this._orbitalAngles.jupiterCallisto),this._orbitalAngles.saturn+=bs*e,this._saturn.position=this.planetPosition(ws,this._orbitalAngles.saturn),this._saturnInfo.position=this.planetInfoPosition(this._saturn.position,vs),this._orbitalAngles.saturnTitan+=Vs*e,this._saturnTitan.position=this.moonPosition(this._saturn.position,Fs,this._orbitalAngles.saturnTitan),this._saturnRing1.path=this.ringPositions(this._saturn.position,Js[0]),this._saturnRing2.path=this.ringPositions(this._saturn.position,Js[1]),this._saturnRing3.path=this.ringPositions(this._saturn.position,Js[2]),this._saturnRing4.path=this.ringPositions(this._saturn.position,Js[3]),this._saturnRing5.path=this.ringPositions(this._saturn.position,Js[4]),this._orbitalAngles.uranus+=Ss*e,this._uranus.position=this.planetPosition(ks,this._orbitalAngles.uranus),this._uranusInfo.position=this.planetInfoPosition(this._uranus.position,xs),this._orbitalAngles.uranusTitania+=Ks*e,this._uranusTitania.position=this.moonPosition(this._uranus.position,Hs,this._orbitalAngles.uranusTitania),this._orbitalAngles.neptune+=Ms*e,this._neptune.position=this.planetPosition(Es,this._orbitalAngles.neptune),this._neptuneInfo.position=this.planetInfoPosition(this._neptune.position,As),this._orbitalAngles.neptuneTriton-=qs*e,this._neptuneTriton.position=this.moonPosition(this._neptune.position,Us,this._orbitalAngles.neptuneTriton)}planetPosition(t,e){return{x:t*Math.cos(e*_t),y:0,z:t*Math.sin(e*_t)}}planetInfoPosition(t,e){return{x:t.x,y:.15+e/20,z:t.z}}moonPosition(t,e,n){return{x:t.x+e*Math.cos(n*_t),y:0,z:t.z+e*Math.sin(n*_t)}}ringPositions(t,e){return Array.from({length:36},(t,e)=>10*e).map(n=>({x:t.x+e*Math.cos(n*_t),y:0,z:t.z+e*Math.sin(n*_t)}))}calculateInitialPositions(t,e,n){const i=new Date(2e3,0,1),r=(new Date(t,e-1,n).getTime()-i.getTime())/864e5;return{mercury:252.2509+r*os%360,venus:181.9798+r*hs%360,earth:100.4644+r*fs%360,earthLuna:360*Math.random(),mars:355.4333+r*ys%360,jupiter:34.3515+r*ms%360,jupiterIo:360*Math.random(),jupiterEuropa:360*Math.random(),jupiterGanymede:360*Math.random(),jupiterCallisto:360*Math.random(),saturn:49.9443+r*bs%360,saturnTitan:360*Math.random(),uranus:313.2322+r*Ss%360,uranusTitania:360*Math.random(),neptune:304.88+r*Ms%360,neptuneTriton:360*Math.random()}}}new class{constructor(){this._keyboardAnimationManager=new bt,this._abortWorldTick$=new N,this._newWorldSubscription=new kr,this._currentWorldIdSubscriontion=new kr,this._worldTitleArea=document.getElementById("worldTitle"),this._cameraInfoArea=document.getElementById("cameraInfo"),console.log("#constructor(Start) - ZetaSVG - Version:0.0.15"),function(t){const e="app-version",n=localStorage.getItem(e);n!==t&&(console.info(`#configVersionCheck - storedVersion=${n} does not match appVersion=${t}`),localStorage.clear(),caches.keys().then(t=>{t.forEach(t=>{caches.delete(t)})}),localStorage.setItem(e,t),window.location.reload())}("0.0.15"),this._stageMode=zr();const t=document.getElementById("main");if(null==t)return void console.error("Critical: Main div element not found");this.setupStage(t),this._stage=new Cr("main"),this._camera=new mt,this._cameraControl=new wt(this._camera),this._world=null,this._config=new yt({currentWorldId:1,worldTick:40},"mainConfig"),this._currentWorldId$=new Y(this._config.data.currentWorldId);const e=this._stageMode==Pr.IMMERSIVE;this.handlePhysicalKeyboardEvents(!e),e||(this.appendVirtualKeyboard(),this.updateCameraInfo()),this.runWorld()}setupStage(t){const e=document.getElementById("info"),n=document.getElementById("virtual-keyboard-container");switch(this._stageMode){case Pr.DEFAULT:t.classList.add("main--default"),null==e||e.classList.add("info--default");break;case Pr.SMALL:t.classList.add("main--small"),null==e||e.classList.add("info--small");break;case Pr.IMMERSIVE:console.log("Fullscreen detected - going immersive!"),t.classList.add("main--immersive"),null==e||e.classList.add("element--gone"),null==n||n.classList.add("element--gone")}window.addEventListener("resize",()=>{zr()!==this._stageMode&&window.location.reload()})}handlePhysicalKeyboardEvents(t){t?document.addEventListener("keydown",t=>{this.signalPhysicalEventToVirtualKeyboard(t.key),this.handleKeyPress(t.key)},!1):document.addEventListener("keydown",t=>{this.handleKeyPress(t.key)},!1)}appendVirtualKeyboard(){fetch("virtual-keyboard.html").then(t=>t.text()).then(t=>{const e=document.getElementById("virtual-keyboard-container");null!=e?e.innerHTML=t:console.error("virtual-keyboard-container not found to append virtual keyboard html")}).then(t=>{Array.from(document.getElementsByClassName("virtual-key")).forEach(t=>function(t,e,n){const i=t.dataset.key||"",r=Or(Rr(t,"mousedown"),Rr(t,"touchstart")),s=Or(Rr(t,"mouseup"),Rr(t,"touchend"),Rr(t,"mouseleave"));var o;Rr(t,"touchstart").subscribe(t=>t.preventDefault()),r.pipe((o=()=>(n(e,i),J(300,50).pipe(dt(s))),tt(function(t,e){var n=null,i=!1,r=function(){return i&&!n&&e.complete()};t.subscribe(et(e,function(t){null==n||n.unsubscribe(),ft(o()).subscribe(n=et(e,function(t){return e.next(t)},function(){n=null,r()}))},function(){i=!0,r()}))}))).subscribe(()=>{n(e,i)})}(t,this,this.handleKeyPressViaVirtualKeyboard)),this._currentWorldIdSubscriontion.set(this._currentWorldId$.subscribe(t=>{for(let e=0;e<10;e++){const n=document.getElementById(`virtual-key-${e}`);e==t?null==n||n.classList.add("virtual-key--selected"):null==n||n.classList.remove("virtual-key--selected")}}))})}signalPhysicalEventToVirtualKeyboard(t){this._keyboardAnimationManager.triggerAnimation(t)}handleKeyPressViaVirtualKeyboard(t,e){t.handleKeyPress(e)}handleKeyPress(t){var e,n;if(!this._cameraControl.onNextEvent(t))switch(t){case"":console.log("invalid key");case"Escape":null===(e=this._world)||void 0===e||e.resetConfig(),null===(n=this._world)||void 0===n||n.mountCamera(this._camera);break;case"1":this.switchWorld(1);break;case"2":this.switchWorld(2);break;case"3":this.switchWorld(3);break;case"4":this.switchWorld(4);break;case"5":this.switchWorld(5);break;case"6":this.switchWorld(6);break;case"7":this.switchWorld(7);break;case"8":this.switchWorld(8);break;case"9":this.switchWorld(9);break;case"0":this.switchWorld(0)}}switchWorld(t){console.log(`switching world to (${t})`),this._currentWorldId$.next(t),this._config.data.currentWorldId=t,this._abortWorldTick$.next(),this._newWorldSubscription.set(J(100).subscribe(()=>{this.runWorld()}))}runWorld(){var t;null===(t=this._world)||void 0===t||t.onDestroy(),this._world=this.createWorldById(this._config.data.currentWorldId),this._world.mountCamera(this._camera),this.updateWorldTitle(this._world.name);const e=new ae(this._world,this._camera,function(t){var e;const n=null!==(e=window.devicePixelRatio)&&void 0!==e?e:1;switch(t){case Pr.DEFAULT:return 1280;case Pr.SMALL:return 800;case Pr.IMMERSIVE:return window.innerWidth*n}}(this._stageMode),function(t){var e;const n=null!==(e=window.devicePixelRatio)&&void 0!==e?e:1;switch(t){case Pr.DEFAULT:return 720;case Pr.SMALL:return 450;case Pr.IMMERSIVE:return window.innerHeight*n}}(this._stageMode));this._stage.registerShapes(e.shapes,this._world.backgroundColor),Q(this._config.data.worldTick).pipe(dt(this._abortWorldTick$)).subscribe({next:()=>{var t;null===(t=this._world)||void 0===t||t.tick()},complete:()=>{console.log("Old world completed - unregistering shapes"),this._stage.unregisterShapes(e.shapes.id)}})}createWorldById(t){switch(t){case 1:return new ts;case 2:return new is;case 3:return new Kr;case 4:return new Lr;case 5:return new Yr;case 6:return new es;case 7:return new Gr;case 8:return new po;case 9:return new Fr;case 0:return new Hr;default:return console.error("Unnown world id",t),new ts}}updateWorldTitle(t){null!=this._worldTitleArea&&(this._worldTitleArea.textContent=`World: ${t} (${this._config.data.currentWorldId})`)}updateCameraInfo(){this._camera.state$.subscribe({next:t=>{const e=`Perspective: Position (X ${(n=t).position.x.toFixed(1)}, Y ${n.position.y.toFixed(1)}, Z ${n.position.z.toFixed(1)}), Angle-X ${(180*n.angleX/Math.PI).toFixed(0)}, Angle-Y ${(180*n.angleY/Math.PI).toFixed(0)}, Angle-Z ${(180*n.angleZ/Math.PI).toFixed(0)})`;var n;null!=this._cameraInfoArea&&(this._cameraInfoArea.textContent=e)}})}}})();