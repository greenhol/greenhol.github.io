(()=>{"use strict";var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function n(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function r(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function i(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function s(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function o(t){return this instanceof o?(this.v=t,this):new o(t)}function a(t){return"function"==typeof t}function l(t){var e=t(function(t){Error.call(t),t.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}Object.create,Object.create;var u=l(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}});function c(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var h=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,n,o,l;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var h=r(c),d=h.next();!d.done;d=h.next())d.value.remove(this)}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}else c.remove(this);var f=this.initialTeardown;if(a(f))try{f()}catch(t){l=t instanceof u?t.errors:[t]}var y=this._finalizers;if(y){this._finalizers=null;try{for(var v=r(y),g=v.next();!g.done;g=v.next()){var m=g.value;try{p(m)}catch(t){l=null!=l?l:[],t instanceof u?l=s(s([],i(l)),i(t.errors)):l.push(t)}}}catch(t){n={error:t}}finally{try{g&&!g.done&&(o=v.return)&&o.call(v)}finally{if(n)throw n.error}}}if(l)throw new u(l)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)p(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&c(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&c(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t;var e}(),d=h.EMPTY;function f(t){return t instanceof h||t&&"closed"in t&&a(t.remove)&&a(t.add)&&a(t.unsubscribe)}function p(t){a(t)?t():t.unsubscribe()}var y=null,v=null,g=void 0,m=!1,_=!1,w={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=w.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,s([t,e],i(n))):setTimeout.apply(void 0,s([t,e],i(n)))},clearTimeout:function(t){var e=w.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function b(t){w.setTimeout(function(){if(!y)throw t;y(t)})}function x(){}var k=S("C",void 0,void 0);function S(t,e,n){return{kind:t,value:e,error:n}}var E=null;function C(t){if(m){var e=!E;if(e&&(E={errorThrown:!1,error:null}),t(),e){var n=E,r=n.errorThrown,i=n.error;if(E=null,r)throw i}}else t()}var A=function(t){function n(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,f(e)&&e.add(n)):n.destination=L,n}return e(n,t),n.create=function(t,e,n){return new I(t,e,n)},n.prototype.next=function(t){this.isStopped?O(function(t){return S("N",t,void 0)}(t),this):this._next(t)},n.prototype.error=function(t){this.isStopped?O(S("E",void 0,t),this):(this.isStopped=!0,this._error(t))},n.prototype.complete=function(){this.isStopped?O(k,this):(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},n.prototype._next=function(t){this.destination.next(t)},n.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},n.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},n}(h),M=Function.prototype.bind;function $(t,e){return M.call(t,e)}var T=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){P(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){P(t)}else P(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){P(t)}},t}(),I=function(t){function n(e,n,r){var i,s,o=t.call(this)||this;return a(e)||!e?i={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:o&&_?((s=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},i={next:e.next&&$(e.next,s),error:e.error&&$(e.error,s),complete:e.complete&&$(e.complete,s)}):i=e,o.destination=new T(i),o}return e(n,t),n}(A);function P(t){var e;m?(e=t,m&&E&&(E.errorThrown=!0,E.error=e)):b(t)}function O(t,e){var n=v;n&&w.setTimeout(function(){return n(t,e)})}var L={closed:!0,next:x,error:function(t){throw t},complete:x},N="function"==typeof Symbol&&Symbol.observable||"@@observable";function z(t){return t}var W=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r,i=this,s=(r=t)&&r instanceof A||function(t){return t&&a(t.next)&&a(t.error)&&a(t.complete)}(r)&&f(r)?t:new I(t,e,n);return C(function(){var t=i,e=t.operator,n=t.source;s.add(e?e.call(s,n):n?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=D(e))(function(e,r){var i=new I({next:function(e){try{t(e)}catch(t){r(t),i.unsubscribe()}},error:r,complete:e});n.subscribe(i)})},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[N]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0===(n=t).length?z:1===n.length?n[0]:function(t){return n.reduce(function(t,e){return e(t)},t)})(this);var n},t.prototype.toPromise=function(t){var e=this;return new(t=D(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}();function D(t){var e;return null!==(e=null!=t?t:g)&&void 0!==e?e:Promise}var R=l(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),j=function(t){function n(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(n,t),n.prototype.lift=function(t){var e=new V(this,this);return e.operator=t,e},n.prototype._throwIfClosed=function(){if(this.closed)throw new R},n.prototype.next=function(t){var e=this;C(function(){var n,i;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var s=r(e.currentObservers),o=s.next();!o.done;o=s.next())o.value.next(t)}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}}})},n.prototype.error=function(t){var e=this;C(function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}})},n.prototype.complete=function(){var t=this;C(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},n.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(n.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),n.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},n.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},n.prototype._innerSubscribe=function(t){var e=this,n=this,r=n.hasError,i=n.isStopped,s=n.observers;return r||i?d:(this.currentObservers=null,s.push(t),new h(function(){e.currentObservers=null,c(s,t)}))},n.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,r=e.thrownError,i=e.isStopped;n?t.error(r):i&&t.complete()},n.prototype.asObservable=function(){var t=new W;return t.source=this,t},n.create=function(t,e){return new V(t,e)},n}(W),V=function(t){function n(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return e(n,t),n.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},n.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},n.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},n.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:d},n}(j),H=function(t){function n(e){var n=t.call(this)||this;return n._value=e,n}return e(n,t),Object.defineProperty(n.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),n.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return!n.closed&&e.next(this._value),n},n.prototype.getValue=function(){var t=this,e=t.hasError,n=t.thrownError,r=t._value;if(e)throw n;return this._throwIfClosed(),r},n.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},n}(j),F=function(t){function n(e,n){return t.call(this)||this}return e(n,t),n.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},n}(h),B={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=B.delegate;return(null==o?void 0:o.setInterval)?o.setInterval.apply(o,s([t,e],i(n))):setInterval.apply(void 0,s([t,e],i(n)))},clearInterval:function(t){var e=B.delegate;return((null==e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},X=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return e(n,t),n.prototype.schedule=function(t,e){var n;if(void 0===e&&(e=0),this.closed)return this;this.state=t;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,e)),this.pending=!0,this.delay=e,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,e),this},n.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),B.setInterval(t.flush.bind(t,this),n)},n.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return e;null!=e&&B.clearInterval(e)},n.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},n.prototype._execute=function(t,e){var n,r=!1;try{this.work(t)}catch(t){r=!0,n=t||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},n.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,c(r,this),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},n}(F),Z={now:function(){return(Z.delegate||Date).now()},delegate:void 0},G=function(){function t(e,n){void 0===n&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(n,e)},t.now=Z.now,t}(),Y=function(t){function n(e,n){void 0===n&&(n=G.now);var r=t.call(this,e,n)||this;return r.actions=[],r._active=!1,r}return e(n,t),n.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},n}(G),K=new Y(X),U=K;function q(t){return t&&a(t.schedule)}function J(t,e,n){void 0===t&&(t=0),void 0===n&&(n=U);var r=-1;return null!=e&&(q(e)?n=e:r=e),new W(function(e){var i,s=(i=t)instanceof Date&&!isNaN(i)?+t-n.now():t;s<0&&(s=0);var o=0;return n.schedule(function(){e.closed||(e.next(o++),0<=r?this.schedule(void 0,r):e.complete())},s)})}function Q(t,e){return void 0===t&&(t=0),void 0===e&&(e=K),t<0&&(t=0),J(t,t,e)}function tt(t){return function(e){if(function(t){return a(null==t?void 0:t.lift)}(e))return e.lift(function(e){try{return t(e,this)}catch(t){this.error(t)}});throw new TypeError("Unable to lift unknown Observable type")}}function et(t,e,n,r,i){return new nt(t,e,n,r,i)}var nt=function(t){function n(e,n,r,i,s,o){var a=t.call(this,e)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=n?function(t){try{n(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=i?function(t){try{i(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=r?function(){try{r()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return e(n,t),n.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},n}(A),rt=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function it(t){return a(null==t?void 0:t.then)}function st(t){return a(t[N])}function ot(t){return Symbol.asyncIterator&&a(null==t?void 0:t[Symbol.asyncIterator])}function at(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var lt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ut(t){return a(null==t?void 0:t[lt])}function ct(t){return function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),s=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){i[t]&&(r[t]=function(e){return new Promise(function(n,r){s.push([t,e,n,r])>1||l(t,e)})})}function l(t,e){try{(n=i[t](e)).value instanceof o?Promise.resolve(n.value.v).then(u,c):h(s[0][2],n)}catch(t){h(s[0][3],t)}var n}function u(t){l("next",t)}function c(t){l("throw",t)}function h(t,e){t(e),s.shift(),s.length&&l(s[0][0],s[0][1])}}(this,arguments,function(){var e,r,i;return n(this,function(n){switch(n.label){case 0:e=t.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,o(e.read())];case 3:return r=n.sent(),i=r.value,r.done?[4,o(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,o(i)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function ht(t){return a(null==t?void 0:t.getReader)}function dt(t){if(t instanceof W)return t;if(null!=t){if(st(t))return s=t,new W(function(t){var e=s[N]();if(a(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(rt(t))return e=t,new W(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()});if(it(t))return i=t,new W(function(t){i.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,b)});if(ot(t))return ft(t);if(ut(t))return n=t,new W(function(t){var e,i;try{for(var s=r(n),o=s.next();!o.done;o=s.next()){var a=o.value;if(t.next(a),t.closed)return}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}t.complete()});if(ht(t))return ft(ct(t))}var e,n,i,s;throw at(t)}function ft(t){return new W(function(e){(function(t,e){var i,s,o,a,l,u,c,h;return l=this,u=void 0,h=function(){var l,u;return n(this,function(n){switch(n.label){case 0:n.trys.push([0,5,6,11]),i=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=r(t),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise(function(r,i){!function(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)}(r,i,(e=t[n](e)).done,e.value)})}}}(t),n.label=1;case 1:return[4,i.next()];case 2:if((s=n.sent()).done)return[3,4];if(l=s.value,e.next(l),e.closed)return[2];n.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=n.sent(),o={error:u},[3,11];case 6:return n.trys.push([6,,9,10]),s&&!s.done&&(a=i.return)?[4,a.call(i)]:[3,8];case 7:n.sent(),n.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})},new((c=void 0)||(c=Promise))(function(t,e){function n(t){try{i(h.next(t))}catch(t){e(t)}}function r(t){try{i(h.throw(t))}catch(t){e(t)}}function i(e){var i;e.done?t(e.value):(i=e.value,i instanceof c?i:new c(function(t){t(i)})).then(n,r)}i((h=h.apply(l,u||[])).next())})})(t,e).catch(function(t){return e.error(t)})})}function pt(t){return tt(function(e,n){dt(t).subscribe(et(n,function(){return n.complete()},x)),!n.closed&&e.subscribe(n)})}class yt{constructor(t,e="",n="local"){this._initialConfig=t,this._storageKey=e,this._persistable=!!e,this._storageType=n,this.load()||(this.data=Object.assign({},this._initialConfig)),this.init()}init(){null==window.zetaConfig&&(window.zetaConfig=[]),null==window.zetaConfigCtrl&&(window.zetaConfigCtrl=[]),window.zetaConfig[this._storageKey]=this.data,window.zetaConfigCtrl[this._storageKey]=this,window.addEventListener("beforeunload",()=>{this.save()})}save(){this._persistable?(("local"===this._storageType?localStorage:sessionStorage).setItem(this._storageKey,JSON.stringify(this.data)),console.log(`Configuration ${this._storageKey} saved to ${this._storageType}`)):console.log(`Configuration ${this._storageKey} not persistable`)}load(){if(!this._persistable)return!1;{const t=("local"===this._storageType?localStorage:sessionStorage).getItem(this._storageKey);if(!t)return console.log(`No Configuration ${this._storageKey} found in ${this._storageType}`),!1;try{return this.data=JSON.parse(t),console.log(`Configuration ${this._storageKey} loaded from ${this._storageType}`),!0}catch(t){return console.error("Error loading configuration ${this._storageKey}:",t),!1}}}clear(){("local"===this._storageType?localStorage:sessionStorage).removeItem(this._storageKey),console.log(`Configuration ${this._storageKey} cleared from ${this._storageType}`)}print(){console.log("Current configuration ${this._storageKey}:",this.data)}reset(){this.data=Object.assign({},this._initialConfig),console.log(`Configuration ${this._storageKey} reset ${JSON.stringify(this.data)}`)}}const vt=Math.PI/180;function gt(){return{position:{x:0,y:0,z:-7.5},angleX:45*vt,angleY:45*vt,angleZ:0*vt}}class mt{constructor(){this.state$=new H(gt())}get position(){return this.state$.getValue().position}get angleX(){return this.state$.getValue().angleX}get angleY(){return this.state$.getValue().angleY}get angleZ(){return this.state$.getValue().angleZ}moveX(t){const e=structuredClone(this.state$.getValue());e.position.x+=t,this.state$.next(e)}moveY(t){const e=structuredClone(this.state$.getValue());e.position.y+=t,this.state$.next(e)}moveZ(t){const e=structuredClone(this.state$.getValue());e.position.z+=t,this.state$.next(e)}rotateX(t){const e=structuredClone(this.state$.getValue());e.angleX+=t,this.state$.next(e)}rotateY(t){const e=structuredClone(this.state$.getValue());e.angleY+=t,this.state$.next(e)}rotateZ(t){const e=structuredClone(this.state$.getValue());e.angleZ+=t,this.state$.next(e)}mountCamera(t){const e=structuredClone(t);this.state$.next(e)}}var _t;!function(t){t.W="w",t.A="a",t.S="s",t.D="d",t.R="r",t.F="f",t.Up="ArrowUp",t.Left="ArrowLeft",t.Down="ArrowDown",t.Right="ArrowRight",t.Comma=",",t.Dot="."}(_t||(_t={}));class wt{constructor(t){this._camera=t}onNextEvent(t){switch(t){case _t.W:return this._camera.moveZ(.1),!0;case _t.A:return this._camera.moveX(-.1),!0;case _t.S:return this._camera.moveZ(-.1),!0;case _t.D:return this._camera.moveX(.1),!0;case _t.R:return this._camera.moveY(.1),!0;case _t.F:return this._camera.moveY(-.1),!0;case _t.Up:return this._camera.rotateX(vt),!0;case _t.Left:return this._camera.rotateY(vt),!0;case _t.Down:return this._camera.rotateX(-vt),!0;case _t.Right:return this._camera.rotateY(-vt),!0;case _t.Comma:return this._camera.rotateZ(-vt),!0;case _t.Dot:return this._camera.rotateZ(vt),!0;default:return!1}}}class bt{constructor(){this._listeners=new Map,this._animationClassName="physical-key-pressed-detected",this._animationEndEvent="animationend"}triggerAnimation(t){const e=this.getElementFromKeyValue(t);if(null!=e){const t=()=>{e.classList.remove(this._animationClassName),this._listeners.delete(e)};this.cleanupListener(e),e.classList.remove(this._animationClassName),e.offsetWidth,e.classList.add(this._animationClassName),e.addEventListener(this._animationEndEvent,t,{once:!0}),this._listeners.set(e,t)}}cleanupAll(){this._listeners.forEach((t,e)=>{e.removeEventListener(this._animationEndEvent,t)}),this._listeners.clear()}cleanupListener(t){const e=this._listeners.get(t);e&&(t.removeEventListener(this._animationEndEvent,e),this._listeners.delete(t))}getElementFromKeyValue(t){switch(t){case _t.W:case _t.A:case _t.S:case _t.D:case _t.R:case _t.F:case _t.Up:case _t.Left:case _t.Down:case _t.Right:return document.getElementById(`virtual-key-${t}`);case _t.Comma:return document.getElementById("virtual-key-Comma");case _t.Dot:return document.getElementById("virtual-key-Period");case"Escape":return document.getElementById("virtual-key-Escape");default:return null}}}var xt=new W(function(t){return t.complete()}),kt=Array.isArray,St=Object.getPrototypeOf,Et=Object.prototype,Ct=Object.keys;function At(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function Mt(t,e){return void 0===e&&(e=0),tt(function(n,r){n.subscribe(et(r,function(n){return At(r,t,function(){return r.next(n)},e)},function(){return At(r,t,function(){return r.complete()},e)},function(n){return At(r,t,function(){return r.error(n)},e)}))})}function $t(t,e){return void 0===e&&(e=0),tt(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function Tt(t,e){if(!t)throw new Error("Iterable cannot be null");return new W(function(n){At(n,e,function(){var r=t[Symbol.asyncIterator]();At(n,e,function(){r.next().then(function(t){t.done?n.complete():n.next(t.value)})},0,!0)})})}function It(t,e){return e?function(t,e){if(null!=t){if(st(t))return function(t,e){return dt(t).pipe($t(e),Mt(e))}(t,e);if(rt(t))return function(t,e){return new W(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}(t,e);if(it(t))return function(t,e){return dt(t).pipe($t(e),Mt(e))}(t,e);if(ot(t))return Tt(t,e);if(ut(t))return function(t,e){return new W(function(n){var r;return At(n,e,function(){r=t[lt](),At(n,e,function(){var t,e,i;try{e=(t=r.next()).value,i=t.done}catch(t){return void n.error(t)}i?n.complete():n.next(e)},0,!0)}),function(){return a(null==r?void 0:r.return)&&r.return()}})}(t,e);if(ht(t))return function(t,e){return Tt(ct(t),e)}(t,e)}throw at(t)}(t,e):dt(t)}function Pt(t,e){return tt(function(n,r){var i=0;n.subscribe(et(r,function(n){r.next(t.call(e,n,i++))}))})}var Ot,Lt=Array.isArray;function Nt(t){return Pt(function(e){return function(t,e){return Lt(e)?t.apply(void 0,s([],i(e))):t(e)}(t,e)})}function zt(t){return t[t.length-1]}function Wt(t){return q(zt(t))?t.pop():void 0}function Dt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Wt(t),r=function(t){return a(zt(t))?t.pop():void 0}(t),i=function(t){if(1===t.length){var e=t[0];if(kt(e))return{args:e,keys:null};if((r=e)&&"object"==typeof r&&St(r)===Et){var n=Ct(e);return{args:n.map(function(t){return e[t]}),keys:n}}}var r;return{args:t,keys:null}}(t),s=i.args,o=i.keys;if(0===s.length)return It([],n);var l=new W(function(t,e,n){return void 0===n&&(n=z),function(r){Rt(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,l=function(i){Rt(e,function(){var l=It(t[i],e),u=!1;l.subscribe(et(r,function(t){s[i]=t,u||(u=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},u=0;u<i;u++)l(u)},r)}}(s,n,o?function(t){return function(t,e){return t.reduce(function(t,n,r){return t[n]=e[r],t},{})}(o,t)}:z));return r?l.pipe(Nt(r)):l}function Rt(t,e,n){t?At(n,t,e):e()}!function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"}(Ot||(Ot={}));class jt{constructor(){this.m=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}static multiply(t,e){let n=new jt;for(let r=0;r<jt.SIZE;r++)for(let i=0;i<jt.SIZE;i++)for(let s=0;s<jt.SIZE;s++)n.m[r][i]+=t.m[r][s]*e.m[s][i];return n}get det(){let t=this.m;return t[0][0]*t[1][1]*t[2][2]*t[3][3]+t[0][0]*t[1][2]*t[2][3]*t[3][1]+t[0][0]*t[1][3]*t[2][1]*t[3][2]+t[0][1]*t[1][0]*t[2][3]*t[3][2]+t[0][1]*t[1][2]*t[2][0]*t[3][3]+t[0][1]*t[1][3]*t[2][2]*t[3][0]+t[0][2]*t[1][0]*t[2][1]*t[3][3]+t[0][2]*t[1][1]*t[2][3]*t[3][0]+t[0][2]*t[1][3]*t[2][0]*t[3][1]+t[0][3]*t[1][0]*t[2][2]*t[3][1]+t[0][3]*t[1][1]*t[2][0]*t[3][2]+t[0][3]*t[1][2]*t[2][1]*t[3][0]-t[0][0]*t[1][1]*t[2][3]*t[3][2]-t[0][0]*t[1][2]*t[2][1]*t[3][3]-t[0][0]*t[1][3]*t[2][2]*t[3][1]-t[0][1]*t[1][0]*t[2][2]*t[3][3]-t[0][1]*t[1][2]*t[2][3]*t[3][0]-t[0][1]*t[1][3]*t[2][0]*t[3][2]-t[0][2]*t[1][0]*t[2][3]*t[3][1]-t[0][2]*t[1][1]*t[2][0]*t[3][3]-t[0][2]*t[1][3]*t[2][1]*t[3][0]-t[0][3]*t[1][0]*t[2][1]*t[3][2]-t[0][3]*t[1][1]*t[2][2]*t[3][0]-t[0][3]*t[1][2]*t[2][0]*t[3][1]}get inv(){let t=this.det;if(!t)return null;let e=this.m,n=new jt;return n.m[0][0]=e[1][1]*e[2][2]*e[3][3]+e[1][2]*e[2][3]*e[3][1]+e[1][3]*e[2][1]*e[3][2]-e[1][1]*e[2][3]*e[3][2]-e[1][2]*e[2][1]*e[3][3]-e[1][3]*e[2][2]*e[3][1],n.m[0][1]=e[0][1]*e[2][3]*e[3][2]+e[0][2]*e[2][1]*e[3][3]+e[0][3]*e[2][2]*e[3][1]-e[0][1]*e[2][2]*e[3][3]-e[0][2]*e[2][3]*e[3][1]-e[0][3]*e[2][1]*e[3][2],n.m[0][2]=e[0][1]*e[1][2]*e[3][3]+e[0][2]*e[1][3]*e[3][1]+e[0][3]*e[1][1]*e[3][2]-e[0][1]*e[1][3]*e[3][2]-e[0][2]*e[1][1]*e[3][3]-e[0][3]*e[1][2]*e[3][1],n.m[0][3]=e[0][1]*e[1][3]*e[2][2]+e[0][2]*e[1][1]*e[2][3]+e[0][3]*e[1][2]*e[2][1]-e[0][1]*e[1][2]*e[2][3]-e[0][2]*e[1][3]*e[2][1]-e[0][3]*e[1][1]*e[2][2],n.m[1][0]=e[1][0]*e[2][3]*e[3][2]+e[1][2]*e[2][0]*e[3][3]+e[1][3]*e[2][2]*e[3][0]-e[1][0]*e[2][2]*e[3][3]-e[1][2]*e[2][3]*e[3][0]-e[1][3]*e[2][0]*e[3][2],n.m[1][1]=e[0][0]*e[2][2]*e[3][3]+e[0][2]*e[2][3]*e[3][0]+e[0][3]*e[2][0]*e[3][2]-e[0][0]*e[2][3]*e[3][2]-e[0][2]*e[2][0]*e[3][3]-e[0][3]*e[2][2]*e[3][0],n.m[1][2]=e[0][0]*e[1][3]*e[3][2]+e[0][2]*e[1][0]*e[3][3]+e[0][3]*e[1][2]*e[3][0]-e[0][0]*e[1][2]*e[3][3]-e[0][2]*e[1][3]*e[3][0]-e[0][3]*e[1][0]*e[3][2],n.m[1][3]=e[0][0]*e[1][2]*e[2][3]+e[0][2]*e[1][3]*e[2][0]+e[0][3]*e[1][0]*e[2][2]-e[0][0]*e[1][3]*e[2][2]-e[0][2]*e[1][0]*e[2][3]-e[0][3]*e[1][2]*e[2][0],n.m[2][0]=e[1][0]*e[2][1]*e[3][3]+e[1][1]*e[2][3]*e[3][0]+e[1][3]*e[2][0]*e[3][1]-e[1][0]*e[2][3]*e[3][1]-e[1][1]*e[2][0]*e[3][3]-e[1][3]*e[2][1]*e[3][0],n.m[2][1]=e[0][0]*e[2][3]*e[3][1]+e[0][1]*e[2][0]*e[3][3]+e[0][3]*e[2][1]*e[3][0]-e[0][0]*e[2][1]*e[3][3]-e[0][1]*e[2][3]*e[3][0]-e[0][3]*e[2][0]*e[3][1],n.m[2][2]=e[0][0]*e[1][1]*e[3][3]+e[0][1]*e[1][3]*e[3][0]+e[0][3]*e[1][0]*e[3][1]-e[0][0]*e[1][3]*e[3][1]-e[0][1]*e[1][0]*e[3][3]-e[0][3]*e[1][1]*e[3][0],n.m[2][3]=e[0][0]*e[1][3]*e[2][1]+e[0][1]*e[1][0]*e[2][3]+e[0][3]*e[1][1]*e[2][0]-e[0][0]*e[1][1]*e[2][3]-e[0][1]*e[1][3]*e[2][0]-e[0][3]*e[1][0]*e[2][1],n.m[3][0]=e[1][0]*e[2][2]*e[3][1]+e[1][1]*e[2][0]*e[3][2]+e[1][2]*e[2][1]*e[3][0]-e[1][0]*e[2][1]*e[3][2]-e[1][1]*e[2][2]*e[3][0]-e[1][2]*e[2][0]*e[3][1],n.m[3][1]=e[0][0]*e[2][1]*e[3][2]+e[0][1]*e[2][2]*e[3][0]+e[0][2]*e[2][0]*e[3][1]-e[0][0]*e[2][2]*e[3][1]-e[0][1]*e[2][0]*e[3][2]-e[0][2]*e[2][1]*e[3][0],n.m[3][2]=e[0][0]*e[1][2]*e[3][1]+e[0][1]*e[1][0]*e[3][2]+e[0][2]*e[1][1]*e[3][0]-e[0][0]*e[1][1]*e[3][2]-e[0][1]*e[1][2]*e[3][0]-e[0][2]*e[1][0]*e[3][1],n.m[3][3]=e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[1][0]*e[2][1]-e[0][0]*e[1][2]*e[2][1]-e[0][1]*e[1][0]*e[2][2]-e[0][2]*e[1][1]*e[2][0],n.scalarMultiply(1/t),n}scalarMultiply(t){for(let e=0;e<jt.SIZE;e++)for(let n=0;n<jt.SIZE;n++)this.m[e][n]*=t}vector3Multiply(t){let e,n=[t.x,t.y,t.z,1],r=[];for(let t=0;t<jt.SIZE;t++){e=0;for(let r=0;r<jt.SIZE;r++)e+=this.m[t][r]*n[r];r.push(e)}return{x:r[0],y:r[1],z:r[2]}}vector4Multiply(t){let e,n=[t.x,t.y,t.z,t.u],r=[];for(let t=0;t<jt.SIZE;t++){e=0;for(let r=0;r<jt.SIZE;r++)e+=this.m[t][r]*n[r];r.push(e)}return{x:r[0],y:r[1],z:r[2],u:r[3]}}log(){let t="";for(let e=0;e<jt.SIZE;e++){for(let n=0;n<jt.SIZE;n++)t+=this.m[e][n].toFixed(5)+" ";t+="\n"}console.log(t)}}jt.SIZE=4;class Vt extends jt{constructor(){super();for(let t=0;t<jt.SIZE;t++)this.m[t][t]=1}}class Ht extends Vt{constructor(t,e){super(),this.axis=t,this.angle=e}set angle(t){const e=Math.cos(t),n=Math.sin(t);switch(this.axis){case Ot.X:this.m[1][1]=e,this.m[1][2]=-n,this.m[2][1]=n,this.m[2][2]=e;break;case Ot.Y:this.m[0][0]=e,this.m[0][2]=n,this.m[2][0]=-n,this.m[2][2]=e;break;case Ot.Z:this.m[0][0]=e,this.m[0][1]=-n,this.m[1][0]=n,this.m[1][1]=e}}}class Ft extends Vt{constructor(t){super(),this.vector=t}set vector(t){this.m[0][3]=t.x,this.m[1][3]=t.y,this.m[2][3]=t.z}set x(t){this.m[0][3]=t}set y(t){this.m[1][3]=t}set z(t){this.m[2][3]=t}}class Bt{constructor(t,e){this.list=new Set,this.partSize=t,this.parts=e}newId(t){let e=this.createCandidate(t),n=0;for(;this.exists(e);)if(console.warn(`Candidate ${e} already exists. Retry.`),e=this.createCandidate(t),n++,n>10)return console.error("Could not create a unique id, returning empty string",this.list),"";return this.list.add(e),e}generateSyllable(){return Bt.CONSONANTS[Math.floor(Math.random()*Bt.CONSONANTS.length)]+Bt.VOWELS[Math.floor(Math.random()*Bt.VOWELS.length)]}createCandidate(t){for(let e=0;e<this.parts;e++)t+=`_${this.createPart()}`;return t}createPart(){return[...Array(this.partSize).keys()].map(()=>this.generateSyllable()).join("")}exists(t){return this.list.has(t)}}Bt.CONSONANTS="BCDFGHJKLMNPQRSTVWXYZ",Bt.VOWELS="AEIOU";const Xt=new Bt(2,2);var Zt,Gt;!function(t){t.GROUP="GROUP",t.CIRCLE="CIRCLE",t.RECTANGLE="RECTANGLE",t.PATH="PATH",t.TEXT="TEXT"}(Zt||(Zt={}));class Yt{constructor(t){this._dist=0,this._index=0,this._visible=t}set dist(t){this._dist=t}get dist(){return this._dist}set index(t){this._index=t}get index(){return this._index}set visible(t){this._visible=t}set inView(t){this._inView=t}isHidden(){return!this._visible||!this._inView}}class Kt extends Yt{constructor(t,e,n,r,i,s){super(s),this.id=Xt.newId(Zt.CIRCLE),this.type=Zt.CIRCLE,this.attr={cx:t,cy:e,r:n},this.dist=r,this.style=i}setPosition(t,e,n){this.attr.cx=t,this.attr.cy=e,this.attr.r=n}}class Ut{constructor(t){this._visible=t}set visible(t){this._visible=t}get visible(){return this._visible}}class qt extends Ut{constructor(t,e=1,n=function(){return te().get()}(),r=!0){super(r),this.type=Zt.CIRCLE,this.position=t,this.radius=e,this.style=n}get position(){return this._position}set position(t){this._position=t}get radius(){return this._radius}set radius(t){this._radius=t}get style(){return this._style}set style(t){this._style=t}get attributes(){return{visible:this.visible,type:this.type,position:structuredClone(this._position),radius:this._radius,style:structuredClone(this._style)}}}class Jt{get(){return this._style}}class Qt extends Jt{constructor(){super(),this._style={strokeWidth:.15,stroke:"#aaa",strokeOpacity:1,fill:"#ddd",fillOpacity:1}}strokeWidth(t){return this._style.strokeWidth=t,this}stroke(t){return this._style.stroke=t,this}strokeOpacity(t){return this._style.strokeOpacity=t,this}fill(t){return this._style.fill=t,this}fillOpacity(t){return this._style.fillOpacity=t,this}}function te(){return new Qt}!function(t){t.DISTANCE="DISTANCE",t.INDEX="INDEX"}(Gt||(Gt={}));class ee extends Yt{constructor(t,e,n,r){super(r),this.id=Xt.newId(Zt.GROUP),this.type=Zt.GROUP,this.attr={children:t,sortBy:e},this.dist=n}get children(){return this.attr.children}set sortBy(t){this.attr.sortBy=t}}class ne extends Ut{constructor(t,e,n=Gt.DISTANCE,r=!0){super(r),this.type=Zt.GROUP,this.position=t,this._children=e,this._sortBy=n}get position(){return this._position}set position(t){this._position=t}get children(){return this._children}set children(t){this._children=t}get attributes(){return{visible:this.visible,type:this.type,position:structuredClone(this._position),children:structuredClone(this._children.map(t=>t.attributes)),sortBy:this._sortBy}}}class re extends Yt{constructor(t,e,n,r){super(r),this.id=Xt.newId(Zt.PATH),this.type=Zt.PATH,this.attr={d:t},this.dist=e,this.style=n}setPath(t){this.attr.d=t}}class ie extends Ut{constructor(t,e=!1,n=!1,r=function(){return oe().get()}(),i=!0){super(i),this.type=Zt.PATH,this.path=t,this._close=e,this._lockStrokeWidth=n,this.style=r}get path(){return this._path}set path(t){this._path=t}get style(){return this._style}set style(t){this._style=t}get attributes(){return{visible:this.visible,type:this.type,path:structuredClone(this._path),close:this._close,lockStrokeWidth:this._lockStrokeWidth,style:structuredClone(this._style)}}}class se extends Jt{constructor(){super(),this._style={strokeWidth:1.5,stroke:"#aaa",strokeOpacity:1,strokeLinecap:"butt",strokeLinejoin:"miter"}}strokeWidth(t){return this._style.strokeWidth=t,this}stroke(t){return this._style.stroke=t,this}strokeOpacity(t){return this._style.strokeOpacity=t,this}strokeLinecap(t){return this._style.strokeLinecap=t,this}strokeLinejoin(t){return this._style.strokeLinejoin=t,this}}function oe(){return new se}class ae extends Yt{constructor(t,e,n,r){super(r),this.id=Xt.newId(Zt.RECTANGLE),this.type=Zt.RECTANGLE,this.attr={d:t},this.dist=e,this.style=n}setPath(t){this.attr.d=t}}class le{constructor(){this.m=[[0,0,0],[0,0,0],[0,0,0]]}static multiply(t,e){let n=new le;for(let r=0;r<le.SIZE;r++)for(let i=0;i<le.SIZE;i++)for(let s=0;s<le.SIZE;s++)n.m[r][i]+=t.m[r][s]*e.m[s][i];return n}scalarMultiply(t){for(let e=0;e<le.SIZE;e++)for(let n=0;n<le.SIZE;n++)this.m[e][n]*=t}vector3Multiply(t){let e,n=[t.x,t.y,t.z,1],r=[];for(let t=0;t<le.SIZE;t++){e=0;for(let r=0;r<le.SIZE;r++)e+=this.m[t][r]*n[r];r.push(e)}return{x:r[0],y:r[1],z:r[2]}}log(){let t="";for(let e=0;e<le.SIZE;e++){for(let n=0;n<le.SIZE;n++)t+=this.m[e][n].toFixed(5)+" ";t+="\n"}console.log(t)}}function ue(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}}le.SIZE=3;var ce=function(t){function n(e,n,r){void 0===e&&(e=1/0),void 0===n&&(n=1/0),void 0===r&&(r=Z);var i=t.call(this)||this;return i._bufferSize=e,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,e),i._windowTime=Math.max(1,n),i}return e(n,t),n.prototype.next=function(e){var n=this,r=n.isStopped,i=n._buffer,s=n._infiniteTimeWindow,o=n._timestampProvider,a=n._windowTime;r||(i.push(e),!s&&i.push(o.now()+a)),this._trimBuffer(),t.prototype.next.call(this,e)},n.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(t),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!t.closed;i+=n?1:2)t.next(r[i]);return this._checkFinalizedStatuses(t),e},n.prototype._trimBuffer=function(){var t=this,e=t._bufferSize,n=t._timestampProvider,r=t._buffer,i=t._infiniteTimeWindow,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){for(var o=n.now(),a=0,l=1;l<r.length&&r[l]<=o;l+=2)a=l;a&&r.splice(0,a+1)}},n}(j);class he{constructor(t,e){this._collection$=new ce(1),this.collection$=this._collection$,this.id=Xt.newId(t),this._collection=e,this.emitList()}update(t){t(this._collection),this.emitList()}emitList(){this._collection$.next(this._collection)}}class de extends Yt{constructor(t,e,n,r,i,s){super(s),this.id=Xt.newId(Zt.TEXT),this.type=Zt.TEXT,this.attr={x:t,y:e,text:n},this.dist=r,this.style=i}setPosition(t,e){this.attr.x=t,this.attr.y=e}setText(t){this.attr.text=t}}class fe{constructor(t,e,n,r,i){var s,o,a;this._stageWidthHalf=n/2,this._stageHeightHalf=r/2,this._stageRatioInverted=r/n,this._stageNear=1,this._stageFar=30,this._elementStageSizeFactor=r/720,this._world=t,this._camera=e,this._world.state$.pipe(tt(function(t,e){var n=0;t.subscribe(et(e,function(t){++n<=1&&(e.next(t),1<=n&&e.complete())}))})).subscribe(t=>{this.createShapes(this.createData(t))}),Dt([this._world.state$,this._camera.state$]).pipe((s=i,void 0===o&&(o=K),a=Q(s,o),tt(function(t,e){var n=!1,r=null;t.subscribe(et(e,function(t){n=!0,r=t})),dt(a).subscribe(et(e,function(){if(n){n=!1;var t=r;r=null,e.next(t)}},x))}))).subscribe(t=>{this.updateShapes(this.createData(t[0]))})}get shapes(){return this._shapes}createData(t){const e=new Ht(Ot.X,this._camera.angleX),n=new Ht(Ot.Y,this._camera.angleY),r=new Ht(Ot.Z,this._camera.angleZ),i=new Ft(this._camera.position);let s=new Vt;return s=jt.multiply(s,r),s=jt.multiply(s,n),s=jt.multiply(s,e),s=jt.multiply(s,i),s=s.inv,{groups:t.groups.map(t=>{let e=s.vector3Multiply(t.position);const n=[];return t.children.forEach((e,r)=>{switch(e.type){case Zt.CIRCLE:n.push({child:this.projectCircle(this.translateCircle(e,t.position),s),index:r});break;case Zt.PATH:n.push({child:this.projectPath(this.translatePath(e,t.position),s),index:r})}}),{visible:t.visible,type:t.type,children:t.children,sortBy:t.sortBy,projectedChildren:n,dist:this.distanceToCamera(e),position:t.position}}),circles:t.circles.map(t=>this.projectCircle(t,s)),paths:t.paths.map(t=>this.projectPath(t,s)),rectangles:t.rectangles.map(t=>this.projectRectangle(t,s)),texts:t.texts.map(t=>this.projectText(t,s))}}translateCircle(t,e){return{visible:t.visible,type:t.type,position:ue(t.position,e),radius:t.radius,style:t.style}}translatePath(t,e){return{visible:t.visible,type:t.type,path:t.path.map(t=>ue(t,e)),close:t.close,lockStrokeWidth:t.lockStrokeWidth,style:t.style}}projectCircle(t,e){let n=e.vector3Multiply(t.position);return{visible:t.visible,type:t.type,pixel:this.spaceToPixel(n),dist:this.distanceToCamera(n),position:{x:t.position.x,y:t.position.y,z:t.position.z},radius:t.radius,style:t.style}}projectPath(t,e){let n,r=e.vector3Multiply(t.path[0]),i=this.spaceToPixel(r),s=this.distanceToCamera(r),o="M"+i.left+" "+i.top+" ";for(let a=1;a<t.path.length;a++)r=e.vector3Multiply(t.path[a]),i=this.spaceToPixel(r),n=this.distanceToCamera(r),s=Math.min(s,n),o+="L"+i.left+" "+i.top+" ";return{visible:t.visible,type:t.type,path:t.path,close:t.close,d:t.close?o+"Z":o,dist:s,lockStrokeWidth:t.lockStrokeWidth,style:t.style}}projectRectangle(t,e){let n,r=e.vector3Multiply(t.path[0]),i=this.spaceToPixel(r),s=this.distanceToCamera(r),o="M"+i.left+" "+i.top+" ";for(let a=1;a<t.path.length;a++)r=e.vector3Multiply(t.path[a]),i=this.spaceToPixel(r),n=this.distanceToCamera(r),s=Math.min(s,n),o+="L"+i.left+" "+i.top+" ";return{visible:t.visible,type:t.type,path:t.path,d:o+"Z",dist:s,style:t.style}}projectText(t,e){let n=e.vector3Multiply(t.position);return{visible:t.visible,type:t.type,pixel:this.spaceToPixel(n),dist:this.distanceToCamera(n),position:{x:t.position.x,y:t.position.y,z:t.position.z},text:t.text,lockFontSize:t.lockFontSize,style:t.style}}createShapes(t){this._shapes=new he("PRJ",{groups:t.groups.map(t=>{const e=[];return t.projectedChildren.forEach(t=>{switch(t.child.type){case Zt.CIRCLE:e.push({child:this.createCircle(t.child),index:t.index});break;case Zt.PATH:e.push({child:this.createPath(t.child),index:t.index})}}),new ee(e,t.sortBy,t.dist,t.visible)}),circles:t.circles.map(t=>this.createCircle(t)),paths:t.paths.map(t=>this.createPath(t)),rectangles:t.rectangles.map(t=>this.createRectangle(t)),texts:t.texts.map(t=>this.createText(t))})}createCircle(t){return new Kt(t.pixel.left,t.pixel.top,this.getDistantDependentValue(t.radius,t.dist),t.dist,{strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity,fill:t.style.fill,fillOpacity:t.style.fillOpacity},t.visible)}createPath(t){return new re(t.d,t.dist,{strokeWidth:t.lockStrokeWidth?t.style.strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity,strokeLinecap:t.style.strokeLinecap,strokeLinejoin:t.style.strokeLinejoin},t.visible)}createRectangle(t){return new ae(t.d,t.dist,{strokeWidth:this.getDistantDependentValue(t.style.strokeWidth,t.dist),stroke:t.style.stroke,strokeOpacity:t.style.strokeOpacity,strokeLinejoin:t.style.strokeLinejoin,fill:t.style.fill,fillOpacity:t.style.fillOpacity},t.visible)}createText(t){return new de(t.pixel.left,t.pixel.top,t.text,t.dist,{fontSize:t.lockFontSize?t.style.fontSize:this.getDistantDependentValue(t.style.fontSize,t.dist),fontFamily:t.style.fontFamily,fill:t.style.fill,fillOpacity:t.style.fillOpacity,alignmentBaseline:t.style.alignmentBaseline},t.visible)}updateShapes(t){this._shapes.update(e=>{e.groups.forEach((e,n)=>this.updateGroup(e,t.groups[n])),e.circles.forEach((e,n)=>this.updateCircle(e,t.circles[n])),e.paths.forEach((e,n)=>this.updatePath(e,t.paths[n])),e.rectangles.forEach((e,n)=>this.updateRectangles(e,t.rectangles[n])),e.texts.forEach((e,n)=>this.updateText(e,t.texts[n]))})}updateGroup(t,e){t.children.forEach((t,n)=>{switch(t.child.type){case Zt.CIRCLE:{const r=t.child,i=e.projectedChildren[n].child;r.type==Zt.CIRCLE&&i.type==Zt.CIRCLE||console.error(`#updateGroup: Error in Child Elements shape=${r} and projectedShape=${i} should be ${Zt.CIRCLE}!`),this.updateCircle(r,i,t.index);break}case Zt.PATH:{const r=t.child,i=e.projectedChildren[n].child;r.type==Zt.PATH&&i.type==Zt.PATH||console.error(`#updateGroup: Error in Child Elements shape=${r} and projectedShape=${i} should be ${Zt.PATH}!`),this.updatePath(r,i,t.index);break}}}),t.dist=e.dist,t.sortBy=e.sortBy,t.visible=e.visible,t.inView=e.dist>0}updateCircle(t,e,n=null){t.setPosition(e.pixel.left,e.pixel.top,this.getDistantDependentValue(e.radius,e.dist)),t.dist=e.dist,t.style={strokeWidth:this.getDistantDependentValue(e.style.strokeWidth,e.dist),stroke:e.style.stroke,strokeOpacity:e.style.strokeOpacity,fill:e.style.fill,fillOpacity:e.style.fillOpacity},null!=n&&(t.index=n),t.visible=e.visible,t.inView=e.dist>0}updateRectangles(t,e){t.setPath(e.d),t.dist=e.dist,t.style={strokeWidth:this.getDistantDependentValue(e.style.strokeWidth,e.dist),stroke:e.style.stroke,strokeOpacity:e.style.strokeOpacity,strokeLinejoin:e.style.strokeLinejoin,fill:e.style.fill,fillOpacity:e.style.fillOpacity},t.visible=e.visible,t.inView=e.dist>0}updatePath(t,e,n=null){t.setPath(e.d),t.dist=e.dist,t.style={strokeWidth:e.lockStrokeWidth?e.style.strokeWidth:this.getDistantDependentValue(e.style.strokeWidth,e.dist),stroke:e.style.stroke,strokeOpacity:e.style.strokeOpacity,strokeLinecap:e.style.strokeLinecap,strokeLinejoin:e.style.strokeLinejoin},null!=n&&(t.index=n),t.visible=e.visible,t.inView=e.dist>0}updateText(t,e){t.setPosition(e.pixel.left,e.pixel.top),t.dist=e.dist,t.style={fontSize:e.lockFontSize?e.style.fontSize:this.getDistantDependentValue(e.style.fontSize,e.dist),fontFamily:e.style.fontFamily,fill:e.style.fill,fillOpacity:e.style.fillOpacity,alignmentBaseline:e.style.alignmentBaseline},t.visible=e.visible,t.inView=e.dist>0,t.setText(e.text)}getDistantDependentValue(t,e){return e>0?t/e*20*this._elementStageSizeFactor:0}spaceToPixel(t){return this.planeToPixel(this.spaceToPlane(t))}spaceToPlane(t){if(t.z<this._stageNear)return{x:0,y:0};const e=1/t.z;return{x:e*t.x,y:e*t.y}}distanceToCamera(t){return t.z<this._stageNear?-1:t.z*(this._stageFar-this._stageNear)/(this._stageNear*(this._stageFar-t.z))}planeToPixel(t){return{left:this._stageWidthHalf*t.x*this._stageRatioInverted+this._stageWidthHalf,top:-this._stageHeightHalf*t.y+this._stageHeightHalf}}}function pe(){}function ye(t){return null==t?pe:function(){return this.querySelector(t)}}function ve(){return[]}function ge(t){return null==t?ve:function(){return this.querySelectorAll(t)}}function me(t){return function(){return this.matches(t)}}function _e(t){return function(e){return e.matches(t)}}var we=Array.prototype.find;function be(){return this.firstElementChild}var xe=Array.prototype.filter;function ke(){return Array.from(this.children)}function Se(t){return new Array(t.length)}function Ee(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function Ce(t,e,n,r,i,s){for(var o,a=0,l=e.length,u=s.length;a<u;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):n[a]=new Ee(t,s[a]);for(;a<l;++a)(o=e[a])&&(i[a]=o)}function Ae(t,e,n,r,i,s,o){var a,l,u,c=new Map,h=e.length,d=s.length,f=new Array(h);for(a=0;a<h;++a)(l=e[a])&&(f[a]=u=o.call(l,l.__data__,a,e)+"",c.has(u)?i[a]=l:c.set(u,l));for(a=0;a<d;++a)u=o.call(t,s[a],a,s)+"",(l=c.get(u))?(r[a]=l,l.__data__=s[a],c.delete(u)):n[a]=new Ee(t,s[a]);for(a=0;a<h;++a)(l=e[a])&&c.get(f[a])===l&&(i[a]=l)}function Me(t){return t.__data__}function $e(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Te(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}Ee.prototype={constructor:Ee,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var Ie="http://www.w3.org/1999/xhtml";const Pe={svg:"http://www.w3.org/2000/svg",xhtml:Ie,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Oe(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),Pe.hasOwnProperty(e)?{space:Pe[e],local:t}:t}function Le(t){return function(){this.removeAttribute(t)}}function Ne(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ze(t,e){return function(){this.setAttribute(t,e)}}function We(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function De(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function Re(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function je(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ve(t){return function(){this.style.removeProperty(t)}}function He(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Fe(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Be(t,e){return t.style.getPropertyValue(e)||je(t).getComputedStyle(t,null).getPropertyValue(e)}function Xe(t){return function(){delete this[t]}}function Ze(t,e){return function(){this[t]=e}}function Ge(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function Ye(t){return t.trim().split(/^|\s+/)}function Ke(t){return t.classList||new Ue(t)}function Ue(t){this._node=t,this._names=Ye(t.getAttribute("class")||"")}function qe(t,e){for(var n=Ke(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Je(t,e){for(var n=Ke(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Qe(t){return function(){qe(this,t)}}function tn(t){return function(){Je(this,t)}}function en(t,e){return function(){(e.apply(this,arguments)?qe:Je)(this,t)}}function nn(){this.textContent=""}function rn(t){return function(){this.textContent=t}}function sn(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function on(){this.innerHTML=""}function an(t){return function(){this.innerHTML=t}}function ln(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function un(){this.nextSibling&&this.parentNode.appendChild(this)}function cn(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function hn(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Ie&&e.documentElement.namespaceURI===Ie?e.createElement(t):e.createElementNS(n,t)}}function dn(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function fn(t){var e=Oe(t);return(e.local?dn:hn)(e)}function pn(){return null}function yn(){var t=this.parentNode;t&&t.removeChild(this)}function vn(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function gn(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function mn(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,s=e.length;r<s;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function _n(t,e,n){return function(){var r,i=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),void(r.value=e);this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function wn(t,e,n){var r=je(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function bn(t,e){return function(){return wn(this,t,e)}}function xn(t,e){return function(){return wn(this,t,e.apply(this,arguments))}}Ue.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var kn=[null];function Sn(t,e){this._groups=t,this._parents=e}function En(){return new Sn([[document.documentElement]],kn)}Sn.prototype=En.prototype={constructor:Sn,select:function(t){"function"!=typeof t&&(t=ye(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o,a=e[i],l=a.length,u=r[i]=new Array(l),c=0;c<l;++c)(s=a[c])&&(o=t.call(s,s.__data__,c,a))&&("__data__"in s&&(o.__data__=s.__data__),u[c]=o);return new Sn(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):ge(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o,a=e[s],l=a.length,u=0;u<l;++u)(o=a[u])&&(r.push(t.call(o,o.__data__,u,a)),i.push(o));return new Sn(r,i)},selectChild:function(t){return this.select(null==t?be:function(t){return function(){return we.call(this.children,t)}}("function"==typeof t?t:_e(t)))},selectChildren:function(t){return this.selectAll(null==t?ke:function(t){return function(){return xe.call(this.children,t)}}("function"==typeof t?t:_e(t)))},filter:function(t){"function"!=typeof t&&(t=me(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o=e[i],a=o.length,l=r[i]=[],u=0;u<a;++u)(s=o[u])&&t.call(s,s.__data__,u,o)&&l.push(s);return new Sn(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,Me);var n,r=e?Ae:Ce,i=this._parents,s=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=s.length,a=new Array(o),l=new Array(o),u=new Array(o),c=0;c<o;++c){var h=i[c],d=s[c],f=d.length,p=$e(t.call(h,h&&h.__data__,c,i)),y=p.length,v=l[c]=new Array(y),g=a[c]=new Array(y);r(h,d,v,g,u[c]=new Array(f),p,e);for(var m,_,w=0,b=0;w<y;++w)if(m=v[w]){for(w>=b&&(b=w+1);!(_=g[b])&&++b<y;);m._next=_||null}}return(a=new Sn(a,i))._enter=l,a._exit=u,a},enter:function(){return new Sn(this._enter||this._groups.map(Se),this._parents)},exit:function(){return new Sn(this._exit||this._groups.map(Se),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,s=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?s.remove():n(s),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var u,c=n[l],h=r[l],d=c.length,f=a[l]=new Array(d),p=0;p<d;++p)(u=c[p]||h[p])&&(f[p]=u);for(;l<i;++l)a[l]=n[l];return new Sn(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],s=i.length-1,o=i[s];--s>=0;)(r=i[s])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Te);for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o,a=n[s],l=a.length,u=i[s]=new Array(l),c=0;c<l;++c)(o=a[c])&&(u[c]=o);u.sort(e)}return new Sn(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,s=e[n],o=0,a=s.length;o<a;++o)(i=s[o])&&t.call(i,i.__data__,o,s);return this},attr:function(t,e){var n=Oe(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?Ne:Le:"function"==typeof e?n.local?Re:De:n.local?We:ze)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?Ve:"function"==typeof e?Fe:He)(t,e,null==n?"":n)):Be(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?Xe:"function"==typeof e?Ge:Ze)(t,e)):this.node()[t]},classed:function(t,e){var n=Ye(t+"");if(arguments.length<2){for(var r=Ke(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?en:e?Qe:tn)(n,e))},text:function(t){return arguments.length?this.each(null==t?nn:("function"==typeof t?sn:rn)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?on:("function"==typeof t?ln:an)(t)):this.node().innerHTML},raise:function(){return this.each(un)},lower:function(){return this.each(cn)},append:function(t){var e="function"==typeof t?t:fn(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:fn(t),r=null==e?pn:"function"==typeof e?e:ye(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(yn)},clone:function(t){return this.select(t?gn:vn)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,s=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?_n:mn,r=0;r<o;++r)this.each(a(s[r],e,n));return this}var a=this.node().__on;if(a)for(var l,u=0,c=a.length;u<c;++u)for(r=0,l=a[u];r<o;++r)if((i=s[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?xn:bn)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],s=0,o=i.length;s<o;++s)(r=i[s])&&(yield r)}};const Cn=En;var An={value:()=>{}};function Mn(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new $n(r)}function $n(t){this._=t}function Tn(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function In(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=An,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}$n.prototype=Mn.prototype={constructor:$n,on:function(t,e){var n,r,i=this._,s=(r=i,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),o=-1,a=s.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=s[o]).type)i[n]=In(i[n],t.name,e);else if(null==e)for(n in i)i[n]=In(i[n],t.name,null);return this}for(;++o<a;)if((n=(t=s[o]).type)&&(n=Tn(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new $n(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(r=this._[t]).length;s<n;++s)r[s].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};const Pn=Mn;var On,Ln,Nn=0,zn=0,Wn=0,Dn=0,Rn=0,jn=0,Vn="object"==typeof performance&&performance.now?performance:Date,Hn="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Fn(){return Rn||(Hn(Bn),Rn=Vn.now()+jn)}function Bn(){Rn=0}function Xn(){this._call=this._time=this._next=null}function Zn(t,e,n){var r=new Xn;return r.restart(t,e,n),r}function Gn(){Rn=(Dn=Vn.now())+jn,Nn=zn=0;try{!function(){Fn(),++Nn;for(var t,e=On;e;)(t=Rn-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Nn}()}finally{Nn=0,function(){for(var t,e,n=On,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:On=e);Ln=t,Kn(r)}(),Rn=0}}function Yn(){var t=Vn.now(),e=t-Dn;e>1e3&&(jn-=e,Dn=t)}function Kn(t){Nn||(zn&&(zn=clearTimeout(zn)),t-Rn>24?(t<1/0&&(zn=setTimeout(Gn,t-Vn.now()-jn)),Wn&&(Wn=clearInterval(Wn))):(Wn||(Dn=Vn.now(),Wn=setInterval(Yn,1e3)),Nn=1,Hn(Gn)))}function Un(t,e,n){var r=new Xn;return e=null==e?0:+e,r.restart(n=>{r.stop(),t(n+e)},e,n),r}Xn.prototype=Zn.prototype={constructor:Xn,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Fn():+n)+(null==e?0:+e),this._next||Ln===this||(Ln?Ln._next=this:On=this,Ln=this),this._call=t,this._time=n,Kn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Kn())}};var qn=Pn("start","end","cancel","interrupt"),Jn=[];function Qn(t,e,n,r,i,s){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function s(l){var u,c,h,d;if(1!==n.state)return a();for(u in i)if((d=i[u]).name===n.name){if(3===d.state)return Un(s);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[u]):+u<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[u])}if(Un(function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(l))}),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),u=0,c=-1;u<h;++u)(d=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++c]=d);r.length=c+1}}function o(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(a),n.state=5,1),s=-1,o=r.length;++s<o;)r[s].call(t,i);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){for(var r in n.state=6,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=Zn(function(t){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=t&&s(t-n.delay)},0,n.time)}(t,n,{name:e,index:r,group:i,on:qn,tween:Jn,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function tr(t,e){var n=nr(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function er(t,e){var n=nr(t,e);if(n.state>3)throw new Error("too late; already running");return n}function nr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function rr(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var ir,sr=180/Math.PI,or={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ar(t,e,n,r,i,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),t*r<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*sr,skewX:Math.atan(l)*sr,scaleX:o,scaleY:a}}function lr(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],l=[];return s=t(s),o=t(o),function(t,r,i,s,o,a){if(t!==i||r!==s){var l=o.push("translate(",null,e,null,n);a.push({i:l-4,x:rr(t,i)},{i:l-2,x:rr(r,s)})}else(i||s)&&o.push("translate("+i+e+s+n)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(t,e,n,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:n.push(i(n)+"rotate(",null,r)-2,x:rr(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(s.rotate,o.rotate,a,l),function(t,e,n,s){t!==e?s.push({i:n.push(i(n)+"skewX(",null,r)-2,x:rr(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(s.skewX,o.skewX,a,l),function(t,e,n,r,s,o){if(t!==n||e!==r){var a=s.push(i(s)+"scale(",null,",",null,")");o.push({i:a-4,x:rr(t,n)},{i:a-2,x:rr(e,r)})}else 1===n&&1===r||s.push(i(s)+"scale("+n+","+r+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(t){for(var e,n=-1,r=l.length;++n<r;)a[(e=l[n]).i]=e.x(t);return a.join("")}}}var ur=lr(function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?or:ar(e.a,e.b,e.c,e.d,e.e,e.f)},"px, ","px)","deg)"),cr=lr(function(t){return null==t?or:(ir||(ir=document.createElementNS("http://www.w3.org/2000/svg","g")),ir.setAttribute("transform",t),(t=ir.transform.baseVal.consolidate())?ar((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):or)},", ",")",")");function hr(t,e){var n,r;return function(){var i=er(this,t),s=i.tween;if(s!==n)for(var o=0,a=(r=n=s).length;o<a;++o)if(r[o].name===e){(r=r.slice()).splice(o,1);break}i.tween=r}}function dr(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var s=er(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:e,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===e){i[l]=a;break}l===u&&i.push(a)}s.tween=i}}function fr(t,e,n){var r=t._id;return t.each(function(){var t=er(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return nr(t,r).value[e]}}function pr(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function yr(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function vr(){}var gr=.7,mr=1/gr,_r="\\s*([+-]?\\d+)\\s*",wr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",br="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xr=/^#([0-9a-f]{3,8})$/,kr=new RegExp(`^rgb\\(${_r},${_r},${_r}\\)$`),Sr=new RegExp(`^rgb\\(${br},${br},${br}\\)$`),Er=new RegExp(`^rgba\\(${_r},${_r},${_r},${wr}\\)$`),Cr=new RegExp(`^rgba\\(${br},${br},${br},${wr}\\)$`),Ar=new RegExp(`^hsl\\(${wr},${br},${br}\\)$`),Mr=new RegExp(`^hsla\\(${wr},${br},${br},${wr}\\)$`),$r={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Tr(){return this.rgb().formatHex()}function Ir(){return this.rgb().formatRgb()}function Pr(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=xr.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Or(e):3===n?new zr(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Lr(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Lr(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=kr.exec(t))?new zr(e[1],e[2],e[3],1):(e=Sr.exec(t))?new zr(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Er.exec(t))?Lr(e[1],e[2],e[3],e[4]):(e=Cr.exec(t))?Lr(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ar.exec(t))?Hr(e[1],e[2]/100,e[3]/100,1):(e=Mr.exec(t))?Hr(e[1],e[2]/100,e[3]/100,e[4]):$r.hasOwnProperty(t)?Or($r[t]):"transparent"===t?new zr(NaN,NaN,NaN,0):null}function Or(t){return new zr(t>>16&255,t>>8&255,255&t,1)}function Lr(t,e,n,r){return r<=0&&(t=e=n=NaN),new zr(t,e,n,r)}function Nr(t,e,n,r){return 1===arguments.length?((i=t)instanceof vr||(i=Pr(i)),i?new zr((i=i.rgb()).r,i.g,i.b,i.opacity):new zr):new zr(t,e,n,null==r?1:r);var i}function zr(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Wr(){return`#${Vr(this.r)}${Vr(this.g)}${Vr(this.b)}`}function Dr(){const t=Rr(this.opacity);return`${1===t?"rgb(":"rgba("}${jr(this.r)}, ${jr(this.g)}, ${jr(this.b)}${1===t?")":`, ${t})`}`}function Rr(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function jr(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Vr(t){return((t=jr(t))<16?"0":"")+t.toString(16)}function Hr(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Br(t,e,n,r)}function Fr(t){if(t instanceof Br)return new Br(t.h,t.s,t.l,t.opacity);if(t instanceof vr||(t=Pr(t)),!t)return new Br;if(t instanceof Br)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(o=e===s?(n-r)/a+6*(n<r):n===s?(r-e)/a+2:(e-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new Br(o,a,l,t.opacity)}function Br(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Xr(t){return(t=(t||0)%360)<0?t+360:t}function Zr(t){return Math.max(0,Math.min(1,t||0))}function Gr(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function Yr(t,e,n,r,i){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*n+(1+3*t+3*s-3*o)*r+o*i)/6}pr(vr,Pr,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Tr,formatHex:Tr,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Fr(this).formatHsl()},formatRgb:Ir,toString:Ir}),pr(zr,Nr,yr(vr,{brighter(t){return t=null==t?mr:Math.pow(mr,t),new zr(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?gr:Math.pow(gr,t),new zr(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new zr(jr(this.r),jr(this.g),jr(this.b),Rr(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Wr,formatHex:Wr,formatHex8:function(){return`#${Vr(this.r)}${Vr(this.g)}${Vr(this.b)}${Vr(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Dr,toString:Dr})),pr(Br,function(t,e,n,r){return 1===arguments.length?Fr(t):new Br(t,e,n,null==r?1:r)},yr(vr,{brighter(t){return t=null==t?mr:Math.pow(mr,t),new Br(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?gr:Math.pow(gr,t),new Br(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new zr(Gr(t>=240?t-240:t+120,i,r),Gr(t,i,r),Gr(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Br(Xr(this.h),Zr(this.s),Zr(this.l),Rr(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Rr(this.opacity);return`${1===t?"hsl(":"hsla("}${Xr(this.h)}, ${100*Zr(this.s)}%, ${100*Zr(this.l)}%${1===t?")":`, ${t})`}`}}));const Kr=t=>()=>t;function Ur(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):Kr(isNaN(t)?e:t)}const qr=function t(e){var n=function(t){return 1===(t=+t)?Ur:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Kr(isNaN(e)?n:e)}}(e);function r(t,e){var r=n((t=Nr(t)).r,(e=Nr(e)).r),i=n(t.g,e.g),s=n(t.b,e.b),o=Ur(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=s(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function Jr(t){return function(e){var n,r,i=e.length,s=new Array(i),o=new Array(i),a=new Array(i);for(n=0;n<i;++n)r=Nr(e[n]),s[n]=r.r||0,o[n]=r.g||0,a[n]=r.b||0;return s=t(s),o=t(o),a=t(a),r.opacity=1,function(t){return r.r=s(t),r.g=o(t),r.b=a(t),r+""}}}Jr(function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],s=t[r+1],o=r>0?t[r-1]:2*i-s,a=r<e-1?t[r+2]:2*s-i;return Yr((n-r/e)*e,o,i,s,a)}}),Jr(function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],s=t[r%e],o=t[(r+1)%e],a=t[(r+2)%e];return Yr((n-r/e)*e,i,s,o,a)}});var Qr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ti=new RegExp(Qr.source,"g");function ei(t,e){var n,r,i,s=Qr.lastIndex=ti.lastIndex=0,o=-1,a=[],l=[];for(t+="",e+="";(n=Qr.exec(t))&&(r=ti.exec(e));)(i=r.index)>s&&(i=e.slice(s,i),a[o]?a[o]+=i:a[++o]=i),(n=n[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:rr(n,r)})),s=ti.lastIndex;return s<e.length&&(i=e.slice(s),a[o]?a[o]+=i:a[++o]=i),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,r=0;r<e;++r)a[(n=l[r]).i]=n.x(t);return a.join("")})}function ni(t,e){var n;return("number"==typeof e?rr:e instanceof Pr?qr:(n=Pr(e))?(e=n,qr):ei)(t,e)}function ri(t){return function(){this.removeAttribute(t)}}function ii(t){return function(){this.removeAttributeNS(t.space,t.local)}}function si(t,e,n){var r,i,s=n+"";return function(){var o=this.getAttribute(t);return o===s?null:o===r?i:i=e(r=o,n)}}function oi(t,e,n){var r,i,s=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===r?i:i=e(r=o,n)}}function ai(t,e,n){var r,i,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttribute(t))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=e(r=o,l));this.removeAttribute(t)}}function li(t,e,n){var r,i,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=e(r=o,l));this.removeAttributeNS(t.space,t.local)}}function ui(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,i)),n}return i._value=e,i}function ci(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,i)),n}return i._value=e,i}function hi(t,e){return function(){tr(this,t).delay=+e.apply(this,arguments)}}function di(t,e){return e=+e,function(){tr(this,t).delay=e}}function fi(t,e){return function(){er(this,t).duration=+e.apply(this,arguments)}}function pi(t,e){return e=+e,function(){er(this,t).duration=e}}var yi=Cn.prototype.constructor;function vi(t){return function(){this.style.removeProperty(t)}}var gi=0;function mi(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function _i(){return++gi}var wi=Cn.prototype;mi.prototype=function(t){return Cn().transition(t)}.prototype={constructor:mi,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=ye(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a,l,u=r[o],c=u.length,h=s[o]=new Array(c),d=0;d<c;++d)(a=u[d])&&(l=t.call(a,a.__data__,d,u))&&("__data__"in a&&(l.__data__=a.__data__),h[d]=l,Qn(h[d],e,n,d,h,nr(a,n)));return new mi(s,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=ge(t));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l,u=r[a],c=u.length,h=0;h<c;++h)if(l=u[h]){for(var d,f=t.call(l,l.__data__,h,u),p=nr(l,n),y=0,v=f.length;y<v;++y)(d=f[y])&&Qn(d,e,n,y,f,p);s.push(f),o.push(l)}return new mi(s,o,e,n)},selectChild:wi.selectChild,selectChildren:wi.selectChildren,filter:function(t){"function"!=typeof t&&(t=me(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o=e[i],a=o.length,l=r[i]=[],u=0;u<a;++u)(s=o[u])&&t.call(s,s.__data__,u,o)&&l.push(s);return new mi(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l,u=e[a],c=n[a],h=u.length,d=o[a]=new Array(h),f=0;f<h;++f)(l=u[f]||c[f])&&(d[f]=l);for(;a<r;++a)o[a]=e[a];return new mi(o,this._parents,this._name,this._id)},selection:function(){return new yi(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=_i(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o,a=r[s],l=a.length,u=0;u<l;++u)if(o=a[u]){var c=nr(o,e);Qn(o,t,n,u,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new mi(r,this._parents,t,n)},call:wi.call,nodes:wi.nodes,node:wi.node,size:wi.size,empty:wi.empty,each:wi.each,on:function(t,e){var n=this._id;return arguments.length<2?nr(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,s=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?tr:er;return function(){var o=s(this,t),a=o.on;a!==r&&(i=(r=a).copy()).on(e,n),o.on=i}}(n,t,e))},attr:function(t,e){var n=Oe(t),r="transform"===n?cr:ni;return this.attrTween(t,"function"==typeof e?(n.local?li:ai)(n,r,fr(this,"attr."+t,e)):null==e?(n.local?ii:ri)(n):(n.local?oi:si)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=Oe(t);return this.tween(n,(r.local?ui:ci)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?ur:ni;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var s=Be(this,t),o=(this.style.removeProperty(t),Be(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}(t,r)).on("end.style."+t,vi(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,i,s;return function(){var o=Be(this,t),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=Be(this,t)),o===l?null:o===r&&l===i?s:(i=l,s=e(r=o,a))}}(t,r,fr(this,"style."+t,e))).each(function(t,e){var n,r,i,s,o="style."+e,a="end."+o;return function(){var l=er(this,t),u=l.on,c=null==l.value[o]?s||(s=vi(e)):void 0;u===n&&i===c||(r=(n=u).copy()).on(a,i=c),l.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,i,s=n+"";return function(){var o=Be(this,t);return o===s?null:o===r?i:i=e(r=o,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){var r,i;function s(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&function(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}(t,s,n)),r}return s._value=e,s}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(fr(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&function(t){return function(e){this.textContent=t.call(this,e)}}(r)),e}return r._value=t,r}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=nr(this.node(),n).tween,s=0,o=i.length;s<o;++s)if((r=i[s]).name===t)return r.value;return null}return this.each((null==e?hr:dr)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?hi:di)(e,t)):nr(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?fi:pi)(e,t)):nr(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){er(this,t).ease=e}}(e,t)):nr(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;er(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){0===--i&&s()}};n.each(function(){var n=er(this,r),i=n.on;i!==t&&((e=(t=i).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),n.on=e}),0===i&&s()})},[Symbol.iterator]:wi[Symbol.iterator]};var bi={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function xi(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}Cn.prototype.interrupt=function(t){return this.each(function(){!function(t,e){var n,r,i,s=t.__transition,o=!0;if(s){for(i in e=null==e?null:e+"",s)(n=s[i]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete s[i]):o=!1;o&&delete t.__transition}}(this,t)})},Cn.prototype.transition=function(t){var e,n;t instanceof mi?(e=t._id,t=t._name):(e=_i(),(n=bi).time=Fn(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o,a=r[s],l=a.length,u=0;u<l;++u)(o=a[u])&&Qn(o,t,e,u,a,n||xi(o,e));return new mi(r,this._parents,t,e)};const{abs:ki,max:Si,min:Ei}=Math;function Ci(t){return{type:t}}function Ai(t){return"string"==typeof t?new Sn([[document.querySelector(t)]],[document.documentElement]):new Sn([[t]],kn)}function Mi(t,e,n){this.k=t,this.x=e,this.y=n}["w","e"].map(Ci),["n","s"].map(Ci),["n","w","e","s","nw","ne","sw","se"].map(Ci),Mi.prototype={constructor:Mi,scale:function(t){return 1===t?this:new Mi(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Mi(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new Mi(1,0,0),Mi.prototype;class $i{constructor(t){this._current=null,null!=t&&(this._current=t)}set(t){var e;null===(e=this._current)||void 0===e||e.unsubscribe(),this._current=t}unsubscribe(){var t;null===(t=this._current)||void 0===t||t.unsubscribe(),this._current=null}}class Ti{constructor(){this._current=new Map}set(t,e){if(this._current.has(t)){let n=this._current.get(t);null==n||n.set(e)}else this._current.set(t,new $i(e))}unsubscribe(t){if(this._current.has(t)){let e=this._current.get(t);null==e||e.unsubscribe(),this._current.delete(t)}else console.error(-`No subscription for ${t} found.`)}}const Ii="circle",Pi="path",Oi="text",Li="svg-shape--invisible";class Ni{constructor(t){this._subscriptions=new Ti,this._created=new Set;const e=document.getElementById(t);this._width=(null==e?void 0:e.clientWidth)?e.clientWidth:0,this._height=(null==e?void 0:e.clientHeight)?e.clientHeight:0,this.addSvgCss(),this._svgg=Ai(`#${t}`).append("svg").attr("id","svgMain").attr("width",this._width).attr("height",this._height).append("g").attr("transform","translate(.5, .5)")}registerShapes(t,e){Ai("svg#svgMain").style("background",e),this._subscriptions.set(t.id,t.collection$.subscribe(e=>{this._created.has(t.id)?this.updateShapes(t.id,e):this.createShapes(t.id,e)}))}unregisterShapes(t){this.removeShapes(t),this._subscriptions.unsubscribe(t),this._created.delete(t)}addSvgCss(){var t=window.document.styleSheets[0];t.insertRule(`.${Li} { visibility: hidden;}`,t.cssRules.length)}createShapes(t,e){console.log("#createShapes",{id:t,collection:e}),this.createGroups(t,e.groups),this.createCircles(t,e.circles),this.createPaths(t,e.paths),this.createRectangles(t,e.rectangles),this.createTexts(t,e.texts),this.updateShapes(t,e),this._created.add(t)}updateShapes(t,e){this.updateGroups(t,e.groups),this.updateCircles(t,e.circles),this.updatePaths(t,e.paths),this.updateRectangles(t,e.rectangles),this.updateTexts(t,e.texts),this.sortAllShapesByDistance(t)}createGroups(t,e){console.log(`#createGroups - id=${t}, cnt=${e.length}`),this._svgg.selectAll(`g.${Zt.GROUP}.${t}`).data(e,t=>t.id).enter().append("g").attr("id",t=>t.id).classed(Zt.GROUP,!0).classed(t,!0),e.forEach(t=>{const e=this._svgg.select(`#${t.id}`);switch(this.createCirclesForGroup(e,t.id,t.children.filter(t=>t.child.type==Zt.CIRCLE).map(t=>t.child)),this.createPathsForGroup(e,t.id,t.children.filter(t=>t.child.type==Zt.PATH).map(t=>t.child)),t.attr.sortBy){case Gt.DISTANCE:this.sortAllShapesByDistance(t.id);break;case Gt.INDEX:this.sortAllGroupChildsByIndex(e,t.id)}})}updateGroups(t,e){this._svgg.selectAll(`g.${Zt.GROUP}.${t}`).data(e,t=>t.id).classed(Li,t=>t.isHidden()),e.forEach(t=>{const e=this._svgg.select(`#${t.id}`);switch(this.updateCirclesForGroup(e,t.id,t.children.filter(t=>t.child.type==Zt.CIRCLE).map(t=>t.child)),this.updatePathsForGroup(e,t.id,t.children.filter(t=>t.child.type==Zt.PATH).map(t=>t.child)),t.attr.sortBy){case Gt.DISTANCE:this.sortAllShapesByDistance(t.id);break;case Gt.INDEX:this.sortAllGroupChildsByIndex(e,t.id)}})}createCircles(t,e){console.log(`#createCircles - id=${t}, cnt=${e.length}`),this._svgg.selectAll(`${Ii}.${Zt.CIRCLE}.${t}`).data(e,t=>t.id).enter().append(Ii).attr("id",t=>t.id).classed(Zt.CIRCLE,!0).classed(t,!0)}createCirclesForGroup(t,e,n){t.selectAll(`${Ii}.${Zt.CIRCLE}.${e}`).data(n,t=>t.id).enter().append(Ii).attr("id",t=>t.id).classed(Zt.CIRCLE,!0).classed(e,!0)}updateCircles(t,e){this.setCircleAttributes(this._svgg.selectAll(`${Ii}.${Zt.CIRCLE}.${t}`).data(e,t=>t.id).classed(Li,t=>t.isHidden()))}updateCirclesForGroup(t,e,n){this.setCircleAttributes(t.selectAll(`${Ii}.${Zt.CIRCLE}.${e}`).data(n).classed(Li,t=>t.isHidden()))}setCircleAttributes(t){t.style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("cx",t=>t.attr.cx).attr("cy",t=>t.attr.cy).attr("r",t=>t.attr.r)}createPaths(t,e){console.log(`#createPaths - id=${t}, cnt=${e.length}`),this._svgg.selectAll(`${Pi}.${Zt.PATH}.${t}`).data(e,t=>t.id).enter().append(Pi).attr("id",t=>t.id).classed(Zt.PATH,!0).classed(t,!0).style("stroke-linejoin","round").style("fill","none")}createPathsForGroup(t,e,n){t.selectAll(`${Pi}.${Zt.PATH}.${e}`).data(n,t=>t.id).enter().append(Pi).attr("id",t=>t.id).classed(Zt.PATH,!0).classed(e,!0).style("fill","none")}updatePaths(t,e){this.setPathAttributes(this._svgg.selectAll(`${Pi}.${Zt.PATH}.${t}`).data(e,t=>t.id).classed(Li,t=>t.isHidden()))}updatePathsForGroup(t,e,n){this.setPathAttributes(t.selectAll(`${Pi}.${Zt.PATH}.${e}`).data(n,t=>t.id).classed(Li,t=>t.isHidden()))}setPathAttributes(t){t.style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("stroke-linecap",t=>t.style.strokeLinecap).style("stroke-linejoin",t=>t.style.strokeLinejoin).attr("d",t=>t.attr.d)}createRectangles(t,e){console.log(`#createRectangles - id=${t}, cnt=${e.length}`),this._svgg.selectAll(`${Pi}.${Zt.RECTANGLE}.${t}`).data(e,t=>t.id).enter().append(Pi).attr("id",t=>t.id).classed(Zt.RECTANGLE,!0).classed(t,!0)}updateRectangles(t,e){this.setRectangleAttributes(this._svgg.selectAll(`${Pi}.${Zt.RECTANGLE}.${t}`).data(e,t=>t.id).classed(Li,t=>t.isHidden()))}setRectangleAttributes(t){t.style("stroke-width",t=>t.style.strokeWidth).style("stroke",t=>t.style.stroke).style("stroke-opacity",t=>t.style.strokeOpacity).style("stroke-linejoin",t=>t.style.strokeLinejoin).style("fill",t=>t.style.fill).style("fill-opacity",t=>t.style.fillOpacity).attr("d",t=>t.attr.d)}createTexts(t,e){console.log(`#createTexts - id=${t}, cnt=${e.length}`),this._svgg.selectAll(`${Oi}.${Zt.TEXT}.${t}`).data(e,t=>t.id).enter().append(Oi).attr("id",t=>t.id).classed(Zt.TEXT,!0).classed(t,!0)}updateTexts(t,e){this.setTextAttributes(this._svgg.selectAll(`${Oi}.${Zt.TEXT}.${t}`).data(e,t=>t.id).classed(Li,t=>t.isHidden()).classed(Zt.TEXT,!0))}setTextAttributes(t){t.style("font-size",t=>t.style.fontSize).style("font-family",t=>t.style.fontFamily).style("fill",t=>t.style.fill).style("fillOpacity",t=>t.style.fillOpacity).style("alignment-baseline",t=>t.style.alignmentBaseline).attr("x",t=>t.attr.x).attr("y",t=>t.attr.y).text(t=>t.attr.text)}sortAllShapesByDistance(t){this._svgg.selectAll(`.${t}`).sort((t,e)=>e.dist-t.dist)}sortAllGroupChildsByIndex(t,e){t.selectAll(`.${e}`).sort((t,e)=>t.index-e.index)}removeShapes(t){this._svgg.selectAll(`.${t}`).remove()}}var zi;function Wi(){return window.innerWidth==screen.width&&window.innerHeight==screen.height?zi.IMMERSIVE:window.innerWidth<1300?zi.SMALL:zi.DEFAULT}function Di(t,e,n){return void 0===n&&(n=1/0),a(e)?Di(function(n,r){return Pt(function(t,i){return e(n,t,r,i)})(dt(t(n,r)))},n):("number"==typeof e&&(n=e),tt(function(e,r){return function(t,e,n,r){var i=[],s=0,o=0,a=!1,l=function(){!a||i.length||s||e.complete()},u=function(t){return s<r?c(t):i.push(t)},c=function(t){s++;var a=!1;dt(n(t,o++)).subscribe(et(e,function(t){e.next(t)},function(){a=!0},void 0,function(){if(a)try{s--;for(var t=function(){var t=i.shift();c(t)};i.length&&s<r;)t();l()}catch(t){e.error(t)}}))};return t.subscribe(et(e,u,function(){a=!0,l()})),function(){}}(e,r,t,n)}))}function Ri(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Wt(t),r=function(t){return"number"==typeof zt(t)?t.pop():1/0}(t),i=t;return i.length?1===i.length?dt(i[0]):function(t){return void 0===t&&(t=1/0),Di(z,t)}(r)(It(i,n)):xt}!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SMALL=1]="SMALL",t[t.IMMERSIVE=2]="IMMERSIVE"}(zi||(zi={}));var ji=["addListener","removeListener"],Vi=["addEventListener","removeEventListener"],Hi=["on","off"];function Fi(t,e,n,r){if(a(n)&&(r=n,n=void 0),r)return Fi(t,e,n).pipe(Nt(r));var s=i(function(t){return a(t.addEventListener)&&a(t.removeEventListener)}(t)?Vi.map(function(r){return function(i){return t[r](e,i,n)}}):function(t){return a(t.addListener)&&a(t.removeListener)}(t)?ji.map(Bi(t,e)):function(t){return a(t.on)&&a(t.off)}(t)?Hi.map(Bi(t,e)):[],2),o=s[0],l=s[1];if(!o&&rt(t))return Di(function(t){return Fi(t,e,n)})(dt(t));if(!o)throw new TypeError("Invalid event target");return new W(function(t){var e=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.next(1<e.length?e:e[0])};return o(e),function(){return l(e)}})}function Bi(t,e){return function(n){return function(r){return t[n](e,r)}}}function Xi(t,e,n){const r=n/100,i=e.x-t.x,s=e.y-t.y,o=e.z-t.z;return[{x:t.x+i*r,y:t.y+s*r,z:t.z+o*r},{x:e.x-i*r,y:e.y-s*r,z:e.z-o*r}]}function Zi(t,e){return t===e}class Gi{constructor(){var t,e;this._t=0,this._cameraSubscription=new $i,this.groups=[],this.circles=[],this.paths=[],this.rectangles=[],this.texts=[],this._state$=new H({groups:this.groups.map(t=>t.attributes),circles:this.circles.map(t=>t.attributes),paths:this.paths.map(t=>t.attributes),rectangles:this.rectangles.map(t=>t.attributes),texts:this.texts.map(t=>t.attributes)}),this.state$=this._state$.pipe((void 0===e&&(e=z),t=null!=(t=(t,e)=>function(t,e){return JSON.stringify(t)===JSON.stringify(e)}(t,e))?t:Zi,tt(function(n,r){var i,s=!0;n.subscribe(et(r,function(n){var o=e(n);!s&&t(i,o)||(s=!1,i=o,r.next(n))}))}))),this.config=new yt({cameraPerspective:gt()}),this.backgroundColor="#fff"}init(){this.emit()}tick(){this._t++,this.transitionToStateAt(this._t),this.emit()}mountCamera(t){t.mountCamera(this.config.data.cameraPerspective),this._cameraSubscription.set(t.state$.subscribe({next:t=>{this.config.data.cameraPerspective=t}}))}resetConfig(){this.config.reset()}onDestroy(){this.config.save(),this._cameraSubscription.unsubscribe()}emit(){this._state$.next({groups:this.groups.map(t=>t.attributes),circles:this.circles.map(t=>t.attributes),paths:this.paths.map(t=>t.attributes),rectangles:this.rectangles.map(t=>t.attributes),texts:this.texts.map(t=>t.attributes)})}}class Yi extends Gi{constructor(){super(),this._zDistance=5,this._current=[],this._circleStyle=te().strokeWidth(1.5).stroke("#f80").fill("#fff").get(),this._pathStyle=oe().strokeWidth(2).stroke("#88a").get(),this.config=new yt({cameraPerspective:{position:{x:0,y:-2,z:-6},angleX:0*vt,angleY:0*vt,angleZ:0*vt},parameters:{m1:1,m2:1,l1:1,l2:1,g:9.81,friction:1}},"doublePendulum2dConfig"),this.name="Double Pendulum 2D";for(let t=-17;t<18;t+=4)for(let e=-9;e<10;e+=4)for(let n=1;n<2;n++)this.groups.push(new ne({x:t,y:e,z:n*this._zDistance},[])),this._current.push({theta1:t/Math.PI/2,theta2:e/Math.PI/2,omega1:1*(n-1),omega2:1*-(n-1)});this.updateWithCurrent(),this.init()}transitionToStateAt(t){this._current=this._current.map(t=>{const e=this.rungeKutta4Step(this.doublePendulumODE,this.pendulumStateAsArray(t),.025,this.config.data);return e[2]*=this.config.data.parameters.friction,e[3]*=this.config.data.parameters.friction,this.pendulumStateFromArray(e)}),this.updateWithCurrent()}updateWithCurrent(){const t=this._current.map((t,e)=>{const n=this.toCartesian(t.theta1,t.theta2);return[{x:0,y:0,z:0},{x:n[0],y:n[1],z:0},{x:n[2],y:n[3],z:0}]});this.groups.forEach((e,n)=>{const r=Xi(t[n][0],t[n][1],20),i=Xi(t[n][1],t[n][2],20);e.children=[new ie(r,!1,!1,this._pathStyle),new ie(i,!1,!1,this._pathStyle),new qt(t[n][0],3,this._circleStyle),new qt(t[n][1],3*Math.cbrt(this.config.data.parameters.m1),this._circleStyle),new qt(t[n][2],3*Math.cbrt(this.config.data.parameters.m2),this._circleStyle)]})}toCartesian(t,e){const n=this.config.data.parameters.l1*Math.sin(t),r=-this.config.data.parameters.l1*Math.cos(t);return[n,r,n+this.config.data.parameters.l2*Math.sin(e),r-this.config.data.parameters.l2*Math.cos(e)]}pendulumStateAsArray(t){return[t.theta1,t.theta2,t.omega1,t.omega2]}pendulumStateFromArray(t){return{theta1:t[0],theta2:t[1],omega1:t[2],omega2:t[3]}}doublePendulumODE(t,e){const n=e.parameters,r=t[0],i=t[1],s=t[2],o=t[3],a=i-r,l=Math.sin(a),u=Math.cos(a);return[s,o,(n.m2*n.l1*Math.pow(s,2)*l*u+n.m2*n.g*Math.sin(i)*u+n.m2*n.l2*Math.pow(o,2)*l-(n.m1+n.m2)*n.g*Math.sin(r))/(n.l1*(n.m1+n.m2-n.m2*Math.pow(u,2))),(-n.m2*n.l2*Math.pow(o,2)*l*u+(n.m1+n.m2)*(n.g*Math.sin(r)*u-n.l1*Math.pow(s,2)*l)-(n.m1+n.m2)*n.g*Math.sin(i))/(n.l2*(n.m1+n.m2-n.m2*Math.pow(u,2)))]}rungeKutta4Step(t,e,n,r){const i=t(e,r),s=t(e.map((t,e)=>t+n/2*i[e]),r),o=t(e.map((t,e)=>t+n/2*s[e]),r),a=t(e.map((t,e)=>t+n*o[e]),r);return e.map((t,e)=>t+n/6*(i[e]+2*s[e]+2*o[e]+a[e]))}}class Ki{constructor(t,e=null){this.n=t,this.prefillWith=e,this.buffer=null!=e?new Array(t).fill(structuredClone(e)):[]}push(t){return this.buffer.push(t),this.buffer.length>this.n&&(this.buffer=this.buffer.slice(-this.n)),this.buffer.slice().reverse()}get values(){return this.buffer.slice().reverse()}get size(){return this.buffer.length}}class Ui{constructor(t,e){this._params=t,this._timeStep=e}}class qi extends Ui{updateState(t){return this.rungeKutta4Step(t,this._timeStep)}getTotalEnergy(t){const e=this._params.m1,n=this._params.m2,r=this._params.l1,i=this._params.l2,s=-r*Math.cos(t.theta1),o=s-i*Math.cos(t.theta2),a=r*(Math.cos(t.theta1)*Math.cos(t.phi1)*t.dtheta1-Math.sin(t.theta1)*Math.sin(t.phi1)*t.dphi1),l=r*(Math.sin(t.theta1)*t.dtheta1),u=r*(Math.cos(t.theta1)*Math.sin(t.phi1)*t.dtheta1+Math.sin(t.theta1)*Math.cos(t.phi1)*t.dphi1),c=a+i*(Math.cos(t.theta2)*Math.cos(t.phi2)*t.dtheta2-Math.sin(t.theta2)*Math.sin(t.phi2)*t.dphi2),h=l+i*(Math.sin(t.theta2)*t.dtheta2),d=u+i*(Math.cos(t.theta2)*Math.sin(t.phi2)*t.dtheta2+Math.sin(t.theta2)*Math.cos(t.phi2)*t.dphi2);return.5*e*(a*a+l*l+u*u)+.5*n*(c*c+h*h+d*d)+(e*this._params.g*(s+r)+n*this._params.g*(o+r+i))}rungeKutta4Step(t,e){const n=this.doublePendulumODE(t);if(null==n)return null;const r=this.addScaledDerivatives(t,n,e/2),i=this.doublePendulumODE(r);if(null==i)return null;const s=this.addScaledDerivatives(t,i,e/2),o=this.doublePendulumODE(s);if(null==o)return null;const a=this.addScaledDerivatives(t,o,e),l=this.doublePendulumODE(a);return null==l?null:{theta1:t.theta1+(n.dtheta1+2*i.dtheta1+2*o.dtheta1+l.dtheta1)*e/6,phi1:t.phi1+(n.dphi1+2*i.dphi1+2*o.dphi1+l.dphi1)*e/6,theta2:t.theta2+(n.dtheta2+2*i.dtheta2+2*o.dtheta2+l.dtheta2)*e/6,phi2:t.phi2+(n.dphi2+2*i.dphi2+2*o.dphi2+l.dphi2)*e/6,dtheta1:t.dtheta1+(n.ddtheta1+2*i.ddtheta1+2*o.ddtheta1+l.ddtheta1)*e/6,dphi1:t.dphi1+(n.ddphi1+2*i.ddphi1+2*o.ddphi1+l.ddphi1)*e/6,dtheta2:t.dtheta2+(n.ddtheta2+2*i.ddtheta2+2*o.ddtheta2+l.ddtheta2)*e/6,dphi2:t.dphi2+(n.ddphi2+2*i.ddphi2+2*o.ddphi2+l.ddphi2)*e/6}}addScaledDerivatives(t,e,n){return{theta1:t.theta1+e.dtheta1*n,phi1:t.phi1+e.dphi1*n,theta2:t.theta2+e.dtheta2*n,phi2:t.phi2+e.dphi2*n,dtheta1:t.dtheta1+e.ddtheta1*n,dphi1:t.dphi1+e.ddphi1*n,dtheta2:t.dtheta2+e.ddtheta2*n,dphi2:t.dphi2+e.ddphi2*n}}doublePendulumODE(t){const e=this._params.m1,n=this._params.m2,r=e+n,i=this._params.l1,s=this._params.l2,o=this._params.g,a=t.theta1,l=t.phi1,u=t.theta2,c=t.phi2,h=t.dtheta1,d=t.dphi1,f=t.dtheta2,p=t.dphi2,y=Math.sin(a),v=Math.sin(u),g=Math.cos(a),m=Math.cos(u),_=(Math.sin(l),Math.sin(c),Math.cos(l),Math.cos(c),c+l),w=c-l,b=(Math.sin(_),Math.cos(_),-Math.sin(w)),x=Math.cos(w),k=Math.sin(2*a),S=(Math.sin(2*l),Math.sin(2*u)),E=(Math.cos(2*u),Math.cos(2*c),Math.pow(y*v,2)),C=Math.pow(g*m,2),A=Math.pow(v,2),M=Math.pow(g,2),$=Math.pow(m,2),T=Math.pow(y,2),I=Math.pow(x,2),P=Math.pow(h,2),O=Math.pow(f,2),L=Math.pow(d,2),N=Math.pow(p,2),z=N+O,W=L+P,D=Math.pow(g,3),R=Math.pow(m,3),j=-(n*E*I+.5*n*k*S*x+n*C-r),V=(n*y*A*(i*g*P+o)*I+(-s*g*N*$+(i*(L+2*P)*M+o*g-i*W)*m+s*g*z)*n*v*x-y*(-s*n*N*R+n*i*g*W*$+s*n*z*m+r*(-i*L*g+o)))/(i*j),H=-(-.5*S*O*s*n*T*I-y*(-m*L*i*r*M+(s*n*(N+2*O)*$+o*r*m-s*n*z)*g+m*i*W*r)*x+(-L*i*r*D+(s*n*z*m+o*r)*M+i*W*r*g-m*N*s*r)*v)/(s*j),F=-(n*(y*A*(-i*L*M+o*g+i*W)*x+v*(-i*m*L*D+o*M*m+i*g*m*W-s*($*N-z)))*b-2*h*i*(n*E*I+.5*n*k*S*x+n*C-r)*d*g)/(i*j*y),B=((-n*s*v*($*N-z)*T*x+y*(-i*L*r*M+(-s*n*N*R+s*n*z*m+o*r)*g+i*W*r))*b+2*m*(n*E*I+.5*k*S*x*n+C*n-r)*f*p*s)/(s*j*v);return this.isInvalidNumber(V)||this.isInvalidNumber(H)||this.isInvalidNumber(F)||this.isInvalidNumber(B)?null:{dtheta1:h,dphi1:d,dtheta2:f,dphi2:p,ddtheta1:V,ddphi1:F,ddtheta2:H,ddphi2:B}}isInvalidNumber(t){return!isFinite(t)||isNaN(t)||null==t}}class Ji extends Gi{constructor(){super(),this._streakLength=120,this._streakOffset=4,this._streakChunkSize=12,this._streakChunkGradientStep=this._streakChunkSize/this._streakLength,this._streak1=new Ki(this._streakLength+this._streakOffset,{point:{x:0,y:0,z:0},valid:!1}),this._streak2=new Ki(this._streakLength+this._streakOffset,{point:{x:0,y:0,z:0},valid:!1}),this._running=!0,this._pathStyleCs=oe().strokeWidth(.5).stroke("#000").strokeOpacity(.5).get(),this._circleStyle=te().strokeWidth(1.5).stroke("#f80").fill("#fff").get(),this._pathStyle=oe().strokeWidth(2).stroke("#88a").strokeLinecap("round").get(),this.config=new yt({cameraPerspective:{position:{x:0,y:-.8,z:-2},angleX:40*vt,angleY:-30*vt,angleZ:0*vt},parameters:{m1:1,m2:1,l1:1,l2:1,g:9.81},initialState:{theta1:1,phi1:0,theta2:1,phi2:0,dtheta1:1,dphi1:1.2300575,dtheta2:0,dphi2:2.460115}},"doublePendulum3dConfig"),this.name="Double Pendulum 3D",this._energy=0;this._csPaths=[new ie([{x:-1.5,y:0,z:0},{x:1.5,y:0,z:0}],!1,!0,this._pathStyleCs),new ie([{x:0,y:-3,z:0},{x:0,y:1.5,z:0}],!1,!0,this._pathStyleCs),new ie([{x:0,y:0,z:-1.5},{x:0,y:0,z:1.5}],!1,!0,this._pathStyleCs)],this._g=new ne({x:0,y:0,z:0},[]),this._current=structuredClone(this.config.data.initialState),this._calculator=new qi(this.config.data.parameters,.001),this.paths=this._csPaths,this.groups=[this._g],this.updateWithCurrent(),this.init()}transitionToStateAt(t){if(!this._running)return;if(10===t&&(this._energy=this._calculator.getTotalEnergy(this._current),console.log(`#transitionToStateAt - Energy the beginning: ${this._energy}`)),t%100==0){const t=.1*this._energy,e=this._calculator.getTotalEnergy(this._current);(e<this._energy-t||e>this._energy+t)&&(this._energy=e,console.warn(`#transitionToStateAt - Energy hat significally changed to: ${this._energy}`))}let e=structuredClone(this._current),n=structuredClone(this._current),r=structuredClone(this._current);for(let i=0;i<20;i++){if(e=structuredClone(r),n=this._calculator.updateState(e),null==n)return console.error(`#transitionToStateAt - Problem at t=${t}, aborting`),void(this._running=!1);r=n}this._current=r,this.updateWithCurrent()}updateWithCurrent(){const t=this.toCartesian(this._current.theta1,this._current.phi1,this._current.theta2,this._current.phi2),e=[{x:0,y:0,z:0},{x:t[0],y:t[1],z:t[2]},{x:t[3],y:t[4],z:t[5]}],n=Xi(e[0],e[1],20),r=Xi(e[1],e[2],20),i=this.pointsToPaths(this._streak1.push({point:e[1],valid:!0}),this._streakChunkSize),s=this.pointsToPaths(this._streak2.push({point:e[2],valid:!0}),this._streakChunkSize);this._g.children=[new ie(n,!1,!1,this._pathStyle),new ie(r,!1,!1,this._pathStyle),new qt(e[0],3,this._circleStyle),new qt(e[1],3*Math.cbrt(this.config.data.parameters.m1),this._circleStyle),new qt(e[2],3*Math.cbrt(this.config.data.parameters.m2),this._circleStyle),...i.map((t,e)=>new ie(t.path,!1,!1,this.createStreakStyle(1-this._streakChunkGradientStep*e),t.visible)),...s.map((t,e)=>new ie(t.path,!1,!1,this.createStreakStyle(1-this._streakChunkGradientStep*e),t.visible))]}pointsToPaths(t,e){const n=[];for(let r=this._streakOffset-1;r<t.length;r+=e){const i=t.slice(r,r+e);i.some(t=>!t.valid)?n.push({path:[{x:0,y:0,z:0},{x:1,y:0,z:0}],visible:!1}):n.push({path:i.map(t=>t.point),visible:!0})}return n}createStreakStyle(t){return oe().strokeWidth(.6*t).stroke("#797").strokeOpacity(t).get()}toCartesian(t,e,n,r){const i=this.config.data.parameters.l1*Math.sin(t)*Math.cos(e),s=-this.config.data.parameters.l1*Math.cos(t),o=this.config.data.parameters.l1*Math.sin(t)*Math.sin(e);return[i,s,o,i+this.config.data.parameters.l2*Math.sin(n)*Math.cos(r),s-this.config.data.parameters.l2*Math.cos(n),o+this.config.data.parameters.l2*Math.sin(n)*Math.sin(r)]}}new class{constructor(){this._keyboardAnimationManager=new bt,this._abortWorldTick$=new j,this._newWorldSubscription=new $i,this._currentWorldIdSubscriontion=new $i,this._worldTitleArea=document.getElementById("worldTitle"),this._cameraInfoArea=document.getElementById("cameraInfo"),console.log("#constructor(Start) - DoublePendulum3D - Version: 1.0.0"),function(t){const e="app-version",n=localStorage.getItem(e);n!==t&&(console.info(`#configVersionCheck - storedVersion=${n} does not match appVersion=${t}`),localStorage.clear(),caches.keys().then(t=>{t.forEach(t=>{caches.delete(t)})}),localStorage.setItem(e,t),window.location.reload())}("1.0.0"),this._stageMode=Wi();const t=document.getElementById("main");if(null==t)return void console.error("Critical: Main div element not found");this.setupStage(t),this._stage=new Ni("main"),this._camera=new mt,this._cameraControl=new wt(this._camera),this._world=null,this._config=new yt({currentWorldId:1,worldTick:40},"mainConfig"),this._currentWorldId$=new H(this._config.data.currentWorldId);const e=this._stageMode==zi.IMMERSIVE;this.handlePhysicalKeyboardEvents(!e),e||(this.appendVirtualKeyboard(),this.updateCameraInfo()),this.runWorld()}setupStage(t){const e=document.getElementById("info"),n=document.getElementById("virtual-keyboard-container");switch(this._stageMode){case zi.DEFAULT:t.classList.add("main--default"),null==e||e.classList.add("info--default");break;case zi.SMALL:t.classList.add("main--small"),null==e||e.classList.add("info--small");break;case zi.IMMERSIVE:console.log("Fullscreen detected - going immersive!"),t.classList.add("main--immersive"),null==e||e.classList.add("element--gone"),null==n||n.classList.add("element--gone")}window.addEventListener("resize",()=>{Wi()!==this._stageMode&&window.location.reload()})}handlePhysicalKeyboardEvents(t){t?document.addEventListener("keydown",t=>{this.signalPhysicalEventToVirtualKeyboard(t.key),this.handleKeyPress(t.key)},!1):document.addEventListener("keydown",t=>{this.handleKeyPress(t.key)},!1)}appendVirtualKeyboard(){fetch("virtual-keyboard.html").then(t=>t.text()).then(t=>{const e=document.getElementById("virtual-keyboard-container");null!=e?e.innerHTML=t:console.error("virtual-keyboard-container not found to append virtual keyboard html")}).then(t=>{Array.from(document.getElementsByClassName("virtual-key")).forEach(t=>function(t,e,n){const r=t.dataset.key||"",i=Ri(Fi(t,"mousedown"),Fi(t,"touchstart")),s=Ri(Fi(t,"mouseup"),Fi(t,"touchend"),Fi(t,"mouseleave"));var o;Fi(t,"touchstart").subscribe(t=>t.preventDefault()),i.pipe((o=()=>(n(e,r),J(300,50).pipe(pt(s))),tt(function(t,e){var n=null,r=!1,i=function(){return r&&!n&&e.complete()};t.subscribe(et(e,function(t){null==n||n.unsubscribe(),dt(o()).subscribe(n=et(e,function(t){return e.next(t)},function(){n=null,i()}))},function(){r=!0,i()}))}))).subscribe(()=>{n(e,r)})}(t,this,this.handleKeyPressViaVirtualKeyboard)),this._currentWorldIdSubscriontion.set(this._currentWorldId$.subscribe(t=>{for(let e=0;e<10;e++){const n=document.getElementById(`virtual-key-${e}`);e==t?null==n||n.classList.add("virtual-key--selected"):null==n||n.classList.remove("virtual-key--selected")}}))})}signalPhysicalEventToVirtualKeyboard(t){this._keyboardAnimationManager.triggerAnimation(t)}handleKeyPressViaVirtualKeyboard(t,e){t.handleKeyPress(e)}handleKeyPress(t){var e,n;if(!this._cameraControl.onNextEvent(t))switch(t){case"":console.log("invalid key");case"Escape":null===(e=this._world)||void 0===e||e.resetConfig(),null===(n=this._world)||void 0===n||n.mountCamera(this._camera);break;case"1":this.switchWorld(1);break;case"2":this.switchWorld(2)}}switchWorld(t){console.log(`switching world to (${t})`),this._currentWorldId$.next(t),this._config.data.currentWorldId=t,this._abortWorldTick$.next(),this._newWorldSubscription.set(J(100).subscribe(()=>{this.runWorld()}))}runWorld(){var t;null===(t=this._world)||void 0===t||t.onDestroy(),this._world=this.createWorldById(this._config.data.currentWorldId),this._world.mountCamera(this._camera),this.updateWorldTitle(this._world.name),console.log(`                       ${"_".repeat(this._world.name.length+2)}`),console.log(`-> initializing world | ${this._world.name} |`),console.log(`                       ${"".repeat(this._world.name.length+2)}`);const e=new fe(this._world,this._camera,function(t){var e;const n=null!==(e=window.devicePixelRatio)&&void 0!==e?e:1;switch(t){case zi.DEFAULT:return 1280;case zi.SMALL:return 800;case zi.IMMERSIVE:return window.innerWidth*n}}(this._stageMode),function(t){var e;const n=null!==(e=window.devicePixelRatio)&&void 0!==e?e:1;switch(t){case zi.DEFAULT:return 720;case zi.SMALL:return 450;case zi.IMMERSIVE:return window.innerHeight*n}}(this._stageMode),this._config.data.worldTick);this._stage.registerShapes(e.shapes,this._world.backgroundColor),Q(this._config.data.worldTick).pipe(pt(this._abortWorldTick$)).subscribe({next:()=>{var t;null===(t=this._world)||void 0===t||t.tick()},complete:()=>{console.log("Old world completed - unregistering shapes"),this._stage.unregisterShapes(e.shapes.id)}})}createWorldById(t){switch(t){case 1:return new Ji;case 2:return new Yi;default:return console.error("Unnown world id",t),new Ji}}updateWorldTitle(t){null!=this._worldTitleArea&&(this._worldTitleArea.textContent=`World: ${t} (${this._config.data.currentWorldId})`)}updateCameraInfo(){this._camera.state$.subscribe({next:t=>{const e=`Perspective: Position (X ${(n=t).position.x.toFixed(1)}, Y ${n.position.y.toFixed(1)}, Z ${n.position.z.toFixed(1)}), Angle-X ${(180*n.angleX/Math.PI).toFixed(0)}, Angle-Y ${(180*n.angleY/Math.PI).toFixed(0)}, Angle-Z ${(180*n.angleZ/Math.PI).toFixed(0)})`;var n;null!=this._cameraInfoArea&&(this._cameraInfoArea.textContent=e)}})}}})();