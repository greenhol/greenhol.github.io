(()=>{"use strict";function t(t){return t.xMax-t.xMin}class e{static copy(t){return new e(t.resolution,t.range)}constructor(t,e){this._resolution=t,this._width=t.width,this._height=t.height,this.setRange(e),console.log(`Grid (${this._width} x ${this._height}) created for resolution: ${t.description}`)}updateRange(t){this.setRange(t),console.log(`Grid (${this._width} x ${this._height}) range set to: ${t.xMin} -> ${t.xMax} and yCenter: ${t.yCenter}`)}getIndex(t,e){return e*this._width+t}pixelToMath(t,e){return[this._xMin+t/this.width*this._xDiff,this._yMax-e/this.height*this._yDiff]}mathToPixel(t,e){return[Math.round((t-this._xMin)*this.width/this._xDiff),Math.round((this._yMax-e)*this.height/this._yDiff)]}get resolution(){return this._resolution}get width(){return this._width}get height(){return this._height}get size(){return this._width*this._height}get ratio(){return this._width/this._height}get range(){return this._range}get xDiff(){return this._xDiff}get blueprint(){return{resolution:{width:this._width,height:this.height,description:`${this._resolution.description} (Copy)`},range:this._range}}toString(){return`width: ${this.width}, height:${this.height} -> size ${this.size}`}setRange(e){this._range=e,this._yDiff=t(e)/this.ratio,this._xMin=e.xMin,this._xMax=e.xMax,this._xDiff=t(e),this._yMin=e.yCenter-this._yDiff/2,this._yMax=e.yCenter+this._yDiff/2}}class i extends e{static resolutionWithMargin(t,e){return{width:t.width+2*e,height:t.height+2*e,description:`${t.description} + buffer:${e}`}}static copyWithMargin(t){return new i(t.baseResolution,t.baseRange,t.margin)}constructor(e,n,h){const s=i.resolutionWithMargin(e,h).width/e.width,r=t(n),o=n.xMin+t(n)/2;super(i.resolutionWithMargin(e,h),{xMin:o-r/2*s,xMax:o+r/2*s,yCenter:n.yCenter}),this._baseResolution=e,this._baseRange=n,this._margin=h}getIndexForCenterArea(t,e){return super.getIndex(t+this._margin,e+this._margin)}get margin(){return this._margin}get withMarginBlueprint(){return{baseResolution:{width:this._baseResolution.width,height:this._baseResolution.height,description:`${this._baseResolution.description} (Copy)`},baseRange:this._baseRange,margin:this._margin}}}var n,h,s,r;!function(t){t.START="START"}(n||(n={})),function(t){t.UPDATE="UPDATE",t.RESULT="RESULT"}(h||(h={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ISOLATED=1]="ISOLATED",t[t.ISOLATED_BIG=2]="ISOLATED_BIG"}(s||(s={})),function(t){t[t.LOWER=0]="LOWER",t[t.UPPER=1]="UPPER",t[t.CENTER=2]="CENTER",t[t.BOUNDS=3]="BOUNDS",t[t.BOUNDS_BY_CUBIC=4]="BOUNDS_BY_CUBIC",t[t.BOUNDS_BY_QUINTIC=5]="BOUNDS_BY_QUINTIC",t[t.BOUNDS_BY_SEPTIC=6]="BOUNDS_BY_SEPTIC",t[t.BOUNDS_BY_TRIG=7]="BOUNDS_BY_TRIG"}(r||(r={})),self.onmessage=t=>{const{type:e,data:r}=t.data;if(e===n.START){const t=i.copyWithMargin(r.gridBlueprint);let e=function(t,e){const i=new Float64Array(t.size);for(let n=0;n<t.height;n++)for(let h=0;h<t.width;h++)i[t.getIndex(h,n)]=Math.random()<e?0:1;return i}(t,r.p);switch(r.type){case s.ISOLATED:e=function(t,e){for(let i=0;i<e.height;i++)for(let n=0;n<e.width;n++)if(0==t[e.getIndex(n,i)]){if(n>0&&0==t[e.getIndex(n-1,i)]){t[e.getIndex(n,i)]=1;continue}const h=i-1;for(let s=-1;s<=1;s++){const r=n+s;h>=0&&r>=0&&r<e.width&&0==t[e.getIndex(r,h)]&&(t[e.getIndex(n,i)]=1)}}return t}(e,t);break;case s.ISOLATED_BIG:e=function(t,e){for(let i=0;i<e.height;i++)for(let n=0;n<e.width;n++)if(0==t[e.getIndex(n,i)]){if(n>0&&0==t[e.getIndex(n-1,i)]){t[e.getIndex(n,i)]=1;continue}if(n>1&&0==t[e.getIndex(n-2,i)]){t[e.getIndex(n,i)]=1;continue}let h=i-2;for(let s=-2;s<=2;s++){const r=n+s;h>=0&&r>=0&&r<e.width&&0==t[e.getIndex(r,h)]&&(t[e.getIndex(n,i)]=1)}h=i-1;for(let s=-2;s<=2;s++){const r=n+s;h>=0&&r>=0&&r<e.width&&0==t[e.getIndex(r,h)]&&(t[e.getIndex(n,i)]=1)}}for(let i=0;i<e.height;i++)for(let n=0;n<e.width;n++)0==t[e.getIndex(n,i)]&&(i>0&&n>0&&(t[e.getIndex(n-1,i-1)]=0),n>0&&(t[e.getIndex(n-1,i)]=0),i>0&&(t[e.getIndex(n,i-1)]=0));return t}(e,t)}self.postMessage({type:h.RESULT,result:e},[e.buffer])}}})();